# פרומפט מוכן: מדריך ארכיטקטורה שכבתית – CodeBot

מסמך זה כולל פרומפט ״להדבקה״ לכלי AI (Claude/Cloud Code/ChatGPT וכו׳) כדי להפיק מדריך ארכיטקטורה שכבתית בדומה ל־4 החלקים שב־PR.

> שים/שימי לב: אין לכלול סודות/טוקנים/PII בפרומפט. אם יש קישורים פרטיים – החלף ב־PLACEHOLDER.

---

## איך משתמשים
1) פתח/י את כלי ה-AI (Claude / ChatGPT / Cloud Code).  
2) הדבק/י את הפרומפט המלא מטה (סעיף “הפרומפט המלא”).  
3) הוסף/י בסוף הפרומפט קישורים/קבצים רלוונטיים מהריפו (read-only):
   - קובצי קוד עיקריים (handlers/, services/, database/, utils.py) – אופציונלי.
   - קישורים לתיעוד פרויקט: https://amirbiron.github.io/CodeBot/  
4) בקש/י תשובה בעברית.  
5) בקש/י תוצרים ב־4 חלקים (Part 1–4) בפורמט Markdown.

---

## הפרומפט המלא (להדבקה)

הוראות מערכת/תפקיד:
את/ה עוזר/ת ארכיטקטורה בכיר/ה. המטרה: לנסח מדריך ארכיטקטורה שכבתית לפרויקט CodeBot בעברית, בשפה פשוטה וברורה, כולל מיפוי קבצים, דוגמאות before/after, וכללי הפרדה. אל תשתמש/י בידע חיצוני שאינו נשען על הקוד/מסמכים שסופקו. אל תכלול/י סודות או מזהים רגישים. שמור/י על טון עניו, ושים/י דגש על פתרון פשוט ומהימן תחילה.

הקשר כללי על הפרויקט (תמציתי):
- CodeBot הוא בוט Telegram לשמירה וארגון קטעי קוד (Snippets), עם MongoDB, חיפוש, תגיות, אינטגרציות (GitHub/Drive), ו־WebApp משלים.  
- עץ קבצים עיקרי: handlers/ (טלגרם), services/ (לוגיקה שימושית), database/ (גישה ל־DB), utils.py (כלי עזר כלליים – כיום מנופח).  
- קיימות יחידות קוד ענקיות (“מונסטרים”) שיש לפרק: conversation_handlers.py, bot_handlers.py, main.py, utils.py.

עקרונות ארכיטקטורה נדרשים:
- מודל 4 שכבות + Shared:  
  Presentation (Handlers) → Application (Services/Orchestration) → Domain (Business Logic Pure) → Infrastructure (DB/IO/HTTP), ובנוסף Shared ל־utilities כלליים.
- חוקי תלות: שכבה פונה רק לשכבה שמתחתיה; Domain טהור ללא תלויות חיצוניות; Repositories מממשים Interfaces שמוגדרים ב־Domain.
- Handlers “דקים”: I/O בלבד; ללא גישה ישירה ל־DB/Entities/Business Logic.
- Services מתזמרים: DTOs פנימה, Entities/תוצאות החוצה; ללא SQL/Queries; ללא תלות ב־Telegram.
- Domain: פונקציות מחושקות/Entities/Value Objects/Validators – Python טהור; ללא I/O.
- Infrastructure: פרטי טכנולוגיה (Mongo/HTTP/Files/Cache/Secrets) ממומשים מאחורי ממשקים.

תוצרים נדרשים (4 חלקים, בפורמט Markdown מסודר):
1) חלק 1 – ניתוח מצב קיים וריחות קוד:  
   - ממצאים עיקריים (ערבוב שכבות, utils “God Object”, מונסטרים).  
   - דוגמאות קוד קצרות (לפחות 2–3) שממחישות בעיות.
2) חלק 2 – הארכיטקטורה המוצעת ומיפוי קבצים:  
   - תרשים שכבות (ASCII).  
   - עץ תיקיות מוצע תחת `src/` (Presentation/Application/Domain/Infrastructure/Shared).  
   - טבלת מיפוי: קובץ נוכחי → יעד חדש (רק עיקריים).  
   - דוגמאות import נכונות/שגויות.
3) חלק 3 – כללי הפרדה ודוגמאות before/after:  
   - 5–7 “כללי זהב” (Handlers לא מדברים DB; Services מתזמרים בלבד; Domain טהור; Repos בלי Business Logic; DTOs).  
   - דוגמאות before/after קצרות לקבצים מרכזיים (למשל save_flow).  
   - Checklists לכל שכבה + Testing strategy (unit/application/integration).
4) חלק 4 – מפת דרכים לרפקטור:  
   - 5 שלבים הדרגתיים עם סיכוני Rollback.  
   - שלב “פיצול utils.py” לתת-שלבים (כולל wrapper לתאימות אחורה).  
   - Hooks/בדיקות אוטומטיות לאכיפת הפרות שכבות (רעיון/סקיצה).  
   - דוגמה זרימה מלאה end-to-end אחרי המודולריזציה (למשל /save).

אילוצים/מדיניות משלימות:
- כתיבה בעברית, בשפה פשוטה.  
- אין להציג/לייצר סודות/מפתחות/PII.  
- אם חסר מידע – כתוב/י הנחה מפורשת.  
- הימנע/י מקוד ארוך; העדף/י מקטעים קצרים עם הסבר.  
- קשר ל־Docs: “CodeBot – Project Docs” (`https://amirbiron.github.io/CodeBot/`).  
- שמור/י תאימות לאחור בתכנון (wrappers, feature flags, fallback), והדגש/י rollout הדרגתי.

פורמט יציאה מדויק:
- השתמש/י בכותרות Markdown ברורות (“###”/“##”).  
- בכל חלק: תקציר תמציתי (3–5 נקודות), ולאחר מכן פירוט.  
- טבלאות קצרות וקריאות (Mapping/Dependencies).  
- מקטע “Next Steps” בסוף כל חלק.  
- בסוף: רשימת יתרונות/סיכונים/המלצות מעשיות.

Deliverable validation (Self-check לפני מסירה):
- [ ] יש 4 חלקים מלאים, בעברית, בפורמט Markdown.  
- [ ] יש דוגמאות before/after קצרות.  
- [ ] יש עץ תיקיות + טבלת מיפוי עיקרית.  
- [ ] יש Checklists + Testing strategy.  
- [ ] יש מפת דרכים הדרגתית + Rollback plan.  
- [ ] אין סודות/PII; שמירה על תאימות לאחור.

סיים/י בהדגשת ROI (מהירות פיתוח, פחות באגים, בדיקות קלות, Onboarding מהיר) ובצעדי אימוץ הדרגתיים (פיילוט קטן, מפה לשבועיים הקרובים).

---

## טיפים לשימוש
- אם לכלי יש “attach files” – צרף/י קבצים רלוונטיים לקריאה בלבד (אין הרצה בזמן build).  
- בקש/י מהמודל לצמצם קטעי קוד ארוכים לדוגמאות מינימליות.  
- בקש/י דיוק רכיב ההפרדות (מה מותר/אסור בכל שכבה) עם דוגמאות יבוא.
