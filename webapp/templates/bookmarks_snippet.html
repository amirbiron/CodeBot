<!-- 
    Bookmarks System HTML Snippet
    ×œ×”×•×¡×¤×” ×‘×§×•×‘×¥ view_file.html ××• ×‘×›×œ ×¢××•×“ ×©××¦×™×’ ×§×•×“
-->

<!-- Hidden file ID for JavaScript -->
<input type="hidden" id="fileId" value="{{ file.id }}">

<!-- Bookmarks Toggle Button -->
<button 
    id="toggleBookmarksBtn" 
    class="bookmarks-toggle-btn"
    aria-label="×¤×ª×— ×¤×× ×œ ×¡×™×× ×™×•×ª"
    aria-expanded="false"
    aria-controls="bookmarksPanel"
    title="×¡×™×× ×™×•×ª">
    <span aria-hidden="true">ğŸ”–</span>
    <span id="bookmarkCount" class="bookmark-count" style="display: none;">0</span>
</button>

<!-- Bookmarks Panel -->
<aside 
    id="bookmarksPanel" 
    class="bookmarks-panel"
    role="complementary"
    aria-label="×¤×× ×œ ×¡×™×× ×™×•×ª">
    
    <!-- Panel Header -->
    <div class="bookmarks-panel-header">
        <h2>
            <span aria-hidden="true">ğŸ”–</span>
            ×¡×™×× ×™×•×ª ×‘×§×•×‘×¥
            <button id="bookmarksInfoBtn" class="info-inline-btn" title="××™×š ××©×ª××©×™×" aria-label="××™×š ××©×ª××©×™×">â„¹ï¸</button>
        </h2>
        <div class="bookmarks-panel-actions">
            <div class="color-picker" title="×¦×‘×¢ ×‘×¨×™×¨×ª ××—×“×œ" aria-label="×¦×‘×¢ ×‘×¨×™×¨×ª ××—×“×œ" style="display:inline-flex;align-items:center;gap:6px;">
                <span style="font-size:12px;opacity:0.85">×¦×‘×¢ ×‘×¨×™×¨×ª ××—×“×œ:</span>
                <button class="color-swatch" data-default-color="yellow" style="width:16px;height:16px;border-radius:50%;border:1px solid rgba(0,0,0,0.2);background: var(--bookmark-yellow);"></button>
                <button class="color-swatch" data-default-color="red" style="width:16px;height:16px;border-radius:50%;border:1px solid rgba(0,0,0,0.2);background: var(--bookmark-red);"></button>
                <button class="color-swatch" data-default-color="green" style="width:16px;height:16px;border-radius:50%;border:1px solid rgba(0,0,0,0.2);background: var(--bookmark-green);"></button>
                <button class="color-swatch" data-default-color="blue" style="width:16px;height:16px;border-radius:50%;border:1px solid rgba(0,0,0,0.2);background: var(--bookmark-blue);"></button>
                <button class="color-swatch" data-default-color="purple" style="width:16px;height:16px;border-radius:50%;border:1px solid rgba(0,0,0,0.2);background: var(--bookmark-purple);"></button>
                <button class="color-swatch" data-default-color="orange" style="width:16px;height:16px;border-radius:50%;border:1px solid rgba(0,0,0,0.2);background: var(--bookmark-orange);"></button>
                <button class="color-swatch" data-default-color="pink" style="width:16px;height:16px;border-radius:50%;border:1px solid rgba(0,0,0,0.2);background: var(--bookmark-pink);"></button>
            </div>
            <button 
                id="exportBookmarks"
                title="×™×™×¦× ×¡×™×× ×™×•×ª"
                aria-label="×™×™×¦× ×¡×™×× ×™×•×ª ×œ×§×•×‘×¥ JSON">
                <span aria-hidden="true">ğŸ’¾</span>
                ×™×™×¦×
            </button>
            <button 
                id="clearAllBookmarks"
                title="××—×§ ×”×›×œ"
                aria-label="××—×§ ××ª ×›×œ ×”×¡×™×× ×™×•×ª">
                <span aria-hidden="true">ğŸ—‘ï¸</span>
                × ×§×” ×”×›×œ
            </button>
            
            <button 
                id="closePanel"
                onclick="document.getElementById('bookmarksPanel').classList.remove('open')"
                title="×¡×’×•×¨"
                aria-label="×¡×’×•×¨ ×¤×× ×œ ×¡×™×× ×™×•×ª">
                <span aria-hidden="true">âœ•</span>
            </button>
        </div>
    </div>
    
    <!-- Bookmarks List -->
    <div class="bookmarks-list" role="list">
        <!-- Bookmarks will be dynamically inserted here -->
        <div class="empty-state">
            <p>××™×Ÿ ×¢×“×™×™×Ÿ ×¡×™×× ×™×•×ª ×‘×§×•×‘×¥ ×–×”</p>
            <p>×œ×—×¥ ×¢×œ ××¡×¤×¨ ×©×•×¨×” ×›×“×™ ×œ×”×•×¡×™×£ ×¡×™×× ×™×™×”</p>
        </div>
    </div>
</aside>

<!-- Include Styles -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/bookmarks.css') }}">

<!-- Include JavaScript -->
<script src="{{ url_for('static', filename='js/bookmarks.js') }}" defer></script>

<!-- Help tip footer removed per issue comment request -->

<!-- Inline styles for immediate rendering (optional) -->
<style>
    /* Critical styles for immediate rendering */
    .bookmarks-toggle-btn {
        position: fixed;
        top: 1.5rem; /* ×”×—×–×¨×” ×œ××¢×œ×” */
        right: 20px;
        z-index: 1000;
        background: white;
        border: 2px solid #ffd700;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }
    
    .bookmarks-panel {
        position: fixed;
        top: 0;
        right: -400px;
        width: 400px;
        height: 100vh;
        background: white;
        box-shadow: -4px 0 20px rgba(0, 0, 0, 0.15);
        transition: right 0.3s ease;
        z-index: 999;
    }
    
    .bookmarks-panel.open {
        right: 0;
    }
</style>

<script>
// 1ï¸âƒ£ ×œ×—×™×¦×” ×××•×©×›×ª ×¢×œ ×”×›×¤×ª×•×¨ ×”×¦×£: ×”×§×˜×Ÿ ×©×§×™×¤×•×ª
document.addEventListener('DOMContentLoaded', function(){
  try {
    var btn = document.getElementById('toggleBookmarksBtn');
    if (btn) {
      var longTimer = null;
      var isDown = false;
      var startLongPress = function(){
        longTimer = setTimeout(function(){ btn.classList.add('mini'); }, 350);
      };
      var clearAll = function(){
        if (longTimer) { clearTimeout(longTimer); longTimer = null; }
        btn.classList.remove('mini');
        isDown = false;
      };
      btn.addEventListener('mousedown', function(){ isDown = true; startLongPress(); }, {passive:true});
      btn.addEventListener('touchstart', function(){ isDown = true; startLongPress(); }, {passive:true});
      ['mouseup','mouseleave','touchend','touchcancel'].forEach(function(ev){ btn.addEventListener(ev, clearAll, {passive:true}); });
    }
  } catch(_){}

  // 2ï¸âƒ£ ×‘××¡×š ××œ× â€“ ×”×›×¤×ª×•×¨ ××•×§×˜×Ÿ ×›×‘×¨×™×¨×ª ××—×“×œ
  try {
    var codeCard = document.getElementById('codeCard');
    var btn2 = document.getElementById('toggleBookmarksBtn');
    if (codeCard && btn2) {
      var onFs = function(){
        var inFs = (document.fullscreenElement === codeCard);
        if (inFs) {
          // ×ª××™×“ ×”×¦×’ ×‘××¡×š ××œ× + ×‘××¦×‘ ××•×§×˜×Ÿ
          btn2.style.display = 'flex';
          btn2.classList.add('mini');
        } else {
          // ×©×—×–×•×¨ ××¦×‘ ×”×¦×’×” ×œ×¤×™ ×”×”×¢×“×¤×” ×”××§×•××™×ª
          try {
            var vis = localStorage.getItem('bookmarks_toggle_btn_visible');
            btn2.style.display = (vis === '0') ? 'none' : 'flex';
          } catch(_) { btn2.style.display = 'flex'; }
          btn2.classList.remove('mini');
        }
      };
      document.addEventListener('fullscreenchange', onFs);
      onFs();
    }
  } catch(_){}

  // 3ï¸âƒ£ ×›×¤×ª×•×¨ â„¹ï¸ â€“ ×¤×•×ª×— ××™×“×¢
  try {
    var infoBtn = document.getElementById('bookmarksInfoBtn');
    if (infoBtn) {
      infoBtn.addEventListener('click', function(){
        var overlay = document.createElement('div');
        overlay.className = 'bookmarks-info-overlay';
        overlay.innerHTML = '\
<div class="bookmarks-info-modal" role="dialog" aria-modal="true" aria-labelledby="bm-info-title">\
  <header>\
    <h3 id="bm-info-title">â„¹ï¸ ××™×š ××©×ª××©×™×</h3>\
    <button class="close-btn" aria-label="×¡×’×•×¨">âœ•</button>\
  </header>\
  <div class="content">\
    <p><b>ğŸ·ï¸ ××™×š ××©×ª××©×™× ×‘×¡×™×× ×™×•×ª:</b></p>\
    <ul>\
      <li>×”×§×© ×¢×œ ××¡×¤×¨ ×©×•×¨×” ×›×“×™ ×œ×”×•×¡×™×£ ×¡×™×× ×™×™×”.</li>\
      <li>×œ×—×¥ ×©×•×‘ ×›×“×™ ×œ×”×¡×™×¨.</li>\
      <li>× ×™×ª×Ÿ ×œ×‘×—×•×¨ ×¦×‘×¢ ×©×•× ×” ×œ××™×•×Ÿ × ×•×—.</li>\
    </ul>\
    <p><b>ğŸ’¡ ×”×¡×™×× ×™×•×ª × ×©××¨×•×ª ××•×˜×•××˜×™×ª ×œ×›×œ ×§×•×‘×¥.</b></p>\
    <p><b>âš™ï¸ ××¤×©×¨ ×œ×”×¡×ª×™×¨ ××ª ×›×¤×ª×•×¨ ×”×¡×™×× ×™×•×ª ×“×¨×š ×”×”×’×“×¨×•×ª ×©×œ ×”-WebApp.</b></p>\
    <p><b>â„¹ï¸ ×œ××™×“×¢ ××œ× ×•×”×¡×‘×¨×™× × ×•×¡×¤×™× â€“ ×”×©×ª××© ×‘×›×¤×ª×•×¨ â€×”×¡×‘×¨ ×¢×œ ×”×‘×•×˜" ×‘×ª×•×š ×”×‘×•×˜ ×¢×¦××•.</b></p>\
  </div>\
  <footer>\
    <button class="close-btn">×¡×’×•×¨</button>\
  </footer>\
</div>';
        function close(){ try { document.body.removeChild(overlay); } catch(_){} }
        overlay.addEventListener('click', function(e){ if (e.target === overlay) close(); });
        overlay.querySelectorAll('.close-btn').forEach(function(b){ b.addEventListener('click', close); });
        document.body.appendChild(overlay);
      });
    }
  } catch(_){}
});
</script>
