{% extends "base.html" %}

{% block title %}注 拽抓 砖 - Code Keeper Bot{% endblock %}

{% from "components/editor_components.html" import image_uploader %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/split-view.css') }}?v={{ static_version }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/md_preview.bundle.css') }}?v={{ static_version }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/file-editor.css') }}?v={{ static_version }}">
{% endblock %}

{% block content %}
<h1 class="page-title">注 拽抓 砖</h1>

<div class="glass-card">
  {% if error %}
  <div class="alert alert-error">{{ error }}</div>
  {% endif %}
  {% if success %}
  <div class="alert alert-success">{{ success }}</div>
  {% endif %}

  {% set ffm_config = {
    "mode": "create",
    "fileId": none,
    "selectors": {
      "form": "#uploadForm",
      "editorContainer": "#editorContainer",
      "languageSelect": "#languageSelect",
      "filenameInput": "#fileNameInput",
      "imageUploadContainer": "#image-upload-widget",
      "sourceUrlContainer": "#source-url-group"
    },
    "initialData": {
      "language": (language_value or "text"),
      "existingImages": []
    }
  } %}

  <form id="uploadForm"
        method="post"
        enctype="multipart/form-data"
        data-file-form-config='{{ ffm_config | tojson }}'
        data-upload-success="{{ '1' if success else '0' }}"
        data-reset-draft="{{ '1' if clear_local_draft else '0' }}"
        style="display: grid; gap: 1rem;">
    <div>
      <label for="fileNameInput">砖 拽抓</label>
      <input id="fileNameInput" type="text" name="file_name" placeholder="example.py" value="{{ file_name_value or '' }}" class="form-field">
      <small class="markdown-image-hint">
        转 爪专祝 转转 专拽 拽爪 Markdown (.md / .markdown).
      </small>
    </div>

    {{ image_uploader(existing_images=[]) }}
    <div>
      <label>砖驻</label>
      <select id="languageSelect" name="language" class="form-field">
        <option value="text" {% if (language_value or 'text') == 'text' %}selected{% endif %}> 驻 住转</option>
        {% for lang in languages %}
        <option value="{{ lang }}" {% if lang == language_value %}selected{% endif %}>{{ lang }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label>转专</label>
      <input type="text" name="description" placeholder="转专 拽爪专" value="{{ description_value or '' }}" class="form-field">
    </div>
    <div>
      <label>转转</label>
      <input type="text" name="tags" placeholder="#utils, #repo:owner/name" value="{{ tags_value or '' }}" class="form-field">
    </div>
    <div id="livePreviewRoot" class="split-view" data-active-panel="editor">
      <div class="split-toolbar">
        <div class="split-toolbar-controls">
          <button
            type="button"
            class="split-toggle"
            data-action="toggle-live-preview"
            aria-pressed="false"
          >
            <i class="fas fa-columns"></i>
            <span class="split-toggle__text">Live Preview</span>
          </button>
          <span class="split-toolbar-hint">Ctrl+Shift+Enter</span>
        </div>
        <div class="split-tabs" role="tablist" aria-label="转 转爪">
          <button type="button" role="tab" aria-selected="true" data-panel-target="editor">注专</button>
          <button type="button" role="tab" aria-selected="false" data-panel-target="preview">转爪</button>
        </div>
      </div>
      <div class="split-panels">
        <section class="split-panel split-panel--editor" aria-label="专 注专">
          <div id="editorContainer">
            <label for="codeTextarea">拽</label>
            <textarea id="codeTextarea" name="code" rows="18" placeholder="# 拽  转 拽" class="form-field code-field">{{ code_value or '' }}</textarea>
          </div>
        </section>
        <div class="split-resizer" role="separator" aria-label="砖 转 专 驻"></div>
        <section class="split-panel split-panel--preview" aria-label="转爪 ">
          <div class="split-preview-content" data-preview-content aria-live="polite">
            <div class="split-preview-canvas" data-preview-canvas>
              <div class="split-preview-placeholder">
                <p>转爪  转驻注 </p>
                <small>驻注 转 Live Preview  专注  转</small>
              </div>
            </div>
            <div class="split-preview-meta" data-preview-meta></div>
            <p class="split-preview-status" data-preview-status>驻注 转 Live Preview  专转 注  转.</p>
          </div>
        </section>
      </div>
    </div>
    <div class="source-url-block" id="source-url-group">
      <button type="button"
              id="sourceUrlToggle"
              class="source-url-toggle"
              aria-expanded="{{ 'true' if source_url_value else 'false' }}"
              aria-controls="sourceUrlField"
              data-open-label="住转专 拽砖专 拽专"
              data-closed-label="住祝 拽砖专 拽专">
        <span class="source-url-toggle__icon"></span>
        <span class="source-url-toggle__text">{{ '住转专 拽砖专 拽专' if source_url_value else '住祝 拽砖专 拽专' }}</span>
      </button>
      <div class="source-url-field{% if source_url_value %} is-open{% endif %}" id="sourceUrlField" data-open="{{ '1' if source_url_value else '0' }}">
        <label for="sourceUrlInput">拽砖专 拽专</label>
        <input type="url"
               name="source_url"
               id="sourceUrlInput"
               class="source-url-input"
               value="{{ source_url_value or '' }}"
               placeholder="https://github.com/..."
               inputmode="url"
               autocomplete="url">
        <small class="source-url-hint">砖专 拽砖专 拽专 拽 (StackOverflow, GitHub 注)  爪 拽专 拽砖专.</small>
      </div>
      <input type="hidden" name="source_url_touched" id="sourceUrlTouched" value="{{ 'edited' if source_url_value else '0' }}">
    </div>
    <div>
      <label> 注 拽抓</label>
      <input type="file" name="code_file" accept=".txt,.py,.js,.ts,.java,.c,.cpp,.cs,.go,.rs,.rb,.php,.swift,.kt,.html,.css,.sql,.sh,.yaml,.yml,.json,.xml,.md" style="width: 100%;">
      <small style="opacity:.8;"> 专 拽抓, 转 拽专  砖转砖 砖 拽抓  砖驻.</small>
    </div>
    <div class="save-actions">
      <div class="primary-actions">
        <button type="submit" class="btn btn-primary btn-icon"><i class="fas fa-upload"></i> 砖专</button>
        <a href="/files" class="btn btn-secondary btn-icon"><i class="fas fa-arrow-right"></i> </a>
      </div>
      <div class="draft-meta" aria-live="polite">
        <span id="draftSaveStatus" class="draft-status"> 专 砖专</span>
        <button type="button" id="clearDraftBtn" class="btn-clear-draft">拽 </button>
      </div>
    </div>
  </form>
</div>
{% endblock %}
{% block extra_js %}
<script src="{{ url_for('static', filename='js/file-form-manager.js') }}?v={{ static_version }}" defer></script>
<script src="{{ url_for('static', filename='js/upload-page.js') }}?v={{ static_version }}" defer></script>
<script src="{{ url_for('static', filename='js/md_preview.bundle.js') }}?v={{ static_version }}" defer></script>
<script src="{{ url_for('static', filename='js/live-preview.js') }}?v={{ static_version }}" defer></script>
{% endblock %}

