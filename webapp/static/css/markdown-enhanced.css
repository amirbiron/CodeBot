/* ============================================
   עיצוב משופר לקטעים מתקפלים וכרטיסיות הסבר
   ============================================ */

/* === משתנים גלובליים === */
:root {
  --details-border: #e1e4e8;
  --details-bg: #ffffff;
  --details-hover: #f6f8fa;
  --summary-color: #24292e;
  --summary-bg: linear-gradient(to right, #f8f9fa, transparent);
  --summary-arrow-color: #586069;
  --admonition-radius: 8px;
  --animation-speed: 0.3s;
  --admonition-content-bg: rgba(255, 255, 255, 0.8);
  --admonition-content-text: inherit;
  --header-anchor-color: #6c757d;
  --header-anchor-hover: #0366d6;
  --tooltip-bg: rgba(0, 0, 0, 0.8);
  --tooltip-text: white;
}

/* === Dark themes override === */
:root[data-theme="dark"],
:root[data-theme="dim"],
:root[data-theme="nebula"] {
  --details-border: #30363d;
  --details-bg: #0d1117;
  --details-hover: #161b22;
  --summary-color: #c9d1d9;
  --summary-bg: linear-gradient(to right, rgba(22, 27, 34, 0.8), transparent);
  --summary-arrow-color: #8b949e;
  --admonition-content-bg: rgba(0, 0, 0, 0.3);
  --admonition-content-text: #c9d1d9;
  --header-anchor-color: #8b949e;
  --header-anchor-hover: #58a6ff;
  --tooltip-bg: rgba(255, 255, 255, 0.9);
  --tooltip-text: #000;
}

/* === Ocean theme override === */
:root[data-theme="ocean"] {
  --details-border: rgba(49, 130, 206, 0.35);
  --details-bg: rgba(26, 54, 93, 0.85);
  --details-hover: rgba(42, 67, 101, 0.9);
  --summary-color: #ffffff;
  --summary-bg: linear-gradient(to right, rgba(49, 130, 206, 0.15), transparent);
  --summary-arrow-color: rgba(255, 255, 255, 0.65);
  --admonition-content-bg: rgba(26, 54, 93, 0.5);
  --admonition-content-text: #e2e8f0;
  --header-anchor-color: rgba(255, 255, 255, 0.65);
  --header-anchor-hover: #63b3ed;
  --tooltip-bg: rgba(26, 54, 93, 0.95);
  --tooltip-text: #ffffff;
}

/* === Forest theme override === */
:root[data-theme="forest"] {
  --details-border: rgba(72, 187, 120, 0.35);
  --details-bg: rgba(20, 83, 45, 0.85);
  --details-hover: rgba(22, 101, 52, 0.9);
  --summary-color: #ffffff;
  --summary-bg: linear-gradient(to right, rgba(72, 187, 120, 0.15), transparent);
  --summary-arrow-color: rgba(255, 255, 255, 0.65);
  --admonition-content-bg: rgba(20, 83, 45, 0.5);
  --admonition-content-text: #e2e8f0;
  --header-anchor-color: rgba(255, 255, 255, 0.65);
  --header-anchor-hover: #68d391;
  --tooltip-bg: rgba(20, 83, 45, 0.95);
  --tooltip-text: #ffffff;
}

/* === Rose Pine Dawn theme override === */
:root[data-theme="rose-pine-dawn"] {
  --details-border: #dfdad9;
  --details-bg: #faf4ed;
  --details-hover: #f2e9e1;
  --summary-color: #575279;
  --summary-bg: linear-gradient(to right, rgba(242, 233, 225, 0.8), transparent);
  --summary-arrow-color: #9893a5;
  --admonition-content-bg: rgba(250, 244, 237, 0.8);
  --admonition-content-text: #575279;
  --header-anchor-color: #9893a5;
  --header-anchor-hover: #907aa9;
  --tooltip-bg: rgba(87, 82, 121, 0.9);
  --tooltip-text: #faf4ed;
}

/* === High Contrast theme override === */
:root[data-theme="high-contrast"] {
  --details-border: #ffffff;
  --details-bg: #000000;
  --details-hover: #1a1a1a;
  --summary-color: #ffffff;
  --summary-bg: linear-gradient(to right, rgba(255, 255, 255, 0.1), transparent);
  --summary-arrow-color: #ffffff;
  --admonition-content-bg: rgba(0, 0, 0, 0.8);
  --admonition-content-text: #ffffff;
  --header-anchor-color: #ffffff;
  --header-anchor-hover: #ffff00;
  --tooltip-bg: #ffffff;
  --tooltip-text: #000000;
}

/* === Classic theme override === */
:root[data-theme="classic"] {
  --details-border: #e1e4e8;
  --details-bg: #ffffff;
  --details-hover: #f6f8fa;
  --summary-color: #24292e;
  --summary-bg: linear-gradient(to right, #f8f9fa, transparent);
  --summary-arrow-color: #586069;
  --admonition-content-bg: rgba(255, 255, 255, 0.8);
  --admonition-content-text: inherit;
  --header-anchor-color: #6c757d;
  --header-anchor-hover: #0366d6;
  --tooltip-bg: rgba(0, 0, 0, 0.8);
  --tooltip-text: white;
}

/* === קטעים מתקפלים === */
.markdown-details {
  margin: 1rem 0;
  border: 1px solid var(--details-border);
  border-radius: 8px;
  background: var(--details-bg);
  overflow: hidden;
  transition: box-shadow var(--animation-speed) ease;
}

.markdown-details[open] {
  box-shadow: 0 3px 12px rgba(0, 0, 0, 0.08);
}

.markdown-summary {
  padding: 0.75rem 1rem;
  background: var(--summary-bg);
  cursor: pointer;
  user-select: none;
  font-weight: 600;
  color: var(--summary-color);
  display: flex;
  align-items: center;
  transition: background-color var(--animation-speed) ease;
  position: relative;
}

.markdown-summary:hover {
  background: var(--details-hover);
}

.markdown-summary::before {
  content: '▶';
  display: inline-block;
  margin-left: 0.5rem;
  font-size: 0.8em;
  transition: transform var(--animation-speed) ease;
  color: var(--summary-arrow-color);
}

.markdown-details[open] .markdown-summary::before {
  transform: rotate(90deg);
}

.markdown-summary::-webkit-details-marker { display: none; }

.details-content {
  padding: 1rem;
  border-top: 1px solid var(--details-border);
  animation: slideDown var(--animation-speed) ease-out;
}

/* === כרטיסיות הסבר === */
.admonition {
  margin: 1.25rem 0;
  border-radius: var(--admonition-radius);
  overflow: hidden;
  border-right: 4px solid;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
}

.admonition-title {
  padding: 0.75rem 1rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.admonition-content {
  padding: 1rem;
  background: var(--admonition-content-bg);
  color: var(--admonition-content-text);
}

.admonition-content > *:first-child { margin-top: 0; }
.admonition-content > *:last-child { margin-bottom: 0; }

/* סוגים */
.admonition-note { border-color: #0969da; background: #ddf4ff; }
.admonition-note .admonition-title { background: #b6e3ff; color: #0550ae; }

.admonition-tip { border-color: #1a7f37; background: #dafbe1; }
.admonition-tip .admonition-title { background: #aceebb; color: #116329; }

.admonition-warning { border-color: #9a6700; background: #fff8c5; }
.admonition-warning .admonition-title { background: #ffec99; color: #7d4e00; }

.admonition-danger { border-color: #cf222e; background: #ffebe9; }
.admonition-danger .admonition-title { background: #ffcecb; color: #a40e26; }

.admonition-info { border-color: #0969da; background: #ddf4ff; }
.admonition-info .admonition-title { background: #b6e3ff; color: #0550ae; }

.admonition-success { border-color: #1a7f37; background: #dafbe1; }
.admonition-success .admonition-title { background: #aceebb; color: #116329; }

/* סוגים נוספים */
.admonition-question { border-color: #8250df; background: #f5f0ff; }
.admonition-question .admonition-title { background: #e6dcfd; color: #5e3db3; }

.admonition-example { border-color: #1f6feb; background: #ddf4ff; }
.admonition-example .admonition-title { background: #b6e3ff; color: #0550ae; }

.admonition-quote { border-color: #57606a; background: #f6f8fa; }
.admonition-quote .admonition-title { background: #eaeef2; color: #24292f; }

.admonition-experimental { border-color: #bf8700; background: #fff1b6; }
.admonition-experimental .admonition-title { background: #ffe08a; color: #7d5b00; }

.admonition-deprecated { border-color: #8b949e; background: #f2f2f2; }
.admonition-deprecated .admonition-title { background: #e6e6e6; color: #555; }

.admonition-todo { border-color: #0969da; background: #e7f5ff; }
.admonition-todo .admonition-title { background: #cfe8ff; color: #0550ae; }

.admonition-abstract { border-color: #6e7781; background: #eef2f7; }
.admonition-abstract .admonition-title { background: #dce3ea; color: #374151; }

/* === אנימציות === */
@keyframes slideDown {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* === RTL === */
[dir="rtl"] .admonition { border-right: none; border-left: 4px solid; }
[dir="rtl"] .markdown-summary::before { margin-left: 0; margin-right: 0.5rem; }

/* === מובייל === */
@media (max-width: 768px) {
  .markdown-details, .admonition { margin: 0.75rem -0.5rem; border-radius: 0; }
  .admonition-content, .details-content { padding: 0.75rem; }
}

/* === מצב כהה מוגדר כעת ב-data-theme למעלה === */

/* === Header anchors & copy buttons accessibility additions === */
/* קישור עוגן (סמל בלבד) שמתווסף אחרי הכותרת; לא מסתיר טקסט הכותרת */
.header-anchor {
  margin-left: 0.5em;
  opacity: 0;
  color: var(--header-anchor-color);
  text-decoration: none;
  font-size: 0.9em;
  transition: opacity 0.2s ease, color 0.2s ease;
  vertical-align: middle;
}
.header-anchor:focus {
  opacity: 1;
  outline: 2px solid var(--header-anchor-hover);
  outline-offset: 2px;
  border-radius: 3px;
}
h1:hover .header-anchor,
h2:hover .header-anchor,
h3:hover .header-anchor,
h4:hover .header-anchor,
h5:hover .header-anchor,
h6:hover .header-anchor { opacity: 1; }
.header-anchor:hover { color: var(--header-anchor-hover); transform: scale(1.05); }

.permalink-tooltip {
  background: var(--tooltip-bg);
  color: var(--tooltip-text);
  padding: 5px 10px;
  border-radius: 4px;
  font-size: 12px;
  white-space: nowrap;
  pointer-events: none;
  transition: opacity 0.3s ease;
  z-index: 1000;
}

/* Visually hidden but accessible to screen readers */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* Contrast/reduced motion adjustments */
/* Dark mode colors now handled via data-theme above */
@media (prefers-contrast: high) {
  .header-anchor:focus { outline-width: 3px; }
}
@media (prefers-reduced-motion: reduce) {
  .header-anchor, .permalink-tooltip { transition: none; }
}

/* Mobile/touch devices: אין hover, לכן האייקון תמיד גלוי ומגדילים hit-area */
@media (hover: none) {
  .header-anchor { opacity: 1; padding: 0.25em; display: inline-flex; align-items: center; }
}
@media (pointer: coarse) {
  .header-anchor { opacity: 1; padding: 0.25em; display: inline-flex; align-items: center; }
}
