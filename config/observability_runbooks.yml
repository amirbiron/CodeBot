version: 1
default: generic_incident_flow
runbooks:
  high_error_rate:
    title: "×–×™× ×•×§ ×‘×©×™×¢×•×¨ ×”×©×’×™××•×ª"
    description: "Playbook ××”×™×¨ ×œ×–×™×”×•×™ ×•×˜×™×¤×•×œ ×‘×”×ª×¨××•×ª error_rate ×’×‘×•×”."
    aliases:
      - error_rate_spike
      - high_errors
    steps:
      - id: focus_timeline
        title: "×”×ª××§×“ ×‘×—×œ×•×Ÿ ×”×–××Ÿ ×”× ×›×•×Ÿ"
        description: "×¤×ª×— Incident Replay ×¡×‘×™×‘ ××•×¢×“ ×”×”×ª×¨××” ×›×“×™ ×œ×”×‘×™×Ÿ ××” ×”×•×‘×™×œ ×œ×–×™× ×•×§."
        action:
          label: "âª Incident Replay"
          type: link
          href: "/admin/observability/replay?timerange=3h&focus_ts={{timestamp}}"
          safety: safe
      - id: run_triage_errors
        title: "××©×•×š /triage errors"
        description: "×”×¨×¥ ××ª ×¤×§×•×“×ª ChatOps ×›×“×™ ×œ×§×‘×œ ×“×’×™××•×ª ×©×’×™××” ×•×”×§×©×¨×™× ××”×œ×•×’×™×."
        action:
          label: "ğŸ§ª /triage errors"
          type: copy
          payload: "/triage errors"
          safety: safe
      - id: open_error_playbook
        title: "×¢×™×™×Ÿ ×‘×¤×œ×™×™×‘×•×§ ×”×©×’×™××•×ª"
        description: "×‘×“×•×§ ××ª ×¡×¢×™×¤×™ ×”× ×™×ª×•×— ×‘-Logging Improvements ×œ×¤× ×™ ×©×™× ×•×™×™× ×‘×§×•×“."
        action:
          label: "ğŸ“˜ Playbook ×©×’×™××•×ª"
          type: link
          href: "/GUIDES/LOGGING_IMPROVEMENTS.md"
          safety: safe
  slow_response:
    title: "Latency ×’×‘×•×” / ×©×™×¨×•×ª ××™×˜×™"
    description: "××¡×œ×•×œ ×˜×™×¤×•×œ ×‘×‘×™×¦×•×¢×™× ××™×˜×™×™× ××• ×‘×–×™× ×•×§×™ P95."
    aliases:
      - latency_spike
      - slow_response_time
    steps:
      - id: replay_latency
        title: "×‘×“×•×§ ××ª ×¦×™×¨ ×”×–××Ÿ"
        description: "×—×¤×© Deployment ×§×¨×•×‘ ××• ××™×¨×•×¢×™ ChatOps ×©××©×¤×™×¢×™× ×¢×œ latency."
        action:
          label: "ğŸ” ×¤×ª×— Replay"
          type: link
          href: "/admin/observability/replay?timerange=6h&focus_ts={{timestamp}}"
          safety: safe
      - id: run_triage_latency
        title: "×”×¨×¥ /triage latency"
        description: "×”×¤×§×•×“×” ××•×©×›×ª ××“×“×™ ×©×¨×ª ×•×—×•×¡×›×ª ×—×™×‘×•×¨ ×™×“× ×™ ×œ×’×¨×¤× ×”."
        action:
          label: "âš™ï¸ /triage latency"
          type: copy
          payload: "/triage latency"
          safety: safe
      - id: review_connection_pooling
        title: "×•×•×“× ×”×’×“×¨×•×ª Connection Pool"
        description: "×—×–×•×¨ ×œ×¡×¢×™×£ ×”-Troubleshooting ×‘××“×¨×™×š Connection Pooling."
        action:
          label: "ğŸ§­ ××“×¨×™×š Latency"
          type: link
          href: "/GUIDES/GUIDE_CONNECTION_POOLING.md"
          safety: safe
  db_connection_issue:
    title: "×›×©×œ×™× ××•×œ ×‘×¡×™×¡ ×”× ×ª×•× ×™×"
    description: "×¦×¢×“×™× ×œ×˜×™×¤×•×œ ×‘-DB connection issue ×œ×¤× ×™ Escalation."
    aliases:
      - db_connection_error
      - db_connection_issue
      - db_conn_error
    steps:
      - id: copy_triage_db
        title: "×”×¨×¥ /triage db"
        description: "××§×‘×œ ××ª ×¡×˜×˜×•×¡ ×”-Pool ×•××¡×¤×¨ ×”×—×™×‘×•×¨×™× ×”×¤×¢×™×œ×™×."
        action:
          label: "ğŸ—„ï¸ /triage db"
          type: copy
          payload: "/triage db"
          safety: caution
      - id: check_backup_runbook
        title: "×‘×“×•×§ ××ª Playbook ×”-DB"
        description: "×•×•×“× ×©×”×’×™×‘×•×™ ×”××—×¨×•×Ÿ ×•×”×‘×“×™×§×•×ª ×”××•×˜×•××˜×™×•×ª ×¢×‘×¨×•."
        action:
          label: "ğŸ› ï¸ ×‘×“×™×§×ª DB"
          type: link
          href: "/GUIDES/BACKUP_RESTORE.md#db-health-check"
          safety: caution
      - id: open_incident_replay_db
        title: "×‘×“×•×§ ×”×§×©×¨×™× × ×•×¡×¤×™×"
        description: "×¤×ª×— ×©×•×‘ ××ª Incident Replay ×›×“×™ ×œ×‘×“×•×§ ×× ×™×© ×”×ª×¨××•×ª × ×•×¡×¤×•×ª ×¡×‘×™×‘ ××•×ª×” ×©×¢×”."
        action:
          label: "â±ï¸ ×”×§×©×¨ × ×•×¡×£"
          type: link
          href: "/admin/observability/replay?timerange=1h&focus_ts={{timestamp}}"
          safety: safe
  # ğŸ’¾ 1. ×‘×¢×™×•×ª ××©××‘×™× (×“×™×¡×§/×–×™×›×¨×•×Ÿ)
  resource_exhaustion:
    title: "×¦×¨×™×›×ª ××©××‘×™× ×§×¨×™×˜×™×ª (CPU/RAM/Disk)"
    description: "×”×©×¨×ª ××ª×§×¨×‘ ×œ×§×¦×” ×’×‘×•×œ ×”×™×›×•×œ×ª. ×¡×›× ×ª ×§×¨×™×¡×” ××™×™×“×™×ª."
    aliases:
      - high_cpu
      - high_memory
      - disk_full
    steps:
      - id: check_system_health
        title: "×”×¨×¥ /triage system"
        description: "×§×‘×œ ×ª××•× ×ª ××¦×‘ ×©×œ Top Processes ×•× ×™×¦×•×œ ×“×™×¡×§."
        action:
          label: "ğŸ’» /triage system"
          type: copy
          payload: "/triage system"
          safety: safe
      - id: clear_cache_suggestion
        title: "×©×§×•×œ × ×™×§×•×™ Cache"
        description: "×× ×”×–×™×›×¨×•×Ÿ ××œ× ×‘×’×œ×œ Redis, ×”×¨×¥ × ×™×§×•×™ Stale ××‘×•×§×¨ ×“×¨×š ChatOps."
        action:
          label: "ğŸ§¹ /cache_clear_stale"
          type: copy
          payload: "/cache_clear_stale"
          safety: caution
  # âš™ï¸ 2. ×ª×•×¨×™× ×•××©×™××•×ª ×¨×§×¢
  worker_lag:
    title: "×¢×™×›×•×‘ ×‘×¢×™×‘×•×“ ××©×™××•×ª ×¨×§×¢"
    description: "×”×ª×•×¨ (Queue) ×¢××•×¡ ××• ×©×”-Worker × ×ª×§×¢."
    aliases:
      - queue_spike
      - worker_down
      - job_failure
    steps:
      - id: check_worker_status
        title: "×¡×˜×˜×•×¡ Sidecar Worker"
        description: "×‘×“×•×§ ×”×× ×”-Worker ××—×•×‘×¨ ×•××—×–×™×¨ /healthz ×ª×§×™×Ÿ."
        action:
          label: "ğŸ‘· /status_worker"
          type: copy
          payload: "/status_worker"
          safety: safe
      - id: check_queue_depth
        title: "×‘×“×•×§ ×¢×•××§ ×ª×•×¨"
        description: "×”×× ×™×© ×”×¦×˜×‘×¨×•×ª ×—×¨×™×’×” ×©×œ ××©×™××•×ª?"
        action:
          label: "ğŸ“Š /triage queues"
          type: copy
          payload: "/triage queues"
          safety: safe
  # â˜ï¸ 3. ×ª×§×œ×•×ª ×¦×“ ×’' (×¡×¤×§×™×)
  external_outage:
    title: "×›×©×œ ×‘×©×™×¨×•×ª ×—×™×¦×•× ×™"
    description: "×©×’×™××•×ª ×‘×—×™×‘×•×¨ ×œ-GitHub, AWS, ××• ×¡×¤×§×™× ××—×¨×™×."
    aliases:
      - github_api_error
      - s3_error
      - external_api_timeout
    steps:
      - id: check_status_pages
        title: "×‘×“×•×§ ×¡×˜×˜×•×¡ ×¡×¤×§×™×"
        description: "×œ×¤× ×™ ×“×™×‘××’, ×‘×“×•×§ ×× ×™×© ×ª×§×œ×” ×¢×•×œ××™×ª ×‘-GitHub ××• ××¦×œ ×¡×¤×§ ×”×¢× ×Ÿ."
        action:
          label: "ğŸŒ GitHub Status"
          type: link
          href: "https://www.githubstatus.com/"
          safety: safe
  generic_incident_flow:
    title: "×¤×œ×™×™×‘×•×§ ×›×œ×œ×™ ×œ×”×ª×¨××•×ª"
    description: "Fallback ×‘×¡×™×¡×™ ×”××ª××™× ×œ×›×œ alert_type ×œ×œ× Runbook ×™×™×¢×•×“×™."
    default: true
    steps:
      - id: open_focus_link
        title: "×¤×ª×— ××ª ×”××™×¨×•×¢ ×‘×œ×•×—"
        description: "×”×§×¤×¥ ××ª ×”×œ×•×— ×œ×˜×•×•×— ×”×–××Ÿ ×©×œ ×”×”×ª×¨××” ×›×“×™ ×œ×¨××•×ª ××“×“×™× ×¨×œ×•×•× ×˜×™×™×."
        action:
          label: "ğŸ“ ×¤×ª×— ×‘×œ×•×—"
          type: link
          href: "/admin/observability?focus_ts={{timestamp}}"
          safety: safe
      - id: run_errors_command
        title: "××©×•×š /errors"
        description: "×¤×§×•×“×ª ×‘×¨×™×¨×ª ××—×“×œ ×©××¦×™×¤×” 5 ×©×’×™××•×ª ××—×¨×•× ×•×ª."
        action:
          label: "ğŸš¨ /errors"
          type: copy
          payload: "/errors"
          safety: safe
      - id: check_recent_deploys
        title: "×‘×“×•×§ ×’×¨×¡××•×ª ××—×¨×•× ×•×ª"
        description: "×”×× ×¢×œ×ª×” ×’×¨×¡×” ×‘-30 ×”×“×§×•×ª ×”××—×¨×•× ×•×ª? ×©×œ×•×£ ××ª ×™×•××Ÿ ×”×“×¤×œ×•×™×™×."
        action:
          label: "ğŸš€ /version_history"
          type: copy
          payload: "/version_history"
          safety: safe
      - id: review_replay
        title: "×‘×“×•×§ ××ª Incident Replay"
        description: "×ª××™×“ ×›×“××™ ×œ×”×¦×™×¥ ×‘×¦×™×¨ ×”×–××Ÿ ×›×“×™ ×œ×¨××•×ª ×× ×™×© Runbook ×™×¢×•×“×™ ××—×¨."
        action:
          label: "âª Incident Replay"
          type: link
          href: "/admin/observability/replay?timerange=6h"
          safety: safe
