# Runbooks – SLO Incidents

> תמצית. קצר, תכל'ס, בעברית פשוטה.

## HighErrorRate
- בדוק Grafana: פאנל Error Rate.
- בדוק פריסות אחרונות. אם נפרס – שקול rollback מהיר.
- בדוק תלויות חיצוניות (DB/Redis/חיבורים) ושגרות רקע.
- אם חריג זמני – עקוב 10 דק' והפעל rate‑limit עדין אם צריך.

PromQL לדוגמה:
```text
sum(rate(http_requests_total{status=~"5.."}[5m]))
  /
sum(rate(http_requests_total[5m]))
```

## SLOAvailabilityBreach (זמינות < 99.9%)
- בדוק ב‑Grafana זמינות מול תקלות 5xx.
- סקור לוגים לפי trace_id; חפש דפוס אחיד (endpoint ספציפי?).
- עקוף רכיב חולה (feature flag או ניתוק זמני) והורד עומס.
- פתח Incident אם נמשך > 30 דק'.

מדד זמינות משוער (על בסיס מונים סטנדרטיים):
```text
(1 - (sum(rate(http_requests_total{status=~"5.."}[5m]))
      / sum(rate(http_requests_total[5m])))) * 100
```

## SLOLatencyP95Breach (P95 > 0.5s)
- בדוק פאנל Latency P95 והיסטוגרמות endpoint.
- זהה צוואר בקבוק (DB/IO/חיצוני) דרך traces.
- פרוס cache/עלות חישובית מופחתת/הגדל משאבים זמנית.
- כתוב ממצא קצר ברנבוק בסיום.

PromQL לדוגמה (Histogram):
```text
histogram_quantile(0.95,
  sum(rate(http_request_duration_seconds_bucket[5m])) by (le, endpoint))
```

דשבורד
-------
- דשבורד `codebot-slo-dashboard.json` מסופק תחת `docker/grafana/provisioning/dashboards/`.
- מומלץ לקשר אליו מתוך Grafana ולכוונן ספים לפי סביבת Staging/Prod.
