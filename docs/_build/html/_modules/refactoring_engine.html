

<!DOCTYPE html>
<html class="writer-html5" lang="he" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>refactoring_engine &mdash; ×ª×™×¢×•×“ Code Keeper Bot 1.0.0</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=97689da2" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=0062297a"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/vendor/turndown.umd.js?v=c7d37de5"></script>
      <script src="../_static/vendor/turndown-plugin-gfm.js?v=cc6884c9"></script>
      <script src="../_static/copy-page.js?v=8142343d"></script>
      <script src="../_static/translations.js?v=a336edf7"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs"></script>
      <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";import elkLayouts from "https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs";mermaid.registerLayoutLoaders(elkLayouts);mermaid.initialize({startOnLoad:false});</script>
      <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
      <script type="module">
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";
window.addEventListener("load", () => mermaid.run());
</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="××™× ×“×§×¡" href="../genindex.html" />
    <link rel="search" title="×—×™×¤×•×©" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Code Keeper Bot
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">×œ××¤×ª×—×™× ×•×œ×¡×•×›× ×™ AI:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart-ai.html">×”×ª×—×œ×” ××”×™×¨×” - ×¡×•×›× ×™ AI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../quickstart-ai.html#id1">××˜×¨×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart-ai.html#id2">××” ××¡×•×¨</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart-ai.html#id3">××” ××•×ª×¨ ×•××•××œ×¥</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart-ai.html#id4">×¤×•×¨××˜×™ ×¦×™×˜×•×˜ ×§×•×“</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart-ai.html#tmp">××—×™×§×” ×‘×˜×•×—×” (×¨×§ ×‘-/tmp)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart-ai.html#pr">×§×•××™×˜×™× ×•-PR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart-ai.html#id5">×§×™×©×•×¨×™× ××”×™×¨×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart-ai.html#cheatsheet-github-cli-gh">Cheatsheet â€“ GitHub CLI (gh)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">×”×ª×—×œ×” ××”×™×¨×” - ××¤×ª×—×™×</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#id2">××˜×¨×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#id3">×©×œ×‘ 1: ×”×ª×§× ×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#env">×©×œ×‘ 2: ×”×’×“×¨×ª .env</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#id4">×©×œ×‘ 3: ×”×¨×¦×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#id5">××” ×”×œ××”?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart-contrib.html">Quickstart ×œ×ª×¨×•××”</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../quickstart-contrib.html#id1">××˜×¨×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart-contrib.html#id2">×¦×¢×“×™ ×”×›× ×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart-contrib.html#id3">×¡×‘×™×‘×ª ×¤×™×ª×•×—</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart-contrib.html#id4">×”×¨×¦×ª ×˜×¡×˜×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart-contrib.html#stubs">×¢×œ ×”â€‘Stubs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart-contrib.html#id5">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ai-guidelines.html">×”× ×—×™×•×ª ××œ××•×ª ×œ×¡×•×›× ×™ AI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ai-guidelines.html#id1">××’×‘×œ×•×ª ×§×¨×™×˜×™×•×ª</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ai-guidelines.html#id2">×”×¨×¦×ª ×¤×§×•×“×•×ª</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ai-guidelines.html#id3">×›×œ×™ ×§×‘×¦×™× ×××•×©×¨×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ai-guidelines.html#id4">×¢×§×¨×•× ×•×ª ×¢×¨×™×›×ª ×§×•×“</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ai-guidelines.html#pull-requests">×§×•××™×˜×™× ×•-Pull Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ai-guidelines.html#id5">×¢×‘×•×“×” ×¢× ×˜×¡×˜×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ai-guidelines.html#id6">×§×™×©×•×¨×™× ××”×™×¨×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../agents/rate-limiting.html">ğŸš¦ ××¢×¨×›×ª Rate Limiting ×œ×¡×•×›× ×™ AI ×•×œ×•×•×‘</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../agents/rate-limiting.html#shadow-mode">××¡×˜×¨×˜×’×™×” â€“ Shadow Mode ×ª×—×™×œ×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../agents/rate-limiting.html#id1">××©×ª× ×™ ×¡×‘×™×‘×” ×•×§×•× ×¤×™×’</a></li>
<li class="toctree-l2"><a class="reference internal" href="../agents/rate-limiting.html#id2">××™× ×˜×’×¨×¦×™×” â€“ ×‘×•×˜ ×˜×œ×’×¨×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../agents/rate-limiting.html#flask-webapp">××™× ×˜×’×¨×¦×™×” â€“ Flask/WebApp</a></li>
<li class="toctree-l2"><a class="reference internal" href="../agents/rate-limiting.html#id3">×”×—×¨×’×•×ª ×—×©×•×‘×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../agents/rate-limiting.html#prometheus">× ×™×˜×•×¨ ×•××“×“×™× (Prometheus)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../agents/rate-limiting.html#id4">××‘×˜×—×” ×•×”×’× ×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../agents/rate-limiting.html#pydantic-settings">×§×•× ×¤×™×’×•×¨×¦×™×” (Pydantic Settings)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../agents/rate-limiting.html#id5">×ª×§×œ×•×ª × ×¤×•×¦×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../agents/rate-limiting.html#id6">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../doc-authoring.html">Doc Authoring Guide (Sphinx/RTD)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../doc-authoring.html#id1">××˜×¨×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../doc-authoring.html#id2">××“×™× ×™×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../doc-authoring.html#id3">×˜×™×¤×™× ××”×™×¨×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../doc-authoring.html#id4">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../style-glossary.html">Style &amp; Naming Glossary</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../style-glossary.html#id1">××˜×¨×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../style-glossary.html#id2">××™×¤×•×™ ××•× ×—×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../style-glossary.html#id3">×›×œ×œ×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../style-glossary.html#id4">×¢×•×’× ×™ ×ª×™×¢×•×“</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../versioning-stable-anchors.html">Versioning &amp; Stable Anchors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../versioning-stable-anchors.html#id1">××“×™× ×™×•×ª ×¢×•×’× ×™× ×™×¦×™×‘×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../versioning-stable-anchors.html#whats-new">Whatâ€™s New</a></li>
<li class="toctree-l2"><a class="reference internal" href="../versioning-stable-anchors.html#anchors">×“×•×’××ª Anchors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../versioning-stable-anchors.html#id2">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../whats-new.html">Whatâ€™s New</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../whats-new.html#id1">2025-12-11</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whats-new.html#id2">2025-11-11</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whats-new.html#id3">2025-11-06</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whats-new.html#id4">2025-11-05</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whats-new.html#id5">2025-10-30</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whats-new.html#id6">2025-10-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whats-new.html#id7">2025-10-15</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">××¨×›×™×˜×§×˜×•×¨×”</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html#id2">×¡×§×™×¨×” ×›×œ×œ×™×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html#id3">×ª×¨×©×™× ×¨×›×™×‘×™× (×ª××¦×™×ª×™)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html#id4">××‘× ×” ×ª×™×§×™×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html#id5">××§×•×¨×•×ª × ×•×¡×¤×™×</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../architecture/clean-architecture.html">Clean Architecture ×‘-src</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../architecture/clean-architecture.html#clean-architecture">×œ××” Clean Architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="../architecture/clean-architecture.html#id1">×ª×¨×©×™× ×©×›×‘×•×ª</a></li>
<li class="toctree-l4"><a class="reference internal" href="../architecture/clean-architecture.html#id2">××‘× ×” ×ª×™×§×™×•×ª</a></li>
<li class="toctree-l4"><a class="reference internal" href="../architecture/clean-architecture.html#domain">×©×›×‘×ª ×”×“×•××™×™×Ÿ (Domain)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../architecture/clean-architecture.html#application">×©×›×‘×ª ×”×™×™×©×•× (Application)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../architecture/clean-architecture.html#infrastructure">×©×›×‘×ª ×”×ª×©×ª×™×ª (Infrastructure)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../architecture/clean-architecture.html#id3">×“×•×’××ª ×–×¨×™××”: ×™×¦×™×¨×ª ×¡× ×™×¤×˜</a></li>
<li class="toctree-l4"><a class="reference internal" href="../architecture/clean-architecture.html#id4">×”× ×—×™×•×ª ×¢×‘×•×“×”</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html#id6">×–×¨×™××•×ª ××¨×›×–×™×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html#id7">×§×™×©×•×¨×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html#http-aiohttp">×ª×©×ª×™×ª HTTP â€“ ×¡×©×Ÿ aiohttp ××©×•×ª×£</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html#documenthandler">×”×¤×¨×“×ª ××—×¨×™×•×ª â€“ DocumentHandler</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">××“×¨×™×š ×ª×¨×•××”</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#id2">××˜×¨×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#id3">×›×œ×œ×™× ×›×œ×œ×™×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#workflow">Workflow ×‘×¡×™×¡×™</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#pre-commit">Pre-commit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#conventional-commits">Conventional Commits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#id4">×“×•×’×××•×ª ×©×™××•×©×™×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#id5">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../branch-protection-and-pr-rules.html">Branch Protection &amp; PR Rules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../branch-protection-and-pr-rules.html#id1">××˜×¨×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../branch-protection-and-pr-rules.html#id2">×›×œ×œ×™ ×¢× ×¤×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../branch-protection-and-pr-rules.html#pr">×—×•×§×™ PR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../branch-protection-and-pr-rules.html#ci-required-checks">CI â€“ Required Checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../branch-protection-and-pr-rules.html#id3">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">××“×¨×™×›×™× ×‘×¡×™×¡×™×™×:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">×”×ª×§× ×” ×•×”×’×“×¨×”</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#id2">×“×¨×™×©×•×ª ××¢×¨×›×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#id3">×”×ª×§× ×” ××”×™×¨×”</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#id4">1. ×©×›×¤×œ ××ª ×”×¨×™×¤×•×–×™×˜×•×¨×™</a></li>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#id5">2. ×”×ª×§×Ÿ ×ª×œ×•×™×•×ª</a></li>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#id6">3. ×”×’×“×¨ ××©×ª× ×™ ×¡×‘×™×‘×”</a></li>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#id7">4. ×”×¤×¢×œ ××ª ×”×‘×•×˜</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#docker">×”×ª×§× ×” ×¢× Docker</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#image">1. ×‘× ×” ××ª ×”-Image</a></li>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#docker-compose">2. ×”×¤×¢×œ ×¢× Docker Compose</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#mongodb">×”×’×“×¨×ª MongoDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#telegram-bot">×”×’×“×¨×ª Telegram Bot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#id8">×”×’×“×¨×•×ª ××ª×§×“××•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#id9">×‘×“×™×§×ª ×”×ª×§× ×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#id10">×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#id11">×ª××™×›×”</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Rate Limiting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#environment-variables">Environment variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#databases-and-cache-pooling-timeouts">Databases and Cache (Pooling/Timeouts)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#http-clients">HTTP Clients</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#http-async-async-http">×©×™××•×© ×‘â€‘http_async (Async HTTP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#http-sync-sync-http">×©×™××•×© ×‘â€‘http_sync (Sync HTTP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#flask">Flask</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#telegram-bot">Telegram Bot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#metrics">Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#security">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#id1">Databases and Cache (Pooling/Timeouts)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#id2">HTTP Clients</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#id3">×©×™××•×© ×‘-http_sync (Sync HTTP)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html#config-via-pydantic-settings">Config via Pydantic Settings</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#id4">×”×™×¨×¨×›×™×™×ª ×˜×¢×™× ×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#id5">×•×œ×™×“×¦×™×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#env-example">.env.example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#id6">×©×™××•×© ×œ×¡×•×›× ×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#id7">×¤×¨××˜×¨×™ ×§×•× ×¤×™×’×•×¨×¦×™×” ××¨×›×–×™×™× (×—×“×©×™×)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#id8">××™×—×•×“ ×ª×™×¢×•×“ ×§×•× ×¤×™×’×•×¨×¦×™×”</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html#id9">×§×‘×¦×™ ×§×•× ×¤×™×’×•×¨×¦×™×” ×™×™×¢×•×“×™×™×</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#config-alert-graph-sources-json"><code class="docutils literal notranslate"><span class="pre">config/alert_graph_sources.json</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#config-observability-runbooks-yml"><code class="docutils literal notranslate"><span class="pre">config/observability_runbooks.yml</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#config-alert-quick-fixes-json"><code class="docutils literal notranslate"><span class="pre">config/alert_quick_fixes.json</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#config-alerts-yml"><code class="docutils literal notranslate"><span class="pre">config/alerts.yml</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#config-error-signatures-yml"><code class="docutils literal notranslate"><span class="pre">config/error_signatures.yml</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#config-image-settings-yaml"><code class="docutils literal notranslate"><span class="pre">config/image_settings.yaml</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../environment-variables.html">××©×ª× ×™ ×¡×‘×™×‘×” - ×¨×¤×¨× ×¡</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../environment-variables.html#id2">×˜×‘×œ×” ××¨×›×–×™×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../environment-variables.html#id3">×”×ª×¨××•×ª ×•× ×™×˜×•×¨ (×”×¨×—×‘×”)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../environment-variables.html#otel">××“×“×™×, OTEL ×•×—×™×–×•×™</a></li>
<li class="toctree-l2"><a class="reference internal" href="../environment-variables.html#id4">×ª×¤×¢×•×œ, ××™× ×˜×’×¨×¦×™×•×ª ×•×¤×™×¦â€™×¨×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../environment-variables.html#id5">×“×’×œ×™ ×‘×“×™×§×•×ª ×•×¤×™×ª×•×—</a></li>
<li class="toctree-l2"><a class="reference internal" href="../environment-variables.html#id6">×“×•×’×××•×ª ×§×•× ×¤×™×’×•×¨×¦×™×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../environment-variables.html#id7">×§×™×©×•×¨×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../environment-variables.html#scopes-github">×˜×‘×œ×ª Scopes ×œ×¤×™×¦â€™×¨×™× ×©×œ GitHub</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../performance-bible.html">ğŸš€ The Performance Bible: CodeKeeper Optimization Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../performance-bible.html#projection">1. ×—×•×§ ×”-Projection (××œ ×ª××©×•×š ××” ×©××ª×” ×œ× ××¦×™×’)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance-bible.html#db-smart-metadata">2. ×—×™×©×•×‘×™× ×‘-DB (Smart Metadata)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance-bible.html#compound-indexes">3. ××™× ×“×•×§×¡ ××•×¨×›×‘ (Compound Indexes)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance-bible.html#api-the-snippet-pattern">4. ××•×¤×˜×™××™×–×¦×™×™×ª API ×•×—×™×¤×•×© (The Snippet Pattern)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance-bible.html#lazy-loading">5. ×”×–×¨×§×ª × ×ª×•× ×™× ××¡×™× ×›×¨×•× ×™×ª (Lazy Loading)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance-bible.html#the-production-sweet-spot">6. ×”×’×“×¨×•×ª ×¡×‘×™×‘×” (The Production Sweet Spot)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../performance-scaling.html">×‘×™×¦×•×¢×™× ×•×”×¨×—×‘×” (Performance &amp; Scaling)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../performance-scaling.html#pagination">×¢×™××•×“ (Pagination)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance-scaling.html#projection">Projection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance-scaling.html#id1">×“×’×©×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance-scaling.html#connection-pooling-timeouts">×›×•×•× ×•×Ÿ Connection Pooling ×•-Timeouts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance-scaling.html#id2">×œ×•×’×™ ××™×˜×™×•×ª (××”×™×¨ ×œ××™×ª×•×¨ ×¦×•×•××¨×™ ×‘×§×‘×•×§)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance-scaling.html#env">×‘×“×™×§×•×ª ××”×™×¨×•×ª ××—×¨×™ ×©×™× ×•×™ ENV</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance-scaling.html#id3">×”× ×—×™×•×ª ×œ×¤×™ ×¡×‘×™×‘×”</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../performance-sticky-notes.html">Sticky Notes Warmup â€“ ×¤×ª×¨×•×Ÿ ×‘×™×¦×•×¢×™× ××©×•×œ×‘</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../performance-sticky-notes.html#id1">×¨×§×¢ ×§×¦×¨</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance-sticky-notes.html#id2">×”×ª×¨×•×¤×” ×”××™×™×“×™×ª (××•×›×—×ª)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance-sticky-notes.html#warmup">Warmup ××‘× ×™ (×¢×“×™×™×Ÿ ×‘×ª×”×œ×™×š ××™××•×ª)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance-sticky-notes.html#id3">××™×¤×•×¡ ×”×“×’×œ ×‘×¢×ª ×©×™× ×•×™ ××™× ×“×§×¡×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance-sticky-notes.html#rollout">××” ×œ×××ª ×œ×¤× ×™ rollout ××œ×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance-sticky-notes.html#latency">××” ×œ×¢×©×•×ª ×× latency ×§×•×¤×¥ ×©×•×‘</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance-sticky-notes.html#id4">×”××œ×¦×” ×¨×©××™×ª</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../large-files-runbook.html">×˜×™×¤×•×œ ×‘×§×‘×¦×™× ×’×“×•×œ×™× (Large Files)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../large-files-runbook.html#id1">××’×‘×œ×•×ª ×•×¤×•×œ×‘×§×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../large-files-runbook.html#id2">×”× ×—×™×•×ª ×”×¤×¢×œ×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../large-files-runbook.html#id3">× ×™×˜×•×¨</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/main.html">main module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/config.html">config module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/bot_handlers.html">bot_handlers module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/conversation_handlers.html">conversation_handlers module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/database.html">database package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/database.html#submodules">Submodules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/database.bookmark.html">database.bookmark module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/database.bookmarks_manager.html">database.bookmarks_manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/database.collections_manager.html">database.collections_manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/database.manager.html">database.manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/database.models.html">database.models module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/database.repository.html">database.repository module</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/services.html">services package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/services.html#submodules">Submodules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/services.backoff_state.html">services.backoff_state module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/services.backup_service.html">services.backup_service module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/services.code_service.html">services.code_service module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/services.github_service.html">services.github_service module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/services.google_drive_service.html">services.google_drive_service module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/services.investigation_service.html">services.investigation_service module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/services.webserver.html">services.webserver module</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/handlers.html">handlers package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/handlers.html#subpackages">Subpackages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/handlers.github.html">handlers.github package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/handlers.html#submodules">Submodules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/handlers.documents.html">handlers.documents module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/handlers.file_view.html">handlers.file_view module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/handlers.pagination.html">handlers.pagination module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/handlers.save_flow.html">handlers.save_flow module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/handlers.states.html">handlers.states module</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/utils.html">utils module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/utils.html#utils.CodeErrorLogger"><code class="docutils literal notranslate"><span class="pre">CodeErrorLogger</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.CodeErrorLogger.__init__"><code class="docutils literal notranslate"><span class="pre">CodeErrorLogger.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.CodeErrorLogger.log_code_processing_error"><code class="docutils literal notranslate"><span class="pre">CodeErrorLogger.log_code_processing_error()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.CodeErrorLogger.log_code_activity"><code class="docutils literal notranslate"><span class="pre">CodeErrorLogger.log_code_activity()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.CodeErrorLogger.log_validation_failure"><code class="docutils literal notranslate"><span class="pre">CodeErrorLogger.log_validation_failure()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.CodeErrorLogger.log_sanitization_success"><code class="docutils literal notranslate"><span class="pre">CodeErrorLogger.log_sanitization_success()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/utils.html#utils.TimeUtils"><code class="docutils literal notranslate"><span class="pre">TimeUtils</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.TimeUtils.format_relative_time"><code class="docutils literal notranslate"><span class="pre">TimeUtils.format_relative_time()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.TimeUtils.parse_date_string"><code class="docutils literal notranslate"><span class="pre">TimeUtils.parse_date_string()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.TimeUtils.get_time_ranges"><code class="docutils literal notranslate"><span class="pre">TimeUtils.get_time_ranges()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/utils.html#utils.TextUtils"><code class="docutils literal notranslate"><span class="pre">TextUtils</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.TextUtils.truncate_text"><code class="docutils literal notranslate"><span class="pre">TextUtils.truncate_text()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.TextUtils.escape_markdown"><code class="docutils literal notranslate"><span class="pre">TextUtils.escape_markdown()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.TextUtils.clean_filename"><code class="docutils literal notranslate"><span class="pre">TextUtils.clean_filename()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.TextUtils.extract_hashtags"><code class="docutils literal notranslate"><span class="pre">TextUtils.extract_hashtags()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.TextUtils.highlight_text"><code class="docutils literal notranslate"><span class="pre">TextUtils.highlight_text()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.TextUtils.format_file_size"><code class="docutils literal notranslate"><span class="pre">TextUtils.format_file_size()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.TextUtils.pluralize_hebrew"><code class="docutils literal notranslate"><span class="pre">TextUtils.pluralize_hebrew()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/utils.html#utils.SecurityUtils"><code class="docutils literal notranslate"><span class="pre">SecurityUtils</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.SecurityUtils.generate_secure_token"><code class="docutils literal notranslate"><span class="pre">SecurityUtils.generate_secure_token()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.SecurityUtils.hash_content"><code class="docutils literal notranslate"><span class="pre">SecurityUtils.hash_content()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.SecurityUtils.validate_user_input"><code class="docutils literal notranslate"><span class="pre">SecurityUtils.validate_user_input()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.SecurityUtils.sanitize_code"><code class="docutils literal notranslate"><span class="pre">SecurityUtils.sanitize_code()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/utils.html#utils.TelegramUtils"><code class="docutils literal notranslate"><span class="pre">TelegramUtils</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.TelegramUtils.send_typing_action"><code class="docutils literal notranslate"><span class="pre">TelegramUtils.send_typing_action()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.TelegramUtils.send_document_action"><code class="docutils literal notranslate"><span class="pre">TelegramUtils.send_document_action()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.TelegramUtils.safe_answer"><code class="docutils literal notranslate"><span class="pre">TelegramUtils.safe_answer()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.TelegramUtils.get_user_mention"><code class="docutils literal notranslate"><span class="pre">TelegramUtils.get_user_mention()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.TelegramUtils.split_long_message"><code class="docutils literal notranslate"><span class="pre">TelegramUtils.split_long_message()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.TelegramUtils.safe_edit_message_text"><code class="docutils literal notranslate"><span class="pre">TelegramUtils.safe_edit_message_text()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.TelegramUtils.safe_edit_message_reply_markup"><code class="docutils literal notranslate"><span class="pre">TelegramUtils.safe_edit_message_reply_markup()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.TelegramUtils.extract_message_text_preserve_markdown"><code class="docutils literal notranslate"><span class="pre">TelegramUtils.extract_message_text_preserve_markdown()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/utils.html#utils.CallbackQueryGuard"><code class="docutils literal notranslate"><span class="pre">CallbackQueryGuard</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.CallbackQueryGuard.DEFAULT_WINDOW_SECONDS"><code class="docutils literal notranslate"><span class="pre">CallbackQueryGuard.DEFAULT_WINDOW_SECONDS</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.CallbackQueryGuard.should_block"><code class="docutils literal notranslate"><span class="pre">CallbackQueryGuard.should_block()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.CallbackQueryGuard.should_block_async"><code class="docutils literal notranslate"><span class="pre">CallbackQueryGuard.should_block_async()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/utils.html#utils.AsyncUtils"><code class="docutils literal notranslate"><span class="pre">AsyncUtils</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.AsyncUtils.run_with_timeout"><code class="docutils literal notranslate"><span class="pre">AsyncUtils.run_with_timeout()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.AsyncUtils.batch_process"><code class="docutils literal notranslate"><span class="pre">AsyncUtils.batch_process()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/utils.html#utils.PerformanceUtils"><code class="docutils literal notranslate"><span class="pre">PerformanceUtils</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.PerformanceUtils.timing_decorator"><code class="docutils literal notranslate"><span class="pre">PerformanceUtils.timing_decorator()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.PerformanceUtils.measure_time"><code class="docutils literal notranslate"><span class="pre">PerformanceUtils.measure_time()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/utils.html#utils.ValidationUtils"><code class="docutils literal notranslate"><span class="pre">ValidationUtils</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.ValidationUtils.is_valid_filename"><code class="docutils literal notranslate"><span class="pre">ValidationUtils.is_valid_filename()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.ValidationUtils.is_safe_code"><code class="docutils literal notranslate"><span class="pre">ValidationUtils.is_safe_code()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/utils.html#utils.FileUtils"><code class="docutils literal notranslate"><span class="pre">FileUtils</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.FileUtils.download_file"><code class="docutils literal notranslate"><span class="pre">FileUtils.download_file()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.FileUtils.get_file_extension"><code class="docutils literal notranslate"><span class="pre">FileUtils.get_file_extension()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.FileUtils.get_mime_type"><code class="docutils literal notranslate"><span class="pre">FileUtils.get_mime_type()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.FileUtils.create_temp_file"><code class="docutils literal notranslate"><span class="pre">FileUtils.create_temp_file()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/utils.html#utils.ConfigUtils"><code class="docutils literal notranslate"><span class="pre">ConfigUtils</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.ConfigUtils.load_json_config"><code class="docutils literal notranslate"><span class="pre">ConfigUtils.load_json_config()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.ConfigUtils.save_json_config"><code class="docutils literal notranslate"><span class="pre">ConfigUtils.save_json_config()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/utils.html#utils.CacheUtils"><code class="docutils literal notranslate"><span class="pre">CacheUtils</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.CacheUtils.set"><code class="docutils literal notranslate"><span class="pre">CacheUtils.set()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.CacheUtils.get"><code class="docutils literal notranslate"><span class="pre">CacheUtils.get()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.CacheUtils.delete"><code class="docutils literal notranslate"><span class="pre">CacheUtils.delete()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.CacheUtils.clear"><code class="docutils literal notranslate"><span class="pre">CacheUtils.clear()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/utils.html#utils.get_memory_usage"><code class="docutils literal notranslate"><span class="pre">get_memory_usage()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/utils.html#utils.setup_logging"><code class="docutils literal notranslate"><span class="pre">setup_logging()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/utils.html#utils.generate_summary_stats"><code class="docutils literal notranslate"><span class="pre">generate_summary_stats()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/utils.html#utils.detect_language_from_filename"><code class="docutils literal notranslate"><span class="pre">detect_language_from_filename()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/utils.html#utils.get_language_emoji"><code class="docutils literal notranslate"><span class="pre">get_language_emoji()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/utils.html#utils.SensitiveDataFilter"><code class="docutils literal notranslate"><span class="pre">SensitiveDataFilter</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.SensitiveDataFilter.filter"><code class="docutils literal notranslate"><span class="pre">SensitiveDataFilter.filter()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/utils.html#utils.install_sensitive_filter"><code class="docutils literal notranslate"><span class="pre">install_sensitive_filter()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/utils.html#utils.normalize_code"><code class="docutils literal notranslate"><span class="pre">normalize_code()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/modules.html">workspace</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/activity_reporter.html">activity_reporter module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/activity_reporter.html#activity_reporter.get_mongo_client"><code class="docutils literal notranslate"><span class="pre">get_mongo_client()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/activity_reporter.html#activity_reporter.close_mongo_client"><code class="docutils literal notranslate"><span class="pre">close_mongo_client()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/activity_reporter.html#activity_reporter.SimpleActivityReporter"><code class="docutils literal notranslate"><span class="pre">SimpleActivityReporter</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/activity_reporter.html#activity_reporter.create_reporter"><code class="docutils literal notranslate"><span class="pre">create_reporter()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/alert_forwarder.html">alert_forwarder module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/alert_forwarder.html#alert_forwarder.emit_event"><code class="docutils literal notranslate"><span class="pre">emit_event()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/alert_forwarder.html#alert_forwarder.forward_alerts"><code class="docutils literal notranslate"><span class="pre">forward_alerts()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/alert_manager.html">alert_manager module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/alert_manager.html#alert_manager.emit_event"><code class="docutils literal notranslate"><span class="pre">emit_event()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/alert_manager.html#alert_manager.reset_state_for_tests"><code class="docutils literal notranslate"><span class="pre">reset_state_for_tests()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/alert_manager.html#alert_manager.note_request"><code class="docutils literal notranslate"><span class="pre">note_request()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/alert_manager.html#alert_manager.get_current_error_rate_percent"><code class="docutils literal notranslate"><span class="pre">get_current_error_rate_percent()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/alert_manager.html#alert_manager.get_current_avg_latency_seconds"><code class="docutils literal notranslate"><span class="pre">get_current_avg_latency_seconds()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/alert_manager.html#alert_manager.get_request_stats_between"><code class="docutils literal notranslate"><span class="pre">get_request_stats_between()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/alert_manager.html#alert_manager.bump_threshold"><code class="docutils literal notranslate"><span class="pre">bump_threshold()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/alert_manager.html#alert_manager.get_thresholds_snapshot"><code class="docutils literal notranslate"><span class="pre">get_thresholds_snapshot()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/alert_manager.html#alert_manager.check_and_emit_alerts"><code class="docutils literal notranslate"><span class="pre">check_and_emit_alerts()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/alert_manager.html#alert_manager.forward_critical_alert"><code class="docutils literal notranslate"><span class="pre">forward_critical_alert()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/alert_manager.html#alert_manager.get_dispatch_log"><code class="docutils literal notranslate"><span class="pre">get_dispatch_log()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/autocomplete_manager.html">autocomplete_manager module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/backup_menu_handler.html">backup_menu_handler module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/backup_menu_handler.html#backup_menu_handler.emit_event"><code class="docutils literal notranslate"><span class="pre">emit_event()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/backup_menu_handler.html#backup_menu_handler.BackupMenuHandler"><code class="docutils literal notranslate"><span class="pre">BackupMenuHandler</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/batch_commands.html">batch_commands module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/batch_processor.html">batch_processor module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/bot_handlers.html">bot_handlers module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/bot_rate_limiter.html">bot_rate_limiter module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/cache_commands.html">cache_commands module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/cache_commands.html#cache_commands.cache_stats_command"><code class="docutils literal notranslate"><span class="pre">cache_stats_command()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/cache_commands.html#cache_commands.clear_cache_command"><code class="docutils literal notranslate"><span class="pre">clear_cache_command()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/cache_commands.html#cache_commands.setup_cache_handlers"><code class="docutils literal notranslate"><span class="pre">setup_cache_handlers()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/cache_commands.html#cache_commands.cache_warm_command"><code class="docutils literal notranslate"><span class="pre">cache_warm_command()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/cache_manager.html">cache_manager module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/cache_manager.html#cache_manager.DynamicTTL"><code class="docutils literal notranslate"><span class="pre">DynamicTTL</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/cache_manager.html#cache_manager.ActivityBasedTTL"><code class="docutils literal notranslate"><span class="pre">ActivityBasedTTL</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/cache_manager.html#cache_manager.build_cache_key"><code class="docutils literal notranslate"><span class="pre">build_cache_key()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/cache_manager.html#cache_manager.CacheManager"><code class="docutils literal notranslate"><span class="pre">CacheManager</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/cache_manager.html#cache_manager.dynamic_cache"><code class="docutils literal notranslate"><span class="pre">dynamic_cache()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/cache_manager.html#cache_manager.cached"><code class="docutils literal notranslate"><span class="pre">cached()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/cache_manager.html#cache_manager.async_cached"><code class="docutils literal notranslate"><span class="pre">async_cached()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/chatops.html">chatops package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/chatops.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/code_preview.html">code_preview module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/code_preview.html#code_preview.CodePreviewManager"><code class="docutils literal notranslate"><span class="pre">CodePreviewManager</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/code_processor.html">code_processor module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/config.html">config module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/conftest.html">conftest module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/conversation_handlers.html">conversation_handlers module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/database.html">database package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/database.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/duplicate_detector.html">duplicate_detector module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/duplicate_detector.html#duplicate_detector.scan_duplicates"><code class="docutils literal notranslate"><span class="pre">scan_duplicates()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/file_manager.html">file_manager module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/file_manager.html#file_manager.BackupInfo"><code class="docutils literal notranslate"><span class="pre">BackupInfo</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/file_manager.html#file_manager.BackupManager"><code class="docutils literal notranslate"><span class="pre">BackupManager</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/fix_telegram_parse_error.html">fix_telegram_parse_error module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/fix_telegram_parse_error.html#fix_telegram_parse_error.clean_for_telegram"><code class="docutils literal notranslate"><span class="pre">clean_for_telegram()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/fix_telegram_parse_error.html#fix_telegram_parse_error.apply_fix"><code class="docutils literal notranslate"><span class="pre">apply_fix()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/fix_telegram_parse_error.html#fix_telegram_parse_error.wrap_edit_message_calls"><code class="docutils literal notranslate"><span class="pre">wrap_edit_message_calls()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/github_menu_handler.html">github_menu_handler module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/github_upload_fix.html">github_upload_fix module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/github_upload_fix.html#github_upload_fix.github_upload_new_file"><code class="docutils literal notranslate"><span class="pre">github_upload_new_file()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/github_upload_fix.html#github_upload_fix.handle_document_fixed"><code class="docutils literal notranslate"><span class="pre">handle_document_fixed()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/github_upload_fix.html#github_upload_fix.upload_to_github_fixed"><code class="docutils literal notranslate"><span class="pre">upload_to_github_fixed()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/github_upload_fix.html#github_upload_fix.setup_minimal_commands"><code class="docutils literal notranslate"><span class="pre">setup_minimal_commands()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/github_upload_fix.html#github_upload_fix.stats_command_secured"><code class="docutils literal notranslate"><span class="pre">stats_command_secured()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/github_upload_fix.html#github_upload_fix.check_commands"><code class="docutils literal notranslate"><span class="pre">check_commands()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/handlers.html">handlers package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/handlers.html#subpackages">Subpackages</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/handlers.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/http_async.html">http_async module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/http_async.html#http_async.CircuitOpenError"><code class="docutils literal notranslate"><span class="pre">CircuitOpenError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/http_async.html#http_async.get_session"><code class="docutils literal notranslate"><span class="pre">get_session()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/http_async.html#http_async.request"><code class="docutils literal notranslate"><span class="pre">request()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/http_async.html#http_async.close_session"><code class="docutils literal notranslate"><span class="pre">close_session()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/http_sync.html">http_sync module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/http_sync.html#http_sync.CircuitOpenError"><code class="docutils literal notranslate"><span class="pre">CircuitOpenError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/http_sync.html#http_sync.get_session"><code class="docutils literal notranslate"><span class="pre">get_session()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/http_sync.html#http_sync.request"><code class="docutils literal notranslate"><span class="pre">request()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/i18n.html">i18n package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/i18n.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/integrations.html">integrations module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/integrations_github_monitor.html">integrations_github_monitor module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/integrations_github_monitor.html#integrations_github_monitor.fetch_rate_limit"><code class="docutils literal notranslate"><span class="pre">fetch_rate_limit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/integrations_github_monitor.html#integrations_github_monitor.summarize_rate_limit"><code class="docutils literal notranslate"><span class="pre">summarize_rate_limit()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/integrations_sentry.html">integrations_sentry module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/integrations_sentry.html#integrations_sentry.is_configured"><code class="docutils literal notranslate"><span class="pre">is_configured()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/integrations_sentry.html#integrations_sentry.get_recent_issues"><code class="docutils literal notranslate"><span class="pre">get_recent_issues()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/integrations_sentry.html#integrations_sentry.search_events"><code class="docutils literal notranslate"><span class="pre">search_events()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/integrations_sentry.html#integrations_sentry.get_issue_events"><code class="docutils literal notranslate"><span class="pre">get_issue_events()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/internal_alerts.html">internal_alerts module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/internal_alerts.html#internal_alerts.emit_event"><code class="docutils literal notranslate"><span class="pre">emit_event()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/internal_alerts.html#internal_alerts.emit_internal_alert"><code class="docutils literal notranslate"><span class="pre">emit_internal_alert()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/internal_alerts.html#internal_alerts.get_recent_alerts"><code class="docutils literal notranslate"><span class="pre">get_recent_alerts()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/large_files_handler.html">large_files_handler module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/lazy_loader.html">lazy_loader module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/main.html">main module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/metrics.html">metrics module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.emit_event"><code class="docutils literal notranslate"><span class="pre">emit_event()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.generate_latest"><code class="docutils literal notranslate"><span class="pre">generate_latest()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.track_performance"><code class="docutils literal notranslate"><span class="pre">track_performance()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.metrics_endpoint_bytes"><code class="docutils literal notranslate"><span class="pre">metrics_endpoint_bytes()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.metrics_content_type"><code class="docutils literal notranslate"><span class="pre">metrics_content_type()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.note_active_user"><code class="docutils literal notranslate"><span class="pre">note_active_user()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.note_request_started"><code class="docutils literal notranslate"><span class="pre">note_request_started()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.note_request_finished"><code class="docutils literal notranslate"><span class="pre">note_request_finished()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.get_active_requests_count"><code class="docutils literal notranslate"><span class="pre">get_active_requests_count()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.get_current_memory_usage"><code class="docutils literal notranslate"><span class="pre">get_current_memory_usage()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.get_recent_errors_count"><code class="docutils literal notranslate"><span class="pre">get_recent_errors_count()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.get_top_slow_endpoints"><code class="docutils literal notranslate"><span class="pre">get_top_slow_endpoints()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.get_slowest_endpoint"><code class="docutils literal notranslate"><span class="pre">get_slowest_endpoint()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.note_deployment_started"><code class="docutils literal notranslate"><span class="pre">note_deployment_started()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.note_deployment_shutdown"><code class="docutils literal notranslate"><span class="pre">note_deployment_shutdown()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.get_avg_response_time_seconds"><code class="docutils literal notranslate"><span class="pre">get_avg_response_time_seconds()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.record_request_outcome"><code class="docutils literal notranslate"><span class="pre">record_request_outcome()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.update_health_gauges"><code class="docutils literal notranslate"><span class="pre">update_health_gauges()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.record_startup_stage_metric"><code class="docutils literal notranslate"><span class="pre">record_startup_stage_metric()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.record_startup_total_metric"><code class="docutils literal notranslate"><span class="pre">record_startup_total_metric()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.record_http_request"><code class="docutils literal notranslate"><span class="pre">record_http_request()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.record_request_queue_delay"><code class="docutils literal notranslate"><span class="pre">record_request_queue_delay()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.record_outbound_request_duration"><code class="docutils literal notranslate"><span class="pre">record_outbound_request_duration()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.increment_outbound_retry"><code class="docutils literal notranslate"><span class="pre">increment_outbound_retry()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.set_circuit_state"><code class="docutils literal notranslate"><span class="pre">set_circuit_state()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.set_circuit_success_rate"><code class="docutils literal notranslate"><span class="pre">set_circuit_success_rate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.get_boot_monotonic"><code class="docutils literal notranslate"><span class="pre">get_boot_monotonic()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.mark_startup_complete"><code class="docutils literal notranslate"><span class="pre">mark_startup_complete()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.note_first_request_latency"><code class="docutils literal notranslate"><span class="pre">note_first_request_latency()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.get_process_uptime_seconds"><code class="docutils literal notranslate"><span class="pre">get_process_uptime_seconds()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.record_dependency_init"><code class="docutils literal notranslate"><span class="pre">record_dependency_init()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.record_db_operation"><code class="docutils literal notranslate"><span class="pre">record_db_operation()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.get_uptime_percentage"><code class="docutils literal notranslate"><span class="pre">get_uptime_percentage()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.set_adaptive_observability_gauges"><code class="docutils literal notranslate"><span class="pre">set_adaptive_observability_gauges()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.set_external_error_rate_percent"><code class="docutils literal notranslate"><span class="pre">set_external_error_rate_percent()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.track_file_saved"><code class="docutils literal notranslate"><span class="pre">track_file_saved()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.track_search_performed"><code class="docutils literal notranslate"><span class="pre">track_search_performed()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/metrics.html#metrics.track_github_sync"><code class="docutils literal notranslate"><span class="pre">track_github_sync()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/monitoring.html">monitoring package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/monitoring.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/observability.html">observability module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/observability_instrumentation.html">observability_instrumentation module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/observability_instrumentation.html#observability_instrumentation.traced"><code class="docutils literal notranslate"><span class="pre">traced()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/observability_instrumentation.html#observability_instrumentation.start_span"><code class="docutils literal notranslate"><span class="pre">start_span()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/observability_instrumentation.html#observability_instrumentation.set_current_span_attributes"><code class="docutils literal notranslate"><span class="pre">set_current_span_attributes()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/observability_otel.html">observability_otel module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/observability_otel.html#observability_otel.setup_telemetry"><code class="docutils literal notranslate"><span class="pre">setup_telemetry()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/predictive_engine.html">predictive_engine module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/predictive_engine.html#predictive_engine.emit_event"><code class="docutils literal notranslate"><span class="pre">emit_event()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/predictive_engine.html#predictive_engine.Trend"><code class="docutils literal notranslate"><span class="pre">Trend</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/predictive_engine.html#predictive_engine.note_observation"><code class="docutils literal notranslate"><span class="pre">note_observation()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/predictive_engine.html#predictive_engine.evaluate_predictions"><code class="docutils literal notranslate"><span class="pre">evaluate_predictions()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/predictive_engine.html#predictive_engine.reset_state_for_tests"><code class="docutils literal notranslate"><span class="pre">reset_state_for_tests()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/predictive_engine.html#predictive_engine.maybe_recompute_and_preempt"><code class="docutils literal notranslate"><span class="pre">maybe_recompute_and_preempt()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/predictive_engine.html#predictive_engine.get_recent_predictions"><code class="docutils literal notranslate"><span class="pre">get_recent_predictions()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/predictive_engine.html#predictive_engine.get_trend_snapshot"><code class="docutils literal notranslate"><span class="pre">get_trend_snapshot()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/rate_limiter.html">rate_limiter module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/rate_limiter.html#rate_limiter.RateLimiter"><code class="docutils literal notranslate"><span class="pre">RateLimiter</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/refactor_handlers.html">refactor_handlers module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/refactoring_engine.html">refactoring_engine module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/refactoring_engine.html#id1">××“×™× ×™×•×ª ×•×§×•× ×¤×™×’×•×¨×¦×™×”</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/refactoring_engine.html#safe-decomposition-models-py">××§×¨×” ××™×•×—×“: Safe Decomposition ×œâ€‘<code class="docutils literal notranslate"><span class="pre">models.py</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/remediation_manager.html">remediation_manager module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/remediation_manager.html#remediation_manager.handle_critical_incident"><code class="docutils literal notranslate"><span class="pre">handle_critical_incident()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/remediation_manager.html#remediation_manager.get_incidents"><code class="docutils literal notranslate"><span class="pre">get_incidents()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/reminders.html">reminders package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/reminders.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/repo_analyzer.html">repo_analyzer module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/repo_analyzer.html#repo_analyzer.emit_event"><code class="docutils literal notranslate"><span class="pre">emit_event()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/repo_analyzer.html#repo_analyzer.RepoAnalyzer"><code class="docutils literal notranslate"><span class="pre">RepoAnalyzer</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/search_engine.html">search_engine module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/secret_manager.html">secret_manager module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/secret_manager.html#secret_manager.encrypt_secret"><code class="docutils literal notranslate"><span class="pre">encrypt_secret()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/secret_manager.html#secret_manager.decrypt_secret"><code class="docutils literal notranslate"><span class="pre">decrypt_secret()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/services.html">services package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/services.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/setup_bookmarks.html">setup_bookmarks module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/setup_bookmarks.html#setup_bookmarks.emit_event"><code class="docutils literal notranslate"><span class="pre">emit_event()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/setup_bookmarks.html#setup_bookmarks.check_mongodb_connection"><code class="docutils literal notranslate"><span class="pre">check_mongodb_connection()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/setup_bookmarks.html#setup_bookmarks.setup_bookmarks_collection"><code class="docutils literal notranslate"><span class="pre">setup_bookmarks_collection()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/setup_bookmarks.html#setup_bookmarks.verify_installation"><code class="docutils literal notranslate"><span class="pre">verify_installation()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/setup_bookmarks.html#setup_bookmarks.main"><code class="docutils literal notranslate"><span class="pre">main()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/terminal_commands.html">terminal_commands module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/terminal_commands.html#terminal_commands.emit_event"><code class="docutils literal notranslate"><span class="pre">emit_event()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/terminal_commands.html#terminal_commands.run_in_sandbox"><code class="docutils literal notranslate"><span class="pre">run_in_sandbox()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/terminal_commands.html#terminal_commands.terminal_enter"><code class="docutils literal notranslate"><span class="pre">terminal_enter()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/terminal_commands.html#terminal_commands.terminal_exit"><code class="docutils literal notranslate"><span class="pre">terminal_exit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/terminal_commands.html#terminal_commands.terminal_run_command"><code class="docutils literal notranslate"><span class="pre">terminal_run_command()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/terminal_commands.html#terminal_commands.terminal_command"><code class="docutils literal notranslate"><span class="pre">terminal_command()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/terminal_commands.html#terminal_commands.setup_terminal_handlers"><code class="docutils literal notranslate"><span class="pre">setup_terminal_handlers()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/test_basic.html">test_basic module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/test_basic.html#test_basic.test_python_version"><code class="docutils literal notranslate"><span class="pre">test_python_version()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/test_basic.html#test_basic.test_import_main"><code class="docutils literal notranslate"><span class="pre">test_import_main()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/test_basic.html#test_basic.test_environment"><code class="docutils literal notranslate"><span class="pre">test_environment()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/test_basic.html#test_basic.test_basic_calculation"><code class="docutils literal notranslate"><span class="pre">test_basic_calculation()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/test_basic.html#test_basic.TestRequirements"><code class="docutils literal notranslate"><span class="pre">TestRequirements</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/test_bookmarks.html">test_bookmarks module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/user_stats.html">user_stats module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/utils.html">utils module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.CodeErrorLogger"><code class="docutils literal notranslate"><span class="pre">CodeErrorLogger</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.TimeUtils"><code class="docutils literal notranslate"><span class="pre">TimeUtils</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.TextUtils"><code class="docutils literal notranslate"><span class="pre">TextUtils</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.SecurityUtils"><code class="docutils literal notranslate"><span class="pre">SecurityUtils</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.TelegramUtils"><code class="docutils literal notranslate"><span class="pre">TelegramUtils</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.CallbackQueryGuard"><code class="docutils literal notranslate"><span class="pre">CallbackQueryGuard</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.AsyncUtils"><code class="docutils literal notranslate"><span class="pre">AsyncUtils</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.PerformanceUtils"><code class="docutils literal notranslate"><span class="pre">PerformanceUtils</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.ValidationUtils"><code class="docutils literal notranslate"><span class="pre">ValidationUtils</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.FileUtils"><code class="docutils literal notranslate"><span class="pre">FileUtils</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.ConfigUtils"><code class="docutils literal notranslate"><span class="pre">ConfigUtils</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.CacheUtils"><code class="docutils literal notranslate"><span class="pre">CacheUtils</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.get_memory_usage"><code class="docutils literal notranslate"><span class="pre">get_memory_usage()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.setup_logging"><code class="docutils literal notranslate"><span class="pre">setup_logging()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.generate_summary_stats"><code class="docutils literal notranslate"><span class="pre">generate_summary_stats()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.detect_language_from_filename"><code class="docutils literal notranslate"><span class="pre">detect_language_from_filename()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.get_language_emoji"><code class="docutils literal notranslate"><span class="pre">get_language_emoji()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.SensitiveDataFilter"><code class="docutils literal notranslate"><span class="pre">SensitiveDataFilter</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.install_sensitive_filter"><code class="docutils literal notranslate"><span class="pre">install_sensitive_filter()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/utils.html#utils.normalize_code"><code class="docutils literal notranslate"><span class="pre">normalize_code()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/webapp.html">webapp package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/webapp.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/index.html">××•×“×•×œ×™× ×¨××©×™×™×</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html#file-management">File Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html#github-integration">GitHub Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html#backup-system">Backup System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html#code-processing">Code Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html#search-engine">Search Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html#repository-analysis">Repository Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html#batch-processing">Batch Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html#large-files-handling">Large Files Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html#cache-management">Cache Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html#user-statistics">User Statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html#activity-reporting">Activity Reporting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html#utilities">Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html#lazy-loading">Lazy Loading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html#integrations">Integrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html#terminal-commands">Terminal Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html#autocomplete-manager">Autocomplete Manager</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../handlers/index.html">Handlers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../handlers/index.html#show-command">Show Command</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../handlers/show.html">Show Command</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../handlers/show.html#show">××¤×¨×˜ ×¤×§×•×“×ª <cite>/show</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../handlers/show.html#html">×“×•×’××ª ×ª×’×•×‘×ª HTML</a></li>
<li class="toctree-l4"><a class="reference internal" href="../handlers/show.html#id1">×”×¢×¨×•×ª ×™×™×©×•×</a></li>
<li class="toctree-l4"><a class="reference internal" href="../handlers/show.html#id2">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../handlers/index.html#drive-menu">Drive Menu</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../handlers/drive_menu.html">Drive Menu V2</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../handlers/drive_menu.html#id1">×¡×§×™×¨×”</a></li>
<li class="toctree-l4"><a class="reference internal" href="../handlers/drive_menu.html#id2">×“×’×œ ×¤×™×¦â€™×¨</a></li>
<li class="toctree-l4"><a class="reference internal" href="../handlers/drive_menu.html#id3">×–×¨×™××•×ª ×¢×™×§×¨×™×•×ª</a></li>
<li class="toctree-l4"><a class="reference internal" href="../handlers/drive_menu.html#device-flow">×”×ª×—×‘×¨×•×ª (Device Flow)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../handlers/drive_menu.html#id4">×˜×™×¤×•×œ ×©×’×™××•×ª</a></li>
<li class="toctree-l4"><a class="reference internal" href="../handlers/drive_menu.html#id5">× ×™×˜×•×¨</a></li>
<li class="toctree-l4"><a class="reference internal" href="../handlers/drive_menu.html#api-autodoc">API (autodoc)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../handlers/index.html#file-view-handler">File View Handler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../handlers/index.html#pagination-handler">Pagination Handler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../handlers/index.html#save-flow-handler">Save Flow Handler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../handlers/index.html#states-handler">States Handler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../handlers/index.html#github-handlers">GitHub Handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../handlers/index.html#github-menu-bridge">GitHub Menu Bridge</a></li>
<li class="toctree-l2"><a class="reference internal" href="../handlers/index.html#document-flow">Document Flow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../handlers/document-flow.html">×–×¨×™××ª ×”×˜×™×¤×•×œ ×‘××¡××›×™× (Document Flow)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../handlers/document-flow.html#id1">××¤×” ×•×ª×¤×§×™×“×™×</a></li>
<li class="toctree-l4"><a class="reference internal" href="../handlers/document-flow.html#id2">×–×¨×™××ª ×˜×™×¤×•×œ ×‘×§×•×‘×¥</a></li>
<li class="toctree-l4"><a class="reference internal" href="../handlers/document-flow.html#upload-mode">××¦×‘×™ upload_mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="../handlers/document-flow.html#id3">×ª×œ×•×™×•×ª ×•×”×–×¨×§×•×ª</a></li>
<li class="toctree-l4"><a class="reference internal" href="../handlers/document-flow.html#best-practices">Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../handlers/document-flow.html#filesfacade-db">×©×›×‘×ª ××—×¡×•×Ÿ (FilesFacade ××•×œ DB ×”×™×©×Ÿ)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../handlers/document-flow.html#id4">×¨××• ×’×</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../handlers/index.html#drive-utilities">Drive Utilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../services/index.html">Services</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../services/index.html#code-service">Code Service</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../services/index.html#code-service-module">Code Service Module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../services/index.html#github-service">GitHub Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services/index.html#backup-service">Backup Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services/index.html#ai-explain-service">AI Explain Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services/index.html#community-library-service">Community Library Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services/index.html#image-generator-service">Image Generator Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services/index.html#snippet-library-service">Snippet Library Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services/index.html#observability-http-service">Observability HTTP Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services/index.html#google-drive-service">Google Drive Service</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../services/google_drive_service.html">Google Drive Service</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../services/google_drive_service.html#id1">×¡×§×™×¨×”</a></li>
<li class="toctree-l4"><a class="reference internal" href="../services/google_drive_service.html#oauth">×”×¢×¨×•×ª OAuth</a></li>
<li class="toctree-l4"><a class="reference internal" href="../services/google_drive_service.html#id2">××‘× ×™ ×§×‘×¦×™×</a></li>
<li class="toctree-l4"><a class="reference internal" href="../services/google_drive_service.html#api-autodoc">API (autodoc)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../database/index.html">Database</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../database/index.html#database-manager">Database Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/index.html#models">Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../database/index.html#codesnippet-model">CodeSnippet Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../database/index.html#databasemanager-class">DatabaseManager Class</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../database/index.html#database-operations">Database Operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../database/index.html#save-operations">Save Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../database/index.html#search-operations">Search Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../database/index.html#delete-operations">Delete Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../database/index.html#statistics-operations">Statistics Operations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../database/index.html#users">××™× ×“×§×¡×™× ×‘×§×•×œ×§×¦×™×™×ª users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/index.html#id1">××“×¨×™×›×™ ××•×“×•×œ×™× ×™×™×¢×•×“×™×™×</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../database/bookmarks-manager.html">×× ×”×œ ×¡×™×× ×™×•×ª â€“ BookmarksManager</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../database/bookmarks-manager.html#id1">××ª×™ ××©×ª××©×™× ×‘×•?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../database/bookmarks-manager.html#id2">××‘× ×” ×•××™× ×“×§×¡×™×</a></li>
<li class="toctree-l4"><a class="reference internal" href="../database/bookmarks-manager.html#id3">××’×‘×œ×•×ª ×©×™××•×©</a></li>
<li class="toctree-l4"><a class="reference internal" href="../database/bookmarks-manager.html#toggle">×ª×”×œ×™×š Toggle</a></li>
<li class="toctree-l4"><a class="reference internal" href="../database/bookmarks-manager.html#id4">×¡× ×›×¨×•×Ÿ ×¢× ×©×™× ×•×™×™× ×‘×§×•×‘×¥</a></li>
<li class="toctree-l4"><a class="reference internal" href="../database/bookmarks-manager.html#analytics">××™×¨×•×¢×™× (Analytics)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../database/bookmarks-manager.html#autodoc">Autodoc</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../database/collections-manager.html">×× ×”×œ ××•×¡×¤×™× â€“ CollectionsManager</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../database/collections-manager.html#id1">×¨×›×™×‘×™ ×‘×¡×™×¡</a></li>
<li class="toctree-l4"><a class="reference internal" href="../database/collections-manager.html#id2">××™× ×“×§×¡×™×</a></li>
<li class="toctree-l4"><a class="reference internal" href="../database/collections-manager.html#id3">×¡×•×’×™ ××•×¡×¤×™×</a></li>
<li class="toctree-l4"><a class="reference internal" href="../database/collections-manager.html#id4">×ª×¨×—×™×©×™ ×©×™××•×© × ×¤×•×¦×™×</a></li>
<li class="toctree-l4"><a class="reference internal" href="../database/collections-manager.html#id5">×—×•×§×™× ×•×©××™×¨×” ×¢×œ ××™×›×•×ª</a></li>
<li class="toctree-l4"><a class="reference internal" href="../database/collections-manager.html#id6">×©×™×ª×•×£ ×¦×™×‘×•×¨×™</a></li>
<li class="toctree-l4"><a class="reference internal" href="../database/collections-manager.html#autodoc">Autodoc</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../database/indexing.html">MongoDB Indexing Cookbook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../database/indexing.html#id1">×œ××”?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/indexing.html#id2">××™× ×“×§×¡×™× ××•××œ×¦×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/indexing.html#python-pymongo">××ª×›×•× ×™× (Python / PyMongo)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/indexing.html#explain-mongo-shell">×‘×“×™×§×•×ª explain (Mongo Shell)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/indexing.html#explain">××” ×œ×—×¤×© ×‘-explain?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/indexing.html#id3">×‘×“×™×§×ª ×§×™×•× ××™× ×“×§×¡×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/indexing.html#id4">×©×™×˜×•×ª ×¢×‘×•×“×” ××•××œ×¦×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/indexing.html#id5">×“×•×’×××•×ª × ×•×¡×¤×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/indexing.html#gotchas">Gotchas × ×¤×•×¦×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../database/cursor-pagination.html">Cursor-based Pagination (created_at / _id)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../database/cursor-pagination.html#id1">×œ××”?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/cursor-pagination.html#id2">×¢×§×¨×•× ×•×ª ××™×•×Ÿ ×™×¦×™×‘</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/cursor-pagination.html#python">×§×™×“×•×“/×¤×¢× ×•×— ×§×•×¨×¡×•×¨ (Python)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/cursor-pagination.html#id3">×ª×‘× ×™×ª ×©××™×œ×ª×” (×—×“×© â†’ ×™×©×Ÿ)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/cursor-pagination.html#pymongo">PyMongo â€“ ×“×•×’××” ××œ××”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/cursor-pagination.html#id4">×“×¤×“×•×£ ×œ××—×•×¨ (×™×©×Ÿ â†’ ×—×“×©)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/cursor-pagination.html#copypaste">×‘×“×™×§×•×ª ×™×“× ×™×•×ª (Copyâ€‘Paste)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/cursor-pagination.html#id5">×©×™×˜×•×ª ×¢×‘×•×“×” ××•××œ×¦×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/cursor-pagination.html#gotchas">Gotchas × ×¤×•×¦×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/cursor-pagination.html#id6">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../database-schema.html">Database Schema</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../database-schema.html#collections">Collections</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../database-schema.html#code-snippets"><code class="docutils literal notranslate"><span class="pre">code_snippets</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../database-schema.html#users"><code class="docutils literal notranslate"><span class="pre">users</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../database-schema.html#bookmarks"><code class="docutils literal notranslate"><span class="pre">bookmarks</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../database-schema.html#sessions-webapp"><code class="docutils literal notranslate"><span class="pre">sessions</span></code> (WebApp)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../database-schema.html#indexes">Indexes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database-schema.html#relationships">Relationships</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database-schema.html#id1">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../database/detailed-schema.html">××‘× ×” × ×ª×•× ×™× ××¤×•×¨×˜ (Detailed Database Schema)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../database/detailed-schema.html#id1">×¡×§×™×¨×” ×›×œ×œ×™×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/detailed-schema.html#code-snippets">××•×¡×£: code_snippets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/detailed-schema.html#large-files">××•×¡×£: large_files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/detailed-schema.html#users">××•×¡×£: users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/detailed-schema.html#bookmarks">××•×¡×£: bookmarks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/detailed-schema.html#collections">××•×¡×£: collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/detailed-schema.html#backups">××•×¡×£: backups</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/detailed-schema.html#id2">×™×—×¡×™× ×‘×™×Ÿ ××•×¡×¤×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/detailed-schema.html#best-practices">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/detailed-schema.html#id3">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">×¢×–×¨×” ×•×“×•×’×××•×ª:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">×“×•×’×××•×ª ×©×™××•×©</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#id2">×©×™××•×© ×‘×¡×™×¡×™</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#id3">×™×¦×™×¨×ª ××¤×œ×™×§×¦×™×™×ª ×‘×•×˜</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#id4">×©××™×¨×ª ×§×•×“ ×—×“×©</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#id5">×—×™×¤×•×© ×§×•×“</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#handlers">×©×™××•×© ×‘-Handlers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#command-handler">×™×¦×™×¨×ª Command Handler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#conversation-handler">×™×¦×™×¨×ª Conversation Handler</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#services">×©×™××•×© ×‘-Services</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#id6">×–×™×”×•×™ ×©×¤×ª ×ª×›× ×•×ª</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#id7">× ×™×ª×•×— ×§×•×“</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#github">××™× ×˜×’×¨×¦×™×” ×¢× GitHub</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#gist">×”×¢×œ××ª ×§×•×“ ×œ-Gist</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#gists">×©×œ×™×¤×ª Gists ×©×œ ××©×ª××©</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#id8">×¢×‘×•×“×” ×¢× ××¡×“ ×”× ×ª×•× ×™×</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#id9">×‘×™×¦×•×¢ ×©××™×œ×ª×•×ª ××•×¨×›×‘×•×ª</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#id10">×¢×“×›×•×Ÿ ×§×‘×¦×™×</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#id11">×¡×˜×˜×™×¡×˜×™×§×•×ª</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#id12">×˜×™×¤×•×œ ×‘×©×’×™××•×ª</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#id13">×˜×™×¤×•×œ ×‘×©×’×™××•×ª ×‘×¡×™×¡×™</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#retry-logic">Retry Logic</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#id14">×‘×“×™×§×•×ª</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#id15">×‘×“×™×§×ª ×™×—×™×“×”</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#id16">×‘×“×™×§×ª ××™× ×˜×’×¨×¦×™×”</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#id17">×“×•×’×××•×ª ××ª×§×“××•×ª</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#id18">×¢×™×‘×•×“ ×‘××¦×•×•×”</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#id19">×§××©×™× ×’</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#api-curl">×©×™×ª×•×£ ×¦×™×‘×•×¨×™ ×“×¨×š ×”â€‘API (curl)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#markdown">×“×•×’××ª Markdown ××ª×§×“××ª ×œ×ª×¦×•×’×”</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">Testing Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../testing.html#quickstart">ğŸš€ Quickstart ×œ×˜×¡×˜×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing.html#id1">×”× ×—×™×•×ª ×§×¨×™×˜×™×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing.html#stubs">×˜×¢×™× ×ª Stubs ×œ×˜×œ×’×¨×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing.html#tmp-path">×“×•×’××ª ×©×™××•×© ×‘â€‘tmp_path</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing.html#id2">××—×™×§×” ×‘×˜×•×—×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing.html#mocking-http-github-menu-handler">Mocking HTTP ×‘â€‘github_menu_handler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing.html#blueprint">×¨×™×©×•× Blueprint ×‘×¡×‘×™×‘×ª ×˜×¡×˜×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing.html#pytest-cov">×›×™×¡×•×™ ×‘×“×™×§×•×ª (pytest-cov)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing.html#ci">CI × ×ª××š</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing.html#performance">×‘×“×™×§×•×ª ×‘×™×¦×•×¢×™× (Performance)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing.html#id3">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../testing-rate-limit-examples.html">×“×•×’×××•×ª ×˜×¡×˜×™× â€“ Rate Limiting ×•××¡×™× ×›×¨×•× ×™×•×ª</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../testing-rate-limit-examples.html#rate-limiting-redis-mock">Rate Limiting (Redis Mock)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing-rate-limit-examples.html#id1">×˜×¡×˜×™× ××¡×™× ×›×¨×•× ×™×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../performance-tests.html">×‘×“×™×§×•×ª ×‘×™×¦×•×¢×™× (Performance Tests)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../performance-tests.html#id1">××˜×¨×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance-tests.html#id2">×¡×™××•×Ÿ ×˜×¡×˜×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance-tests.html#id3">×”×¨×¦×” ××§×•××™×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance-tests.html#ci-github-actions">CI / GitHub Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance-tests.html#id4">×“×•×—×•×ª ×•×–×× ×™ ×¨×™×¦×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance-tests.html#id5">×˜×™×¤×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ci-cd.html">CI/CD Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ci-cd.html#id1">×—×•×§×™× ×§×©×™×—×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ci-cd.html#id2">×¡×˜×˜×•×¡×™× × ×“×¨×©×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ci-cd.html#ci-overview">×¨×™×›×•×– CI (Overview)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ci-cd.html#id3">×‘×“×™×§×•×ª ××•××œ×¦×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ci-cd.html#id4">×‘× ×™×™×” ×©×œ ×”×ª×™×¢×•×“</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ci-cd.html#id5">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../conversation-handlers.html">Conversation Handlers &amp; States</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../conversation-handlers.html#id1">×¡×§×™×¨×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conversation-handlers.html#states">×¨×©×™××ª States (××‘×—×¨ ×‘×¤×•×¢×œ)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conversation-handlers.html#save-flow">Save Flow (×ª×¨×©×™× ××¦×‘×™×)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conversation-handlers.html#github-flow">GitHub Flow (×ª×¨×©×™× ××¦×‘×™×)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conversation-handlers.html#bot">×¡×¤×¨×™×™×ª ×¡× ×™×¤×˜×™× â€“ ×–×¨×™××ª ×”×’×©×” (Bot)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../conversation-handlers.html#id2">×‘×™×˜×•×œ ×”×•×’×Ÿ</a></li>
<li class="toctree-l3"><a class="reference internal" href="../conversation-handlers.html#id3">×”×ª×¨××•×ª ××“××™×Ÿ ×•×”×•×“×¢×ª ××©×ª××©</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../conversation-handlers.html#handler">×“×•×’××ª Handler ×ª××¦×™×ª×™×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conversation-handlers.html#id4">×˜×‘×œ×ª ×–×¨×™××•×ª ××œ××”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conversation-handlers.html#id5">×§×™×©×•×¨×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conversation-handlers.html#id6">×“×•×’×××•×ª ×§×•×“ ×ª××¦×™×ª×™×•×ª (×××©×™×•×ª)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../conversation-handlers.html#save">Save â€“ ×©×œ×‘×™× ×¢×™×§×¨×™×™×</a></li>
<li class="toctree-l3"><a class="reference internal" href="../conversation-handlers.html#github">GitHub â€“ ×ª×¤×¨×™×˜ ×•×©×™×—×ª ×”×¢×œ××”</a></li>
<li class="toctree-l3"><a class="reference internal" href="../conversation-handlers.html#backup">Backup â€“ ×ª×¤×¨×™×˜</a></li>
<li class="toctree-l3"><a class="reference internal" href="../conversation-handlers.html#drive">Drive â€“ ×ª×¤×¨×™×˜</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../conversation-handlers.html#id7">××•×§×©×™× × ×¤×•×¦×™× ×•×¤×ª×¨×•× ×•×ª</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../conversation-handlers.html#query-answer"><code class="docutils literal notranslate"><span class="pre">query.answer()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../conversation-handlers.html#message-is-not-modified">×¢×¨×™×›×ª ×”×•×“×¢×•×ª ×‘×‘×˜×—×” â€“ â€Message is not modifiedâ€œ</a></li>
<li class="toctree-l3"><a class="reference internal" href="../conversation-handlers.html#filters">Filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../conversation-handlers.html#persistent-data-context-user-data">Persistent data (<code class="docutils literal notranslate"><span class="pre">context.user_data</span></code>)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../conversation-handlers.html#id8">×“×•×’×××•×ª ×˜×¡×˜×™× ×§×¦×¨×•×ª</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../conversation-handlers.html#id9">Save â€“ ×”×ª×—×œ×” ×•×–×¨×™××” ×‘×¡×™×¡×™×ª</a></li>
<li class="toctree-l3"><a class="reference internal" href="../conversation-handlers.html#github-upload-conv-handler">GitHub â€“ upload_conv_handler</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#id1">×©×’×™××•×ª × ×¤×•×¦×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#importerror-telegram-conversationhandler-filters">ImportError ×‘×–××Ÿ ×˜×¡×˜×™× (telegram / ConversationHandler / filters)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#parse-mode">×©×’×™××•×ª parse_mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#asyncio-attached-to-a-different-loop-event-loop-is-closed">×©×’×™××•×ª asyncio: â€attached to a different loopâ€œ / â€Event loop is closedâ€œ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#id2">×“×™×‘×•×’ ××”×™×¨</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#mongodb">×‘×“×™×§×ª ×—×™×‘×•×¨ MongoDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#id3">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">Development Workflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../development.html#handler">×”×•×¡×¤×ª Handler ×—×“×©</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development.html#endpoint-webapp">×”×•×¡×¤×ª Endpoint ×œâ€‘WebApp</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development.html#schema">×¢×“×›×•×Ÿ Schema ×‘××¡×“ ×”× ×ª×•× ×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development.html#id1">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../development/pre-commit.html">Pre-commit Hooks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../development/pre-commit.html#id1">××˜×¨×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/pre-commit.html#id2">×”×ª×§× ×” ×•×”×¨×¦×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/pre-commit.html#hooks">Hooks ×¤×¢×™×œ×™× (×¢×™×§×¨×™×™×)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/pre-commit.html#id3">×˜×™×¤×™× ×œ×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../development/tools.html">×›×œ×™ ×¢×–×¨ ×œ××¤×ª×—×™×</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../development/tools.html#tools-analyze-queries-py"><code class="docutils literal notranslate"><span class="pre">tools/analyze_queries.py</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../development/tools.html#id3">××˜×¨×”</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/tools.html#id4">×“×¨×™×©×•×ª</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/tools.html#id5">×“×•×’××ª ×”×¨×¦×”</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/tools.html#id6">×¤×œ×˜ ××•×¤×™×™× ×™</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/tools.html#id7">×˜×™×¤×™×</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../development/tools.html#tools-dup-scan-py"><code class="docutils literal notranslate"><span class="pre">tools/dup_scan.py</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../development/tools.html#id8">××˜×¨×”</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/tools.html#id9">×“×•×’××ª ×”×¨×¦×”</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/tools.html#id10">×¤×¨××˜×¨×™× ×—×©×•×‘×™×</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/tools.html#best-practices">Best Practices</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../development/scripts.html">×¡×§×¨×™×¤×˜×™× ×©×™××•×©×™×™×</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../development/scripts.html#scripts-cleanup-repo-tags-py"><code class="docutils literal notranslate"><span class="pre">scripts/cleanup_repo_tags.py</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/scripts.html#scripts-dev-seed-py"><code class="docutils literal notranslate"><span class="pre">scripts/dev_seed.py</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/scripts.html#scripts-import-snippets-from-markdown-py">scripts/import_snippets_from_markdown.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/scripts.html#scripts-migrate-workspace-collections-py">scripts/migrate_workspace_collections.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/scripts.html#scripts-run-log-aggregator-py"><code class="docutils literal notranslate"><span class="pre">scripts/run_log_aggregator.py</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/scripts.html#scripts-start-webapp-sh"><code class="docutils literal notranslate"><span class="pre">scripts/start_webapp.sh</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/scripts.html#scripts-start-with-worker-sh"><code class="docutils literal notranslate"><span class="pre">scripts/start_with_worker.sh</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../development/i18n.html">×‘×™× ××•× ×•×ª××™×›×” ×‘×©×¤×•×ª</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../development/i18n.html#id3">××‘× ×” ×”×§×‘×¦×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/i18n.html#id4">×‘×—×™×¨×ª ×©×¤×” ×‘×–××Ÿ ×¨×™×¦×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/i18n.html#id5">×”×•×¡×¤×ª ×©×¤×” ×—×“×©×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/i18n.html#id6">×¢×§×¨×•× ×•×ª ×›×ª×™×‘×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/i18n.html#id7">×‘×“×™×§×•×ª ××”×™×¨×•×ª</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../integrations.html">Integrations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../integrations.html#github-api">GitHub API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../integrations.html#gist">×™×¦×™×¨×ª Gist (×“×•×’××”)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../integrations.html#google-drive-oauth-flow">Google Drive (OAuth Flow)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations.html#telegram-webhooks-vs-polling">Telegram Webhooks vs Polling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations.html#id1">×§×™×©×•×¨×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations.html#github-scopes">GitHub â€“ Scopes × ×“×¨×©×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations.html#troubleshooting-github-rate-limits">Troubleshooting GitHub â€“ Rate limits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations.html#github-cli-gh">GitHub CLI (gh) â€“ ×ª×§×¦×™×¨ ×§×¦×¨</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations.html#repository-providers">Repository Providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations.html#best-practices-monorepos">Best Practices â€“ ×××’×¨×™× ×’×“×•×œ×™×/Monorepos</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../repository-integrations.html">Repository Integrations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../repository-integrations.html#id1">×¡×§×™×¨×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../repository-integrations.html#id2">××¦×‘ ×ª××™×›×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../repository-integrations.html#id3">×”×¢×¨×•×ª</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">Security Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../security.html#id1">×¡×•×“×•×ª ×•×¤×¨×˜×™×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#id2">×”×¦×¤× ×ª ×˜×•×§× ×™× (×“×•×’××”)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#csrf-webapp">CSRF ×‘â€‘WebApp</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#rate-limiting">Rate Limiting (×“×•×’××”)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#id3">×§×™×©×•×¨×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html#id4">××‘×˜×—×ª ×”×•×“×¢×•×ª ×‘×˜×œ×’×¨×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../monitoring.html">Smart Observability v7 â€“ Predictive Health &amp; Adaptive Feedback</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../monitoring.html#grafana-telegram-webhook">×—×™×‘×•×¨ Grafana â†’ Telegram (Webhook)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring.html#grafana-annotations">Grafana Annotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring.html#adaptive-thresholds">Adaptive Thresholds (×¡×¤×™× ×“×™× ××™×™×)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring.html#id1">×”×¤×¨×“×” ×‘×™×Ÿ ×©×’×™××•×ª ×¤× ×™××™×•×ª ×œ×—×™×¦×•× ×™×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring.html#predictive-health-v7">Predictive Health (v7)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../monitoring.html#safe-mode">SAFE_MODE ×•×“×™×œ×•×’ ×¢×œ ×¤×¢×•×œ×•×ª ×× ×¢</a></li>
<li class="toctree-l3"><a class="reference internal" href="../monitoring.html#chatops">ChatOps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../monitoring.html#chatops-rate-limit">×”×¨×©××•×ª ChatOps ×•-Rate Limit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../monitoring.html#grafana">Grafana â€“ ×™×™×‘×•× ×“×©×‘×•×¨×“ ×œ×“×•×’××”</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring.html#grafana-accuracy-prevention-panels">Grafana â€“ Accuracy &amp; Prevention Panels</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../monitoring.html#feedback-loop">×ª×¨×©×™× ×–×¨×™××ª Feedback Loop</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring.html#autoremediation-v5">Autoâ€‘Remediation (v5)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../monitoring.html#incident-memory">Incident Memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../monitoring.html#id2">Feedback Loop ×œ××™×¨×•×¢×™× ×—×•×–×¨×™×</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring.html#chatops-observe">ChatOps â€“ /observe</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../monitoring.html#id3">×”×¨×—×‘×•×ª ××¦×‘ ××¤×•×¨×˜</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring.html#endpoints">Endpoints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring.html#id4">×§×™×©×•×¨×™× ×œ×ª×™×¢×•×“ ChatOps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring.html#id5">×˜×™×¤×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../git-lfs.html">Git LFS Integration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../git-lfs.html#id1">××˜×¨×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git-lfs.html#lfs">××ª×™ ×œ×”×©×ª××© ×‘â€‘LFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git-lfs.html#id2">×”×ª×§× ×” ×‘×¡×™×¡×™×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git-lfs.html#best-practices">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git-lfs.html#id3">××’×‘×œ×•×ª ×•×’×‘×•×œ×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git-lfs.html#id4">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user/bookmarks.html">×¡×™×× ×™×•×ª (Bookmarks)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../user/bookmarks.html#id1">××”×Ÿ ×¡×™×× ×™×•×ª?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/bookmarks.html#id2">××™×š ×œ×”×•×¡×™×£ ×¡×™×× ×™×™×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/bookmarks.html#id3">×¤×× ×œ ×”×¡×™×× ×™×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/bookmarks.html#anchor">Anchor ×™×¦×™×‘</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/bookmarks.html#id4">××’×‘×œ×•×ª, ××‘×˜×—×” ×•×¤×¨×˜×™×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/bookmarks.html#api">API ×§×¦×¨ (×œ××¤×ª×—×™×)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/bookmarks.html#id5">×”×¢×¨×•×ª ×©×™××•×©×™×•×ª</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user/sticky_notes.html">×¤×ª×§×™× ×“×‘×™×§×™× (Sticky Notes)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../user/sticky_notes.html#id1">××”× ×¤×ª×§×™× ×“×‘×™×§×™×?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/sticky_notes.html#id2">××™×š ××•×¡×™×¤×™× ×•×× ×”×œ×™× ×¤×ª×§×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/sticky_notes.html#id3">×¢×™×’×•×Ÿ ×™×¦×™×‘ ×œ×¢×•××ª ××™×§×•× ×§×‘×•×¢</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/sticky_notes.html#id4">×©×™×œ×•×‘ ×¢× ×¡×™×× ×™×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/sticky_notes.html#id5">××’×‘×œ×•×ª, ×¤×¨×˜×™×•×ª ×•××‘×˜×—×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/sticky_notes.html#id6">×˜×™×¤×™× ×©×™××•×©×™×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/sticky_notes.html#api">API ×§×¦×¨ (×œ××¤×ª×—×™×)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/sticky_notes.html#reminders">×”×ª×¨××•×ª ×•×ª×–×›×•×¨×•×ª (Reminders)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user/sticky_notes.html#id7">××™×•×¨×™×</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user/sticky_notes.html#troubleshooting">Troubleshooting ×§×¦×¨</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user/sticky_notes.html#id8">×‘×¢×™×•×ª × ×¤×•×¦×•×ª ×‘×ª×–×›×•×¨×•×ª</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user/reminders.html">×ª×–×›×•×¨×•×ª ×‘×‘×•×˜</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../user/reminders.html#id2">×¡×§×™×¨×” ×§×¦×¨×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/reminders.html#id3">×¤×§×•×“×•×ª ×¢×™×§×¨×™×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/reminders.html#id4">××™×š ×”×•×•×™×–×¨×“ ×¢×•×‘×“</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/reminders.html#id5">×˜×™×¤×™× ×œ×©×™××•×© ×‘×¤×§×•×“×” ××”×™×¨×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/reminders.html#id6">× ×™×”×•×œ ×”×ª×–×›×•×¨×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/reminders.html#id7">××’×‘×œ×•×ª ×•××“×™× ×™×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/reminders.html#id8">××ª×–××Ÿ ×•×”×ª××•×©×©×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/reminders.html#id9">×—×™×‘×•×¨ ×œ×§×•×“</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/reminders.html#id10">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user/my_collections.html">×”××•×¡×¤×™× ×©×œ×™ (My Collections)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../user/my_collections.html#id1">××”× ××•×¡×¤×™×?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/my_collections.html#id2">×™×›×•×œ×•×ª ××¨×›×–×™×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/my_collections.html#id3">××™×š ××©×ª××©×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/my_collections.html#id4">×©×™×œ×•×‘ ×¢× ×¡×™×× ×™×•×ª ×•×¤×ª×§×™× ×“×‘×™×§×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/my_collections.html#id5">××’×‘×œ×•×ª ×•×¤×¨×˜×™×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/my_collections.html#api">API ×§×¦×¨ (×œ××¤×ª×—×™×)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/my_collections.html#id6">×˜×™×¤×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/my_collections.html#id7">××•×‘×™×™×œ/×˜××‘×œ×˜ â€“ ×’×¨×™×¨×” ×œ×¡×™×“×•×¨</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/my_collections.html#kanban">×œ×•×— Kanban ×¢×‘×•×¨ <em>×©×•×œ×—×Ÿ ×”×¢×‘×•×“×”</em></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user/share_code.html">×©×™×ª×•×£ ×§×•×“ (×—×©×•×‘)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../user/share_code.html#id2">××” ×–×” ×¢×•×©×”?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/share_code.html#id3">××™×¤×” ×”×›×¤×ª×•×¨ ××•×¤×™×¢?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/share_code.html#id4">××™×š ×–×” ×¢×•×‘×“ (×–×¨×™××”)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/share_code.html#env">×“×¨×™×©×•×ª ×¡×‘×™×‘×ª×™×•×ª (ENV)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/share_code.html#id5">××’×‘×œ×•×ª ×•×”×ª× ×”×’×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/share_code.html#id6">×”×•×“×¢×•×ª ×”×¦×œ×—×”/×©×’×™××”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/share_code.html#troubleshooting">Troubleshooting ×§×¦×¨</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/share_code.html#id7">×“×•×’×××•×ª (×˜×§×¡×˜×•××œ×™×•×ª)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user/github_browse.html">×¢×™×•×Ÿ ×‘×§×•×“ GitHub (×›×•×œ×œ ×—×™×¤×•×© ×‘×©× ×§×•×‘×¥)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../user/github_browse.html#id1">×©×•×¨×ª ×›×œ×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/github_browse.html#id2">×ª×•×¦××•×ª ×—×™×¤×•×©</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/github_browse.html#id3">× ×™×•×•×˜ ×¨×™×¤×•</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user/download_repo.html">×”×•×¨×“×ª ×¨×™×¤×•</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../user/download_repo.html#id2">××” ×‘×“×™×•×§ ××•×¨×™×“</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/download_repo.html#id3">××’×‘×œ×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/download_repo.html#id4">×”×•×“×¢×•×ª × ×¤×•×¦×•×ª</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../BOT_TEST_PLAN_CONTAINER.html">×ª×›× ×™×ª ×‘×“×™×§×•×ª ×œ×‘×•×˜ â€“ Composition Root (Container) ×œ×©×™×¨×•×ª Snippet</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../BOT_TEST_PLAN_CONTAINER.html#id1">××™×š ×œ×‘×“×•×§</a></li>
<li class="toctree-l2"><a class="reference internal" href="../BOT_TEST_PLAN_CONTAINER.html#copy-paste">×¡×˜ ×“×•×’×××•×ª ×œ×©××™×¨×” (Copy/Paste)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../BOT_TEST_PLAN_CONTAINER.html#id2">×‘×“×™×§×•×ª × ×•×¡×¤×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../BOT_TEST_PLAN_CONTAINER.html#id3">×ª×§×œ×•×ª ×©×›×“××™ ×œ×¢×§×•×‘ ××—×¨×™×”×Ÿ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../BOT_TEST_PLAN_CONTAINER.html#facade-container">×‘×“×™×§×•×ª ×–×¨×™××” ××•×¨×—×‘×•×ª (×œ××—×¨ ××¢×‘×¨ ×œ-Facade/Container)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../BOT_TEST_PLAN_CONTAINER.html#id4">1) ×©××™×¨×”/×ª×¦×•×’×”/×¢×¨×™×›×” (×§×‘×¦×™× ×¨×’×™×œ×™×)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../BOT_TEST_PLAN_CONTAINER.html#id5">2) ×§×‘×¦×™× ×’×“×•×œ×™×</a></li>
<li class="toctree-l3"><a class="reference internal" href="../BOT_TEST_PLAN_CONTAINER.html#id6">3) ××¡××›×™×/×”×¢×œ××•×ª</a></li>
<li class="toctree-l3"><a class="reference internal" href="../BOT_TEST_PLAN_CONTAINER.html#google-drive">4) Google Drive</a></li>
<li class="toctree-l3"><a class="reference internal" href="../BOT_TEST_PLAN_CONTAINER.html#chatops">5) ChatOps â€“ ×–×™×”×•×™ ×©×¤×” (×©×§×™×¤×•×ª ×•×“×™×‘×•×’)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../BOT_TEST_PLAN_CONTAINER.html#id7">6) ×¨×’×¨×¡×™×” ×›×œ×œ×™×ª</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">×–×¨×™××•×ª ×¢×‘×•×“×”:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../workflows/index.html">×–×¨×™××•×ª ×¢×‘×•×“×” (Workflows)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../workflows/index.html#id1">×¡×§×™×¨×” ×›×œ×œ×™×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workflows/index.html#id2">×¨×©×™××ª ×–×¨×™××•×ª</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../workflows/save-flow.html">×–×¨×™××ª ×©××™×¨×ª ×§×•×“ (Save Flow)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../workflows/save-flow.html#id1">×¡×§×™×¨×” ×›×œ×œ×™×ª</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/save-flow.html#id2">××¦×‘×™ ×©××™×¨×”</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/save-flow.html#id3">×–×¨×™××ª ×¢×‘×•×“×” ×‘×¡×™×¡×™×ª</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/save-flow.html#long-collect">××¦×‘ ××™×¡×•×£ ××¨×•×š (LONG_COLLECT)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/save-flow.html#secrets-detection">×–×™×”×•×™ ×¡×•×“×•×ª (Secrets Detection)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/save-flow.html#id4">×˜×™×¤×•×œ ×‘×›×¤×™×œ×•×™×•×ª</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/save-flow.html#id5">× ×¨××•×œ ×§×•×“</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/save-flow.html#edge-cases">Edge Cases</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/save-flow.html#id6">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../workflows/search-flow.html">×–×¨×™××ª ×—×™×¤×•×© (Search Flow)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../workflows/search-flow.html#id1">×¡×§×™×¨×” ×›×œ×œ×™×ª</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/search-flow.html#id2">×¡×•×’×™ ×—×™×¤×•×©</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/search-flow.html#id3">×–×¨×™××ª ×¢×‘×•×“×”</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/search-flow.html#searchindex">××‘× ×” SearchIndex</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/search-flow.html#id4">×¤×™×œ×˜×¨×™×</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/search-flow.html#regex">×˜×™×¤×•×œ ×‘×©×’×™××•×ª Regex</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/search-flow.html#id5">××™×•×Ÿ ×ª×•×¦××•×ª</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/search-flow.html#relevance-score">×—×™×©×•×‘ Relevance Score</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/search-flow.html#edge-cases">Edge Cases</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/search-flow.html#id6">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../workflows/refactor-flow.html">×–×¨×™××ª ×¨×¤×§×˜×•×¨×™× ×’ (Refactor Flow)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../workflows/refactor-flow.html#id1">×¡×§×™×¨×” ×›×œ×œ×™×ª</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/refactor-flow.html#id2">×¡×•×’×™ ×¨×¤×§×˜×•×¨×™× ×’</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/refactor-flow.html#id3">×–×¨×™××ª ×¢×‘×•×“×”</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/refactor-flow.html#telegram">×©×™××•×© ×‘×‘×•×˜ (Telegram)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/refactor-flow.html#codeanalyzer">CodeAnalyzer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/refactor-flow.html#id4">×™×¦×™×¨×ª ×”×¦×¢×ª ×¨×¤×§×˜×•×¨×™× ×’</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/refactor-flow.html#id5">××™××•×ª ×œ×¤× ×™ ×•××—×¨×™</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/refactor-flow.html#id6">×™×™×¦×•× ×œ×’×™×¡×˜ (××•×¤×¦×™×•× ×œ×™)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/refactor-flow.html#id7">×©××™×¨×ª ×’×¨×¡×”</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/refactor-flow.html#edge-cases">Edge Cases</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/refactor-flow.html#cohesion-policy">××“×™× ×™×•×ª ×§×™×‘×•×¥ ×•×¤×™×¦×•×œ (Cohesion Policy)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/refactor-flow.html#smart-clustering-cycle-guard">Smart Clustering ×•â€‘Cycle Guard</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/refactor-flow.html#safe-decomposition-models-py">Safe Decomposition ×œâ€‘models.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/refactor-flow.html#canonical">×©××•×ª ×§×‘×¦×™× ×“×•××™×™× ×™×™× (Canonical)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/refactor-flow.html#layered">××¦×‘ ×©×›×‘×•×ª (Layered)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/refactor-flow.html#id8">×¤×¨××˜×¨×™× × ×™×ª× ×™× ×œ×›×•×•× ×•×Ÿ</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/refactor-flow.html#id9">××’×‘×œ×•×ª ×™×“×•×¢×•×ª</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/refactor-flow.html#id10">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../workflows/backup-flow.html">×–×¨×™××ª ×’×™×‘×•×™ ×•×©×—×–×•×¨ (Backup Flow)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../workflows/backup-flow.html#id1">×¡×§×™×¨×” ×›×œ×œ×™×ª</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/backup-flow.html#id2">×¡×•×’×™ ×’×™×‘×•×™×™×</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/backup-flow.html#id3">×™×¦×™×¨×ª ×’×™×‘×•×™ ××œ×</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/backup-flow.html#id4">×©×—×–×•×¨ ××’×™×‘×•×™</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/backup-flow.html#google-drive">×’×™×‘×•×™ ×œ-Google Drive</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/backup-flow.html#id5">× ×™×”×•×œ ×’×™×‘×•×™×™×</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/backup-flow.html#zip">×™×™×‘×•× ZIP ×—×™×¦×•× ×™</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/backup-flow.html#edge-cases">Edge Cases</a></li>
<li class="toctree-l4"><a class="reference internal" href="../workflows/backup-flow.html#id6">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../workflows/index.html#id3">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">×× ×•×¢×™ ×”××¢×¨×›×ª:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../engines/overview.html">×× ×•×¢×™ ×”××¢×¨×›×ª (System Engines)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../engines/overview.html#id1">×¡×§×™×¨×” ×›×œ×œ×™×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../engines/overview.html#search-engine">×× ×•×¢ ×—×™×¤×•×© (Search Engine)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../engines/overview.html#refactoring-engine">×× ×•×¢ ×¨×¤×§×˜×•×¨×™× ×’ (Refactoring Engine)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../engines/overview.html#smart-clustering-cycle-guard">×™×›×•×œ×•×ª ××ª×§×“××•×ª (Smart Clustering, Cycle Guard)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../engines/overview.html#layered-mode">××¦×‘ ×©×›×‘×•×ª (Layered Mode)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../engines/overview.html#safe-decomposition-models-py-models">Safe Decomposition ×œâ€‘models.py (×¤×™×¦×•×œ ×‘×˜×•×— ×œ×—×‘×™×œ×ª models/)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../engines/overview.html#code-processor">××¢×‘×“ ×§×•×“ (Code Processor)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../engines/overview.html#code-analyzer">×× ×•×¢ × ×™×ª×•×— (Code Analyzer)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../engines/overview.html#backup-service">×× ×•×¢ ×’×™×‘×•×™×™× (Backup Service)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../engines/overview.html#integration-services">×× ×•×¢ ××™× ×˜×’×¨×¦×™×•×ª (Integration Services)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../engines/overview.html#observability">×× ×•×¢ Observability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../engines/overview.html#id2">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Edge Cases ×•×˜×™×¤×•×œ ×‘×©×’×™××•×ª:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../edge-cases.html">Edge Cases ×•×˜×™×¤×•×œ ×‘×©×’×™××•×ª</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../edge-cases.html#id1">×¡×§×™×¨×” ×›×œ×œ×™×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../edge-cases.html#id2">×§×‘×¦×™× ×’×“×•×œ×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../edge-cases.html#id3">×§×™×“×•×“×™× ×œ× ×¡×˜× ×“×¨×˜×™×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../edge-cases.html#github-rate-limits">GitHub Rate Limits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../edge-cases.html#mongodb-connection-errors">MongoDB Connection Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../edge-cases.html#redis-unavailability">Redis Unavailability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../edge-cases.html#parsing">×©×’×™××•×ª Parsing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../edge-cases.html#file-i-o">×©×’×™××•×ª File I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="../edge-cases.html#network">×©×’×™××•×ª Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="../edge-cases.html#validation">×©×’×™××•×ª Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../edge-cases.html#concurrent-access">×©×’×™××•×ª Concurrent Access</a></li>
<li class="toctree-l2"><a class="reference internal" href="../edge-cases.html#best-practices">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../edge-cases.html#id4">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">××™×›×•×ª ×•×§×•× ×‘× ×¦×™×•×ª:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quality/type-safety.html">ğŸ“ Type Hints â€“ Best Practices</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../quality/type-safety.html#id1">××¡×˜×¨×˜×’×™×”: ×”×§×©×—×” ×”×“×¨×’×ª×™×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quality/type-safety.html#id2">×¤×¨×•×˜×•×§×•×œ×™× ×•×¡×˜××‘×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quality/type-safety.html#id3">×“×•×’×××•×ª ××”×§×•×“</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quality/type-safety.html#mypy">×”×’×“×¨×•×ª MyPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quality/type-safety.html#id4">××¡×œ×•×œ ××™×’×¨×¦×™×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quality/type-safety.html#id5">×”× ×—×™×•×ª ×œ×¡×•×›× ×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quality/type-safety.html#id6">×“×•×’×××•×ª ×§×¦×¨×•×ª</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../quality/code-normalization.html">× ×¨××•×œ ×§×•×“ (Code Normalization)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../quality/code-normalization.html#id1">×œ××” ×‘×›×œ×œ ×× ×¨××œ×™×?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quality/code-normalization.html#id2">××ª×™ ×•××™×¤×” ×”×× ×’× ×•×Ÿ ×¨×¥?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quality/code-normalization.html#id3">××” ×‘×“×™×•×§ ×§×•×¨×” ×‘××”×œ×š ×”× ×¨××•×œ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quality/code-normalization.html#api">××™×š ×œ×‘×—×•×¨ API?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quality/code-normalization.html#id4">×“×’×©×™× ×œ×¡×•×›× ×™× ×‘×¢×ª ×›×ª×™×‘×ª ×§×•×“</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quality/code-normalization.html#id5">×˜×¡×˜×™×, ×“×™×‘×•×’ ×•×©×—×–×•×¨ ×ª×§×œ×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quality/code-normalization.html#id6">×©××œ×•×ª × ×¤×•×¦×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quality/code-normalization.html#id7">××” ×œ×¢×©×•×ª ×›×©××•×¡×™×¤×™× ×–×¨×™××” ×—×“×©×”?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quality/code-normalization.html#id8">×§×™×©×•×¨×™× ×¨×œ×•×•× ×˜×™×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ARCHITECTURE_LAYER_RULES.html">×›×œ×œ×™ ×©×›×‘×•×ª â€“ CodeBot</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ARCHITECTURE_LAYER_RULES.html#id1">×©×›×‘×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ARCHITECTURE_LAYER_RULES.html#composition-root">Composition Root</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ARCHITECTURE_LAYER_RULES.html#id2">×–×™×”×•×™ ×©×¤×” â€“ ××§×•×¨ ×××ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ARCHITECTURE_LAYER_RULES.html#id3">×‘×“×™×§×•×ª ××›×™×¤×”</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">WebApp:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../webapp/overview.html">×”××™× ×™ Web App (×¡×§×™×¨×”)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../webapp/overview.html#id1">××” × ×•×ª×Ÿ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/overview.html#id2">×“×©×‘×•×¨×“ ×—×“×©</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../webapp/overview.html#id3">××™×™×§×•× ×™ ×©×¤×” ××—×™×“×™×</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../webapp/overview.html#id4">×˜×‘×œ×ª ××™×™×§×•× ×™× × ×¤×•×¦×™×</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/overview.html#ai">×”× ×—×™×•×ª ×œ×¡×•×›× ×™ AI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/overview.html#id5">×›×ª×•×‘×ª ×•×”×¨×©××•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/overview.html#env">×”×’×“×¨×•×ª ENV</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/overview.html#id6">×§×™×©×•×¨×™× ×•×ª××•× ×•×ª ××¡×š</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/overview.html#id7">×¨××• ×’×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/overview.html#id8">×‘×× ×¨ ×”×›×¨×–×•×ª ×‘×¨××© ×”××¡×š</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../webapp/overview.html#id9">××™×š ××¤×¢×™×œ×™×?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/overview.html#id10">×”×¢×¨×•×ª ×•×§×™×©×•×¨×™×</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/overview.html#id11">××” ×§×•×¨×” ×××—×•×¨×™ ×”×§×œ×¢×™×?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/overview.html#id12">×›×™×‘×•×™ ×–×× ×™</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/overview.html#id13">×”××œ×¦×•×ª ×œ×ª×•×›×Ÿ</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../DEV_WEB_PUSH.html">Web Push â€“ Sticky Notes Reminders</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../DEV_WEB_PUSH.html#id1">×“×¨×™×©×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../DEV_WEB_PUSH.html#vapid">×”×’×“×¨×ª ××¤×ª×—×•×ª VAPID</a></li>
<li class="toctree-l2"><a class="reference internal" href="../DEV_WEB_PUSH.html#id2">×”×¤×¢×œ×”/×›×™×‘×•×™</a></li>
<li class="toctree-l2"><a class="reference internal" href="../DEV_WEB_PUSH.html#remote-worker">××¦×‘ Remote Worker (××•××œ×¥ ×œ×¤×¨×•×“×§×©×Ÿ)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../DEV_WEB_PUSH.html#sidecar-render">×—×œ×•×¤×”: Sidecar (×œ×œ× ×©×™×¨×•×ª Render × ×•×¡×£)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../DEV_WEB_PUSH.html#server">× ×§×•×“×•×ª ×§×¦×” (Server)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../DEV_WEB_PUSH.html#service-worker">Service Worker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../DEV_WEB_PUSH.html#id3">×¦×“â€‘×œ×§×•×—</a></li>
<li class="toctree-l2"><a class="reference internal" href="../DEV_WEB_PUSH.html#id4">×©×œ×™×—×” ×‘×–××Ÿ ×××ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../DEV_WEB_PUSH.html#id5">×‘×“×™×§×•×ª</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../webapp/user-interfaces.html">×××©×§×™ ××©×ª××©×™× (Web)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../webapp/user-interfaces.html#id1">××” ×–×”?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/user-interfaces.html#id2">×”×™×›×Ÿ ×–×” × ××¦×?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/user-interfaces.html#id3">×–×¨×™××ª ×¢×‘×•×“×” ×“×¨×š ×”×‘×•×˜</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/user-interfaces.html#id4">×©×“×•×ª ×—×•×‘×” ×•×œ×•×’×™×§×ª ×•×œ×™×“×¦×™×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/user-interfaces.html#id5">×—×™×•×•×™ ××¦×‘ ×ª×”×œ×™×š</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/user-interfaces.html#id6">×××©×§ ××“××™×Ÿ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/user-interfaces.html#ai">×“×•×’×××•×ª ×©×™××•×© ×œ×¡×•×›× ×™ AI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/user-interfaces.html#id7">××‘×˜×—×” ×•×¤×¨×˜×™×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/user-interfaces.html#id8">×”×¢×¨×•×ª ×ª××™××•×ª</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../webapp/snippet-library.html">×¡×¤×¨×™×™×ª ×¡× ×™×¤×˜×™× (Web)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../webapp/snippet-library.html#id1">××” ×–×”?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/snippet-library.html#ui">×××¤×™×™× ×™ UI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/snippet-library.html#api-json">API â€“ JSON</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../webapp/snippet-library.html#openapi">OpenAPI (×ª×§×¦×™×¨)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/snippet-library.html#json-schema-response">JSON Schema (Response)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/snippet-library.html#id2">×›×œ×œ×™ ×“×¤×“×•×£/×¡×¤×™×¨×”</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/snippet-library.html#id3">×©×’×™××•×ª</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/snippet-library.html#curl">×“×•×’×××•×ª cURL</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/snippet-library.html#id4">×”×’×©×•×ª, ××™×©×•×¨ ×•× ×™×”×•×œ (××“××™×Ÿ)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/snippet-library.html#id5">×™×™×‘×•× ××¡××š (××“××™×Ÿ)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/snippet-library.html#id6">×”×’×©×” ×“×¨×š ×”×‘×•×˜</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/snippet-library.html#id7">UI ×‘×‘×•×˜ â€“ ×”×¡×¨×•×ª ×•×©×™×¤×•×¨×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/snippet-library.html#id8">×’×¨×¡×” ××©×•×“×¨×’×ª â€“ ××” ×—×“×©</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/snippet-library.html#ai">××“×¨×™×š ×§×¦×¨ ×œ×¡×•×›× ×™ AI</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../webapp/onboarding.html">ğŸ§­ WebApp Onboarding â€“ Welcome Modal, Interactive Tour &amp; Theme Wizard</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../webapp/onboarding.html#id1">×¨×›×™×‘×™× ×•××” ×”× ×¢×•×©×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/onboarding.html#id2">×ª×¨×©×™× ××™× ×˜×¨××§×¦×™×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/onboarding.html#welcome-modal">Welcome Modal â€“ ×¨×¢× ×•×Ÿ ×§×¦×¨</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../webapp/onboarding.html#id3">××˜×¨×•×ª</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/onboarding.html#id4">×–×¨×™××ª ××©×ª××©</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/onboarding.html#id5">×¡× ×›×¨×•×Ÿ ×œ××“×¨×™×š ×”×¢×“×›× ×™</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../webapp/onboarding.html#id6">××™×š ×œ×¢×“×›×Ÿ</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/onboarding.html#anchors">×§×™×©×•×¨×™ ××“×¨×™×›×™× (Anchors)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/onboarding.html#best-practices">Best Practices â€“ ×¡×™××•×Ÿ ××©×ª××©×™× ×—×“×©×™×</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/onboarding.html#js-ajax">×“×•×’××ª JS â€“ ××•×“××œ ×¢× Ajax</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/onboarding.html#api">API ×§×©×•×¨</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/onboarding.html#interactive-tour-driver-js">Interactive Tour (Driver.js)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../webapp/onboarding.html#id7">××ª×™ ×”×¡×™×•×¨ × ×¤×ª×—?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/onboarding.html#id8">×©×œ×‘×™ ×”×¡×™×•×¨</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/onboarding.html#id9">×”×¤×¢×œ×” ×™×“× ×™×ª ×•××™×¤×•×¡</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/onboarding.html#id10">×ª×—×–×•×§×” ×œ××¤×ª×—×™×</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/onboarding.html#troubleshooting">Troubleshooting â€“ â€×œ××” ×”×¡×™×•×¨ ×œ× ××•×¤×™×¢?â€œ</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/onboarding.html#gif">×¦×™×œ×•××™ ××¡×š / GIF</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/onboarding.html#theme-picker-wizard-personalization">Theme Picker Wizard (Personalization)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../webapp/onboarding.html#id11">×¡×§×™×¨×” ×›×œ×œ×™×ª</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/onboarding.html#id12">×˜×¨×™×’×¨×™× ×•×”×’× ×•×ª</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/onboarding.html#id13">×××©×§ ×•×—×•×•×™×™×ª ××©×ª××©</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/onboarding.html#id14">×”×ª××“×” ×•×¡× ×›×¨×•×Ÿ ×©×¨×ª</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/onboarding.html#debugging-reset">ğŸ› ï¸ Debugging &amp; Reset</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/onboarding.html#qa">××“×¨×™×š ×‘×“×™×§×•×ª (QA)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/onboarding.html#id15">×¦×™×œ×•××™ ××¡×š</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/onboarding.html#id16">×§×™×©×•×¨×™× ×¨×œ×•×•× ×˜×™×™×</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/onboarding.html#id17">Troubleshooting ××¨×•×›×– â€“ â€×œ××” ×©×•× ×“×‘×¨ ×œ× ×§×•×¤×¥ ×œ×™?â€œ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/onboarding.html#id18">××“×™×” ×•×”×¨×—×‘×•×ª</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../webapp/caching.html">Caching &amp; HTTP Validators (ETag / Last-Modified / 304)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../webapp/caching.html#id1">×œ××” ×–×” ×—×©×•×‘?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/caching.html#id2">×¢×§×¨×•× ×•×ª ×‘×¡×™×¡</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/caching.html#flask-werkzeug">××ª×›×•×Ÿ: Flask + werkzeug</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/caching.html#copypaste">×‘×“×™×§×•×ª ×™×“× ×™×•×ª (Copyâ€‘Paste)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/caching.html#checklist">Checklist ×œ××™××•×© × ×›×•×Ÿ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/caching.html#gotchas">Gotchas × ×¤×•×¦×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/caching.html#cache-control">×©×™×œ×•×‘ ×¢× Cache-Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/caching.html#id3">×§×™×©×•×¨×™× × ×•×¡×¤×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../webapp/advanced-caching.html">××¢×¨×›×ª Caching ××ª×§×“××ª ×¢× TTL ×“×™× ××™</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../webapp/advanced-caching.html#id1">×¢×§×¨×•× ×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/advanced-caching.html#id2">×§×•×“ ×œ×“×•×’××”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/advanced-caching.html#id3">×“×’×©×™× ×ª×¤×¢×•×œ×™×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/advanced-caching.html#warmup-frontend">Warmup ×œ× ×›×¡×™ Frontend</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/advanced-caching.html#id4">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../webapp/static-checklist.html">Static Performance &amp; Security Checklist (gzip/br, Cache, SRI)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../webapp/static-checklist.html#id1">××˜×¨×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/static-checklist.html#br-gzip">×“×—×™×¡×” (br/gzip)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/static-checklist.html#cache-control">×›×•×ª×¨×•×ª Cache-Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/static-checklist.html#subresource-integrity-sri">Subresource Integrity (SRI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/static-checklist.html#copypaste">×‘×“×™×§×•×ª ×™×“× ×™×•×ª (Copyâ€‘Paste)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/static-checklist.html#best-practices">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/static-checklist.html#gotchas">Gotchas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../webapp/commands-catalog.html">×ª×—×–×•×§×ª ×§×˜×œ×•×’ ×”×¤×§×•×“×•×ª (<code class="docutils literal notranslate"><span class="pre">commands.json</span></code>)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../webapp/commands-catalog.html#id1">××‘×•×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/commands-catalog.html#schema">××‘× ×” ×”× ×ª×•× ×™× (Schema)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/commands-catalog.html#json">×“×•×’××ª JSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/commands-catalog.html#taxonomy">×”× ×—×™×•×ª ×¡×™×•×•×’ (Taxonomy)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../webapp/commands-catalog.html#id2">×˜×™×¤×™× ×œ×–×™×”×•×™ ××•×˜×•××˜×™</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/commands-catalog.html#id3">×¦â€™×§-×œ×™×¡×˜ ×œ×”×•×¡×¤×ª ×¤×§×•×“×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/commands-catalog.html#id4">×‘×“×™×§×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/commands-catalog.html#id5">×›×¨×˜×™×¡×™×•×ª ×—×“×©×•×ª (×“×¦×Â« 2025)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../webapp/api-reference.html">WebApp API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../webapp/api-reference.html#endpoints">Endpoints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/api-reference.html#authentication-flow">Authentication Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/api-reference.html#response-schema-example">Response Schema Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/api-reference.html#errors">Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/api-reference.html#post-api-shared-save">×©×’×™××•×ª × ×¤×•×¦×•×ª â€“ <code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/api/shared/save</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/api-reference.html#id1">×§×™×©×•×¨×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/api-reference.html#files">××¡× ×Ÿ ×•×©×“×•×ª ×§×œ×˜ ×œ-<code class="docutils literal notranslate"><span class="pre">/files</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../webapp/api-reference.html#id2">×˜×‘×œ×ª ×¤×¨××˜×¨×™×</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/api-reference.html#id3">×“×•×’×××•×ª ×‘×§×©×”</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/api-reference.html#id4">×“×•×’×××•×ª ×ª×’×•×‘×”</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../webapp/bulk-actions.html">Bulk actions (×‘×—×™×¨×” ××¨×•×‘×”)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../webapp/bulk-actions.html#id1">×¡×§×™×¨×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/bulk-actions.html#endpoints">Endpoints</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../webapp/bulk-actions.html#post-api-files-bulk-favorite"><code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/api/files/bulk-favorite</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/bulk-actions.html#post-api-files-bulk-unfavorite"><code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/api/files/bulk-unfavorite</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/bulk-actions.html#post-api-files-bulk-tag"><code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/api/files/bulk-tag</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/bulk-actions.html#post-api-files-create-zip"><code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/api/files/create-zip</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/bulk-actions.html#post-api-files-bulk-delete-soft-delete"><code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/api/files/bulk-delete</span></code> (Soft Delete)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../webapp/bulk-actions.html#post-api-files-create-share-link"><code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/api/files/create-share-link</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/bulk-actions.html#id2">×©×’×™××•×ª × ×¤×•×¦×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/bulk-actions.html#id3">×”×¢×¨×•×ª ×œ××¤×ª×—×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../webapp/editor.html">âŒ¨ï¸ ×¢×•×¨×š ×§×•×“ (WebApp Editor)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../webapp/editor.html#codemirror-isloading">×˜×¢×™× ×ª CodeMirror ×•××¦×‘ isLoading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/editor.html#api">×©××™×¨×ª ×”×¢×“×¤×•×ª ××©×ª××© â€“ ×©× ×™ × ×ª×™×‘×™ API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/editor.html#id1">×”××œ×¦×•×ª</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../webapp/markdown-folding.html">Markdown â€“ ××¦×‘ ××¦×•××¦× (×§×™×¤×•×œ ×›×•×ª×¨×•×ª ###) â€“ ××“××™×Ÿ ×‘×œ×‘×“</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../webapp/markdown-folding.html#id1">×××¤×™×™× ×™× ×¢×™×§×¨×™×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/markdown-folding.html#id2">×”×–×¨×§×ª ×“×’×œ ×”×¨×©××” ×œ×ª×‘× ×™×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/markdown-folding.html#id3">×¢×§×¨×•× ×•×ª ×”××™××•×© ×‘×¦×“ ×”×œ×§×•×—</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/markdown-folding.html#id4">×¦â€™×§â€‘×œ×™×¡×˜ ×œ×¤×™×¦â€™×¨×™× ××§×•××™×™× ×“×•××™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../webapp/smooth-scrolling.html">Smooth Scrolling (WebApp) â€” ××“×¨×™×š ×ª××¦×™×ª×™ ×œ×¡×•×›× ×™ AI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../webapp/smooth-scrolling.html#id1">××” ×¤×¢×™×œ ×›×‘×¨</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/smooth-scrolling.html#api">API ×œ×©×™××•×© ×§×œ×™×™× ×˜</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/smooth-scrolling.html#id2">×©××™×¨×ª ×”×¢×“×¤×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/smooth-scrolling.html#id3">×××©×§ ×”×’×“×¨×•×ª ××•×‘× ×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/smooth-scrolling.html#ai">×”× ×—×™×•×ª ×œ×¡×•×›× ×™ AI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/smooth-scrolling.html#id4">×× ×“×¨×•××™×“ â€” ××” ×™×© ×•××” ×œ×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/smooth-scrolling.html#id5">× ×’×™×©×•×ª ×•×‘×™×¦×•×¢×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/smooth-scrolling.html#id6">×¤×ª×¨×•×Ÿ ×ª×§×œ×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/smooth-scrolling.html#roadmap">×ª×•×›× ×™×ª ×”××©×š (Roadmap ××§×•×¦×¨)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/smooth-scrolling.html#id7">×§×™×©×•×¨×™× ×¤× ×™××™×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../webapp/system-modules.html">××•×“×•×œ×™× ×¤× ×™××™×™× ×‘-WebApp</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../webapp/system-modules.html#activity-tracker-py"><code class="docutils literal notranslate"><span class="pre">activity_tracker.py</span></code> â€“ ×“×’×™××ª ×¤×¢×™×œ×•×ª ××©×ª××©×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/system-modules.html#community-library-api-py-rest"><code class="docutils literal notranslate"><span class="pre">community_library_api.py</span></code> â€“ REST ×¢×‘×•×¨ ××•×¡×£ ×”×§×”×™×œ×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/system-modules.html#community-library-ui-py-web"><code class="docutils literal notranslate"><span class="pre">community_library_ui.py</span></code> â€“ ×ª×¦×•×’×ª Web</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/system-modules.html#snippet-library-api-py-snippet-library-ui-py"><code class="docutils literal notranslate"><span class="pre">snippet_library_api.py</span></code> ×•-<code class="docutils literal notranslate"><span class="pre">snippet_library_ui.py</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/system-modules.html#push-api-py-web-push-subscriptions"><code class="docutils literal notranslate"><span class="pre">push_api.py</span></code> â€“ Web Push Subscriptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/system-modules.html#workspace-api-py-kanban-workspaces"><code class="docutils literal notranslate"><span class="pre">workspace_api.py</span></code> â€“ × ×™×”×•×œ Kanban (Workspaces)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/system-modules.html#config-radar-py"><code class="docutils literal notranslate"><span class="pre">config_radar.py</span></code> â€“ ×¨× ×˜×’×Ÿ ×§×•× ×¤×™×’×•×¨×¦×™×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/system-modules.html#id2">××™×š ×œ×”×©×ª××© ×‘×¢××•×“ ×–×”</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Frontend &gt; Theming</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../webapp/theming_and_css.html">××¢×¨×›×ª ×¢×¨×›×•×ª ×”× ×•×©× ×•×”×˜×•×§× ×™× ×”×—×“×©×”</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../webapp/theming_and_css.html#id3">×¨×§×¢ ×•××•×˜×™×‘×¦×™×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/theming_and_css.html#data-theme">×©×›×‘×•×ª ××©×ª× ×™× ×•×˜×¢×™× ×ª <code class="docutils literal notranslate"><span class="pre">data-theme</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../webapp/theming_and_css.html#id4">×ª×¨×©×™× ×–×¨×™××ª ×”×™×¨×¨×›×™×™×ª ×˜×•×§× ×™×</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/theming_and_css.html#id5">×˜×‘×œ×ª ×˜×•×§× ×™× ×¢×™×§×¨×™×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/theming_and_css.html#theme-reference">××¤×ª ×¢×¨×›×•×ª ×”× ×•×©× (Theme Reference)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/theming_and_css.html#markdown-viewer-split-view">Markdown Viewer ×•â€‘Split View</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/theming_and_css.html#best-practices">×”× ×—×™×•×ª ×œ××¤×ª×—×™× (Best Practices)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../webapp/theming_and_css.html#id6">×“×•×’××ª ×§×•×“ â€“ ×œ× ×ª×§×™×Ÿ ×œ×¢×•××ª ×ª×§×™×Ÿ</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/theming_and_css.html#component-tokens-theme-builder">Component Tokens ×•â€‘Theme Builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/theming_and_css.html#merge">×‘×“×™×§×•×ª ×—×•×‘×” ×œ×¤× ×™ Merge</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/theming_and_css.html#id7">×©×™××•×©×™× × ×•×¡×¤×™× ×•×—×¨×™×’×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp/theming_and_css.html#id8">×§×™×©×•×¨×™× ×•× ×¡×¤×—×™×</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Observability</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../observability.html">××•×‘×–×¨×•×•×‘×™×œ×™×•×ª (Observability)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../observability.html#id1">××˜×¨×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability.html#id2">×§×”×œ×™ ×™×¢×“</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability.html#id3">×ª×¦×•×¨×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability.html#backend-traces">×‘×—×™×¨×ª Backend ×œÖ¾Traces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability.html#otlp">×”×’×“×¨×ª OTLP ×œ×¡×‘×™×‘×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability.html#id4">×§×™×©×•×¨×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability.html#manual-instrumentation">××™× ×¡×˜×¨×•×× ×˜×¦×™×” ×™×“× ×™×ª (Manual Instrumentation)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability.html#jaeger">×“×•×§×¨ ×§×•××¤×•×– â€“ ×”×¤×¢×œ×” ××”×™×¨×” ×¢× Jaeger</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../observability.html#quick-start-jaeger">Quick start â€“ ××™××•×ª ×¡×¤×× ×™× ×‘Ö¾Jaeger</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../observability.html#traced">×›×™×¡×•×™ ×“×§×•×¨×˜×•×¨ &#64;traced</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability.html#staging">××™××•×ª ×‘-Staging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../observability/background-jobs-monitor.html">Background Jobs Monitor</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../observability/background-jobs-monitor.html#id1">×¡×§×™×¨×” ×›×œ×œ×™×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/background-jobs-monitor.html#id2">×¨×›×™×‘×™× ×•×§×•×“ ×¨×œ×•×•× ×˜×™</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/background-jobs-monitor.html#id3">××¡×“ × ×ª×•× ×™×</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../observability/background-jobs-monitor.html#job-runs">×§×•×œ×§×¦×™×”: <code class="docutils literal notranslate"><span class="pre">job_runs</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../observability/background-jobs-monitor.html#ui-webapp">UI / WebApp</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../observability/background-jobs-monitor.html#id4">×’×™×©×” ×œ×“×©×‘×•×¨×“</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/background-jobs-monitor.html#id5">××” ×¨×•××™× ×‘×“×©×‘×•×¨×“</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/background-jobs-monitor.html#jobs-vs">Jobs ×¡×˜×˜×™×™× vs. ×“×™× ××™×™×</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../observability/background-jobs-monitor.html#api-reference">API Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../observability/background-jobs-monitor.html#get-api-jobs">GET /api/jobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/background-jobs-monitor.html#get-api-jobs-active">GET /api/jobs/active</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/background-jobs-monitor.html#get-api-jobs-job-id">GET /api/jobs/{job_id}</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/background-jobs-monitor.html#get-api-jobs-runs-run-id">GET /api/jobs/runs/{run_id}</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/background-jobs-monitor.html#post-api-jobs-job-id-trigger">POST /api/jobs/{job_id}/trigger</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../observability/background-jobs-monitor.html#id6">××‘×˜×—×”</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../observability/background-jobs-monitor.html#api">×”×’× ×” ×¢×œ ×”-API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../observability/background-jobs-monitor.html#env">ENV ×•×§×•× ×¤×™×’×•×¨×¦×™×”</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../observability/background-jobs-monitor.html#id7">××©×ª× ×™ ×¡×‘×™×‘×”</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../observability/background-jobs-monitor.html#chatops-jobs">ChatOps â€“ ×¤×§×•×“×ª /jobs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../observability/background-jobs-monitor.html#id8">×¤×§×•×“×•×ª ×–××™× ×•×ª</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/background-jobs-monitor.html#id9">×“×•×’×××•×ª</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../observability/background-jobs-monitor.html#alerts">Alerts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../observability/background-jobs-monitor.html#alerts-yml">×”×’×“×¨×•×ª ×‘-alerts.yml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/background-jobs-monitor.html#flow-alerts">Flow ×©×œ Alerts</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../observability/background-jobs-monitor.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../observability/background-jobs-monitor.html#id10">â€×”×˜×¨×™×’×¨ ×œ× ×¢×•×‘×“â€œ</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/background-jobs-monitor.html#jobs">â€××™×Ÿ jobs ×“×™× ××™×™× ×‘×“×©×‘×•×¨×“â€œ</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/background-jobs-monitor.html#id11">â€×œ× ××’×™×¢×™× Alertsâ€œ</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/background-jobs-monitor.html#job">â€Job ×ª×§×•×¢ ××‘×œ ××™×Ÿ ×”×ª×¨××”â€œ</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/background-jobs-monitor.html#id12">â€×”×©×¨×ª ××—×–×™×¨ 401/403â€œ</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/background-jobs-monitor.html#id13">â€×œ×•×’×™× ×¨×™×§×™× ×‘×“×©×‘×•×¨×“â€œ</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../observability/background-jobs-monitor.html#best-practices">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/background-jobs-monitor.html#id14">×¨××• ×’×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../observability/observability_dashboard.html">ğŸ“¡ Observability Dashboard &amp; API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../observability/observability_dashboard.html#admin-observability">ğŸ–¥ï¸ ×¡×§×™×¨×ª ×”×××©×§ <code class="docutils literal notranslate"><span class="pre">/admin/observability</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../observability/observability_dashboard.html#id1">×—×œ×•×§×ª ×”×“×£</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/observability_dashboard.html#id2">×™×›×•×œ×•×ª ×¡×™× ×•×Ÿ</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/observability_dashboard.html#ui">××§×¨× ×•Ö¾UI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/observability_dashboard.html#ai">ğŸ¤– ×”×¡×‘×¨ AI ×œ×”×ª×¨××•×ª</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../observability/observability_dashboard.html#api-reference">ğŸ“š API Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../observability/observability_dashboard.html#id3">×¤×¨××˜×¨×™ ×–××Ÿ ××©×•×ª×¤×™×</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/observability_dashboard.html#get-api-observability-alerts"><code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/api/observability/alerts</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../observability/observability_dashboard.html#meta-high-error-rate">Meta ××•×¢×©×¨ ×œ×”×ª×¨××•×ª High Error Rate</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../observability/observability_dashboard.html#get-api-observability-aggregations"><code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/api/observability/aggregations</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/observability_dashboard.html#get-api-observability-timeseries"><code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/api/observability/timeseries</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/observability_dashboard.html#get-api-observability-replay"><code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/api/observability/replay</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/observability_dashboard.html#runbooks-quick-fix">Runbooks ×“×™× ××™×™× + Quick Fix</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/observability_dashboard.html#get-api-observability-export"><code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/api/observability/export</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/observability_dashboard.html#post-api-observability-quickfix-track"><code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/api/observability/quickfix/track</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/observability_dashboard.html#post-api-observability-alerts-ai-explain"><code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/api/observability/alerts/ai_explain</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../observability/observability_dashboard.html#rate-limiting">ğŸ” ××‘×˜×—×”, Rate Limiting ×•×§××©</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/observability_dashboard.html#id4">ğŸ”Œ ××™× ×˜×’×¨×¦×™×•×ª ×•×“×•×’×××•×ª ×©×™××•×©</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../observability/observability_dashboard.html#grafana-bi">Grafana / BI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/observability_dashboard.html#slack-on-call-bot">Slack / On-call Bot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/observability_dashboard.html#config-radar">×©×™×œ×•×‘ ×¢× Config Radar</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/observability_dashboard.html#readme">×¨×¤×¨× ×¡ ×œÖ¾README</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../observability/observability_dashboard.html#id5">âœ”ï¸ ××” ×”×œ××”?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../observability/quick_fix_rules.html">ğŸ§  Quick Fix ×—×›× (Queue Delay + ×¢×•××¡/DB) â€“ ×”× ×—×™×•×ª ×œ××¤×ª×—×™× ×•×œ×¡×•×›× ×™ AI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../observability/quick_fix_rules.html#id1">××™×¤×” ×–×” ××•×¤×™×¢</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/quick_fix_rules.html#id2">××§×•×¨ ×××ª: ××™×¤×” ×”×—×•×§×™× ×—×™×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/quick_fix_rules.html#latency-slow-response">×˜×‘×œ×ª ×”×—×œ×˜×” (Latency / Slow Response)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/quick_fix_rules.html#id3">××™×œ×• ×©×“×•×ª ×× ×—× ×• ××©×ª××©×™× ×‘×”× (×¡×›××ª × ×ª×•× ×™×)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../observability/quick_fix_rules.html#id4">××•×ª×•×ª ×¢×™×§×¨×™×™×</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/quick_fix_rules.html#id5">×¢×•××¡ ×•××©××‘×™×</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/quick_fix_rules.html#db-pool-utilization">â€œDB Pool utilizationâ€</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../observability/quick_fix_rules.html#safety">×¢×§×¨×•× ×•×ª Safety (×—×©×•×‘)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/quick_fix_rules.html#ai">××™×š ×œ×”×•×¡×™×£/×œ×©× ×•×ª ×—×•×§ (×¦â€™×§×œ×™×¡×˜ ×œ××¤×ª×—×™× ×•×œâ€‘AI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/quick_fix_rules.html#id6">×”×¢×¨×•×ª ×œ×¡×•×›× ×™ AI (××™×š ×œ×¢×‘×•×“ × ×›×•×Ÿ)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../visual-rule-engine.html">Visual Rule Engine - ×× ×•×¢ ×›×œ×œ×™× ×•×™×–×•××œ×™</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../visual-rule-engine.html#id1">×¡×§×™×¨×” ×›×œ×œ×™×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-rule-engine.html#id2">×–×¨×™××ª ×”×”×—×œ×˜×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-rule-engine.html#ui-walkthrough">UI Walkthrough</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../visual-rule-engine.html#id3">×’×™×©×” ×œ××¡×š ×”×›×œ×œ×™×</a></li>
<li class="toctree-l3"><a class="reference internal" href="../visual-rule-engine.html#id4">×™×¦×™×¨×ª ×›×œ×œ ×—×“×©</a></li>
<li class="toctree-l3"><a class="reference internal" href="../visual-rule-engine.html#id5">×”×¤×¢×œ×”/×›×™×‘×•×™ ×›×œ×œ</a></li>
<li class="toctree-l3"><a class="reference internal" href="../visual-rule-engine.html#id6">××—×™×§×ª ×›×œ×œ</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../visual-rule-engine.html#json-schema">××‘× ×” ×”×›×œ×œ (JSON Schema)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../visual-rule-engine.html#id7">×©×“×•×ª ×”×›×œ×œ</a></li>
<li class="toctree-l3"><a class="reference internal" href="../visual-rule-engine.html#suppress">×“×•×’××” 1: ×›×œ×œ ×¤×©×•×˜ (Suppress)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../visual-rule-engine.html#group-and">×“×•×’××” 2: ×›×œ×œ ×¢× Group (AND)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../visual-rule-engine.html#or-not">×“×•×’××” 3: OR ×¢× NOT ×¤× ×™××™</a></li>
<li class="toctree-l3"><a class="reference internal" href="../visual-rule-engine.html#github-issue-sentry">×“×•×’××” 4: GitHub Issue ×œ×©×’×™××•×ª Sentry ×—×“×©×•×ª</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../visual-rule-engine.html#actions">×¤×¢×•×œ×•×ª (Actions)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../visual-rule-engine.html#id8">suppress</a></li>
<li class="toctree-l3"><a class="reference internal" href="../visual-rule-engine.html#send-alert">send_alert</a></li>
<li class="toctree-l3"><a class="reference internal" href="../visual-rule-engine.html#create-github-issue">create_github_issue</a></li>
<li class="toctree-l3"><a class="reference internal" href="../visual-rule-engine.html#webhook">webhook</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../visual-rule-engine.html#evaluation-context">Evaluation Context - ×©×“×•×ª ×–××™× ×™×</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../visual-rule-engine.html#id9">×©×“×•×ª ×‘×¡×™×¡×™×™× ××”×”×ª×¨××”</a></li>
<li class="toctree-l3"><a class="reference internal" href="../visual-rule-engine.html#details">×©×“×•×ª ×-details</a></li>
<li class="toctree-l3"><a class="reference internal" href="../visual-rule-engine.html#id10">×©×“×•×ª ××“×“×™×</a></li>
<li class="toctree-l3"><a class="reference internal" href="../visual-rule-engine.html#id11">×©×“×•×ª ×–××Ÿ (××—×•×©×‘×™×)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../visual-rule-engine.html#id12">××•×¤×¨×˜×•×¨×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-rule-engine.html#id13">××‘×˜×—×”</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../visual-rule-engine.html#id14">×”×¨×©××•×ª ××“××™×Ÿ</a></li>
<li class="toctree-l3"><a class="reference internal" href="../visual-rule-engine.html#webhook-ssrf-protection">Webhook SSRF Protection</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../visual-rule-engine.html#id15">×”×¡×™××•×œ×˜×•×¨</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-rule-engine.html#id16">××©×ª× ×™ ×¡×‘×™×‘×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-rule-engine.html#id17">×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../visual-rule-engine.html#id18">â€×”×›×œ×œ ×œ× ×¨×¥â€œ</a></li>
<li class="toctree-l3"><a class="reference internal" href="../visual-rule-engine.html#id19">â€webhook × ×—×¡×â€œ</a></li>
<li class="toctree-l3"><a class="reference internal" href="../visual-rule-engine.html#is-new-error-false">â€is_new_error ×ª××™×“ Falseâ€œ</a></li>
<li class="toctree-l3"><a class="reference internal" href="../visual-rule-engine.html#github-issue">â€GitHub Issue ×œ× × ×•×¦×¨â€œ</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../visual-rule-engine.html#test-plan">Test Plan</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-rule-engine.html#api-reference">API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-rule-engine.html#id20">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../observability/coverage_report.html">Coverage Report (Runbooks / Quick Fixes)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../observability/coverage_report.html#id1">××˜×¨×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/coverage_report.html#catalog-registry">××§×•×¨ ×”×××ª (Catalog / Registry)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/coverage_report.html#matching">×”×’×“×¨×•×ª ×›×™×¡×•×™ (Matching)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../observability/coverage_report.html#runbooks">Runbooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/coverage_report.html#quick-fixes">Quick Fixes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../observability/coverage_report.html#id2">××” ××•×¦×’ ×‘×“×•×—</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/coverage_report.html#api">API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/ai_explain.html">ğŸ§  Observability AI Explain API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/ai_explain.html#id1">ğŸ” ××™××•×ª ×•×‘×§×¨×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/ai_explain.html#post-api-ai-explain">ğŸ“¥ ×‘×§×©×” (<code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/api/ai/explain</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/ai_explain.html#ok">ğŸ“¤ ×ª×’×•×‘×” ××•×¦×œ×—×ª (<code class="docutils literal notranslate"><span class="pre">200</span> <span class="pre">OK</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/ai_explain.html#id2">â— ×§×•×“×™ ×©×’×™××”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/ai_explain.html#id3">âš™ï¸ ×§×•× ×¤×™×’×•×¨×¦×™×” × ×“×¨×©×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/ai_explain.html#id4">ğŸ§ª ×‘×“×™×§×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/ai_explain.html#id5">ğŸ“ ×˜×™×¤×™× ×œ×¤×¨×™×¡×”</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../rate-limiting.html">Rate Limiting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../rate-limiting.html#id1">××‘×•×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rate-limiting.html#shadow-mode">Shadow Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rate-limiting.html#softwarning-80">Softâ€‘Warning (80%)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rate-limiting.html#admin-bypass">Admin Bypass</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rate-limiting.html#monitoring">Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rate-limiting.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rate-limiting.html#id2">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../observability/guidelines.html">ğŸ“Š ×”× ×—×™×•×ª Observability ×•××™×¨×•×¢×™×</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../observability/guidelines.html#id1">×ª×‘× ×™×ª ××™×¨×•×¢/×œ×•×’ â€“ ×©×“×•×ª ×—×•×‘×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/guidelines.html#fail-open">×¢×§×¨×•×Ÿ Fail-Open</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/guidelines.html#id2">×”× ×—×™×•×ª ×˜×™×¤×•×œ ×‘×©×’×™××•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/guidelines.html#request-id">×§×•×¨×œ×¦×™×” ×¢× request_id</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/guidelines.html#id3">×¡×˜× ×“×¨×˜×™× × ×•×¡×¤×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../logging_schema.html">×¡×›××ª ×œ×•×’×™× ×•××™×¨×•×¢×™× (Observability)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../logging_schema.html#id1">×©×“×•×ª ×—×•×‘×” ×‘×›×œ ××™×¨×•×¢</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging_schema.html#id2">×©×“×•×ª ××•××œ×¦×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging_schema.html#id3">××™×¨×•×¢×™× ××¨×›×–×™×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging_schema.html#sampling">×“×’×™××” (Sampling)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging_schema.html#id4">×¤×¨×˜×™×•×ª</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../metrics.html">××“×“×™× (Metrics)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../metrics.html#id1">× ×§×•×“×ª ×§×¦×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metrics.html#id2">××˜×¨×™×§×•×ª ×§×™×™××•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metrics.html#codebot-handlers-commands-db">××“×“×™ CodeBot ×™×™×¢×•×“×™×™× (Handlers/Commands/DB)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metrics.html#opentelemetry">××˜×¨×™×§×•×ª OpenTelemetry (×× ×–××™× ×•×ª)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metrics.html#promql">×“×•×’×××•×ª PromQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metrics.html#tracing-grafana">Tracing ×‘-Grafana</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metrics.html#slo-sli">SLO/SLI ×œ×“×•×’××”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metrics.html#prometheus-alerting-rules">×”×ª×¨××•×ª (Prometheus alerting rules)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../resilience.html">Resilience ×œ×©×™×¨×•×ª×™× ×—×™×¦×•× ×™×™×</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../resilience.html#id1">×œ××” ×©×›×‘×” ××¨×•×›×–×ª?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resilience.html#id2">××™×š ×–×” ×¢×•×‘×“?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resilience.html#env">×§×•× ×¤×™×’×•×¨×¦×™×” ×—×©×•×‘×” (ENV)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resilience.html#id3">×˜×™×¤</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resilience.html#id4">×©×™××•×© ×‘×§×•×“</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resilience.html#id5">×¨××• ×’×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../alerts.html">×”×ª×¨××•×ª (Alerts)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../alerts.html#id1">×¡×§×™×¨×” ××”×™×¨×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alerts.html#id2">×—×•×§×™ ×‘×¨×™×¨×ª ×”××—×“×œ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alerts.html#id3">×”×ª×××” ×œ×¦×¨×›×™× ×©×œ×š</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alerts.html#health-startup-prometheus">××“×“×™ Health ×•-Startup ×œ-Prometheus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alerts.html#alert-manager">×§×•× ×¤×™×’×•×¨×¦×™×™×ª <code class="docutils literal notranslate"><span class="pre">alert_manager</span></code> ×‘××¤×œ×™×§×¦×™×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alerts.html#id4">×˜×¢×™× ×ª ×©×™× ×•×™×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alerts.html#id5">×‘×“×™×§×ª ×”×–×¨×™××” ×‘×§×¦×” ×”×©× ×™</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alerts.html#id6">×˜×™×¤×™× ××—×¨×•× ×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alerts.html#id7">×¨××• ×’×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alerts.html#id8">×”×ª×¨××•×ª ××¢×¨×›×ª â€“ ×“×™×¡×§ ×›××¢×˜ ××œ×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../observability/log_based_alerts.html">×”×ª×¨××•×ª ××‘×•×¡×¡×•×ª ×œ×•×’×™× (Logâ€‘based Alerts)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../observability/log_based_alerts.html#id1">××” ×–×” ×•×œ××”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/log_based_alerts.html#id2">×”×¨×›×™×‘×™× ×‘×§×•×“</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/log_based_alerts.html#id3">×§×‘×¦×™ ×§×•× ×¤×™×’</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../observability/log_based_alerts.html#config-error-signatures-yml">×“×•×’××” ××™× ×™××œ×™×ª: <code class="docutils literal notranslate"><span class="pre">config/error_signatures.yml</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../observability/log_based_alerts.html#config-alerts-yml">×“×•×’××” ××™× ×™××œ×™×ª: <code class="docutils literal notranslate"><span class="pre">config/alerts.yml</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../observability/log_based_alerts.html#option-b">Option B â€“ ×—×™×‘×•×¨ ×‘×ª×•×š ×”×§×•×“ (××•××©)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../observability/log_based_alerts.html#id4">××©×ª× ×™ ×¡×‘×™×‘×”</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../observability/log_based_alerts.html#option-a-sidecar">Option A â€“ Sidecar ××–×¨× ×œ×•×’×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/log_based_alerts.html#id5">×¡×¤×™× ×•×§×™×‘×•×¥ â€“ ×‘×¨×™×¨×•×ª ××—×“×œ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/log_based_alerts.html#fingerprint">××¡×˜×¨×˜×’×™×™×ª fingerprint ×•×§× ×•× ×™×§×œ×™×–×¦×™×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/log_based_alerts.html#id6">×¦â€™×§×œ×™×¡×˜ ×œ××¤×ª×—×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/log_based_alerts.html#id7">×‘×“×™×§×” ××§×•××™×ª (×¡×™××•×œ×¦×™×”)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/log_based_alerts.html#ai">×”× ×—×™×•×ª ×œ×¡×•×›× ×™ AI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/log_based_alerts.html#id8">××‘×˜×—×” ×•×¤×¨×˜×™×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/log_based_alerts.html#rollout">Rollout ××•××œ×¥</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/log_based_alerts.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/log_based_alerts.html#id9">×¨××• ×’×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/log_based_alerts.html#id10">×§×™×©×•×¨×™× ×œ×§×•×“</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/log_based_alerts.html#id11">×˜×§×¡×•× ×•××™×™×ª ×©×’×™××•×ª ×•×—×ª×™××•×ª</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../observability/log_based_alerts.html#id12">×ª×¨×©×™× ×–×¨×™××” ××§×•×¦×¨</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../observability/log_based_alerts.html#chatops">×ª×¦×•×’×” ×‘â€‘ChatOps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../observability/log_based_alerts.html#placeholder">×¤×œ×˜ ×œ×“×•×’××” (Placeholder)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../observability/log_based_alerts.html#classify-error">×§×¨×™××ª ×”××©×š â€“ <code class="docutils literal notranslate"><span class="pre">classify_error()</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../observability/log-aggregator.html">×× ×•×¢ × ×™×ª×•×— ×œ×•×’×™× (Log Event Aggregator)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../observability/log-aggregator.html#id2">××¨×›×™×˜×§×˜×•×¨×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/log-aggregator.html#id3">×§×•× ×¤×™×’×•×¨×¦×™×” ×•×§×‘×¦×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/log-aggregator.html#cli">×”×¨×¦×ª CLI ××§×•××™×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/log-aggregator.html#id4">×©×™×œ×•×‘ ×‘××¢×¨×›×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/log-aggregator.html#id5">×¢×‘×•×“×” ×‘×˜×•×—×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/log-aggregator.html#id6">× ×™×¤×•×™ ×ª×§×œ×•×ª × ×¤×•×¥</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../sentry.html">Sentry</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../sentry.html#id1">×”×¤×¢×œ×” (××©×ª× ×™ ×¡×‘×™×‘×”)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sentry.html#telegram-observability">×”×ª×¨××•×ª ×œÖ¾Telegram ×•×œ×œ×•×— Observability</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../sentry.html#id2">××™×¤×” ×œ×”×’×“×™×¨ ××©×ª× ×™×</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sentry.html#observability">××” ×¦×¨×™×š ×›×“×™ ×©×–×” ×™×•×¤×™×¢ ×‘×œ×•×— Observability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sentry.html#id3">××” ×¦×¨×™×š ×›×“×™ ×©×–×” ×™×™×©×œ×— ×œ×˜×œ×’×¨×</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sentry.html#polling">Polling â€“ ××©×ª× ×™× ×¨×œ×•×•× ×˜×™×™×</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sentry.html#webhook">Webhook â€“ ××‘×˜×—×” ×•×“×”-×“×•×¤×œ×™×§×¦×™×”</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../sentry.html#id4">×¢×§×¨×•× ×•×ª</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../runbooks/incident-checklist.html">Incident Checklist (Onâ€‘Call)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../runbooks/incident-checklist.html#incident">×‘×¢×ª ×¤×ª×™×—×ª Incident</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runbooks/incident-checklist.html#id1">×¡×˜×˜×•×¡×™ ××¢×§×‘ ××—×™×“×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runbooks/incident-checklist.html#id2">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../runbooks/logging-levels.html">×©×™× ×•×™ ×¨××•×ª ×œ×•×’×™×</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../runbooks/logging-levels.html#debug">××ª×™ ×œ×”×¢×œ×•×ª ×œ-DEBUG</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runbooks/logging-levels.html#id2">×˜×™×¤</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../runbooks/github_backup_restore.html">GitHub Backup &amp; Restore Runbook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../runbooks/github_backup_restore.html#id1">××˜×¨×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runbooks/github_backup_restore.html#id2">×“×¨×™×©×•×ª ××§×“×™××•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runbooks/github_backup_restore.html#checkpoint-tag">×™×¦×™×¨×ª × ×§×•×“×ª ×’×™×‘×•×™ (Checkpoint Tag)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runbooks/github_backup_restore.html#zip">×™×¦×™×¨×ª ××¨×›×™×•×Ÿ ZIP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runbooks/github_backup_restore.html#id3">×©×—×–×•×¨ â€“ ×‘×“×™×§×” ××§×•××™×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runbooks/github_backup_restore.html#id4">×©×—×–×•×¨ ××œ× ×œ×¤×¨×•×“×§×©×Ÿ (×–×”×™×¨×•×ª!)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runbooks/github_backup_restore.html#id5">×©×—×–×•×¨ ×§×‘×¦×™×/×ª×™×§×™×•×ª × ×§×•×“×ª×™×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runbooks/github_backup_restore.html#id6">×˜×™×¤×™× ×•×‘×˜×™×—×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runbooks/github_backup_restore.html#id7">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../runbooks/slo.html">Runbooks â€“ SLO Incidents</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../runbooks/slo.html#higherrorrate">HighErrorRate</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runbooks/slo.html#sloavailabilitybreach-99-9">SLOAvailabilityBreach (×–××™× ×•×ª &lt; 99.9%)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runbooks/slo.html#slolatencyp95breach-p95-0-5s">SLOLatencyP95Breach (P95 &gt; 0.5s)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runbooks/slo.html#db-mongodb">×ª×§×œ×ª ×”×ª×—×‘×¨×•×ª ×œâ€‘DB (MongoDB) â€“ ×§×¨×™×˜×™</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../runbooks/slo.html#id1">×¡×™××¤×˜×•××™×</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runbooks/slo.html#id2">×¡×“×¨ ×¤×¢×•×œ×•×ª (×‘×§×¦×¨×”)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../runbooks/slo.html#id3">××™×˜×™×•×ª/× ×¤×™×œ×” ×©×œ ×©×™×¨×•×ª ×—×™×¦×•× ×™ â€“ ×‘×™× ×•× ×™</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../runbooks/slo.html#id4">×¡×™××¤×˜×•××™×</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runbooks/slo.html#id5">×¡×“×¨ ×¤×¢×•×œ×•×ª</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../runbooks/slo.html#deploy-release">×‘××’ ××—×¨×™ Deploy / Release â€“ ××©×ª× ×”</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../runbooks/slo.html#id6">×¡×“×¨ ×¤×¢×•×œ×•×ª</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../runbooks/slo.html#id7">×“×©×‘×•×¨×“</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">×¤×¨×™×¡×” ×•-Workers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../deployment/workers.html">×¢×•×‘×“×™ Push ×•-Edge</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../deployment/workers.html#cloudflare-worker-worker">Cloudflare Worker (<cite>/worker</cite>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deployment/workers.html#node-push-worker-push-worker">Node Push Worker (<cite>/push_worker</cite>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deployment/workers.html#webapp-webapp-push-api-py">×—×™×‘×•×¨ ×œ-WebApp (<cite>webapp/push_api.py</cite>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deployment/workers.html#id2">×‘×“×™×§×•×ª ×•×¢×¦×•×ª</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ChatOps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../chatops/overview.html">ChatOps â€“ ×¡×§×™×¨×” ×›×œ×œ×™×ª</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../chatops/overview.html#id1">×¢×§×¨×•× ×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/overview.html#id2">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../chatops/commands.html">×¤×§×•×“×•×ª ChatOps</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#ctrl-cmd-k">×›×¨×˜×™×¡×™×•×ª ×—×™×¤×•×© (Ctrl/Cmd+K)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#status">/status</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#health">/health</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#uptime">/uptime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#system-info">/system_info</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#metrics">/metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#observe">/observe</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#observe-v">/observe -v (××¤×•×¨×˜)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#observe-vv">/observe -vv (××¤×•×¨×˜ ×××•×“)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#errors">/errors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../chatops/commands.html#mappings">×¡×˜×˜×•×¡×™ ×ª×•×¦××•×ª (Mappings)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#alerts">/alerts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#jobs">/jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#incidents">/incidents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#triage">/triage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#predict">/predict</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#accuracy">/accuracy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#rate-limit">/rate_limit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#enable-backoff">/enable_backoff</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#disable-backoff">/disable_backoff</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#sen">/sen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#lang">/lang</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#lang-debug">/lang_debug</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#dm">/dm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#silence">/silence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#unsilence">/unsilence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#silences">/silences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#cache-stats">/cache_stats</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#clear-cache">/clear_cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#cache-warm">/cache_warm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#cache-clear-stale">/cache_clear_stale</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#status-worker">/status_worker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/commands.html#version-history">/version_history</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../chatops/observe.html">ChatOps â€“ /observe: ×”×¨×—×‘×•×ª -v ×•- -vv</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../chatops/observe.html#id1">×ª×—×‘×™×¨ ×•×¤×¨××˜×¨×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/observe.html#id2">×“×•×’×××•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/observe.html#v">×¤×œ×˜ ×œ×“×•×’××” â€“ â€-v</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/observe.html#vv">×¤×œ×˜ ×œ×“×•×’××” â€“ â€-vv</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/observe.html#id3">×”×¢×¨×•×ª ×©×™××•×©</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/observe.html#id4">×§×™×©×•×¨×™× ×¨×œ×•×•× ×˜×™×™×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../chatops/ratelimit.html">×”×’×‘×œ×ª ×§×¦×‘ ×œ×¤×§×•×“×•×ª ×¨×’×™×©×•×ª</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../chatops/ratelimit.html#id2">×¢×§×¨×•× ×•×ª ××¨×›×–×™×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/ratelimit.html#id3">×©×™××•×© ×‘×“×§×•×¨×˜×•×¨</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/ratelimit.html#id4">×§×•× ×¤×™×’×•×¨×¦×™×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/ratelimit.html#id5">×©×™×œ×•×‘ ×‘×‘×•×˜</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/ratelimit.html#autodoc">Autodoc</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../chatops/playbooks.html">Playbooks â€“ ×ª×¨×—×™×©×™× × ×¤×•×¦×™×</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../chatops/playbooks.html#p95-latency">p95 Latency ×¢×œ×” ××¢×œ ×”×¡×£</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/playbooks.html#error-rate-1">Error Rate &gt; 1%</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/playbooks.html#memory-usage">Memory Usage ××˜×¤×¡</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/playbooks.html#id1">×©×™×¨×•×ª ×—×™×¦×•× ×™ ××™×˜×™</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/playbooks.html#repeated-incident-15">Repeated Incident ×ª×—×ª 15 ×“×§Â«</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../chatops/permissions.html">×”×¨×©××•×ª ×•-Rate Limit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chatops/troubleshooting.html">×¤×ª×¨×•×Ÿ ×ª×§×œ×•×ª (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chatops/faq.html">×©××œ×•×ª × ×¤×•×¦×•×ª</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">×¡×•×›× ×™ AI:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ai-agents/guide.html">ğŸ¤– ××“×¨×™×š ×œ×¡×•×›× ×™ AI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ai-agents/guide.html#id1">× ×§×•×“×ª ×¤×ª×™×—×” ××”×™×¨×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ai-agents/guide.html#id2">××‘× ×” ×”×¤×¨×•×™×§×˜ (×‘×§×¦×¨×”)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ai-agents/guide.html#id3">×”×•×¡×¤×ª ×¤×™×¦â€™×¨×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ai-agents/guide.html#id4">×¡×§×¨×™×¤×˜×™× ×—×©×•×‘×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ai-agents/guide.html#id5">××¤×ª ×“×¨×›×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ai-agents/guide.html#github-issues-chatops">GitHub Issues ×•-ChatOps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../agents/rate-limiting.html">ğŸš¦ ××¢×¨×›×ª Rate Limiting ×œ×¡×•×›× ×™ AI ×•×œ×•×•×‘</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../agents/rate-limiting.html#shadow-mode">××¡×˜×¨×˜×’×™×” â€“ Shadow Mode ×ª×—×™×œ×”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../agents/rate-limiting.html#id1">××©×ª× ×™ ×¡×‘×™×‘×” ×•×§×•× ×¤×™×’</a></li>
<li class="toctree-l2"><a class="reference internal" href="../agents/rate-limiting.html#id2">××™× ×˜×’×¨×¦×™×” â€“ ×‘×•×˜ ×˜×œ×’×¨×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../agents/rate-limiting.html#flask-webapp">××™× ×˜×’×¨×¦×™×” â€“ Flask/WebApp</a></li>
<li class="toctree-l2"><a class="reference internal" href="../agents/rate-limiting.html#id3">×”×—×¨×’×•×ª ×—×©×•×‘×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../agents/rate-limiting.html#prometheus">× ×™×˜×•×¨ ×•××“×“×™× (Prometheus)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../agents/rate-limiting.html#id4">××‘×˜×—×” ×•×”×’× ×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../agents/rate-limiting.html#pydantic-settings">×§×•× ×¤×™×’×•×¨×¦×™×” (Pydantic Settings)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../agents/rate-limiting.html#id5">×ª×§×œ×•×ª × ×¤×•×¦×•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../agents/rate-limiting.html#id6">×§×™×©×•×¨×™×</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Observability â€“ Advanced</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../observability/events_catalog.html">×§×˜×œ×•×’ ××™×¨×•×¢×™× ×§× ×•× ×™×™×</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../observability/events_catalog.html#github">GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/events_catalog.html#db">DB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/events_catalog.html#web-share">Web/Share</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/events_catalog.html#alerts">Alerts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/events_catalog.html#repo-analyzer">Repo Analyzer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/events_catalog.html#business">Business</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../observability/error_codes.html">××™×œ×•×Ÿ ×§×•×“×™ ×©×’×™××” (Error Codes)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../observability/error_codes.html#id1">×“×•×’×××•×ª ××™×¤×•×™</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/error_codes.html#id2">×”× ×—×™×•×ª</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../observability/tracing_hotspots.html">Tracing ×××•×§×“ ×‘× ×§×•×“×•×ª ×—××•×ª</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../observability/tracing_hotspots.html#id1">×ª×¨×©×™××™ ×–×¨×™××”</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../observability/tracing_hotspots.html#bot-update">×–×¨×™××ª bot.update</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../observability/tracing_hotspots.html#spans-bot-update">×××¤×™×™× ×™× ××•××œ×¦×™× ×œâ€‘Spans (bot.update)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../observability/tracing_hotspots.html#web-request">×–×¨×™××ª web.request</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../observability/tracing_hotspots.html#spans-web-request">×××¤×™×™× ×™× ××•××œ×¦×™× ×œâ€‘Spans (web.request)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../observability/tracing_hotspots.html#id2">×˜×‘×œ×ª â€×”×™×›×Ÿ ×¢×•×˜×¤×™×â€œ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/tracing_hotspots.html#trace-viewer">×“×•×’××ª Trace Viewer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/tracing_hotspots.html#id3">×”×˜××¢×ª ×“×§×•×¨×˜×•×¨ ×•×©×™××•×© ×‘×¤×•× ×§×¦×™×•×ª ×¢×–×¨</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/tracing_hotspots.html#best-practices">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/tracing_hotspots.html#id4">×¨××• ×’×</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../observability/metrics_promql.html">×©××™×œ×ª×•×ª PromQL ×©×™××•×©×™×•×ª</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../observability/metrics_promql.html#latency">×–××Ÿ ×ª×’×•×‘×” (Latency)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/metrics_promql.html#id1">×©×™×¢×•×¨ ×©×’×™××•×ª</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/metrics_promql.html#id2">××™×¨×•×¢×™ ×‘×™×–× ×¡</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../observability/alerts_playbook.html">Playbook ×§×¦×¨ ×œ×”×ª×¨××•×ª</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../observability/alerts_playbook.html#id1">×–×¨×™××”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/alerts_playbook.html#id2">×§×™×©×•×¨×™× ×‘×§×•×“</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/alerts_playbook.html#id3">×“×’×©×™×</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/alerts_playbook.html#id4">×›×™×•×•× ×•×Ÿ ×¨×¢×©</a></li>
<li class="toctree-l2"><a class="reference internal" href="../observability/alerts_playbook.html#id5">×˜×™×¤×™× ××”×™×¨×™×</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Code Keeper Bot</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">refactoring_engine</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>×”×¨××” ×§×•×“ ××§×•×¨ ×œ refactoring_engine</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">×× ×•×¢ ×¨×¤×§×˜×•×¨×™× ×’ ××•×˜×•××˜×™</span>
<span class="sd">××‘×¦×¢ ×©×™× ×•×™×™ ××‘× ×” ×‘×§×•×“ ×‘×¦×•×¨×” ×‘×˜×•×—×”</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="RefactorType">
<a class="viewcode-back" href="../api/refactoring_engine.html#refactoring_engine.RefactorType">[×ª×™×¢×•×“]</a>
<span class="k">class</span> <span class="nc">RefactorType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;×¡×•×’×™ ×¨×¤×§×˜×•×¨×™× ×’ × ×ª××›×™×&quot;&quot;&quot;</span>
    <span class="n">SPLIT_FUNCTIONS</span> <span class="o">=</span> <span class="s2">&quot;split_functions&quot;</span>  <span class="c1"># ×¤×™×¦×•×œ ×§×•×‘×¥ ×’×“×•×œ ×œ×¤×•× ×§×¦×™×•×ª</span>
    <span class="n">EXTRACT_FUNCTIONS</span> <span class="o">=</span> <span class="s2">&quot;extract_functions&quot;</span>  <span class="c1"># ×—×™×œ×•×¥ ×§×•×“ ×—×•×–×¨</span>
    <span class="n">MERGE_SIMILAR</span> <span class="o">=</span> <span class="s2">&quot;merge_similar&quot;</span>  <span class="c1"># ××™×–×•×’ ×§×•×“ ×“×•××”</span>
    <span class="n">CONVERT_TO_CLASSES</span> <span class="o">=</span> <span class="s2">&quot;convert_to_classes&quot;</span>  <span class="c1"># ×”××¨×” ×œ××—×œ×§×•×ª</span>
    <span class="n">DEPENDENCY_INJECTION</span> <span class="o">=</span> <span class="s2">&quot;dependency_injection&quot;</span>  <span class="c1"># DI</span></div>



<div class="viewcode-block" id="FunctionInfo">
<a class="viewcode-back" href="../api/refactoring_engine.html#refactoring_engine.FunctionInfo">[×ª×™×¢×•×“]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">FunctionInfo</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;××™×“×¢ ×¢×œ ×¤×•× ×§×¦×™×”&quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">start_line</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">end_line</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">returns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">decorators</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">docstring</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">calls</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">called_by</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">set</span><span class="p">)</span>
    <span class="n">code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># ×©×™×•×š ×œ×¤×™ ×¡×¢×™×£ (Section) ×× ×–×•×”×” ××”×§×•×‘×¥ ×”××•× ×•×œ×™×ª×™</span>
    <span class="n">section</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="ClassInfo">
<a class="viewcode-back" href="../api/refactoring_engine.html#refactoring_engine.ClassInfo">[×ª×™×¢×•×“]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">ClassInfo</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;××™×“×¢ ×¢×œ ××—×œ×§×”&quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">start_line</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">end_line</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">methods</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]</span>
    <span class="n">attributes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">base_classes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">decorators</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">docstring</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="c1"># ×§×•×“ ×”××§×•×¨ ×©×œ ×”××—×œ×§×”</span>
    <span class="n">code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="c1"># ×©×™×•×š ×œ×¤×™ ×¡×¢×™×£ (Section) ×× ×–×•×”×”</span>
    <span class="n">section</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="RefactorProposal">
<a class="viewcode-back" href="../api/refactoring_engine.html#refactoring_engine.RefactorProposal">[×ª×™×¢×•×“]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">RefactorProposal</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;×”×¦×¢×ª ×¨×¤×§×˜×•×¨×™× ×’&quot;&quot;&quot;</span>
    <span class="n">refactor_type</span><span class="p">:</span> <span class="n">RefactorType</span>
    <span class="n">original_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">new_files</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">changes_summary</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">warnings</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">imports_needed</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span></div>



<div class="viewcode-block" id="RefactorResult">
<a class="viewcode-back" href="../api/refactoring_engine.html#refactoring_engine.RefactorResult">[×ª×™×¢×•×“]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">RefactorResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;×ª×•×¦××ª ×¨×¤×§×˜×•×¨×™× ×’&quot;&quot;&quot;</span>
    <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">proposal</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RefactorProposal</span><span class="p">]</span>
    <span class="n">error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">validation_passed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></div>



<span class="n">FunctionNode</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span> <span class="o">|</span> <span class="n">ast</span><span class="o">.</span><span class="n">AsyncFunctionDef</span>


<div class="viewcode-block" id="CodeAnalyzer">
<a class="viewcode-back" href="../api/refactoring_engine.html#refactoring_engine.CodeAnalyzer">[×ª×™×¢×•×“]</a>
<span class="k">class</span> <span class="nc">CodeAnalyzer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;×× ×ª×— ×§×•×“ Python&quot;&quot;&quot;</span>

<div class="viewcode-block" id="CodeAnalyzer.__init__">
<a class="viewcode-back" href="../api/refactoring_engine.html#refactoring_engine.CodeAnalyzer.__init__">[×ª×™×¢×•×“]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;unknown.py&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">AST</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ClassInfo</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imports</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_vars</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># ××™×¤×•×™ ×©×•×¨×” -&gt; slug ×©×œ ×¡×¢×™×£, ×œ×¤×™ ×›×•×ª×¨×•×ª ×‘×§×•×‘×¥</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sections_by_line</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></div>


<div class="viewcode-block" id="CodeAnalyzer.analyze">
<a class="viewcode-back" href="../api/refactoring_engine.html#refactoring_engine.CodeAnalyzer.analyze">[×ª×™×¢×•×“]</a>
    <span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;× ×™×ª×•×— ×”×§×•×“&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extract_sections</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extract_imports</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extract_functions</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extract_classes</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extract_globals</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_dependencies</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">SyntaxError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;×©×’×™××ª ×ª×—×‘×™×¨ ×‘×§×•×“: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;×©×’×™××” ×‘× ×™×ª×•×—: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


    <span class="k">def</span> <span class="nf">_extract_imports</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Import</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">imports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;import </span><span class="si">{</span><span class="n">alias</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">ImportFrom</span><span class="p">):</span>
                <span class="n">module</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">module</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
                <span class="n">names</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">alias</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">imports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;from </span><span class="si">{</span><span class="n">module</span><span class="si">}</span><span class="s2"> import </span><span class="si">{</span><span class="n">names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_extract_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">AsyncFunctionDef</span><span class="p">))</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_top_level_function</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
                <span class="n">func_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_function</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="c1"># ×©×™×•×š ×œ×¡×¢×™×£ ×œ×¤×™ ××™×§×•× ×”×©×•×¨×” ×‘×§×•×“</span>
                <span class="n">func_info</span><span class="o">.</span><span class="n">section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_section_for_line</span><span class="p">(</span><span class="n">func_info</span><span class="o">.</span><span class="n">start_line</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func_info</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_extract_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">ClassDef</span><span class="p">):</span>
                <span class="n">class_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_class</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="n">class_info</span><span class="o">.</span><span class="n">section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_section_for_line</span><span class="p">(</span><span class="n">class_info</span><span class="o">.</span><span class="n">start_line</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">class_info</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_extract_globals</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">global_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_parse_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">FunctionNode</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FunctionInfo</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">arg</span><span class="o">.</span><span class="n">arg</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
        <span class="n">returns</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">returns</span><span class="p">)</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">returns</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">decorators</span> <span class="o">=</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span> <span class="k">for</span> <span class="n">dec</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">decorator_list</span><span class="p">]</span>
        <span class="n">docstring</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">get_docstring</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">calls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_function_calls</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">code_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="n">node</span><span class="o">.</span><span class="n">lineno</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">end_lineno</span><span class="p">]</span>
        <span class="n">code</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">code_lines</span><span class="p">)</span>
        <span class="n">complexity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_complexity</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FunctionInfo</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">start_line</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
            <span class="n">end_line</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">end_lineno</span> <span class="ow">or</span> <span class="n">node</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
            <span class="n">returns</span><span class="o">=</span><span class="n">returns</span><span class="p">,</span>
            <span class="n">decorators</span><span class="o">=</span><span class="n">decorators</span><span class="p">,</span>
            <span class="n">docstring</span><span class="o">=</span><span class="n">docstring</span><span class="p">,</span>
            <span class="n">calls</span><span class="o">=</span><span class="n">calls</span><span class="p">,</span>
            <span class="n">code</span><span class="o">=</span><span class="n">code</span><span class="p">,</span>
            <span class="n">complexity</span><span class="o">=</span><span class="n">complexity</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_parse_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">ClassDef</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ClassInfo</span><span class="p">:</span>
        <span class="n">methods</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">):</span>
                <span class="n">methods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parse_function</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="n">attributes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
                        <span class="n">attributes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">base_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">base</span><span class="p">)</span> <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">bases</span><span class="p">]</span>
        <span class="n">decorators</span> <span class="o">=</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span> <span class="k">for</span> <span class="n">dec</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">decorator_list</span><span class="p">]</span>
        <span class="n">docstring</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">get_docstring</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">code_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="n">node</span><span class="o">.</span><span class="n">lineno</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">end_lineno</span><span class="p">]</span>
        <span class="n">code</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">code_lines</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ClassInfo</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">start_line</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
            <span class="n">end_line</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">end_lineno</span> <span class="ow">or</span> <span class="n">node</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
            <span class="n">methods</span><span class="o">=</span><span class="n">methods</span><span class="p">,</span>
            <span class="n">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="p">,</span>
            <span class="n">base_classes</span><span class="o">=</span><span class="n">base_classes</span><span class="p">,</span>
            <span class="n">decorators</span><span class="o">=</span><span class="n">decorators</span><span class="p">,</span>
            <span class="n">docstring</span><span class="o">=</span><span class="n">docstring</span><span class="p">,</span>
            <span class="n">code</span><span class="o">=</span><span class="n">code</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_extract_function_calls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">AST</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">calls</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
                    <span class="n">calls</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">):</span>
                    <span class="n">calls</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">calls</span>

    <span class="k">def</span> <span class="nf">_calculate_complexity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">AST</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">complexity</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">If</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">While</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">For</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">ExceptHandler</span><span class="p">)):</span>
                <span class="n">complexity</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">BoolOp</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">And</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Or</span><span class="p">)):</span>
                <span class="n">complexity</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">complexity</span>

    <span class="k">def</span> <span class="nf">_is_top_level_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">FunctionNode</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">ClassDef</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># --- ×–×™×”×•×™ ×›×•×ª×¨×•×ª/×¡×¢×™×¤×™× ×‘×§×•×‘×¥ (×œ××©×œ &quot;# 1) USER MANAGEMENT&quot;) ---</span>
    <span class="k">def</span> <span class="nf">_extract_sections</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ×××ª×¨ ×›×•×ª×¨×•×ª ×¡×¢×™×¤×™× ×‘×§×•×‘×¥ ×›×“×™ ×œ×©××¨ ×§×•×”×–×™×” ×¡×× ×˜×™×ª ×‘×¤×™×¦×•×œ.</span>
<span class="sd">        ×ª×•××š ×‘×ª×‘× ×™×•×ª ×›×’×•×Ÿ:</span>
<span class="sd">        &quot;# 1) USER MANAGEMENT&quot;</span>
<span class="sd">        &quot;# 2) PAYMENTS + SUBSCRIPTIONS&quot;</span>
<span class="sd">        ×•×›×Ÿ ×•×¨×™××¦×™×•×ª ×¢× ×¨×™×‘×•×™ ×ª×•×•×™ &#39;#&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sections_by_line</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">raw</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="c1"># ×“×œ×’ ×¢×œ ××¤×¨×™×“×™ &quot;#####&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="c1"># ×”×¡×¨ ×ª×•×•×™ &#39;#&#39;</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># × ×ª××•×š ×‘×ª×‘× ×™×ª &quot;N) &quot; ×‘×ª×—×™×œ×ª ×”×§×• ××š ×œ× × ×“×¨×•×© ×–××ª</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(\d+\)\s*)?(.+)$&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">slug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_section_to_slug</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">slug</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sections_by_line</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">slug</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># ×›×•×ª×¨×ª ×©×œ× ×–×•×”×ª×” × ×—×©×‘×ª ×œ×”×¤×¡×§×ª ×¡×¢×™×£ ×§×™×™× ×›×“×™ ×œ××¤×©×¨ ××–×•×¨ &quot;×œ×œ× ×¡×¢×™×£&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sections_by_line</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_section_to_slug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">((</span><span class="s2">&quot;user management&quot;</span><span class="p">,</span> <span class="s2">&quot;users&quot;</span><span class="p">),</span> <span class="s2">&quot;users&quot;</span><span class="p">),</span>
            <span class="p">((</span><span class="s2">&quot;payments&quot;</span><span class="p">,</span> <span class="s2">&quot;subscriptions&quot;</span><span class="p">,</span> <span class="s2">&quot;billing&quot;</span><span class="p">,</span> <span class="s2">&quot;finance&quot;</span><span class="p">),</span> <span class="s2">&quot;finance&quot;</span><span class="p">),</span>
            <span class="p">((</span><span class="s2">&quot;file system&quot;</span><span class="p">,</span> <span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="s2">&quot;storage&quot;</span><span class="p">),</span> <span class="s2">&quot;files&quot;</span><span class="p">),</span>
            <span class="p">((</span><span class="s2">&quot;inventory&quot;</span><span class="p">,</span> <span class="s2">&quot;products&quot;</span><span class="p">),</span> <span class="s2">&quot;inventory&quot;</span><span class="p">),</span>
            <span class="p">((</span><span class="s2">&quot;network&quot;</span><span class="p">,</span> <span class="s2">&quot;api clients&quot;</span><span class="p">,</span> <span class="s2">&quot;api&quot;</span><span class="p">),</span> <span class="s2">&quot;api_clients&quot;</span><span class="p">),</span>
            <span class="p">((</span><span class="s2">&quot;analytics&quot;</span><span class="p">,</span> <span class="s2">&quot;reports&quot;</span><span class="p">,</span> <span class="s2">&quot;report&quot;</span><span class="p">),</span> <span class="s2">&quot;analytics&quot;</span><span class="p">),</span>
            <span class="p">((</span><span class="s2">&quot;notifications&quot;</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">),</span> <span class="s2">&quot;notifications&quot;</span><span class="p">),</span>
            <span class="p">((</span><span class="s2">&quot;permissions&quot;</span><span class="p">,</span> <span class="s2">&quot;auth&quot;</span><span class="p">),</span> <span class="s2">&quot;permissions&quot;</span><span class="p">),</span>
            <span class="p">((</span><span class="s2">&quot;workflow&quot;</span><span class="p">,</span> <span class="s2">&quot;pipelines&quot;</span><span class="p">),</span> <span class="s2">&quot;workflows&quot;</span><span class="p">),</span>
            <span class="p">((</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="s2">&quot;temp&quot;</span><span class="p">,</span> <span class="s2">&quot;mixed&quot;</span><span class="p">),</span> <span class="s2">&quot;debug&quot;</span><span class="p">),</span>
            <span class="p">((</span><span class="s2">&quot;random utilities&quot;</span><span class="p">,</span> <span class="s2">&quot;utilities&quot;</span><span class="p">,</span> <span class="s2">&quot;utils&quot;</span><span class="p">),</span> <span class="s2">&quot;utils&quot;</span><span class="p">),</span>
            <span class="p">((</span><span class="s2">&quot;application boot&quot;</span><span class="p">,</span> <span class="s2">&quot;main&quot;</span><span class="p">),</span> <span class="s2">&quot;main&quot;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">keys</span><span class="p">,</span> <span class="n">slug</span> <span class="ow">in</span> <span class="n">mapping</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">t</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">slug</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_get_section_for_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sections_by_line</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sections_by_line</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="n">line_no</span><span class="p">:</span>
                <span class="n">prev</span> <span class="o">=</span> <span class="n">k</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sections_by_line</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">prev</span><span class="p">)</span> <span class="k">if</span> <span class="n">prev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_calculate_dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">func_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">func</span><span class="o">.</span><span class="n">calls</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">func_names</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">other_func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">other_func</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">call</span><span class="p">:</span>
                            <span class="n">other_func</span><span class="o">.</span><span class="n">called_by</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="CodeAnalyzer.find_large_functions">
<a class="viewcode-back" href="../api/refactoring_engine.html#refactoring_engine.CodeAnalyzer.find_large_functions">[×ª×™×¢×•×“]</a>
    <span class="k">def</span> <span class="nf">find_large_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_lines</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]:</span>
        <span class="n">large</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">:</span>
            <span class="n">lines_count</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">end_line</span> <span class="o">-</span> <span class="n">func</span><span class="o">.</span><span class="n">start_line</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">lines_count</span> <span class="o">&gt;=</span> <span class="n">min_lines</span> <span class="ow">or</span> <span class="n">func</span><span class="o">.</span><span class="n">complexity</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">large</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">large</span></div>


<div class="viewcode-block" id="CodeAnalyzer.find_large_classes">
<a class="viewcode-back" href="../api/refactoring_engine.html#refactoring_engine.CodeAnalyzer.find_large_classes">[×ª×™×¢×•×“]</a>
    <span class="k">def</span> <span class="nf">find_large_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_methods</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ClassInfo</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">cls</span> <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">classes</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">methods</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">min_methods</span><span class="p">]</span></div>
</div>



<div class="viewcode-block" id="RefactoringEngine">
<a class="viewcode-back" href="../api/refactoring_engine.html#refactoring_engine.RefactoringEngine">[×ª×™×¢×•×“]</a>
<span class="k">class</span> <span class="nc">RefactoringEngine</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;×× ×•×¢ ×¨×¤×§×˜×•×¨×™× ×’&quot;&quot;&quot;</span>

    <span class="n">CANONICAL_DOMAIN_PRIORITY</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;users&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;finance&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;inventory&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;network&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;workflows&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">STICKY_SUPPORT_DOMAINS</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;helpers&quot;</span><span class="p">,</span> <span class="s2">&quot;utils&quot;</span><span class="p">}</span>

<div class="viewcode-block" id="RefactoringEngine.__init__">
<a class="viewcode-back" href="../api/refactoring_engine.html#refactoring_engine.RefactoringEngine.__init__">[×ª×™×¢×•×“]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">CodeAnalyzer</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># ×ª×¦×•×¨×”: ×©×œ×™×˜×” ×‘××¡×¤×¨ ×§×‘×•×¦×•×ª/××•×“×•×œ×™× ×›×“×™ ×œ×× ×•×¢ Oversplitting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preferred_min_groups</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preferred_max_groups</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_functions_per_group</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">absolute_max_groups</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shared_symbol_registry</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span></div>


<div class="viewcode-block" id="RefactoringEngine.propose_refactoring">
<a class="viewcode-back" href="../api/refactoring_engine.html#refactoring_engine.RefactoringEngine.propose_refactoring">[×ª×™×¢×•×“]</a>
    <span class="k">def</span> <span class="nf">propose_refactoring</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">refactor_type</span><span class="p">:</span> <span class="n">RefactorType</span><span class="p">,</span>
        <span class="n">layered_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RefactorResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;×”×¦×¢×ª ×¨×¤×§×˜×•×¨×™× ×’&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span> <span class="o">=</span> <span class="n">CodeAnalyzer</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">analyze</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">RefactorResult</span><span class="p">(</span>
                <span class="n">success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">proposal</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">error</span><span class="o">=</span><span class="s2">&quot;×›×©×œ ×‘× ×™×ª×•×— ×”×§×•×“ - ×™×™×ª×›×Ÿ ×©×’×™××ª ×ª×—×‘×™×¨&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="c1"># ×‘×§×©×ª ×©×›×‘×•×ª ×œ×¤×™-×§×¨×™××” (×œ×œ× ×–×™×”×•× ENV ×’×œ×•×‘×œ×™)</span>
        <span class="k">if</span> <span class="n">layered_mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_layered_mode_override&quot;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="n">layered_mode</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">refactor_type</span> <span class="o">==</span> <span class="n">RefactorType</span><span class="o">.</span><span class="n">SPLIT_FUNCTIONS</span><span class="p">:</span>
                <span class="n">proposal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_functions</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">refactor_type</span> <span class="o">==</span> <span class="n">RefactorType</span><span class="o">.</span><span class="n">EXTRACT_FUNCTIONS</span><span class="p">:</span>
                <span class="n">proposal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_functions</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">refactor_type</span> <span class="o">==</span> <span class="n">RefactorType</span><span class="o">.</span><span class="n">MERGE_SIMILAR</span><span class="p">:</span>
                <span class="n">proposal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merge_similar</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">refactor_type</span> <span class="o">==</span> <span class="n">RefactorType</span><span class="o">.</span><span class="n">CONVERT_TO_CLASSES</span><span class="p">:</span>
                <span class="n">proposal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_to_classes</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">refactor_type</span> <span class="o">==</span> <span class="n">RefactorType</span><span class="o">.</span><span class="n">DEPENDENCY_INJECTION</span><span class="p">:</span>
                <span class="n">proposal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_dependency_injection</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">RefactorResult</span><span class="p">(</span><span class="n">success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">proposal</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;×¡×•×’ ×¨×¤×§×˜×•×¨×™× ×’ ×œ× × ×ª××š: </span><span class="si">{</span><span class="n">refactor_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">validated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_proposal</span><span class="p">(</span><span class="n">proposal</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">RefactorResult</span><span class="p">(</span><span class="n">success</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">proposal</span><span class="o">=</span><span class="n">proposal</span><span class="p">,</span> <span class="n">validation_passed</span><span class="o">=</span><span class="n">validated</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;×©×’×™××” ×‘×¨×¤×§×˜×•×¨×™× ×’: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">RefactorResult</span><span class="p">(</span><span class="n">success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">proposal</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;×©×’×™××”: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_layered_mode_override&quot;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_layered_mode_override&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span></div>


    <span class="k">def</span> <span class="nf">_split_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RefactorProposal</span><span class="p">:</span>
        <span class="c1"># ××¦×‘ ××™×•×—×“: ×§×•×‘×¥ ××•×“×œ×™× ××•× ×•×œ×™×ª×™ (classes ×‘×œ×‘×“) â€” Safe Decomposition ×œ×“×•××™×™× ×™× ×‘×ª×•×š ×—×‘×™×œ×ª models/</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">functions</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="n">filename_stem</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
            <span class="k">if</span> <span class="n">filename_stem</span> <span class="o">==</span> <span class="s2">&quot;models&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_models_monolith</span><span class="p">()</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_related_functions</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;×œ× × ××¦××• ×§×‘×•×¦×•×ª ×¤×•× ×§×¦×™×•×ª × ×¤×¨×“×•×ª. ×”×§×•×“ ×›×‘×¨ ×××•×¨×’×Ÿ ×”×™×˜×‘.&quot;</span><span class="p">)</span>
        <span class="n">new_files</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">changes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">imports_needed</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">per_file_filtered_imports</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">base_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
        <span class="c1"># ×¢×“×™×¤×•×ª ×œ×¢×§×™×¤×ª ×©×›×‘×•×ª ×œ×¤×™-×§×¨×™××”; ××—×¨×ª â€“ ENV</span>
        <span class="n">override</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_layered_mode_override&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">layered_mode</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">override</span><span class="p">)</span> <span class="k">if</span> <span class="n">override</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;REFACTOR_LAYERED_MODE&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">,</span> <span class="s2">&quot;on&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># ×”×§×¦××ª ××—×œ×§×•×ª ×œ×§×‘×•×¦×•×ª (Collocation)</span>
        <span class="n">classes_by_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_classes_to_groups</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
        <span class="c1"># ×‘××¦×‘ ×©×›×‘×•×ª (Layered) â€“ ×“×—×•×£ ××ª ×›×œ ×”××—×œ×§×•×ª ×œ×§×•×‘×¥ Leaf ×™×—×™×“</span>
        <span class="n">classes_filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">layered_mode</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">classes</span><span class="p">):</span>
            <span class="n">classes_filename</span><span class="p">,</span> <span class="n">classes_file_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_classes_file</span><span class="p">(</span><span class="s2">&quot;models&quot;</span><span class="p">)</span>
            <span class="c1"># × ×©×ª××© ×‘×§×•×‘×¥ ×¡×˜× ×“×¨×˜×™ ×‘×©× models.py ×•×œ× ×‘×©× ××‘×•×¡×¡ ×§×œ×˜</span>
            <span class="n">classes_filename</span> <span class="o">=</span> <span class="s2">&quot;models.py&quot;</span>
            <span class="n">new_files</span><span class="p">[</span><span class="n">classes_filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">classes_file_content</span>
            <span class="n">changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ğŸ“¦ </span><span class="si">{</span><span class="n">classes_filename</span><span class="si">}</span><span class="s2">: ×¨×™×›×•×– ×™×©×•×™×•×ª (Leaf)&quot;</span><span class="p">)</span>
        <span class="c1"># ×‘× ×™×™×ª ×§×‘×¦×™ ×“×•××™×™×Ÿ</span>
        <span class="n">module_stem_by_group</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">functions</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">new_filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_choose_filename_for_group</span><span class="p">(</span><span class="n">base_name</span><span class="p">,</span> <span class="n">group_name</span><span class="p">)</span>
            <span class="n">module_stem_by_group</span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">new_filename</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
            <span class="n">group_classes</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">layered_mode</span> <span class="k">else</span> <span class="n">classes_by_group</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">group_name</span><span class="p">,</span> <span class="p">[])</span>
            <span class="c1"># ×¡×™× ×•×Ÿ imports ×œ×¤×™ ×©×™××•×© ×××™×ª×™ ×‘×§×•×“ ×”××©×•×œ×‘</span>
            <span class="n">combined_body_parts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">group_classes</span><span class="p">:</span>
                <span class="n">combined_body_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">functions</span><span class="p">:</span>
                <span class="n">combined_body_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
            <span class="n">group_code_body</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">combined_body_parts</span><span class="p">)</span>
            <span class="n">filtered_imports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_imports_for_code</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">imports</span><span class="p">,</span> <span class="n">group_code_body</span><span class="p">)</span>
            <span class="n">per_file_filtered_imports</span><span class="p">[</span><span class="n">new_filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_imports</span>
            <span class="n">file_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_file_content</span><span class="p">(</span><span class="n">functions</span><span class="p">,</span> <span class="n">imports</span><span class="o">=</span><span class="n">filtered_imports</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="n">group_classes</span><span class="p">)</span>
            <span class="n">new_files</span><span class="p">[</span><span class="n">new_filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_content</span>
            <span class="n">changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ğŸ“¦ </span><span class="si">{</span><span class="n">new_filename</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">group_classes</span><span class="p">)</span><span class="si">}</span><span class="s2"> ××—×œ×§×•×ª, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">functions</span><span class="p">)</span><span class="si">}</span><span class="s2"> ×¤×•× ×§×¦×™×•×ª&quot;</span><span class="p">)</span>
            <span class="c1"># ×©××™×¨×” ×œ××—×•×¨: imports_needed ××›×™×œ ××ª ×”-imports ×”××§×•×¨×™×™× (×œ×¦×¨×›×™ ×ª××™××•×ª ×‘×“×•×—×•×ª)</span>
            <span class="n">imports_needed</span><span class="p">[</span><span class="n">new_filename</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">imports</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">init_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_init_file</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">new_files</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">new_files</span><span class="p">[</span><span class="s2">&quot;__init__.py&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">init_content</span>
        <span class="n">changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ğŸ“¦ __init__.py: ××™×™×¦× ××ª ×›×œ ×”-API&quot;</span><span class="p">)</span>

        <span class="c1"># ××™×—×•×“ imports ××©×•×ª×¤×™× ×œ×§×•×‘×¥ shared ×•×”×—×œ×¤×ª× ×‘-import ×™×—×™×“</span>
        <span class="n">original_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">new_files</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">new_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_centralize_common_imports</span><span class="p">(</span><span class="n">new_files</span><span class="p">,</span> <span class="n">per_file_filtered_imports</span><span class="p">,</span> <span class="n">base_name</span><span class="p">)</span>
        <span class="n">shared_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_shared.py&quot;</span>
        <span class="k">if</span> <span class="n">shared_filename</span> <span class="ow">in</span> <span class="n">new_files</span> <span class="ow">and</span> <span class="n">shared_filename</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">original_keys</span><span class="p">:</span>
            <span class="n">changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ğŸ“¦ </span><span class="si">{</span><span class="n">shared_filename</span><span class="si">}</span><span class="s2">: ×™×™×‘×•× ××©×•×ª×£ ××¨×•×›×–&quot;</span><span class="p">)</span>

        <span class="c1"># ××™×Ÿ ×™×•×ª×¨ ×§×•×‘×¥ ××—×œ×§×•×ª ××¨×›×–×™ â€“ ××—×œ×§×•×ª ××¨×•×›×–×•×ª ×œ×¤×™ ×“×•××™×™×Ÿ (Collocation)</span>

        <span class="c1"># ×”×–×¨×§×ª ×™×‘×•× ×œ×¤×•× ×§×¦×™×•×ª ×‘×™×Ÿ-××•×“×•×œ×™×•×ª (Cross-module function imports)</span>
        <span class="n">func_to_module</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">functions</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">module_stem</span> <span class="o">=</span> <span class="n">module_stem_by_group</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">group_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">functions</span><span class="p">:</span>
                <span class="n">func_to_module</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">module_stem</span>
        <span class="n">new_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inject_function_imports</span><span class="p">(</span><span class="n">new_files</span><span class="p">,</span> <span class="n">func_to_module</span><span class="p">)</span>
        <span class="c1"># ×”×–×¨×§×ª ×™×‘×•× ×œ××—×œ×§×•×ª ×‘×™×Ÿ-××•×“×•×œ×™×•×ª (Cross-module class imports)</span>
        <span class="k">if</span> <span class="n">layered_mode</span> <span class="ow">and</span> <span class="n">classes_filename</span><span class="p">:</span>
            <span class="c1"># ×‘××¦×‘ ×©×›×‘×•×ª â€“ ×›×œ ×”××—×œ×§×•×ª ×‘-models.py, ×”×–×¨×§ import ××× ×•</span>
            <span class="n">new_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inject_class_imports</span><span class="p">(</span><span class="n">new_files</span><span class="p">,</span> <span class="n">classes_filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">class_to_module</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">classes</span> <span class="ow">in</span> <span class="n">classes_by_group</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">module_stem</span> <span class="o">=</span> <span class="n">module_stem_by_group</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">group_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
                    <span class="n">class_to_module</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">module_stem</span>
            <span class="k">if</span> <span class="n">class_to_module</span><span class="p">:</span>
                <span class="n">new_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inject_cross_module_class_imports</span><span class="p">(</span><span class="n">new_files</span><span class="p">,</span> <span class="n">class_to_module</span><span class="p">)</span>

        <span class="c1"># DRY-RUN: ×–×™×”×•×™ ×•×× ×™×¢×ª ×ª×œ×•×ª ××¢×’×œ×™×ª ×‘×™×Ÿ ×”××•×“×•×œ×™× ×©× ×•×¦×¨×•</span>
        <span class="n">cycle_warnings</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">new_files</span><span class="p">,</span> <span class="n">merged_pairs</span><span class="p">,</span> <span class="n">shared_bridges</span><span class="p">,</span> <span class="n">skipped_canonical_cycles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_circular_imports</span><span class="p">(</span>
            <span class="n">new_files</span><span class="p">,</span> <span class="n">base_name</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">merged_pairs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">merged_pairs</span><span class="p">:</span>
                <span class="n">cycle_warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;â™»ï¸ ×¤×•×¨×§×” ×ª×œ×•×ª ××¢×’×œ×™×ª ×‘×××¦×¢×•×ª ××™×–×•×’ ×”××•×“×•×œ×™×: </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> â‡„ </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># ×¢×“×›×•×Ÿ __init__.py ×œ××—×¨ ××™×–×•×’×™×</span>
            <span class="n">module_file_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">fn</span> <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">new_files</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">fn</span> <span class="o">!=</span> <span class="s1">&#39;__init__.py&#39;</span><span class="p">]</span>
            <span class="n">new_files</span><span class="p">[</span><span class="s1">&#39;__init__.py&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_init_file</span><span class="p">(</span><span class="n">module_file_names</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">shared_bridges</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">shared_bridges</span><span class="p">:</span>
                <span class="n">cycle_warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;â™»ï¸ ×¤×•×¨×§×” ×ª×œ×•×ª ××¢×’×œ×™×ª ×‘×××¦×¢×•×ª ×©×›×‘×ª shared: </span><span class="si">{</span><span class="s1">&#39; â‡„ &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">skipped_canonical_cycles</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">skipped_canonical_cycles</span><span class="p">:</span>
                <span class="n">cycle_warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;âš ï¸ × ×•×ª×¨×” ×ª×œ×•×ª ××¢×’×œ×™×ª ×‘×™×Ÿ ××•×“×•×œ×™× ×§× ×•× ×™×™× ×©× ×©××¨×• ×œ×©×™××•×¨ ×“×•××™×™×Ÿ: </span><span class="si">{</span><span class="s1">&#39; â‡„ &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="c1"># × ×™×§×•×™ ×¤×•×¡×˜-×¤×™×¦×•×œ: ×”×¡×¨×ª imports ××™×•×ª×¨×™× ×‘×¨××ª ×§×•×‘×¥</span>
        <span class="n">new_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post_refactor_cleanup</span><span class="p">(</span><span class="n">new_files</span><span class="p">)</span>
        <span class="n">description</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;ğŸ—ï¸ ××¦××ª×™ </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">classes</span><span class="p">)</span><span class="si">}</span><span class="s2"> ××—×œ×§×•×ª ×•-</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">functions</span><span class="p">)</span><span class="si">}</span><span class="s2"> ×¤×•× ×§×¦×™×•×ª.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;×”×¦×¢×ª ×¤×™×¦×•×œ ×œ×¤×™ ×“×•××™×™×Ÿ (Collocation):</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;ğŸ“¦ </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2"> â†’</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">new_files</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   â”œâ”€â”€ </span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">description</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âœ… ××—×œ×§×•×ª ×•×¤×•× ×§×¦×™×•×ª ××¨×•×›×–×•×ª ×™×—×“ ×‘×§×‘×¦×™ ×“×•××™×™×Ÿ; ××™×Ÿ ×§×•×‘×¥ ××—×œ×§×•×ª ×’× ×¨×™&quot;</span>
        <span class="n">warnings</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">global_vars</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;âš ï¸ ×™×© </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">global_vars</span><span class="p">)</span><span class="si">}</span><span class="s2"> ××©×ª× ×™× ×’×œ×•×‘×œ×™×™× - ×¢×œ×•×œ ×œ×”×™×•×ª ×¦×•×¨×š ×‘×”×ª×××” ×™×“× ×™×ª&quot;</span>
            <span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">cycle_warnings</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">RefactorProposal</span><span class="p">(</span>
            <span class="n">refactor_type</span><span class="o">=</span><span class="n">RefactorType</span><span class="o">.</span><span class="n">SPLIT_FUNCTIONS</span><span class="p">,</span>
            <span class="n">original_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">new_files</span><span class="o">=</span><span class="n">new_files</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">changes_summary</span><span class="o">=</span><span class="n">changes</span><span class="p">,</span>
            <span class="n">warnings</span><span class="o">=</span><span class="n">warnings</span><span class="p">,</span>
            <span class="n">imports_needed</span><span class="o">=</span><span class="n">imports_needed</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_group_related_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ×§×™×‘×•×¥ ×¤×•× ×§×¦×™×•×ª ×œ×¤×™ ×§×•×”×–×™×” ×¡×× ×˜×™×ª:</span>
<span class="sd">        1) ×¡×¢×™×£ (Section) ×× ×–×•×”×” ××ª×•×š ×›×•×ª×¨×•×ª ×”×§×•×‘×¥</span>
<span class="sd">        2) ×“×•××™×™×Ÿ (IO/Compute/Helpers)</span>
<span class="sd">        3) Prefix ×•×ª×œ×•×™×•×ª</span>
<span class="sd">        ×ª×•×š ×©××™×¨×” ×¢×œ ×˜×•×•×— ×§×‘×•×¦×•×ª ××•×¢×“×£ ×•×”×™×× ×¢×•×ª ××¤×™×¦×•×œ ×™×ª×¨.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="n">functions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">functions</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">functions</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">section_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scaffold_groups_from_sections</span><span class="p">(</span><span class="n">functions</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">section_groups</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">section_groups</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;module&quot;</span><span class="p">:</span> <span class="n">functions</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">functions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="sa">f</span><span class="s2">&quot;group_</span><span class="si">{</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">func</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">func</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">functions</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="c1"># 1) ×§×™×‘×•×¥ ×œ×¤×™ ×¡×¢×™×£ (×× ×§×™×™×). ×× ×™×© ×¤×•× ×§×¦×™×•×ª ×œ×œ× ×¡×¢×™×£ â€” × ×©××¨ ××•×ª×Ÿ ×¢&quot;×™ ×§×™×‘×•×¥ ×“×•××™×™× ×™ ×•×”×•×¡×¤×”.</span>
        <span class="n">section_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_by_section</span><span class="p">(</span><span class="n">functions</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">section_groups</span><span class="p">:</span>
            <span class="n">leftovers</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">functions</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">section</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">leftovers</span><span class="p">:</span>
                <span class="n">domain_for_leftovers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_by_domain</span><span class="p">(</span><span class="n">leftovers</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">domain_for_leftovers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">section_groups</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># ××™×Ÿ ×›×•×ª×¨×•×ª ×›×œ×œ â€” ×§×™×‘×•×¥ ×“×•××™×™× ×™ ××œ×</span>
            <span class="n">section_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_by_domain</span><span class="p">(</span><span class="n">functions</span><span class="p">)</span>

        <span class="c1"># 2) ×§×™×‘×•×¥ × ×•×¡×£ ×œ×¤×™ prefix ×‘×ª×•×š ×›×œ ×“×•××™×™×Ÿ, ×œ×©××™×¨×ª ×§×¨×‘×” ×¡×× ×˜×™×ª</span>
        <span class="n">refined</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">funcs</span> <span class="ow">in</span> <span class="n">section_groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_by_prefix</span><span class="p">(</span><span class="n">funcs</span><span class="p">)</span>
            <span class="n">large_sub</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sub</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_functions_per_group</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">large_sub</span><span class="p">:</span>
                <span class="n">refined</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">large_sub</span><span class="p">)</span>
                <span class="n">leftovers</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sub</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_functions_per_group</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">leftovers</span><span class="p">:</span>
                    <span class="n">refined</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">leftovers</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">refined</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span> <span class="o">=</span> <span class="n">funcs</span>

        <span class="c1"># 3) ××™×–×•×’ ×œ×¤×™ ×ª×œ×•×ª (affinity) ×›×“×™ ×œ××—×“ ×§×‘×•×¦×•×ª ×§×¨×•×‘×•×ª</span>
        <span class="n">refined</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merge_by_dependency_affinity</span><span class="p">(</span><span class="n">refined</span><span class="p">)</span>

        <span class="c1"># 4) ××™×–×•×’ ×§×‘×•×¦×•×ª ×§×˜× ×•×ª ××“×™</span>
        <span class="n">refined</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merge_small_groups</span><span class="p">(</span><span class="n">refined</span><span class="p">)</span>

        <span class="c1"># 5) ×”×’×‘×œ×ª ××¡×¤×¨ ×§×‘×•×¦×•×ª ×œ×˜×•×•×— ×”××•×¢×“×£/××§×¡×™××œ×™</span>
        <span class="n">refined</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limit_group_count</span><span class="p">(</span><span class="n">refined</span><span class="p">)</span>

        <span class="c1"># ×”×‘×˜×—×ª ××™× ×™××•× ×©×ª×™ ×§×‘×•×¦×•×ª ×›×©×™×© ××¡×¤×™×§ ×¤×•× ×§×¦×™×•×ª</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">refined</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">functions</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">fallback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_by_prefix</span><span class="p">(</span><span class="n">functions</span><span class="p">)</span>
            <span class="n">sorted_groups</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">fallback</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">kv</span><span class="p">:</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">kv</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_groups</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># ×§×— ×©×ª×™ ×§×‘×•×¦×•×ª ××•×‘×™×œ×•×ª ×•××– ××™×–×•×’ ×©×œ ×™×ª×¨ ×”×§×‘×•×¦×•×ª â€” ×œ× ×–×•×¨×§×™× ×¤×•× ×§×¦×™×•×ª!</span>
                <span class="n">refined</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">sorted_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="n">sorted_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="n">sorted_groups</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="n">sorted_groups</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">funcs</span> <span class="ow">in</span> <span class="n">sorted_groups</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
                    <span class="c1"># ×‘×—×¨ ×™×¢×“ ××™×–×•×’ ×œ×¤×™ affinity ××œ ××—×ª ×”×§×‘×•×¦×•×ª ×”×§×™×™××•×ª</span>
                    <span class="n">best_target</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">best_score</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
                    <span class="k">for</span> <span class="n">target_name</span><span class="p">,</span> <span class="n">target_funcs</span> <span class="ow">in</span> <span class="n">refined</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_affinity</span><span class="p">(</span><span class="n">funcs</span><span class="p">,</span> <span class="n">target_funcs</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="n">best_score</span><span class="p">:</span>
                            <span class="n">best_score</span> <span class="o">=</span> <span class="n">score</span>
                            <span class="n">best_target</span> <span class="o">=</span> <span class="n">target_name</span>
                    <span class="k">if</span> <span class="n">best_target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1"># ×’×™×‘×•×™: ××–×’ ×œ×§×‘×•×¦×” ×”×§×˜× ×” ×™×•×ª×¨ ×›×“×™ ×œ××–×Ÿ</span>
                        <span class="n">best_target</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">refined</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">refined</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
                    <span class="n">refined</span><span class="p">[</span><span class="n">best_target</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">funcs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">refined</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;module&quot;</span><span class="p">:</span> <span class="n">functions</span><span class="p">}</span>

        <span class="c1"># ×™×™×¦×•×‘ ×©××•×ª ×§×‘×•×¦×•×ª</span>
        <span class="n">stable</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">seen</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">funcs</span> <span class="ow">in</span> <span class="n">refined</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^a-z0-9_]&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="k">while</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base</span><span class="si">}{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">base</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base</span><span class="si">}{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
            <span class="n">stable</span><span class="p">[</span><span class="n">base</span><span class="p">]</span> <span class="o">=</span> <span class="n">funcs</span>
        <span class="k">return</span> <span class="n">stable</span>

    <span class="k">def</span> <span class="nf">_scaffold_groups_from_sections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">functions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ×›××©×¨ ×™×© ××¢×˜ ×××•×“ ×¤×•× ×§×¦×™×•×ª ××š ×§×™×™××•×ª ××—×œ×§×•×ª ×‘×¡×¢×™×¤×™× ×©×•× ×™×, × ×‘× ×” ×§×‘×•×¦×•×ª ×œ×¤×™ ×”×¡×¢×™×¤×™×</span>
<span class="sd">        ×›×“×™ ×œ××¤×©×¨ ×¤×™×¦×•×œ ×©×¢×“×™×™×Ÿ ×™×©××¨ ××ª ×”×”×§×©×¨×™× ×”×¡×× ×˜×™×™× (×œ××©×œ Users ×œ×¢×•××ª Analytics).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">entries</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">def</span> <span class="nf">_ensure_entry</span><span class="p">(</span><span class="n">section</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start_line</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">entries</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start_line</span><span class="p">,</span> <span class="s2">&quot;funcs&quot;</span><span class="p">:</span> <span class="p">[]})</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">start_line</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">data</span>

        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">functions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">func</span><span class="o">.</span><span class="n">section</span><span class="p">:</span>
                <span class="n">entry</span> <span class="o">=</span> <span class="n">_ensure_entry</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="n">start_line</span><span class="p">)</span>
                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;funcs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">section</span><span class="p">:</span>
                <span class="n">_ensure_entry</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">start_line</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">ordered_sections</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">entries</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">kv</span><span class="p">:</span> <span class="n">kv</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">])</span>
        <span class="n">groups</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">section</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">entries</span><span class="p">[</span><span class="n">section</span><span class="p">][</span><span class="s2">&quot;funcs&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">section</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">ordered_sections</span>
        <span class="p">}</span>
        <span class="n">leftovers</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">functions</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">section</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">leftovers</span><span class="p">:</span>
            <span class="n">first_section</span> <span class="o">=</span> <span class="n">ordered_sections</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">groups</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">first_section</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">leftovers</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">groups</span>

    <span class="k">def</span> <span class="nf">_group_by_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">functions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;×§×™×‘×•×¥ ×¤×•× ×§×¦×™×•×ª ×œ×¤×™ ×¡×¢×™×£ (Section) ×× ×§×™×™×.&quot;&quot;&quot;</span>
        <span class="n">groups</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">functions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">section</span><span class="p">:</span>
                <span class="n">groups</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">groups</span>

    <span class="k">def</span> <span class="nf">_group_by_dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]]:</span>
        <span class="n">groups</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">visited</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">functions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">func</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">group_name</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)[:</span><span class="mi">15</span><span class="p">]</span>
            <span class="n">group</span> <span class="o">=</span> <span class="p">[</span><span class="n">func</span><span class="p">]</span>
            <span class="n">visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">other_func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">functions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">other_func</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">func</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">other_func</span><span class="o">.</span><span class="n">calls</span>
                    <span class="ow">or</span> <span class="n">other_func</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">func</span><span class="o">.</span><span class="n">calls</span>
                    <span class="ow">or</span> <span class="n">func</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">other_func</span><span class="o">.</span><span class="n">called_by</span>
                    <span class="ow">or</span> <span class="n">other_func</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">func</span><span class="o">.</span><span class="n">called_by</span>
                <span class="p">):</span>
                    <span class="n">group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other_func</span><span class="p">)</span>
                    <span class="n">visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other_func</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">groups</span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span>
        <span class="k">return</span> <span class="n">groups</span>

    <span class="k">def</span> <span class="nf">_split_by_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]]:</span>
        <span class="n">max_funcs_per_file</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">groups</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">functions</span><span class="p">),</span> <span class="n">max_funcs_per_file</span><span class="p">):</span>
            <span class="n">group_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;module</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">max_funcs_per_file</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">groups</span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">max_funcs_per_file</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">groups</span>

    <span class="c1"># ==== ×§×™×‘×•×¥ ××©×•×¤×¨: ×“×•××™×™×Ÿ/Prefix/×ª×œ×•×ª ====</span>

    <span class="k">def</span> <span class="nf">_tokenize_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[_]|(?=[A-Z])&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parts</span> <span class="k">if</span> <span class="n">p</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_classify_function_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">FunctionInfo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;×¡×™×•×•×’ ×¤×•× ×§×¦×™×” ×œ-domain ×‘×¡×™×¡×™: io / compute / helpers / other.&quot;&quot;&quot;</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenize_name</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">calls</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">func</span><span class="o">.</span><span class="n">calls</span><span class="p">}</span>
        <span class="n">io_keywords</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="s2">&quot;save&quot;</span><span class="p">,</span> <span class="s2">&quot;fetch&quot;</span><span class="p">,</span> <span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">,</span> <span class="s2">&quot;connect&quot;</span><span class="p">,</span> <span class="s2">&quot;request&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;download&quot;</span><span class="p">,</span> <span class="s2">&quot;upload&quot;</span><span class="p">,</span> <span class="s2">&quot;send&quot;</span><span class="p">,</span> <span class="s2">&quot;receive&quot;</span><span class="p">,</span> <span class="s2">&quot;persist&quot;</span><span class="p">,</span> <span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="s2">&quot;serialize&quot;</span><span class="p">,</span> <span class="s2">&quot;deserialize&quot;</span><span class="p">}</span>
        <span class="n">helper_keywords</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;helper&quot;</span><span class="p">,</span> <span class="s2">&quot;util&quot;</span><span class="p">,</span> <span class="s2">&quot;utils&quot;</span><span class="p">,</span> <span class="s2">&quot;format&quot;</span><span class="p">,</span> <span class="s2">&quot;convert&quot;</span><span class="p">,</span> <span class="s2">&quot;parse&quot;</span><span class="p">,</span> <span class="s2">&quot;normalize&quot;</span><span class="p">,</span> <span class="s2">&quot;validate&quot;</span><span class="p">,</span> <span class="s2">&quot;cleanup&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">tok</span> <span class="ow">in</span> <span class="n">io_keywords</span> <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;io&quot;</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">tok</span> <span class="ow">in</span> <span class="n">helper_keywords</span> <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;helpers&quot;</span>
        <span class="n">io_calls</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;requests&quot;</span><span class="p">,</span> <span class="s2">&quot;httpx&quot;</span><span class="p">,</span> <span class="s2">&quot;urllib&quot;</span><span class="p">,</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="s2">&quot;yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;asyncio&quot;</span><span class="p">,</span> <span class="s2">&quot;sqlite3&quot;</span><span class="p">,</span> <span class="s2">&quot;psycopg2&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">calls</span> <span class="o">&amp;</span> <span class="n">io_calls</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;io&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;compute&quot;</span>

    <span class="k">def</span> <span class="nf">_group_by_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">functions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]]:</span>
        <span class="n">groups</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;io&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;compute&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;helpers&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">functions</span><span class="p">:</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classify_function_domain</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">groups</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_group_by_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">functions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]]:</span>
        <span class="n">groups</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">functions</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenize_name</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">tokens</span> <span class="k">else</span> <span class="s2">&quot;module&quot;</span>
            <span class="n">groups</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">groups</span>

    <span class="k">def</span> <span class="nf">_name_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">ta</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tokenize_name</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
        <span class="n">tb</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tokenize_name</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ta</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">tb</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="n">inter</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ta</span> <span class="o">&amp;</span> <span class="n">tb</span><span class="p">)</span>
        <span class="n">union</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ta</span> <span class="o">|</span> <span class="n">tb</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inter</span> <span class="o">/</span> <span class="n">union</span> <span class="k">if</span> <span class="n">union</span> <span class="k">else</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="nf">_group_affinity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g1</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">],</span> <span class="n">g2</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">g1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">g2</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="n">name_score</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">dep_score</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">f1</span> <span class="ow">in</span> <span class="n">g1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f2</span> <span class="ow">in</span> <span class="n">g2</span><span class="p">:</span>
                <span class="n">pairs</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">name_score</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name_similarity</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">f2</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">f2</span><span class="o">.</span><span class="n">calls</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">f2</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">f1</span><span class="o">.</span><span class="n">calls</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">f2</span><span class="o">.</span><span class="n">called_by</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">f2</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">f1</span><span class="o">.</span><span class="n">called_by</span><span class="p">):</span>
                    <span class="n">dep_score</span> <span class="o">+=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">pairs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="p">(</span><span class="n">name_score</span> <span class="o">/</span> <span class="n">pairs</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="p">(</span><span class="n">dep_score</span> <span class="o">/</span> <span class="n">pairs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_merge_by_dependency_affinity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]]:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">groups</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">protected_groups</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CANONICAL_DOMAIN_PRIORITY</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">STICKY_SUPPORT_DOMAINS</span>
        <span class="k">while</span> <span class="n">changed</span><span class="p">:</span>
            <span class="n">changed</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">merge_candidates</span> <span class="o">=</span> <span class="p">[</span><span class="n">kv</span> <span class="k">for</span> <span class="n">kv</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="n">kv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">protected_groups</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">merge_candidates</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">smallest</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">merge_candidates</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">kv</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">kv</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">smallest</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_functions_per_group</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferred_min_groups</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">best_idx</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">best_score</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">funcs</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">smallest</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">continue</span>
                <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_affinity</span><span class="p">(</span><span class="n">smallest</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">funcs</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="n">best_score</span><span class="p">:</span>
                    <span class="n">best_score</span> <span class="o">=</span> <span class="n">score</span>
                    <span class="n">best_idx</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">if</span> <span class="n">best_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">best_score</span> <span class="o">&gt;=</span> <span class="mf">0.1</span><span class="p">:</span>
                <span class="n">target_name</span><span class="p">,</span> <span class="n">target_funcs</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="n">best_idx</span><span class="p">]</span>
                <span class="n">target_funcs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">smallest</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">items</span> <span class="o">=</span> <span class="p">[(</span><span class="n">n</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="n">smallest</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_merge_small_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]]:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="c1"># ×× ×™×© ×¨×§ 2 ×§×‘×•×¦×•×ª â€” × ×©××™×¨ ××•×ª×Ÿ ×›×“×™ ×œ×× ×•×¢ ×”×ª××–×’×•×ª ×œ××•×“×•×œ ×™×—×™×“</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">groups</span>
        <span class="n">protected_groups</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CANONICAL_DOMAIN_PRIORITY</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">STICKY_SUPPORT_DOMAINS</span>
        <span class="n">large</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">fs</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_functions_per_group</span> <span class="ow">or</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">protected_groups</span>
        <span class="p">]</span>
        <span class="n">small</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">fs</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_functions_per_group</span> <span class="ow">and</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">protected_groups</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">small</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">groups</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">large</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">groups</span>
        <span class="k">for</span> <span class="n">sname</span><span class="p">,</span> <span class="n">sfuncs</span> <span class="ow">in</span> <span class="n">small</span><span class="p">:</span>
            <span class="n">best_name</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">best_score</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
            <span class="k">for</span> <span class="n">lname</span><span class="p">,</span> <span class="n">lfuncs</span> <span class="ow">in</span> <span class="n">large</span><span class="p">:</span>
                <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_affinity</span><span class="p">(</span><span class="n">sfuncs</span><span class="p">,</span> <span class="n">lfuncs</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="n">best_score</span><span class="p">:</span>
                    <span class="n">best_score</span> <span class="o">=</span> <span class="n">score</span>
                    <span class="n">best_name</span> <span class="o">=</span> <span class="n">lname</span>
            <span class="k">if</span> <span class="n">best_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">best_name</span> <span class="o">=</span> <span class="n">large</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">lname</span><span class="p">,</span> <span class="n">lfuncs</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">large</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">lname</span> <span class="o">==</span> <span class="n">best_name</span><span class="p">:</span>
                    <span class="n">lfuncs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">sfuncs</span><span class="p">)</span>
                    <span class="n">large</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lname</span><span class="p">,</span> <span class="n">lfuncs</span><span class="p">)</span>
                    <span class="k">break</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">large</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_limit_group_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]]:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">absolute_max_groups</span><span class="p">:</span>
            <span class="n">best_pair</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">best_score</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)):</span>
                    <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_affinity</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">items</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="n">best_score</span><span class="p">:</span>
                        <span class="n">best_score</span> <span class="o">=</span> <span class="n">score</span>
                        <span class="n">best_pair</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">best_pair</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">best_pair</span>
            <span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">items</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">del</span> <span class="n">items</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferred_max_groups</span><span class="p">:</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferred_max_groups</span><span class="p">:</span>
                <span class="n">smallest_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">best_idx</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">best_score</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">smallest_idx</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_affinity</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="n">smallest_idx</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="n">best_score</span><span class="p">:</span>
                        <span class="n">best_score</span> <span class="o">=</span> <span class="n">score</span>
                        <span class="n">best_idx</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">if</span> <span class="n">best_idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">items</span><span class="p">[</span><span class="n">best_idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="n">best_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">items</span><span class="p">[</span><span class="n">best_idx</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">items</span><span class="p">[</span><span class="n">smallest_idx</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">del</span> <span class="n">items</span><span class="p">[</span><span class="n">smallest_idx</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_merge_singletons_for_oop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ×××–×’ ×§×‘×•×¦×•×ª ×§×˜× ×•×ª (×¤×—×•×ª ×-min_functions_per_group) ××œ ×§×‘×•×¦×” ×“×•××”,</span>
<span class="sd">        ×›×“×™ ×©×œ× ×™××‘×“×• ×¤×•× ×§×¦×™×•×ª ×›××©×¨ ××—×œ×§×•×ª × ×•×¦×¨×•×ª ×¨×§ ×¢×‘×•×¨ ×§×‘×•×¦×•×ª ×¢× 2+ ×¤×•× ×§×¦×™×•×ª.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">groups</span>
        <span class="c1"># ×¢×‘×•×“×” ×¢×œ ×”×¢×ª×§ ×›×“×™ ×œ×©× ×•×ª ×‘×‘×˜×—×”</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">funcs</span> <span class="o">=</span> <span class="n">groups</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">funcs</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_functions_per_group</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># ××¦× ×™×¢×“ ××™×–×•×’</span>
            <span class="n">best_name</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">best_score</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
            <span class="k">for</span> <span class="n">target_name</span><span class="p">,</span> <span class="n">target_funcs</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">target_name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_affinity</span><span class="p">(</span><span class="n">funcs</span><span class="p">,</span> <span class="n">target_funcs</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="n">best_score</span><span class="p">:</span>
                    <span class="n">best_score</span> <span class="o">=</span> <span class="n">score</span>
                    <span class="n">best_name</span> <span class="o">=</span> <span class="n">target_name</span>
            <span class="k">if</span> <span class="n">best_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># ×’×™×‘×•×™: ×‘×—×¨ ××ª ×”×§×‘×•×¦×” ×”×’×“×•×œ×” ×‘×™×•×ª×¨</span>
                <span class="n">best_name</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="n">name</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
            <span class="n">groups</span><span class="p">[</span><span class="n">best_name</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">funcs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">groups</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">groups</span>
    <span class="c1"># ==== Safe Decomposition for models.py (classes-only) ====</span>
    <span class="k">def</span> <span class="nf">_classify_class_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">:</span> <span class="n">ClassInfo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ××¡×•×•×’ ××—×œ×§×” ×œ×“×•××™×™×Ÿ ×‘×¡×™×¡×™ ×›××©×¨ ××™×Ÿ ×¤×•× ×§×¦×™×•×ª ×˜×•×¤-×œ×‘×œ:</span>
<span class="sd">        core / billing / inventory / network / workflows.</span>
<span class="sd">        ×‘×¨×™×¨×ª ××—×“×œ: core.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name_l</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="c1"># ×¡×™×× ×™× ×—×–×§×™×</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">name_l</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;subscription&quot;</span><span class="p">,</span> <span class="s2">&quot;payment&quot;</span><span class="p">,</span> <span class="s2">&quot;billing&quot;</span><span class="p">,</span> <span class="s2">&quot;gateway&quot;</span><span class="p">)):</span>
            <span class="k">return</span> <span class="s2">&quot;billing&quot;</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">name_l</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;product&quot;</span><span class="p">,</span> <span class="s2">&quot;inventory&quot;</span><span class="p">,</span> <span class="s2">&quot;stock&quot;</span><span class="p">)):</span>
            <span class="k">return</span> <span class="s2">&quot;inventory&quot;</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">name_l</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;api&quot;</span><span class="p">,</span> <span class="s2">&quot;client&quot;</span><span class="p">,</span> <span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot;network&quot;</span><span class="p">)):</span>
            <span class="k">return</span> <span class="s2">&quot;network&quot;</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">name_l</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;workflow&quot;</span><span class="p">,</span> <span class="s2">&quot;pipeline&quot;</span><span class="p">)):</span>
            <span class="k">return</span> <span class="s2">&quot;workflows&quot;</span>
        <span class="c1"># ×œ×™×‘×”/××©×ª××©×™×/×”×¨×©××•×ª/××™××™×™×œ</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">name_l</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;permission&quot;</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="s2">&quot;manager&quot;</span><span class="p">)):</span>
            <span class="k">return</span> <span class="s2">&quot;core&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;core&quot;</span>

    <span class="k">def</span> <span class="nf">_extract_module_global_assignments</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ××—×–×™×¨ (×©××•×ª ×’×œ×•×‘×œ×™×™× ×œ×¤×™ ×¡×“×¨ ×”×•×¤×¢×”, ×§×•×“ ×”×”×§×¦××•×ª) ××ª×•×š ×”×§×•×‘×¥ ×”××§×•×¨×™ ×‘×¨××ª ××•×“×•×œ.</span>
<span class="sd">        ××©××© ×‘×©×œ×‘ Safe Decomposition ×œ-models.py ×›×“×™ ×œ×©××¨ ×§×‘×•×¢×™×/××©×ª× ×™× ×’×œ×•×‘×œ×™×™×.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="p">,</span> <span class="s2">&quot;tree&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[],</span> <span class="s2">&quot;&quot;</span>
        <span class="n">names_in_order</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">seen</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">code_blocks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">tree</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">,</span> <span class="p">[]):</span>  <span class="c1"># type: ignore[attr-defined]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">AnnAssign</span><span class="p">)):</span>
                <span class="c1"># ×©×—×–×•×¨ ×§×•×“ ××§×•×¨ ×©×œ ×”×”×§×¦××”</span>
                <span class="n">start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;lineno&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">end</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;end_lineno&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
                <span class="n">snippet</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">end</span><span class="p">])</span>
                <span class="n">code_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">snippet</span><span class="p">)</span>
                <span class="c1"># ××™×¡×•×£ ×©××•×ª</span>
                <span class="n">targets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">AST</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">):</span>
                    <span class="n">targets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">targets</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>  <span class="c1"># type: ignore[attr-defined]</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span> <span class="ow">and</span> <span class="n">n</span><span class="o">.</span><span class="n">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                            <span class="n">names_in_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                            <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">names_in_order</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">code_blocks</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">code_blocks</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_split_models_monolith</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RefactorProposal</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ×¤×™×¦×•×œ ×‘×˜×•×— ×©×œ ×§×•×‘×¥ models.py ××•× ×•×œ×™×ª×™ ×œ×ª×ª-××•×“×•×œ×™× ×“×•××™×™× ×™×™× ×ª×—×ª models/.</span>
<span class="sd">        - core.py: User, UserManager, PermissionSystem, EmailService ×•×›×•&#39;</span>
<span class="sd">        - billing.py: SubscriptionManager, PaymentGateway ×•×›×•&#39;</span>
<span class="sd">        - inventory.py: Product, Inventory ×•×›×•&#39;</span>
<span class="sd">        - network.py/workflows.py ×œ×¤×™ ×”×¦×•×¨×š</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">classes</span> <span class="ow">or</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">classes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;×œ× × ××¦××• ××—×œ×§×•×ª ×œ×¤×™×¦×•×œ ×‘×ª×•×š models.py&quot;</span><span class="p">)</span>
        <span class="c1"># ×§×™×‘×•×¥ ×œ×¤×™ ×“×•××™×™×Ÿ</span>
        <span class="n">domain_to_classes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">ClassInfo</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classify_class_domain</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="n">domain_to_classes</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="c1"># ×¡×“×¨ ×™×¦×™×‘ ×œ×”×¦×’×”</span>
        <span class="n">preferred_order</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;core&quot;</span><span class="p">,</span> <span class="s2">&quot;billing&quot;</span><span class="p">,</span> <span class="s2">&quot;inventory&quot;</span><span class="p">,</span> <span class="s2">&quot;network&quot;</span><span class="p">,</span> <span class="s2">&quot;workflows&quot;</span><span class="p">]</span>
        <span class="n">ordered_domains</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">preferred_order</span> <span class="k">if</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">domain_to_classes</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
            <span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">domain_to_classes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">preferred_order</span>
        <span class="p">]</span>
        <span class="n">new_files</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">changes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># ×—×™×œ×•×¥ ××©×ª× ×™× ×’×œ×•×‘×œ×™×™× ×‘×¨××ª ×”××•×“×•×œ ×›×“×™ ×œ×©××¨× ×‘×¤×™×¦×•×œ (×œ×× ×™×¢×ª NameError)</span>
        <span class="n">global_names</span><span class="p">,</span> <span class="n">globals_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_module_global_assignments</span><span class="p">()</span>
        <span class="c1"># ×‘× ×™×™×ª ×§×‘×¦×™× ×ª×—×ª models/</span>
        <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">ordered_domains</span><span class="p">:</span>
            <span class="n">cls_list</span> <span class="o">=</span> <span class="n">domain_to_classes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cls_list</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># ×¡×™× ×•×Ÿ imports ×œ×¤×™ ×©×™××•×© ×‘××—×œ×§×•×ª ×”×“×•××™×™×Ÿ</span>
            <span class="n">code_body</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">code</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cls_list</span><span class="p">)</span>
            <span class="n">filtered_imports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_imports_for_code</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">imports</span><span class="p">,</span> <span class="n">code_body</span><span class="p">)</span>
            <span class="c1"># ×‘×§×•×‘×¥ core × ×–×¨×™×§ ××ª ×”×”×§×¦××•×ª ×”×’×œ×•×‘×œ×™×•×ª ××—×¨×™ imports ×•×œ×¤× ×™ ×”××—×œ×§×•×ª</span>
            <span class="k">if</span> <span class="n">domain</span> <span class="o">==</span> <span class="s2">&quot;core&quot;</span> <span class="ow">and</span> <span class="n">globals_code</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;××—×œ×§×•×ª: &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cls_list</span><span class="p">)</span>
                <span class="n">parts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;&quot;&quot;</span><span class="se">\n</span><span class="s1">××•×“×•×œ ×¢×‘×•×¨: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="se">\n</span><span class="s1">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">filtered_imports</span><span class="p">)</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">globals_code</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cls_list</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_file_content</span><span class="p">(</span><span class="n">functions</span><span class="o">=</span><span class="p">[],</span> <span class="n">imports</span><span class="o">=</span><span class="n">filtered_imports</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="n">cls_list</span><span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;models/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">.py&quot;</span>
            <span class="n">new_files</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
            <span class="n">changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ğŸ“¦ </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cls_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> ××—×œ×§×•×ª&quot;</span><span class="p">)</span>
        <span class="c1"># __init__ ×œ×—×‘×™×œ×ª models/</span>
        <span class="n">models_module_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">fn</span> <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">new_files</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">fn</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;models/&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">)]</span>
        <span class="n">new_files</span><span class="p">[</span><span class="s2">&quot;models/__init__.py&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_init_file</span><span class="p">(</span><span class="n">models_module_files</span><span class="p">)</span>
        <span class="n">changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ğŸ“¦ models/__init__.py: ××™×™×¦× ××ª ×›×œ ×”×™×©×•×™×•×ª&quot;</span><span class="p">)</span>
        <span class="c1"># ×”×–×¨×§×ª ×™×‘×•× ×‘×™×Ÿ-××•×“×•×œ×™ ×œ××—×œ×§×•×ª (×œ××©×œ billing â†’ core)</span>
        <span class="n">class_to_module</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">cls_list</span> <span class="ow">in</span> <span class="n">domain_to_classes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cls_list</span><span class="p">:</span>
                <span class="n">class_to_module</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">domain</span>
        <span class="n">new_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inject_cross_module_class_imports</span><span class="p">(</span><span class="n">new_files</span><span class="p">,</span> <span class="n">class_to_module</span><span class="p">)</span>
        <span class="c1"># ×”×–×¨×§×ª ×™×‘×•× ×œ××©×ª× ×™× ×’×œ×•×‘×œ×™×™× ×©× ×©××¨×• ×‘-core ××œ ××•×“×•×œ×™× ××—×¨×™× ×”×¦×•×¨×›×™× ××•×ª×</span>
        <span class="k">if</span> <span class="n">global_names</span><span class="p">:</span>
            <span class="n">new_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inject_global_imports</span><span class="p">(</span><span class="n">new_files</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">global_names</span><span class="p">),</span> <span class="n">source_module_stem</span><span class="o">=</span><span class="s2">&quot;core&quot;</span><span class="p">)</span>
        <span class="c1"># DRY-RUN: ×–×™×”×•×™/×¤×™×¨×•×§ ××¢×’×œ×™×•×ª ×‘×ª×•×š models/ ×‘×œ×‘×“</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">new_files</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;models/&quot;</span><span class="p">)}</span>
        <span class="n">subset</span><span class="p">,</span> <span class="n">merged_pairs</span><span class="p">,</span> <span class="n">shared_bridges</span><span class="p">,</span> <span class="n">skipped_canonical_cycles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_circular_imports</span><span class="p">(</span>
            <span class="n">subset</span><span class="p">,</span> <span class="s2">&quot;models&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">merged_pairs</span><span class="p">:</span>
            <span class="c1"># ×¢×“×›×•×Ÿ __init__.py ×©×œ models/ ×œ××—×¨ ××™×–×•×’</span>
            <span class="n">module_file_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">fn</span> <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">subset</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;__init__.py&quot;</span><span class="p">)]</span>
            <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;models/__init__.py&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_init_file</span><span class="p">(</span><span class="n">module_file_names</span><span class="p">)</span>
        <span class="n">cycle_warnings</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">shared_bridges</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">shared_bridges</span><span class="p">:</span>
                <span class="n">cycle_warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;â™»ï¸ ×¤×•×¨×§×” ×ª×œ×•×ª ××¢×’×œ×™×ª ×‘×ª×•×š models/ ×‘×××¦×¢×•×ª ×©×›×‘×ª shared: </span><span class="si">{</span><span class="s1">&#39; â‡„ &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">skipped_canonical_cycles</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">skipped_canonical_cycles</span><span class="p">:</span>
                <span class="n">cycle_warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;âš ï¸ × ×•×ª×¨×” ×ª×œ×•×ª ××¢×’×œ×™×ª ×‘×™×Ÿ ××•×“×•×œ×™× ×§× ×•× ×™×™× ×‘×ª×•×š models/: </span><span class="si">{</span><span class="s1">&#39; â‡„ &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="c1"># ××™×–×•×’ ×—×–×¨×” ××œ ×”××¤×” ×”×›×•×œ×œ×ª</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">new_files</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;models/&quot;</span><span class="p">):</span>
                <span class="k">del</span> <span class="n">new_files</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">new_files</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
        <span class="c1"># × ×™×§×•×™ imports ××™×•×ª×¨×™×</span>
        <span class="n">new_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post_refactor_cleanup</span><span class="p">(</span><span class="n">new_files</span><span class="p">)</span>
        <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;ğŸ—ï¸ ×¤×™×¦×•×œ ×‘×˜×•×— ×©×œ models.py ×œ×ª×ª-××•×“×•×œ×™× ×“×•××™×™× ×™×™× ×ª×—×ª models/:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">new_files</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">fn</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;models/&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">):</span>
                <span class="n">description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   â”œâ”€â”€ </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="c1"># ××–×”×¨×•×ª</span>
        <span class="n">warnings</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">global_names</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;â„¹ï¸ × ×©××¨×• </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">global_names</span><span class="p">)</span><span class="si">}</span><span class="s2"> ××©×ª× ×™× ×’×œ×•×‘×œ×™×™× ××ª×•×š models.py ×‘×ª×•×š models/core.py.&quot;</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">cycle_warnings</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">RefactorProposal</span><span class="p">(</span>
            <span class="n">refactor_type</span><span class="o">=</span><span class="n">RefactorType</span><span class="o">.</span><span class="n">SPLIT_FUNCTIONS</span><span class="p">,</span>
            <span class="n">original_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">new_files</span><span class="o">=</span><span class="n">new_files</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">changes_summary</span><span class="o">=</span><span class="n">changes</span><span class="p">,</span>
            <span class="n">warnings</span><span class="o">=</span><span class="n">warnings</span><span class="p">,</span>
            <span class="n">imports_needed</span><span class="o">=</span><span class="p">{},</span>
        <span class="p">)</span>
    <span class="k">def</span> <span class="nf">_build_file_content</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">functions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">],</span>
        <span class="n">imports</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">classes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ClassInfo</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;×‘×•× ×” ×ª×•×›×Ÿ ×§×•×‘×¥ ×—×“×© ×¢×‘×•×¨ ×§×‘×•×¦×ª ×“×•××™×™×Ÿ ×¢× ××—×œ×§×•×ª ×•×¤×•× ×§×¦×™×•×ª ×•×‘×œ×•×§ imports ××¡×•× ×Ÿ.&quot;&quot;&quot;</span>
        <span class="n">content_parts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">func_names</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">functions</span><span class="p">)</span> <span class="k">if</span> <span class="n">functions</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">class_names</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">classes</span> <span class="ow">or</span> <span class="p">[]))</span> <span class="k">if</span> <span class="n">classes</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">title_parts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">class_names</span><span class="p">:</span>
            <span class="n">title_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;××—×œ×§×•×ª: </span><span class="si">{</span><span class="n">class_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">func_names</span><span class="p">:</span>
            <span class="n">title_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;×¤×•× ×§×¦×™×•×ª: </span><span class="si">{</span><span class="n">func_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">title_parts</span><span class="p">)</span> <span class="k">if</span> <span class="n">title_parts</span> <span class="k">else</span> <span class="s2">&quot;×“×•××™×™×Ÿ&quot;</span>
        <span class="c1"># ×ª××™××•×ª ×œ××—×•×¨: ×©××•×¨ ××ª ×”×¡××Ÿ &quot;××•×“×•×œ ×¢×‘×•×¨&quot; ×©× ×˜×¢×Ÿ ×‘×˜×¡×˜×™×</span>
        <span class="n">content_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;&quot;&quot;</span><span class="se">\n</span><span class="s1">××•×“×•×œ ×¢×‘×•×¨: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="se">\n</span><span class="s1">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">imports_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">imports</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">imports</span><span class="p">)</span>
        <span class="n">content_parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">imports_list</span><span class="p">)</span>
        <span class="n">content_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># ×¡×“×¨: ××—×œ×§×•×ª ×ª×—×™×œ×”, ××—×¨ ×›×š ×¤×•× ×§×¦×™×•×ª â€“ ××¤×—×™×ª ×¦×•×¨×š ×‘-import ×¤× ×™××™</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="p">(</span><span class="n">classes</span> <span class="ow">or</span> <span class="p">[]):</span>
            <span class="n">content_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
            <span class="n">content_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">functions</span><span class="p">:</span>
            <span class="n">content_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
            <span class="n">content_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">content_parts</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_build_init_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filenames</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="s1">&#39;&quot;&quot;&quot;</span><span class="se">\n</span><span class="s1">××™× ×“×§×¡ ××¨×›×–×™ ×œ×›×œ ×”×¤×•× ×§×¦×™×•×ª</span><span class="se">\n</span><span class="s1">&quot;&quot;&quot;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;__init__.py&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">fname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_shared_core.py&quot;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">module_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
            <span class="n">content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;from .</span><span class="si">{</span><span class="n">module_name</span><span class="si">}</span><span class="s2"> import *</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">content</span>

    <span class="k">def</span> <span class="nf">_extract_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RefactorProposal</span><span class="p">:</span>
        <span class="n">duplicates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_code_duplication</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">duplicates</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;×œ× × ××¦× ×§×•×“ ×—×•×–×¨ ××¡×¤×™×§ ××©××¢×•×ª×™ ×œ×—×™×œ×•×¥&quot;</span><span class="p">)</span>
        <span class="n">new_files</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">changes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">utils_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_utils_from_duplicates</span><span class="p">(</span><span class="n">duplicates</span><span class="p">)</span>
        <span class="n">new_files</span><span class="p">[</span><span class="s2">&quot;utils.py&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">utils_content</span>
        <span class="n">changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ğŸ“¦ utils.py: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">duplicates</span><span class="p">)</span><span class="si">}</span><span class="s2"> ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ ×—×“×©×•×ª&quot;</span><span class="p">)</span>
        <span class="n">updated_original</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace_duplicates_with_calls</span><span class="p">(</span><span class="n">duplicates</span><span class="p">)</span>
        <span class="n">new_files</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated_original</span>
        <span class="n">changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœï¸ </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2">: ×¢×•×“×›×Ÿ ×œ×©×™××•×© ×‘×¤×•× ×§×¦×™×•×ª ×”×¢×–×¨&quot;</span><span class="p">)</span>
        <span class="n">description</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;ğŸ”§ ××¦××ª×™ </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">duplicates</span><span class="p">)</span><span class="si">}</span><span class="s2"> ×‘×œ×•×§×™ ×§×•×“ ×—×•×–×¨×™×.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;×”×¦×¢×ª ×—×™×œ×•×¥:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;ğŸ“¦ ×™×¦×™×¨×ª utils.py ×¢× ×¤×•× ×§×¦×™×•×ª ×¢×–×¨</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;ğŸ“ ×¢×“×›×•×Ÿ ×”×§×•×“ ×”××§×•×¨×™ ×œ×©×™××•×© ×‘×”×Ÿ</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;âœ… ×§×•×“ × ×§×™ ×™×•×ª×¨ ×•×œ×œ× ×›×¤×™×œ×•×™×•×ª&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">RefactorProposal</span><span class="p">(</span>
            <span class="n">refactor_type</span><span class="o">=</span><span class="n">RefactorType</span><span class="o">.</span><span class="n">EXTRACT_FUNCTIONS</span><span class="p">,</span>
            <span class="n">original_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">new_files</span><span class="o">=</span><span class="n">new_files</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">changes_summary</span><span class="o">=</span><span class="n">changes</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_find_code_duplication</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_build_utils_from_duplicates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">duplicates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;&quot;&quot;&quot;</span><span class="se">\n</span><span class="s1">×¤×•× ×§×¦×™×•×ª ×¢×–×¨ ××©×•×ª×¤×•×ª</span><span class="se">\n</span><span class="s1">&quot;&quot;&quot;</span><span class="se">\n\n</span><span class="s1"># TODO: implement</span><span class="se">\n</span><span class="s1">&#39;</span>

    <span class="k">def</span> <span class="nf">_replace_duplicates_with_calls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">duplicates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">code</span>  <span class="c1"># type: ignore[return-value]</span>

    <span class="k">def</span> <span class="nf">_merge_similar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RefactorProposal</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;×¤×™×¦&#39;×¨ ××™×–×•×’ ×§×•×“ ×˜×¨× ×™×•×©× ×‘××œ×•××•&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_convert_to_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RefactorProposal</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">functions</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;××™×Ÿ ××¡×¤×™×§ ×¤×•× ×§×¦×™×•×ª ×œ×”××¨×” ×œ××—×œ×§×”&quot;</span><span class="p">)</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_related_functions</span><span class="p">()</span>
        <span class="c1"># ×× ×™×¢×ª God Class: ×× ×™×© ×¨×§ ×§×‘×•×¦×” ××—×ª ×•×”×¨×‘×” ×¤×•× ×§×¦×™×•×ª â€“ × ×¡×” ×œ×¤×¦×œ ×œ×¤×™ ×“×•××™×™×Ÿ</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">functions</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">domain_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_by_domain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">functions</span><span class="p">)</span>
            <span class="n">domain_groups</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">domain_groups</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_functions_per_group</span><span class="p">}</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">domain_groups</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limit_group_count</span><span class="p">(</span><span class="n">domain_groups</span><span class="p">)</span>
        <span class="c1"># ×× ×™×¢×ª ××™×‘×•×“ ×¤×•× ×§×¦×™×•×ª: ××™×–×•×’ ×§×‘×•×¦×•×ª ×§×˜× ×•×ª (singleton) ×œ×¤× ×™ ×‘× ×™×™×ª ×”××—×œ×§×•×ª</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_functions_per_group</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merge_singletons_for_oop</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
        <span class="n">new_files</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">changes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">functions</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">functions</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">class_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_class_name</span><span class="p">(</span><span class="n">group_name</span><span class="p">)</span>
            <span class="n">class_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_class_from_functions</span><span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="n">functions</span><span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">_service.py&quot;</span>
            <span class="n">new_files</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">class_code</span>
            <span class="n">changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ğŸ“¦ </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">: ××—×œ×§×” </span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2"> ×¢× </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">functions</span><span class="p">)</span><span class="si">}</span><span class="s2"> ××ª×•×“×•×ª&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">new_files</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;×œ× × ×™×ª×Ÿ ×œ×§×‘×¥ ××ª ×”×¤×•× ×§×¦×™×•×ª ×œ××—×œ×§×•×ª ××©××¢×•×ª×™×•×ª&quot;</span><span class="p">)</span>
        <span class="n">description</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;ğŸ¨ ×”××¨×” ×œ-OOP:</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;××¦××ª×™ </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">functions</span><span class="p">)</span><span class="si">}</span><span class="s2"> ×¤×•× ×§×¦×™×•×ª.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;×”×¦×¢×ª ×”××¨×” ×œ-</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">new_files</span><span class="p">)</span><span class="si">}</span><span class="s2"> ××—×œ×§×•×ª:</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">new_files</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   ğŸ“¦ </span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">description</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âœ… ××¨×›×™×˜×§×˜×•×¨×” ××•× ×—×™×ª ×¢×¦××™×&quot;</span>
        <span class="k">return</span> <span class="n">RefactorProposal</span><span class="p">(</span>
            <span class="n">refactor_type</span><span class="o">=</span><span class="n">RefactorType</span><span class="o">.</span><span class="n">CONVERT_TO_CLASSES</span><span class="p">,</span>
            <span class="n">original_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">new_files</span><span class="o">=</span><span class="n">new_files</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">changes_summary</span><span class="o">=</span><span class="n">changes</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_generate_class_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">words</span> <span class="o">=</span> <span class="n">prefix</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_build_class_from_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">functions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">lines</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s1"> - ××—×œ×§×” ×©× ×•×¦×¨×” ××¨×¤×§×˜×•×¨×™× ×’&#39;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">imports</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;class </span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s1">:&#39;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;    &quot;&quot;&quot;××—×œ×§×ª ×©×™×¨×•×ª ×œ-</span><span class="si">{</span><span class="n">class_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1">&quot;&quot;&quot;&#39;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;    def __init__(self):&#39;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;        &quot;&quot;&quot;××ª×—×•×œ ×”××—×œ×§×”&quot;&quot;&quot;&#39;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;        pass&#39;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">functions</span><span class="p">:</span>
            <span class="n">method_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_function_to_method</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">method_code</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_convert_function_to_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">FunctionInfo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">method_lines</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="n">def_line_idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">method_lines</span><span class="p">):</span>
            <span class="n">stripped</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;def &#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;async def &#39;</span><span class="p">):</span>
                <span class="n">def_line_idx</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">break</span>
        <span class="n">def_line</span> <span class="o">=</span> <span class="n">method_lines</span><span class="p">[</span><span class="n">def_line_idx</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;(&#39;</span> <span class="ow">in</span> <span class="n">def_line</span><span class="p">:</span>
            <span class="n">def_line</span> <span class="o">=</span> <span class="n">def_line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="s1">&#39;(self, &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">def_line</span> <span class="o">=</span> <span class="n">def_line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(self, )&#39;</span><span class="p">,</span> <span class="s1">&#39;(self)&#39;</span><span class="p">)</span>
        <span class="n">method_lines</span><span class="p">[</span><span class="n">def_line_idx</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;    &#39;</span> <span class="o">+</span> <span class="n">def_line</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">method_lines</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">def_line_idx</span><span class="p">:</span>
                <span class="n">method_lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;    &#39;</span> <span class="o">+</span> <span class="n">method_lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">method_lines</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add_dependency_injection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RefactorProposal</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;×¤×™×¦&#39;×¨ DI ×˜×¨× ×™×•×©× ×‘××œ×•××•&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate_proposal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proposal</span><span class="p">:</span> <span class="n">RefactorProposal</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">filename</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">proposal</span><span class="o">.</span><span class="n">new_files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.py&#39;</span><span class="p">):</span>
                    <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">SyntaxError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;×©×’×™××ª ×ª×—×‘×™×¨ ×‘×§×•×‘×¥ ×©× ×•×¦×¨: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">proposal</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âš ï¸ ×©×’×™××ª ×ª×—×‘×™×¨: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># === Utilities for import cleanup and centralization ===</span>

    <span class="k">def</span> <span class="nf">_get_import_aliases</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">import_line</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;×”×—×–×¨×ª ×©××•×ª ×©×™×™×•×‘××• (alias/×©× ×’×œ×•×™) ××ª×•×š ×©×•×¨×ª import ××—×ª.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">import_line</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Import</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                    <span class="n">base</span> <span class="o">=</span> <span class="p">(</span><span class="n">alias</span><span class="o">.</span><span class="n">asname</span> <span class="ow">or</span> <span class="n">alias</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">ImportFrom</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                    <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alias</span><span class="o">.</span><span class="n">asname</span> <span class="ow">or</span> <span class="n">alias</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">names</span>

    <span class="k">def</span> <span class="nf">_extract_used_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;×”×—×–×¨×ª ×›×œ ×”×©××•×ª ×©×‘×”× × ×¢×©×” ×©×™××•×© ×‘×§×•×“ (×œ×¦×•×¨×š ×‘×“×™×§×ª imports ×‘×©×™××•×©).&quot;&quot;&quot;</span>
        <span class="n">used</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">used</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
                <span class="n">used</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">used</span>

    <span class="k">def</span> <span class="nf">_filter_imports_for_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imports</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;××¡× ×Ÿ imports ×›×š ×©×™×•×¤×™×¢×• ×¨×§ ××œ×• ×”× ×“×¨×©×™× ×¢×œ ×¤×™ ×©×™××•×© ×‘×¤×•× ×§×¦×™×•×ª ×”×§×‘×•×¦×”.&quot;&quot;&quot;</span>
        <span class="n">used</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_used_names</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="n">filtered</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">imp</span> <span class="ow">in</span> <span class="n">imports</span><span class="p">:</span>
            <span class="c1"># ×”×©××¨×ª star-import ×ª××™×“ (×œ××©×œ from .&lt;base&gt;_shared import *)</span>
            <span class="k">if</span> <span class="s1">&#39; import *&#39;</span> <span class="ow">in</span> <span class="n">imp</span><span class="p">:</span>
                <span class="n">filtered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">imp</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">aliases</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_import_aliases</span><span class="p">(</span><span class="n">imp</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">aliases</span><span class="p">:</span>
                <span class="c1"># ×× ×œ× ×–×•×”×• ×©××•×ª (×œ××©×œ import ×œ× ×¡×˜× ×“×¨×˜×™) â€” × ×©××•×¨ ×œ×™×ª×¨ ×‘×˜×—×•×Ÿ</span>
                <span class="n">filtered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">imp</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">alias</span> <span class="ow">in</span> <span class="n">used</span> <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">aliases</span><span class="p">):</span>
                <span class="n">filtered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">imp</span><span class="p">)</span>
        <span class="c1"># ×”×¡×¨×” ×©×œ ×›×¤×™×œ×•×™×•×ª ×ª×•×š ×©××™×¨×ª ×¡×“×¨</span>
        <span class="n">seen</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">unique</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">filtered</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="n">unique</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">unique</span>

    <span class="k">def</span> <span class="nf">_centralize_common_imports</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">new_files</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">per_file_imports</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">base_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;×××—×“ imports ××©×•×ª×¤×™× ×œ×›×œ ×”××•×“×•×œ×™× ×œ×§×•×‘×¥ &lt;base&gt;_shared.py ×•××™×™×‘× ××× ×• ×‘×›×œ ××•×“×•×œ.&quot;&quot;&quot;</span>
        <span class="n">module_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">fn</span> <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">new_files</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">fn</span> <span class="o">!=</span> <span class="s2">&quot;__init__.py&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">module_files</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">new_files</span>
        <span class="c1"># ×—×™×ª×•×š ××©×•×ª×£ ×©×œ imports ×–×”×™× ×‘×™×Ÿ ×›×œ ×”××•×“×•×œ×™×</span>
        <span class="n">import_sets</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">per_file_imports</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="p">[]))</span> <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">module_files</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">import_sets</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">new_files</span>
        <span class="n">common_imports</span> <span class="o">=</span> <span class="nb">set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="o">*</span><span class="n">import_sets</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">import_sets</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="nb">set</span><span class="p">()</span>
        <span class="c1"># ×¡× ×Ÿ ×¨×§ ×©×•×¨×•×ª import ×××©×™×•×ª</span>
        <span class="n">common_imports</span> <span class="o">=</span> <span class="p">{</span><span class="n">imp</span> <span class="k">for</span> <span class="n">imp</span> <span class="ow">in</span> <span class="n">common_imports</span> <span class="k">if</span> <span class="n">imp</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;import &#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">imp</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;from &#39;</span><span class="p">)}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">common_imports</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">new_files</span>

        <span class="n">shared_module_stem</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_shared&quot;</span>
        <span class="n">shared_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">shared_module_stem</span><span class="si">}</span><span class="s2">.py&quot;</span>

        <span class="c1"># ×‘× ×” ×§×•×‘×¥ imports ××©×•×ª×¤×™×</span>
        <span class="n">shared_lines</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">shared_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">)</span>
        <span class="n">shared_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;×™×™×‘×•× ××©×•×ª×£ ×œ×§×‘×¦×™× ×©× ×•×¦×¨×• ××¨×¤×§×˜×•×¨×™× ×’&#39;</span><span class="p">)</span>
        <span class="n">shared_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">)</span>
        <span class="n">shared_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">shared_lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">common_imports</span><span class="p">))</span>
        <span class="n">shared_content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">shared_lines</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">new_files</span><span class="p">[</span><span class="n">shared_filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">shared_content</span>

        <span class="c1"># ×¦×•×¨ ×¨×©×™××ª ×©××•×ª ×©×™×•×‘××• ××©×•×ª×¤×ª ×œ×›×œ ×”××•×“×•×œ×™×</span>
        <span class="c1"># ×›×“×™ ×œ×× ×•×¢ ×”×•×¤×¢×ª ×”××—×¨×•×–×ª &quot;import os\n&quot; ×‘×ª×•×š ×©×•×¨×ª import ×™×—×¡×™×ª (×©××›×©×™×œ×” ×˜×¡×˜×™×),</span>
        <span class="c1"># × ×©×ª××© ×‘-star import, ×××—×¨ ×•×–×” ××•×ª×¨ ×‘×”×§×©×¨ ××•×“×•×œ×™× ×¤× ×™××™×™× ×©× ×•×¦×¨×• ××•×˜×•××˜×™×ª.</span>
        <span class="n">shared_import_stmt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;from .</span><span class="si">{</span><span class="n">shared_module_stem</span><span class="si">}</span><span class="s2"> import *&quot;</span>

        <span class="c1"># ×”×¡×¨ ××ª ×”×©×•×¨×•×ª ×”××©×•×ª×¤×•×ª ××›×œ ××•×“×•×œ ×•×”×•×¡×£ import ××©×•×ª×£ ××—×¨×™ ×”×“×•×§×¡×˜×¨×™× ×’</span>
        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">module_files</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">new_files</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
            <span class="c1"># ××¦× ××ª ×¡×•×£ ×”×“×•×§×¡×˜×¨×™× ×’ ×œ××™×§×•× ×”×”×•×¡×¤×”</span>
            <span class="n">insert_idx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">quote_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">):</span>
                    <span class="n">quote_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">quote_count</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">insert_idx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span>  <span class="c1"># ××—×¨×™ ×”×“×•×§×¡×˜×¨×™× ×’ ×•×”×§×• ×”×¨×™×§ ×©××—×¨×™×•</span>
                        <span class="k">break</span>
            <span class="c1"># ×”×¡×¨×ª imports ××©×•×ª×¤×™×</span>
            <span class="n">filtered_lines</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="n">common_imports</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">filtered_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="c1"># ×”×–×¨×§×ª import ××©×•×ª×£ ×× ×œ× ×§×™×™× ×›×‘×¨</span>
            <span class="n">already_has_shared</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
                <span class="n">ln</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;from .</span><span class="si">{</span><span class="n">shared_module_stem</span><span class="si">}</span><span class="s2"> import&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">filtered_lines</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">already_has_shared</span><span class="p">:</span>
                <span class="n">filtered_lines</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">filtered_lines</span><span class="p">[:</span><span class="n">insert_idx</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">shared_import_stmt</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">filtered_lines</span><span class="p">[</span><span class="n">insert_idx</span><span class="p">:]</span>
                <span class="p">)</span>
            <span class="n">new_files</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filtered_lines</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="n">new_files</span>

    <span class="c1"># === ×ª××™×›×” ×‘××—×œ×§×•×ª: ×™×¦×™×¨×ª ×§×•×‘×¥ ××—×œ×§×•×ª ×•×”×–×¨×§×ª ×™×‘×•× ×œ××—×œ×§×•×ª ×‘×©×™××•×© ===</span>
    <span class="k">def</span> <span class="nf">_build_classes_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ×™×•×¦×¨ ×§×•×‘×¥ ××¨×›×–×™ ×œ×›×œ ×”××—×œ×§×•×ª ×©×–×•×”×• ×‘×§×•×‘×¥ ×”××§×•×¨×™.</span>
<span class="sd">        ××—×–×™×¨ (×©× ×”×§×•×‘×¥, ×ª×•×›×Ÿ).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">classes_stem</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_classes&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">classes_stem</span><span class="si">}</span><span class="s2">.py&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;&quot;&quot;&quot;</span><span class="se">\n</span><span class="s1">××—×œ×§×•×ª (××™×Ÿ)</span><span class="se">\n</span><span class="s1">&quot;&quot;&quot;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="c1"># ×‘×¢×–×¨×ª ××¡× ×Ÿ imports, × ×©××•×¨ ×¨×§ ×™×™×‘×•× ×©× ×“×¨×© ×œ××—×œ×§×•×ª</span>
        <span class="n">classes_code_body</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">code</span> <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">classes</span><span class="p">)</span>
        <span class="n">filtered_imports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_imports_for_code</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">imports</span><span class="p">,</span> <span class="n">classes_code_body</span><span class="p">)</span>
        <span class="n">parts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">)</span>
        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;××—×œ×§×•×ª ×©×”×•×¤×§×• ××”××•× ×•×œ×™×ª&quot;</span><span class="p">)</span>
        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">)</span>
        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">filtered_imports</span><span class="p">)</span>
        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">_inject_class_imports</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_files</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">classes_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ×¢×‘×•×¨ ×›×œ ××•×“×•×œ ×¤×•× ×§×¦×™×•×ª, ××–×”×” ××™×œ×• ××—×œ×§×•×ª ×‘×©×™××•×© ×•××–×¨×™×§ ×©×•×¨×ª import ××ª××™××”.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">classes_stem</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">classes_filename</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
        <span class="n">class_names</span> <span class="o">=</span> <span class="p">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">classes</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span> <span class="k">else</span> <span class="p">[])}</span>
        <span class="n">out</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">fn</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">new_files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;__init__.py&quot;</span> <span class="ow">or</span> <span class="n">fn</span> <span class="o">==</span> <span class="n">classes_filename</span> <span class="ow">or</span> <span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_shared.py&quot;</span><span class="p">):</span>
                <span class="n">out</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
                <span class="k">continue</span>
            <span class="n">used</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_used_names</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="n">needed</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">class_names</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">used</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">needed</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
                <span class="k">continue</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
            <span class="c1"># ××¦× ××ª ×¡×•×£ ×”×“×•×§×¡×˜×¨×™× ×’</span>
            <span class="n">insert_idx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">quote_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">):</span>
                    <span class="n">quote_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">quote_count</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">insert_idx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span>  <span class="c1"># ××—×¨×™ ×”×“×•×§×¡×˜×¨×™× ×’ ×•×©×•×¨×” ×¨×™×§×”</span>
                        <span class="k">break</span>
            <span class="n">import_line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;from .</span><span class="si">{</span><span class="n">classes_stem</span><span class="si">}</span><span class="s2"> import </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">needed</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="c1"># ×”×–×¨×§ ×× ×œ× ×§×™×™×</span>
            <span class="n">already</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">ln</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;from .</span><span class="si">{</span><span class="n">classes_stem</span><span class="si">}</span><span class="s2"> import&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">already</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[:</span><span class="n">insert_idx</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">import_line</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">lines</span><span class="p">[</span><span class="n">insert_idx</span><span class="p">:]</span>
            <span class="n">out</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">_extract_defined_functions_in_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;×©××•×ª ×¤×•× ×§×¦×™×•×ª ×˜×•×¤-×œ×‘×œ ×”××•×’×“×¨×•×ª ×‘×§×•×“ × ×ª×•×Ÿ.</span>
<span class="sd">        ×ª×™×§×•×Ÿ: ××œ ×ª×›×œ×•×œ ××ª×•×“×•×ª ×©×œ ××—×œ×§×•×ª ×›×“×™ ×œ×× ×•×¢ ×“×™×›×•×™ import × ×“×¨×©.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defined</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">defined</span>
        <span class="c1"># ×¤×•× ×§×¦×™×•×ª ×˜×•×¤-×œ×‘×œ ×”×Ÿ ×›××œ×” ×©××•×¤×™×¢×•×ª ×™×©×™×¨×•×ª ×‘-tree.body</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">):</span>
                <span class="n">defined</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">defined</span>

    <span class="k">def</span> <span class="nf">_inject_function_imports</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_files</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">func_to_module</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ××–×¨×™×§ import ×™×—×¡×™ ×œ×¤×•× ×§×¦×™×•×ª ×©××•×’×“×¨×•×ª ×‘××•×“×•×œ×™× ××—×¨×™× ××š × ××¦××•×ª ×‘×©×™××•×©.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">fn</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">new_files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;__init__.py&quot;</span> <span class="ow">or</span> <span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_shared.py&quot;</span><span class="p">):</span>
                <span class="n">out</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
                <span class="k">continue</span>
            <span class="n">current_stem</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
            <span class="n">used</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_used_names</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="n">defined_here</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_defined_functions_in_code</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="c1"># ×¤×•× ×§×¦×™×•×ª × ×“×¨×©×•×ª: × ××¦××•×ª ×‘×©×™××•×©, ×™×“×•×¢ ×”×™×›×Ÿ ××•×’×“×¨×•×ª, ×œ× ××•×’×“×¨×•×ª ×›××Ÿ, ×•××•×’×“×¨×•×ª ×‘××•×“×•×œ ××—×¨</span>
            <span class="n">needed</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">used</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">func_to_module</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">defined_here</span> <span class="ow">and</span> <span class="n">func_to_module</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">!=</span> <span class="n">current_stem</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">needed</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
                <span class="k">continue</span>
            <span class="c1"># ×§×™×‘×•×¥ ×œ×¤×™ ××•×“×•×œ ×™×¢×“</span>
            <span class="n">per_module</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">needed</span><span class="p">:</span>
                <span class="n">per_module</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">func_to_module</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
            <span class="c1"># ××¦× ××ª ×¡×•×£ ×”×“×•×§×¡×˜×¨×™× ×’</span>
            <span class="n">insert_idx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">quote_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">):</span>
                    <span class="n">quote_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">quote_count</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">insert_idx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span>
                        <span class="k">break</span>
            <span class="c1"># ×‘× ×” ×©×•×¨×•×ª import ×œ×œ× ×›×¤×™×œ×•×™×•×ª ×§×™×™××•×ª</span>
            <span class="n">new_imports</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">module_stem</span><span class="p">,</span> <span class="n">names</span> <span class="ow">in</span> <span class="n">per_module</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">names_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">names</span><span class="p">))</span>
                <span class="n">imp</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;from .</span><span class="si">{</span><span class="n">module_stem</span><span class="si">}</span><span class="s2"> import </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names_sorted</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">exists</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">ln</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;from .</span><span class="si">{</span><span class="n">module_stem</span><span class="si">}</span><span class="s2"> import&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">:</span>
                    <span class="n">new_imports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">imp</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">new_imports</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[:</span><span class="n">insert_idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">new_imports</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">lines</span><span class="p">[</span><span class="n">insert_idx</span><span class="p">:]</span>
            <span class="n">out</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">out</span>
    <span class="k">def</span> <span class="nf">_extract_defined_globals_in_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;×©××•×ª ××©×ª× ×™× ×’×œ×•×‘×œ×™×™× (Assign/AnnAssign) ×”××•×’×“×¨×™× ×‘×§×•×“ × ×ª×•×Ÿ ×‘×¨××ª ××•×“×•×œ.&quot;&quot;&quot;</span>
        <span class="n">defined</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">defined</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
                            <span class="n">defined</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">AnnAssign</span><span class="p">):</span>
                <span class="n">tgt</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tgt</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
                    <span class="n">defined</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tgt</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">defined</span>
    <span class="k">def</span> <span class="nf">_inject_global_imports</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_files</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">global_names</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">source_module_stem</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ××–×¨×™×§ import ×œ××©×ª× ×™× ×’×œ×•×‘×œ×™×™× ×©× ×©××¨×• ×‘××•×“×•×œ ××§×•×¨ (×œ××©×œ core) ××œ ××•×“×•×œ×™× ×©×¦×•×¨×›×™× ××•×ª×.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">fn</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">new_files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">stem</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;__init__.py&quot;</span> <span class="ow">or</span> <span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_shared.py&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">stem</span> <span class="o">==</span> <span class="n">source_module_stem</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
                <span class="k">continue</span>
            <span class="n">used</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_used_names</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="n">defined_here</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_defined_globals_in_code</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="n">needed</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">global_names</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">used</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">defined_here</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">needed</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
                <span class="k">continue</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
            <span class="c1"># ××¦× ××ª ×¡×•×£ ×”×“×•×§×¡×˜×¨×™× ×’</span>
            <span class="n">insert_idx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">quote_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">):</span>
                    <span class="n">quote_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">quote_count</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">insert_idx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span>
                        <span class="k">break</span>
            <span class="n">import_line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;from .</span><span class="si">{</span><span class="n">source_module_stem</span><span class="si">}</span><span class="s2"> import </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">needed</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="c1"># ×”×–×¨×§×” ×× ×œ× ×§×™×™× ×›×‘×¨</span>
            <span class="n">already</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">ln</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;from .</span><span class="si">{</span><span class="n">source_module_stem</span><span class="si">}</span><span class="s2"> import&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">already</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[:</span><span class="n">insert_idx</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">import_line</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">lines</span><span class="p">[</span><span class="n">insert_idx</span><span class="p">:]</span>
            <span class="n">out</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">out</span>
<div class="viewcode-block" id="RefactoringEngine.post_refactor_cleanup">
<a class="viewcode-back" href="../api/refactoring_engine.html#refactoring_engine.RefactoringEngine.post_refactor_cleanup">[×ª×™×¢×•×“]</a>
    <span class="k">def</span> <span class="nf">post_refactor_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ×©×œ×‘ × ×™×§×•×™ ×œ××—×¨ ×¨×¤×§×˜×•×¨×™× ×’: × ×§×™×•×Ÿ imports ×œ× ×‘×©×™××•×© ×‘×¨××ª ×§×•×‘×¥ ×ª×•×š ×©×™××•×¨ ×§×‘×•×¢×™×/×”×§×¦××•×ª ×’×œ×•×‘×œ×™×•×ª.</span>
<span class="sd">        ×”×¢×¨×”: × ×× ×¢×™× ××”×¨×¦×ª ×›×œ×™× ×—×™×¦×•× ×™×™× (ruff/black) ××¡×™×‘×•×ª ×ª××™××•×ª ×¡×‘×™×‘×”.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cleaned</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">filename</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;__init__.py&#39;</span>
                <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_shared.py&#39;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_shared_core.py&#39;</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">cleaned</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
                <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">module_import_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_module_level_import_lines</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
                <span class="c1"># × ×–×”×” imports ×‘×§×•×‘×¥ ×•× ×©××•×¨ ×¨×§ ××œ×• ×©×‘×©×™××•×©</span>
                <span class="n">import_lines</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">body_lines</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ln</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(),</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">module_import_lines</span><span class="p">:</span>
                        <span class="n">import_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ln</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">body_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>
                <span class="n">code_body</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">body_lines</span><span class="p">)</span>
                <span class="n">filtered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_imports_for_code</span><span class="p">(</span><span class="n">import_lines</span><span class="p">,</span> <span class="n">code_body</span><span class="p">)</span>

                <span class="n">lines</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
                <span class="c1"># ××™×ª×•×¨ ×”×“×•×§×¡×˜×¨×™× ×’ ×”×¢×œ×™×•×Ÿ ×›×“×™ ×©×œ× × ×–×™×– ×§×•×“ ×œ×¤× ×™×•</span>
                <span class="n">docstring_end_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">quote_count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">):</span>
                        <span class="n">quote_count</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">quote_count</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">docstring_end_idx</span> <span class="o">=</span> <span class="n">idx</span>
                            <span class="k">break</span>
                <span class="k">if</span> <span class="n">docstring_end_idx</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">cleaned</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
                    <span class="k">continue</span>

                <span class="c1"># ×—×™×¤×•×© ×‘×œ×•×§ ×”-imports ×”××•×¤×™×¢ ××™×“ ××—×¨×™ ×”×“×•×§×¡×˜×¨×™× ×’ (×¢× ×¨×•×•×—×™×/×”×¢×¨×•×ª ×‘×™× ×™×™×)</span>
                <span class="k">def</span> <span class="nf">_is_import_stmt</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;import &#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;from &#39;</span><span class="p">)</span>

                <span class="n">import_start_idx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">scan_idx</span> <span class="o">=</span> <span class="n">docstring_end_idx</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">while</span> <span class="n">scan_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                    <span class="n">stripped</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">scan_idx</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">stripped</span> <span class="ow">or</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>
                        <span class="n">scan_idx</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">_is_import_stmt</span><span class="p">(</span><span class="n">stripped</span><span class="p">):</span>
                        <span class="n">import_start_idx</span> <span class="o">=</span> <span class="n">scan_idx</span>
                    <span class="k">break</span>

                <span class="k">if</span> <span class="n">import_start_idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># ××™×Ÿ ×‘×œ×•×§ imports ×œ××—×¨ ×”×“×•×§×¡×˜×¨×™× ×’ â€“ ××™×Ÿ ××” ×œ× ×§×•×ª</span>
                    <span class="n">cleaned</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
                    <span class="k">continue</span>

                <span class="n">import_end_idx</span> <span class="o">=</span> <span class="n">import_start_idx</span>
                <span class="k">while</span> <span class="n">import_end_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                    <span class="n">stripped</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">import_end_idx</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">stripped</span> <span class="ow">or</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_is_import_stmt</span><span class="p">(</span><span class="n">stripped</span><span class="p">):</span>
                        <span class="n">import_end_idx</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">continue</span>
                    <span class="k">break</span>

                <span class="n">before_block</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[:</span><span class="n">import_start_idx</span><span class="p">]</span>
                <span class="n">after_block</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">import_end_idx</span><span class="p">:]</span>

                <span class="n">rebuilt</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">before_block</span><span class="p">)</span>

                <span class="k">def</span> <span class="nf">_ensure_trailing_blank</span><span class="p">(</span><span class="n">target</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">target</span> <span class="ow">and</span> <span class="n">target</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">target</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">filtered</span><span class="p">:</span>
                    <span class="n">_ensure_trailing_blank</span><span class="p">(</span><span class="n">rebuilt</span><span class="p">)</span>
                    <span class="n">rebuilt</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">filtered</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">after_block</span> <span class="ow">and</span> <span class="n">after_block</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">rebuilt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># ×× ××™×Ÿ imports ×œ××—×¨ ×”×¡×™× ×•×Ÿ, × ×©××•×¨ ×¨×•×•×— ××—×“ ×‘×™×Ÿ ×”×“×•×§×¡×˜×¨×™× ×’ ×œ×‘×™×Ÿ ×”×’×•×£ ×× × ×“×¨×©</span>
                    <span class="k">if</span> <span class="n">after_block</span> <span class="ow">and</span> <span class="n">after_block</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">_ensure_trailing_blank</span><span class="p">(</span><span class="n">rebuilt</span><span class="p">)</span>

                <span class="n">rebuilt</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">after_block</span><span class="p">)</span>
                <span class="n">cleaned_content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rebuilt</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">cleaned</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">cleaned_content</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">cleaned</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
        <span class="k">return</span> <span class="n">cleaned</span></div>


    <span class="c1"># === Collocation: ×”×§×¦××ª ××—×œ×§×•×ª ×œ×§×‘×•×¦×•×ª ×¤×•× ×§×¦×™×•×ª ×•×‘× ×™×™×ª ××™×¤×•×™ ===</span>
    <span class="k">def</span> <span class="nf">_extract_defined_classes_in_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">defined</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">defined</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">ClassDef</span><span class="p">):</span>
                <span class="n">defined</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">defined</span>

    <span class="k">def</span> <span class="nf">_assign_classes_to_groups</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionInfo</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">ClassInfo</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ××§×¦×” ×›×œ Class ×œ×§×‘×•×¦×ª ×“×•××™×™×Ÿ ××—×ª ×œ×¤×™:</span>
<span class="sd">        - ×©×™××•×© ×‘×¤×•×¢×œ ×¢×´×™ ×¤×•× ×§×¦×™×•×ª ×”×§×‘×•×¦×” (affinity)</span>
<span class="sd">        - ×”×ª×××ª Section (×× ×§×™×™××ª) ×œ×©× ×”×§×‘×•×¦×”</span>
<span class="sd">        - ×“××™×•×Ÿ ×©××•×ª ×›××©×¨ ××™×Ÿ ×©×™××•×© ×‘×¨×•×¨</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="n">class_by_name</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ClassInfo</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">classes</span><span class="p">}</span>
        <span class="n">groups_classes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">ClassInfo</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="n">g</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">class_by_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">groups_classes</span>

        <span class="c1"># ×”×¢×“×¤×” ×§×©×™×—×”: ×× ×œ××—×œ×§×” ×™×© Section ×”×ª×•×× ×œ×§×‘×•×¦×” ×§×™×™××ª â€“ ××œ ×ª×¡×™×˜ ××•×ª×” ××©×</span>
        <span class="k">for</span> <span class="n">cname</span><span class="p">,</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">class_by_name</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">section</span> <span class="o">=</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">section</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">section</span> <span class="ow">and</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
                <span class="n">groups_classes</span><span class="p">[</span><span class="n">section</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">class_by_name</span><span class="p">[</span><span class="n">cname</span><span class="p">]</span>

        <span class="c1"># ×”×›× ×”: ×©×™××•×©×™ ×§×œ××¡×™× ×œ×¤×™ ×¤×•× ×§×¦×™×•×ª</span>
        <span class="k">def</span> <span class="nf">used_names_in_function</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">FunctionInfo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_used_names</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>

        <span class="c1"># ×¦×‘×™×¨×ª × ×™×§×•×“ ×©×™××•×© ×œ×›×œ Class ××•×œ ×›×œ ×§×‘×•×¦×”</span>
        <span class="n">score</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># (class_name, group_name) -&gt; score</span>
        <span class="k">for</span> <span class="n">gname</span><span class="p">,</span> <span class="n">funcs</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">used_names</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">funcs</span><span class="p">:</span>
                <span class="n">used_names</span> <span class="o">|=</span> <span class="n">used_names_in_function</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cname</span> <span class="ow">in</span> <span class="n">class_by_name</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">s</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">if</span> <span class="n">cname</span> <span class="ow">in</span> <span class="n">used_names</span><span class="p">:</span>
                    <span class="c1"># × ×—×©×‘ ×©×™××•×© ×™×©×™×¨ ×‘××—×œ×§×”</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="mf">3.0</span>
                <span class="c1"># ×‘×•× ×•×¡ ×× ×”-Section ×©×œ ×”××—×œ×§×” ×ª×•×× ××ª ×©× ×”×§×‘×•×¦×”</span>
                <span class="n">cls_section</span> <span class="o">=</span> <span class="n">class_by_name</span><span class="p">[</span><span class="n">cname</span><span class="p">]</span><span class="o">.</span><span class="n">section</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="n">cls_section</span> <span class="ow">and</span> <span class="n">cls_section</span> <span class="o">==</span> <span class="n">gname</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="mf">2.0</span>
                <span class="c1"># ×“××™×•×Ÿ ×œ×©×: ×›××©×¨ ××™×Ÿ ×©×™××•×© ××• section</span>
                <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name_similarity</span><span class="p">(</span><span class="n">cname</span><span class="p">,</span> <span class="n">gname</span><span class="p">)</span>
                <span class="n">score</span><span class="p">[(</span><span class="n">cname</span><span class="p">,</span> <span class="n">gname</span><span class="p">)]</span> <span class="o">=</span> <span class="n">s</span>

        <span class="c1"># ×”×ª×××•×ª ×œ×¤×™ ×©×™××•×© ×”××—×œ×§×” ×‘×¤×•× ×§×¦×™×•×ª (××ª×•×š ××ª×•×“×•×ª)</span>
        <span class="c1"># ×× ××ª×•×“×•×ª ×”××—×œ×§×” ×§×•×¨××•×ª ×œ×¤×•× ×§×¦×™×•×ª ×‘×§×‘×•×¦×” ×¡×¤×¦×™×¤×™×ª â€“ × ×–×™×– ×œ×©×</span>
        <span class="n">func_name_to_group</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">gname</span><span class="p">,</span> <span class="n">funcs</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">funcs</span><span class="p">:</span>
                <span class="n">func_name_to_group</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">gname</span>
        <span class="k">for</span> <span class="n">cname</span><span class="p">,</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">class_by_name</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">group_bonus</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">methods</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">called</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">calls</span><span class="p">:</span>
                    <span class="n">g</span> <span class="o">=</span> <span class="n">func_name_to_group</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">called</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">g</span><span class="p">:</span>
                        <span class="n">group_bonus</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_bonus</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.0</span>
            <span class="k">if</span> <span class="n">group_bonus</span><span class="p">:</span>
                <span class="c1"># ×‘×•× ×•×¡ ××©××¢×•×ª×™ ×œ×§×‘×•×¦×” ×¢× ××™×¨×‘ ×”×§×¨×™××•×ª</span>
                <span class="n">best_g</span><span class="p">,</span> <span class="n">best_v</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">group_bonus</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">kv</span><span class="p">:</span> <span class="n">kv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">score</span><span class="p">[(</span><span class="n">cname</span><span class="p">,</span> <span class="n">best_g</span><span class="p">)]</span> <span class="o">=</span> <span class="n">score</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">cname</span><span class="p">,</span> <span class="n">best_g</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">3.0</span>

        <span class="c1"># ×”×§×¦××”: ×‘×—×¨ ××ª ×”×§×‘×•×¦×” ×¢× ×”× ×™×§×•×“ ×”×’×‘×•×” ×‘×™×•×ª×¨ ×œ×›×œ Class</span>
        <span class="n">assigned_group_for_class</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">cname</span> <span class="ow">in</span> <span class="n">class_by_name</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">best_g</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">best_s</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">gname</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">score</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">cname</span><span class="p">,</span> <span class="n">gname</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="n">best_s</span><span class="p">:</span>
                    <span class="n">best_s</span> <span class="o">=</span> <span class="n">s</span>
                    <span class="n">best_g</span> <span class="o">=</span> <span class="n">gname</span>
            <span class="k">if</span> <span class="n">best_g</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># ×’×™×‘×•×™: ×”×¦××“ ×œ×§×‘×•×¦×” ×”×¨××©×•× ×”</span>
                <span class="n">best_g</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="n">assigned_group_for_class</span><span class="p">[</span><span class="n">cname</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_g</span>
            <span class="n">groups_classes</span><span class="p">[</span><span class="n">best_g</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">class_by_name</span><span class="p">[</span><span class="n">cname</span><span class="p">])</span>

        <span class="c1"># ×›×œ×œ Coupling: ×”×¦××“×ª ×× ×”×œ+×™×©×•×ª ×œ××•×ª×• ×§×•×‘×¥ ×›××©×¨ ×™×© ×©×™××•×© ×ª×›×•×£ ×‘-Type Hint/×©××•×ª</span>
        <span class="c1"># × ×–×”×” ×¢×‘×•×¨ ×›×œ ××—×œ×§×” ××™×œ×• ××—×œ×§×•×ª ××—×¨×•×ª ××•×–×›×¨×•×ª ×‘××ª×•×“×•×ª×™×”, ×•× ××—×“ ×œ×§×‘×•×¦×” ××©×•×ª×¤×ª ×›××©×¨ ×”×™×—×¡ ×’×‘×•×”.</span>
        <span class="c1"># ×”×—××¨×”: ×¢×‘×•×¨ ×“×•××™×™× ×™× ×©×•× ×™× (×œ××©×œ inventory ××•×œ core/billing) ×”×¦××“×” ×ª×ª×‘×¦×¢ ×¨×§ ×‘××§×¨×” ×©×œ ××–×›×•×¨ ×”×“×“×™ ×—×–×§.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">all_class_names</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">classes</span> <span class="ow">or</span> <span class="p">[]))</span>
            <span class="c1"># ××™×¤×•×™ ×“×•××™×™×Ÿ ×¢×‘×•×¨ ×›×œ ××—×œ×§×”</span>
            <span class="n">domain_by_class</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">classes</span> <span class="ow">or</span> <span class="p">[]):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">domain_by_class</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classify_class_domain</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">domain_by_class</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;core&quot;</span>
            <span class="c1"># ××™×¤×•×™: cname -&gt; counter ×©×œ ××—×œ×§×•×ª ××—×¨×•×ª ×©×”×•×–×›×¨×•</span>
            <span class="n">mentions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">method_counts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">classes</span> <span class="ow">or</span> <span class="p">[]):</span>
                <span class="n">method_counts</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">methods</span> <span class="ow">or</span> <span class="p">[])</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">methods</span> <span class="ow">or</span> <span class="p">[]):</span>
                    <span class="n">used</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_used_names</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="p">(</span><span class="n">used</span> <span class="o">&amp;</span> <span class="n">all_class_names</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">other</span> <span class="o">==</span> <span class="bp">cls</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">mentions</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="n">mentions</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="n">other</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># ×¡×£: ××—×œ×§×” A ××–×›×™×¨×” ××ª B ×‘×œ×¤×—×•×ª ××—×¦×™×ª ××”××ª×•×“×•×ª ×©×œ×” (××• 2 ××ª×•×“×•×ª ××™× ×™××•×)</span>
            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">counters</span> <span class="ow">in</span> <span class="n">mentions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">total_methods</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">method_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="c1"># ×‘×—×¨ ××ª B ×¢× ×”×”×–×›×¨×•×ª ×”×’×‘×•×”×•×ª ×‘×™×•×ª×¨</span>
                <span class="n">b</span><span class="p">,</span> <span class="n">cnt</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">other</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">counters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="n">cnt</span><span class="p">:</span>
                        <span class="n">b</span><span class="p">,</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">other</span><span class="p">,</span> <span class="n">c</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">b</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">strong_coupling</span> <span class="o">=</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">&gt;=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">total_methods</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">strong_coupling</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">ga</span> <span class="o">=</span> <span class="n">assigned_group_for_class</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                <span class="n">gb</span> <span class="o">=</span> <span class="n">assigned_group_for_class</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ga</span> <span class="ow">and</span> <span class="n">gb</span> <span class="ow">and</span> <span class="n">ga</span> <span class="o">!=</span> <span class="n">gb</span><span class="p">:</span>
                    <span class="c1"># ×‘×“×™×§×ª ×“×•××™×™× ×™× â€“ ×× ×™×¢×ª ×”×¦××“×” ×—×•×¦×ª-×“×•××™×™×Ÿ ××’×¨×¡×™×‘×™×ª.</span>
                    <span class="n">da</span> <span class="o">=</span> <span class="n">domain_by_class</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s2">&quot;core&quot;</span><span class="p">)</span>
                    <span class="n">db</span> <span class="o">=</span> <span class="n">domain_by_class</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s2">&quot;core&quot;</span><span class="p">)</span>
                    <span class="n">a_to_b</span> <span class="o">=</span> <span class="n">cnt</span>
                    <span class="n">b_to_a</span> <span class="o">=</span> <span class="n">mentions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="c1"># ×“×¨×™×©×ª ×”×“×“×™×•×ª ×¢×‘×•×¨ ×“×•××™×™× ×™× ×©×•× ×™×: ×©× ×™ ×”×›×™×•×•× ×™× ×¦×¨×™×›×™× ×œ×”×™×•×ª &quot;×—×–×§×™×&quot;</span>
                    <span class="c1"># (×œ×¤×—×•×ª ××—×¦×™ ××”××ª×•×“×•×ª ××• ××™× ×™××•× 2, ×œ×›×œ ××—×“ ××”×¦×“×“×™×).</span>
                    <span class="k">if</span> <span class="n">da</span> <span class="o">!=</span> <span class="n">db</span><span class="p">:</span>
                        <span class="n">thr_a</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">method_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
                        <span class="n">thr_b</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">method_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
                        <span class="c1"># ×”×§×©×—×” × ×•×¡×¤×ª: ×× ××—×“ ×”×“×•××™×™× ×™× ×”×•× &#39;inventory&#39;, ××œ ×ª×‘×¦×¢ ×”×¦××“×” ××œ× ×× ×©× ×™ ×”×›×™×•×•× ×™× ×—×–×§×™×.</span>
                        <span class="n">involves_inventory</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;inventory&quot;</span> <span class="ow">in</span> <span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">db</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">involves_inventory</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">a_to_b</span> <span class="o">&gt;=</span> <span class="n">thr_a</span> <span class="ow">and</span> <span class="n">b_to_a</span> <span class="o">&gt;=</span> <span class="n">thr_b</span><span class="p">):</span>
                            <span class="k">continue</span>
                        <span class="c1"># ×‘×”×™×¢×“×¨ ×”×“×“×™×•×ª ××¡×¤×§×ª â€“ ××œ ×ª×‘×¦×¢ ×”×¦××“×” ×—×•×¦×ª-×“×•××™×™×Ÿ</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">a_to_b</span> <span class="o">&gt;=</span> <span class="n">thr_a</span> <span class="ow">and</span> <span class="n">b_to_a</span> <span class="o">&gt;=</span> <span class="n">thr_b</span><span class="p">):</span>
                            <span class="k">continue</span>
                    <span class="c1"># ×”×–×– ××ª ×”××—×œ×§×” ×”×¤×—×•×ª &quot;××•×›×¨×ª&quot; ××œ ×§×‘×•×¦×ª ×”××—×œ×§×” ×”××¨×›×–×™×ª</span>
                    <span class="c1"># ×”×§×¨×™×˜×¨×™×•×Ÿ: ×× b ××–×›×™×¨ ××ª a ×¤×—×•×ª ×-a ×©××–×›×™×¨ ××ª b â€“ × ×¢×“×™×£ ××ª ×§×‘×•×¦×ª a</span>
                    <span class="n">dest</span> <span class="o">=</span> <span class="n">ga</span> <span class="k">if</span> <span class="n">a_to_b</span> <span class="o">&gt;=</span> <span class="n">b_to_a</span> <span class="k">else</span> <span class="n">gb</span>
                    <span class="n">src</span> <span class="o">=</span> <span class="n">gb</span> <span class="k">if</span> <span class="n">dest</span> <span class="o">==</span> <span class="n">ga</span> <span class="k">else</span> <span class="n">ga</span>
                    <span class="c1"># ×¢×“×›×Ÿ mapping ×•×¨×©×™××•×ª</span>
                    <span class="n">assigned_group_for_class</span><span class="p">[</span><span class="n">b</span> <span class="k">if</span> <span class="n">dest</span> <span class="o">==</span> <span class="n">ga</span> <span class="k">else</span> <span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">dest</span>
                    <span class="c1"># ×”×¡×¨ ××§×‘×•×¦×ª ×”××§×•×¨ ×•×”×•×¡×£ ×œ×™×¢×“</span>
                    <span class="n">move_name</span> <span class="o">=</span> <span class="n">b</span> <span class="k">if</span> <span class="n">dest</span> <span class="o">==</span> <span class="n">ga</span> <span class="k">else</span> <span class="n">a</span>
                    <span class="c1"># ×”×¡×¨×” ×‘×˜×•×—×”</span>
                    <span class="k">for</span> <span class="n">gname</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">groups_classes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">groups_classes</span><span class="p">[</span><span class="n">gname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">arr</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">move_name</span><span class="p">]</span>
                    <span class="c1"># ×”×•×¡×¤×”</span>
                    <span class="n">cls_obj</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">classes</span> <span class="ow">or</span> <span class="p">[])</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">move_name</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">cls_obj</span><span class="p">:</span>
                        <span class="n">groups_classes</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cls_obj</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># ×œ× × ×›×©×™×œ ××ª ×”×ª×”×œ×™×š ×‘××§×¨×” ×©×œ ×—×¨×™×’×” â€“ ×”×›×œ×œ ×”×•× ×©×™×¤×•×¨-×”×™×•×¨×™×¡×˜×™</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="n">groups_classes</span>

    <span class="k">def</span> <span class="nf">_inject_cross_module_class_imports</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">new_files</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">class_to_module</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ××–×¨×™×§ import ×™×—×¡×™ ×œ××—×œ×§×•×ª ×©××•×’×“×¨×•×ª ×‘××•×“×•×œ×™× ××—×¨×™× ××š × ××¦××•×ª ×‘×©×™××•×©.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">class_names</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">class_to_module</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">fn</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">new_files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;__init__.py&quot;</span> <span class="ow">or</span> <span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_shared.py&quot;</span><span class="p">):</span>
                <span class="n">out</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
                <span class="k">continue</span>
            <span class="n">current_stem</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
            <span class="n">used</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_used_names</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="n">defined_here</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_defined_classes_in_code</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="n">needed</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">used</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">class_names</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">defined_here</span> <span class="ow">and</span> <span class="n">class_to_module</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">!=</span> <span class="n">current_stem</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">needed</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
                <span class="k">continue</span>
            <span class="n">per_module</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">needed</span><span class="p">:</span>
                <span class="n">mod</span> <span class="o">=</span> <span class="n">class_to_module</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">mod</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">per_module</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
            <span class="c1"># ××¦× ××ª ×¡×•×£ ×”×“×•×§×¡×˜×¨×™× ×’</span>
            <span class="n">insert_idx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">quote_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">):</span>
                    <span class="n">quote_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">quote_count</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">insert_idx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span>
                        <span class="k">break</span>
            <span class="n">new_imports</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">module_stem</span><span class="p">,</span> <span class="n">names</span> <span class="ow">in</span> <span class="n">per_module</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">names_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">names</span><span class="p">))</span>
                <span class="n">imp</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;from .</span><span class="si">{</span><span class="n">module_stem</span><span class="si">}</span><span class="s2"> import </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names_sorted</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">exists</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">ln</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;from .</span><span class="si">{</span><span class="n">module_stem</span><span class="si">}</span><span class="s2"> import&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">:</span>
                    <span class="n">new_imports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">imp</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">new_imports</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[:</span><span class="n">insert_idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">new_imports</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">lines</span><span class="p">[</span><span class="n">insert_idx</span><span class="p">:]</span>
            <span class="n">out</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="c1"># === DRY-RUN: ×–×™×”×•×™ ×•×× ×™×¢×ª ×ª×œ×•×ª ××¢×’×œ×™×ª ×‘×××¦×¢×•×ª ××™×–×•×’ ××•×“×•×œ×™× ×¦××•×“×™× ===</span>
    <span class="k">def</span> <span class="nf">_resolve_circular_imports</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">base_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ××–×”×” ×¨×›×™×‘×™× ×—×–×§×™× (SCC) ×‘×’×¨×£ ×”×™×™×‘×•× ×‘×™×Ÿ ×”××•×“×•×œ×™× ×©× ×•×¦×¨×•.</span>
<span class="sd">        ×¢×‘×•×¨ ×›×œ ××¢×’×œ (SCC ×‘×’×•×“×œ &gt; 1) â€“ ×××–×’ ××•×“×•×œ×™× ×‘×–×•×’×•×ª ×§×¨×•×‘×™× ×›×“×™ ×œ×¤×¨×§ ××ª ×”××¢×’×œ,</span>
<span class="sd">        ×‘×”×ª×× ×œ×›×œ×œ ×”-Coupling (×”×¦××“×”).</span>
<span class="sd">        ××—×–×™×¨ (files_after, merged_pairs)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">_module_stem</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;__init__.py&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_shared.py&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_shared_core.py&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>

        <span class="k">def</span> <span class="nf">_build_graph</span><span class="p">(</span><span class="n">files_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
            <span class="n">stems</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">files_map</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">_module_stem</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">st</span><span class="p">:</span>
                    <span class="n">stems</span><span class="p">[</span><span class="n">st</span><span class="p">]</span> <span class="o">=</span> <span class="n">fn</span>
            <span class="n">graph</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="n">st</span><span class="p">:</span> <span class="nb">set</span><span class="p">()</span> <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">stems</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
            <span class="n">import_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\s*from\s+\.(\w+)\s+import\s+&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">st</span><span class="p">,</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">stems</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">files_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">import_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">target</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">graph</span> <span class="ow">and</span> <span class="n">target</span> <span class="o">!=</span> <span class="n">st</span><span class="p">:</span>
                        <span class="n">graph</span><span class="p">[</span><span class="n">st</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">graph</span><span class="p">,</span> <span class="n">stems</span>

        <span class="k">def</span> <span class="nf">_tarjan_scc</span><span class="p">(</span><span class="n">graph</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">indices</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">lowlink</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">stack</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">onstack</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">sccs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">def</span> <span class="nf">strongconnect</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">nonlocal</span> <span class="n">index</span>
                <span class="n">indices</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
                <span class="n">lowlink</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="n">onstack</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">()):</span>
                    <span class="k">if</span> <span class="n">w</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                        <span class="n">strongconnect</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
                        <span class="n">lowlink</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lowlink</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="n">lowlink</span><span class="p">[</span><span class="n">w</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">onstack</span><span class="p">:</span>
                        <span class="n">lowlink</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lowlink</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="n">indices</span><span class="p">[</span><span class="n">w</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">lowlink</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">==</span> <span class="n">indices</span><span class="p">[</span><span class="n">v</span><span class="p">]:</span>
                    <span class="n">comp</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">w</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                        <span class="n">onstack</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
                        <span class="n">comp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">w</span> <span class="o">==</span> <span class="n">v</span><span class="p">:</span>
                            <span class="k">break</span>
                    <span class="n">sccs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                    <span class="n">strongconnect</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">sccs</span>

        <span class="k">def</span> <span class="nf">_merge_two</span><span class="p">(</span><span class="n">files_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">stems_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">a</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            ×××–×’ ××ª ×”××•×“×•×œ b ×œ×ª×•×š a. ××¢×“×›×Ÿ ×™×™×‘×•××™× ×‘×§×‘×¦×™× ××—×¨×™×.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">a_file</span> <span class="o">=</span> <span class="n">stems_map</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
            <span class="n">b_file</span> <span class="o">=</span> <span class="n">stems_map</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
            <span class="n">a_content</span> <span class="o">=</span> <span class="n">files_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a_file</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">b_content</span> <span class="o">=</span> <span class="n">files_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">b_file</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="c1"># ×”×¡×¨ ×“×•×§×¡×˜×¨×™× ×’ ×¢×œ×™×•×Ÿ ×-b ×›×“×™ ×œ×× ×•×¢ ×›×¤×™×œ×•×ª ××¨×—×™×‘×”</span>
            <span class="k">def</span> <span class="nf">strip_top_docstring</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
                <span class="n">out</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">quote_count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">quote_count</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">):</span>
                        <span class="n">quote_count</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">quote_count</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">continue</span>
                    <span class="k">break</span>
                <span class="c1"># ×“×œ×’ ×’× ×¢×œ ×©×•×¨×” ×¨×™×§×” ×©××—×¨×™ ×”×“×•×§×¡×˜×¨×™× ×’</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="ow">and</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
                <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="n">merged</span> <span class="o">=</span> <span class="n">a_content</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"># ---- merged from </span><span class="si">{</span><span class="n">b_file</span><span class="si">}</span><span class="s2"> ----</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">strip_top_docstring</span><span class="p">(</span><span class="n">b_content</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">files_map</span><span class="p">[</span><span class="n">a_file</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged</span>
            <span class="c1"># ××—×§ ××ª ×§×•×‘×¥ b</span>
            <span class="k">del</span> <span class="n">files_map</span><span class="p">[</span><span class="n">b_file</span><span class="p">]</span>
            <span class="c1"># ×¢×“×›×Ÿ ×™×™×‘×•××™× ×‘×›×œ ×©××¨ ×”×§×‘×¦×™×: from .b import -&gt; from .a import</span>
            <span class="n">b_pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;^(\s*from\s+)\.</span><span class="si">{</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="si">}</span><span class="s1">(\s+import\s+)&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">fn</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">files_map</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">files_map</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">b_pat</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\1.&#39;</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;\2&#39;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
            <span class="c1"># ×”×¡×¨ self-imports ×‘×§×•×‘×¥ ×”×××•×—×“ (from .a import ...) ×›×“×™ ×œ×× ×•×¢ ×˜×¢×™× ×ª ××•×“×•×œ ×—×œ×§×™×ª</span>
            <span class="n">self_import_pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;^\s*from\s+\.</span><span class="si">{</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="si">}</span><span class="s1">\s+import\s+.*$&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
            <span class="n">files_map</span><span class="p">[</span><span class="n">a_file</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">self_import_pat</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">files_map</span><span class="p">[</span><span class="n">a_file</span><span class="p">])</span>
            <span class="c1"># × ×§×” ×¨×•×•×—×™× ×›×¤×•×œ×™× ×©× ×•×¦×¨×• ××”×¡×¨×”</span>
            <span class="n">files_map</span><span class="p">[</span><span class="n">a_file</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\n{3,}&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">files_map</span><span class="p">[</span><span class="n">a_file</span><span class="p">])</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">files_map</span><span class="p">[</span><span class="n">a_file</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">files_map</span><span class="p">,</span> <span class="p">(</span><span class="n">stems_map</span><span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="n">b_file</span><span class="p">)</span>

        <span class="n">merged_pairs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">shared_bridges</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">skipped_canonical_cycles</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">iterations</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">canonical_domains</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CANONICAL_DOMAIN_PRIORITY</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="k">def</span> <span class="nf">_is_canonical</span><span class="p">(</span><span class="n">stem</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">stem</span> <span class="ow">in</span> <span class="n">canonical_domains</span>

        <span class="k">while</span> <span class="n">iterations</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>  <span class="c1"># ×”×’×‘×œ×ª × ×™×¡×™×•× ×•×ª ×›×“×™ ×œ×× ×•×¢ ×œ×•×œ××”</span>
            <span class="n">graph</span><span class="p">,</span> <span class="n">stems_map</span> <span class="o">=</span> <span class="n">_build_graph</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
            <span class="n">sccs</span> <span class="o">=</span> <span class="n">_tarjan_scc</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
            <span class="n">cycles</span> <span class="o">=</span> <span class="p">[</span><span class="n">comp</span> <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">sccs</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cycles</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">changed</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">cycles</span><span class="p">:</span>
                <span class="n">component_has_non_canonical</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="n">_is_canonical</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">comp</span><span class="p">)</span>
                <span class="n">pair_to_merge</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">mutual</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">comp</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">comp</span><span class="p">)):</span>
                        <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">comp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">comp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span> <span class="ow">and</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">set</span><span class="p">()):</span>
                            <span class="n">mutual</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">mutual</span><span class="p">:</span>
                    <span class="n">pair_to_merge</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                        <span class="nb">sorted</span><span class="p">(</span><span class="n">mutual</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])))[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="p">)</span>  <span class="c1"># type: ignore[assignment]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">candidates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">comp</span><span class="p">)):</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">comp</span><span class="p">)):</span>
                            <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">comp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">comp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">_is_canonical</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_is_canonical</span><span class="p">(</span><span class="n">v</span><span class="p">)):</span>
                                <span class="n">candidates</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">candidates</span><span class="p">:</span>
                        <span class="k">def</span> <span class="nf">_score</span><span class="p">(</span><span class="n">pair</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
                            <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">pair</span>
                            <span class="n">non_canon_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="ow">not</span> <span class="n">_is_canonical</span><span class="p">(</span><span class="n">u</span><span class="p">))</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="ow">not</span> <span class="n">_is_canonical</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
                            <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="n">non_canon_count</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
                        <span class="n">pair_to_merge</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">pair_to_merge</span> <span class="o">=</span> <span class="p">(</span><span class="n">comp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">comp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">pair_to_merge</span>  <span class="c1"># type: ignore[misc]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">component_has_non_canonical</span> <span class="ow">and</span> <span class="n">_is_canonical</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_is_canonical</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
                    <span class="n">files</span><span class="p">,</span> <span class="n">bridged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_introduce_shared_layer_for_cycle</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">stems_map</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">base_name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">bridged</span><span class="p">:</span>
                        <span class="n">shared_bridges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">comp</span><span class="p">))</span>
                        <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                    <span class="n">skipped_canonical_cycles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">comp</span><span class="p">))</span>
                    <span class="k">continue</span>

                <span class="k">def</span> <span class="nf">_priority</span><span class="p">(</span><span class="n">stem</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CANONICAL_DOMAIN_PRIORITY</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">stem</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

                <span class="n">prioritized</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">_is_canonical</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_is_canonical</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
                    <span class="n">prioritized</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">_is_canonical</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_is_canonical</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
                    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span>
                    <span class="n">prioritized</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">prioritized</span> <span class="ow">and</span> <span class="n">_priority</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_priority</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
                    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span>
                    <span class="n">prioritized</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">prioritized</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="n">b</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">set</span><span class="p">())):</span>
                        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span>
                <span class="n">files</span><span class="p">,</span> <span class="n">merged</span> <span class="o">=</span> <span class="n">_merge_two</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">stems_map</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
                <span class="n">merged_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">merged</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">merged</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">changed</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">iterations</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">files</span><span class="p">,</span> <span class="n">merged_pairs</span><span class="p">,</span> <span class="n">shared_bridges</span><span class="p">,</span> <span class="n">skipped_canonical_cycles</span>

    <span class="k">def</span> <span class="nf">_introduce_shared_layer_for_cycle</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">files_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">stems_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">cycle</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">base_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]:</span>
        <span class="n">cycle_set</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">cycle</span><span class="p">)</span>
        <span class="n">reference_file</span> <span class="o">=</span> <span class="n">stems_map</span><span class="p">[</span><span class="n">cycle</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">shared_filename</span><span class="p">,</span> <span class="n">shared_stem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shared_core_filename</span><span class="p">(</span><span class="n">base_name</span><span class="p">,</span> <span class="n">reference_file</span><span class="p">)</span>
        <span class="n">wrappers_needed</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">updated_files</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">files_map</span><span class="p">)</span>
        <span class="n">modified</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">cycle</span><span class="p">:</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">stems_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fn</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">files_map</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span>
            <span class="n">new_content</span><span class="p">,</span> <span class="n">wrappers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rewrite_imports_with_shared_layer</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">cycle_set</span><span class="p">,</span> <span class="n">shared_stem</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">wrappers</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">alias</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">wrappers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">wrappers_needed</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
                <span class="n">updated_files</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_content</span>
                <span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">modified</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">wrappers_needed</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">files_map</span><span class="p">,</span> <span class="kc">False</span>
        <span class="n">updated_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_shared_core_file</span><span class="p">(</span><span class="n">updated_files</span><span class="p">,</span> <span class="n">shared_filename</span><span class="p">,</span> <span class="n">wrappers_needed</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">updated_files</span><span class="p">,</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_shared_core_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">reference_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">shared_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_shared_core.py&quot;</span>
        <span class="n">ref_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">reference_file</span><span class="p">)</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">ref_path</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">shared_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="n">parent</span> <span class="o">/</span> <span class="n">shared_name</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;./&quot;</span><span class="p">):</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">filename</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="n">shared_name</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>

    <span class="k">def</span> <span class="nf">_rewrite_imports_with_shared_layer</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">cycle_set</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">shared_stem</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">content</span><span class="p">,</span> <span class="p">{}</span>
        <span class="n">targets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">ImportFrom</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">node</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">ImportFrom</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">module</span> <span class="ow">in</span> <span class="n">cycle_set</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">targets</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">content</span><span class="p">,</span> <span class="p">{}</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="n">wrappers_needed</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">inserted_aliases</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">col_offset</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">module</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">module</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
            <span class="n">indent_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">lineno</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">lineno</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="n">indent</span> <span class="o">=</span> <span class="n">indent_line</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">indent_line</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">indent_line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())]</span>
            <span class="n">replacement_lines</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                <span class="n">original</span> <span class="o">=</span> <span class="n">alias</span><span class="o">.</span><span class="n">name</span>
                <span class="n">alias_name</span> <span class="o">=</span> <span class="n">alias</span><span class="o">.</span><span class="n">asname</span> <span class="ow">or</span> <span class="n">alias</span><span class="o">.</span><span class="n">name</span>
                <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">alias_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inserted_aliases</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">wrapper_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_shared_alias_name</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>
                <span class="n">replacement_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indent</span><span class="si">}</span><span class="s2">from .</span><span class="si">{</span><span class="n">shared_stem</span><span class="si">}</span><span class="s2"> import </span><span class="si">{</span><span class="n">wrapper_name</span><span class="si">}</span><span class="s2"> as </span><span class="si">{</span><span class="n">alias_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">inserted_aliases</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">wrappers_needed</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">wrapper_name</span><span class="p">,</span> <span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">original</span><span class="p">))</span>
            <span class="n">lines</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">lineno</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">end_lineno</span><span class="p">]</span> <span class="o">=</span> <span class="n">replacement_lines</span>
        <span class="n">new_content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">new_content</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="n">new_content</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">new_content</span><span class="p">,</span> <span class="n">wrappers_needed</span>

    <span class="k">def</span> <span class="nf">_build_shared_alias_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">safe_module</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^0-9a-zA-Z_]&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">module</span><span class="p">)</span>
        <span class="n">safe_symbol</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^0-9a-zA-Z_]&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">safe_module</span><span class="si">}</span><span class="s2">__</span><span class="si">{</span><span class="n">safe_symbol</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">_ensure_shared_core_file</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">files_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">shared_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">wrappers_needed</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">registry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shared_symbol_registry</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">shared_filename</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">registry</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">wrappers_needed</span><span class="p">)</span>
        <span class="n">lines</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">,</span>
            <span class="s2">&quot;×©×›×‘×ª ×ª×™×•×•×š ×œ×“×•××™×™× ×™× ×§× ×•× ×™×™× ×›×“×™ ×œ×”×™×× ×¢ ×××¢×’×œ×™ import&quot;</span><span class="p">,</span>
            <span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;from __future__ import annotations&quot;</span><span class="p">,</span>
            <span class="s2">&quot;import importlib&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_LAZY_SYMBOLS = {&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">alias</span><span class="p">,</span> <span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">registry</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    &#39;</span><span class="si">{</span><span class="n">alias</span><span class="si">}</span><span class="s2">&#39;: (&#39;</span><span class="si">{</span><span class="n">module</span><span class="si">}</span><span class="s2">&#39;, &#39;</span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s2">&#39;),&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;__all__ = list(_LAZY_SYMBOLS.keys())&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;def __getattr__(name: str):&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    try:&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;        module, symbol = _LAZY_SYMBOLS[name]&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    except KeyError as exc:&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;        raise AttributeError(name) from exc&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    package = __package__&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    if package:&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;        target_module = importlib.import_module(f&#39;.</span><span class="si">{module}</span><span class="s2">&#39;, package)&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    else:&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;        target_module = importlib.import_module(module)&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    value = getattr(target_module, symbol)&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    globals()[name] = value&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    return value&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">files_map</span><span class="p">[</span><span class="n">shared_filename</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">files_map</span>

    <span class="k">def</span> <span class="nf">_module_level_import_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">module_lines</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">_collect</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">AST</span><span class="p">,</span> <span class="n">allow_nested_type_checking</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Import</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">ImportFrom</span><span class="p">)):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;lineno&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">end</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;end_lineno&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="p">(</span><span class="n">end</span> <span class="ow">or</span> <span class="n">start</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">module_lines</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">If</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_type_checking_guard</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">test</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
                    <span class="n">_collect</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">allow_nested_type_checking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">allow_nested_type_checking</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">If</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">With</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Try</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">_collect</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">allow_nested_type_checking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">top</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">_collect</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">allow_nested_type_checking</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">module_lines</span>

    <span class="k">def</span> <span class="nf">_is_type_checking_guard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">AST</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">expr</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="s2">&quot;TYPE_CHECKING&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">expr</span><span class="o">.</span><span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;TYPE_CHECKING&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Compare</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">ops</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ast</span><span class="o">.</span><span class="n">Is</span><span class="p">):</span>
            <span class="c1"># Handles patterns like &quot;if typing.TYPE_CHECKING is True:&quot;</span>
            <span class="n">left</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">left</span>
            <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">))</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_type_checking_guard</span><span class="p">(</span><span class="n">left</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># === Naming helpers ===</span>
    <span class="k">def</span> <span class="nf">_choose_filename_for_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ×§×•×‘×¢ ×©× ×§×•×‘×¥ ×¢×‘×•×¨ ×§×‘×•×¦×”.</span>
<span class="sd">        ×›××©×¨ ××“×•×‘×¨ ×‘×“×•××™×™×Ÿ ××•×›×¨ â€“ ××©×ª××© ×‘×©× ×“×•××™×™× ×™ ×™×¦×™×‘ (users.py, finance.py, inventory.py, network.py, workflows.py).</span>
<span class="sd">        ××—×¨×ª â€“ × ×©××¨ ××ª ×©× ×”×‘×¡×™×¡ + ×”×§×‘×•×¦×” (base_group.py) ×œ×©××™×¨×ª ×ª××™××•×ª.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">canonical_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;users&quot;</span><span class="p">:</span> <span class="s2">&quot;users.py&quot;</span><span class="p">,</span>
            <span class="s2">&quot;finance&quot;</span><span class="p">:</span> <span class="s2">&quot;finance.py&quot;</span><span class="p">,</span>
            <span class="s2">&quot;inventory&quot;</span><span class="p">:</span> <span class="s2">&quot;inventory.py&quot;</span><span class="p">,</span>
            <span class="s2">&quot;api_clients&quot;</span><span class="p">:</span> <span class="s2">&quot;network.py&quot;</span><span class="p">,</span>
            <span class="s2">&quot;workflows&quot;</span><span class="p">:</span> <span class="s2">&quot;workflows.py&quot;</span><span class="p">,</span>
            <span class="s2">&quot;analytics&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_analytics.py&quot;</span><span class="p">,</span>  <span class="c1"># × ×©××¨ ×××•×§×“-×‘×¡×™×¡ ×›×“×™ ×œ× ×œ×©×‘×•×¨ ×¦×™×¤×™×•×ª ×§×™×™××•×ª ×‘×˜×¡×˜×™×</span>
            <span class="s2">&quot;utils&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_utils.py&quot;</span><span class="p">,</span>
            <span class="s2">&quot;files&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_files.py&quot;</span><span class="p">,</span>
            <span class="s2">&quot;permissions&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_permissions.py&quot;</span><span class="p">,</span>
            <span class="s2">&quot;main&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_main.py&quot;</span><span class="p">,</span>
            <span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_debug.py&quot;</span><span class="p">,</span>
            <span class="s2">&quot;compute&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_compute.py&quot;</span><span class="p">,</span>
            <span class="s2">&quot;helpers&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_helpers.py&quot;</span><span class="p">,</span>
            <span class="s2">&quot;io&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_io.py&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">group_name</span> <span class="ow">in</span> <span class="n">canonical_map</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">canonical_map</span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span>
        <span class="c1"># ×‘×¨×™×¨×ª ××—×“×œ: base_name_group.py</span>
        <span class="n">safe_group</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^a-z0-9_]&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">group_name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">safe_group</span><span class="si">}</span><span class="s2">.py&quot;</span></div>


<span class="c1"># Instance ×’×œ×•×‘×œ×™</span>
<span class="n">refactoring_engine</span> <span class="o">=</span> <span class="n">RefactoringEngine</span><span class="p">()</span>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Development Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>