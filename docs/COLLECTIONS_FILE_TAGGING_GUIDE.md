# ××“×¨×™×š ×œ××™××•×© ×ª×™×•×’ ×§×‘×¦×™× ×‘"××•×¡×¤×™× ×©×œ×™" ğŸ·ï¸

## ×ª×•×›×Ÿ ×¢× ×™×™× ×™×
1. [×¡×§×™×¨×” ×›×œ×œ×™×ª](#×¡×§×™×¨×”-×›×œ×œ×™×ª)
2. [×”×ª×’×™× ×”××•×¦×¢×™×](#×”×ª×’×™×-×”××•×¦×¢×™×)
3. [××¨×›×™×˜×§×˜×•×¨×” ×•××‘× ×” × ×ª×•× ×™×](#××¨×›×™×˜×§×˜×•×¨×”-×•××‘× ×”-× ×ª×•× ×™×)
4. [×©×™× ×•×™×™× × ×“×¨×©×™× ×‘-Backend](#×©×™× ×•×™×™×-× ×“×¨×©×™×-×‘-backend)
5. [×©×™× ×•×™×™× × ×“×¨×©×™× ×‘-Frontend](#×©×™× ×•×™×™×-× ×“×¨×©×™×-×‘-frontend)
6. [UI/UX Components](#uiux-components)
7. [×“×•×’×××•×ª ×§×•×“](#×“×•×’×××•×ª-×§×•×“)
8. [×©×œ×‘×™ ××™××•×© ××•××œ×¦×™×](#×©×œ×‘×™-××™××•×©-××•××œ×¦×™×)
9. [×©×™×§×•×œ×™× × ×•×¡×¤×™×](#×©×™×§×•×œ×™×-× ×•×¡×¤×™×)

---

## ×¡×§×™×¨×” ×›×œ×œ×™×ª

××˜×¨×ª ×”××“×¨×™×š ×”×™× ×œ×”×•×¡×™×£ ×™×›×•×œ×ª ×ª×™×•×’ ×©×œ ×§×‘×¦×™× ×‘××•×¡×¤×™× ×‘×××¦×¢×•×ª **××™××•×’'×™×** ×©×™××¤×©×¨×•:
- **×¡×™××•×Ÿ ×¢×“×™×¤×•×™×•×ª** (×“×—×•×£/×œ× ×“×—×•×£)
- **×§×˜×’×•×¨×™×•×ª ×¤×•× ×§×¦×™×•× ×œ×™×•×ª** (×‘××’, ×“××˜×”-×‘×™×™×¡, × ×™×¡×™×•× ×™)
- **×¡×˜×˜×•×¡ ×•×¡× ×˜×™×× ×˜** (××•×¢×“×£, ×§×¡×•×, ×¨×¢×™×•×Ÿ)
- **×¡×“×¨ ×˜×™×¤×•×œ** (×ª×™×•×’ ××¡×¤×¨×™ 1ï¸âƒ£2ï¸âƒ£3ï¸âƒ£)

×”×ª×™×•×’ ×™×”×™×” **×‘×¨××ª ×”×¤×¨×™×˜ ×‘×ª×•×š ×”××•×¡×£** (collection item) - ×›×œ×•××¨, ××•×ª×• ×§×•×‘×¥ ×™×›×•×œ ×œ×§×‘×œ ×ª×’×™×•×ª ×©×•× ×•×ª ×‘××•×¡×¤×™× ×©×•× ×™×.

---

## ×”×ª×’×™× ×”××•×¦×¢×™×

### ×¨×©×™××ª ×”×ª×’×™×

| ××™××•×’'×™ | ×©× | ×ª×™××•×¨ | ×§×˜×’×•×¨×™×” |
|---------|-----|--------|----------|
| ğŸ¢ | ×œ× ×“×—×•×£ | ××©×™××” ×œ×œ× ×œ×—×¥ ×–××Ÿ | ×¢×“×™×¤×•×ª |
| ğŸ”¥ | ×“×—×•×£ | ×“×•×¨×© ×˜×™×¤×•×œ ××™×™×“×™ | ×¢×“×™×¤×•×ª |
| ğŸ”® | ×§×¡×•× | ×§×•×“ ××™×•×—×“/××¢× ×™×™×Ÿ | ×¡× ×˜×™×× ×˜ |
| â™¥ï¸ | ××•×¢×“×£ | ×§×•×‘×¥ ×—×©×•×‘ ×‘××™×•×—×“ | ×¡× ×˜×™×× ×˜ |
| ğŸ” | ×¡×•×“×™ | ××™×“×¢ ×¨×’×™×© | ××‘×˜×—×” |
| ğŸ’­ | ×¨×¢×™×•×Ÿ/idea | ×¨×¢×™×•×Ÿ ×œ×¤×™×ª×•×— ×¢×ª×™×“×™ | ×¡×˜×˜×•×¡ |
| â¸ï¸ | ××•×©×”×”/paused | ×¢×‘×•×“×” ×–×× ×™×ª ××•×©×”×™×ª | ×¡×˜×˜×•×¡ |
| ğŸ¯ | ××˜×¨×”/goal | ×™×¢×“ ×œ×‘×™×¦×•×¢ | ×¡×˜×˜×•×¡ |
| ğŸ› | ×ª×™×§×•×Ÿ ×‘××’ | ×ª×™×§×•×Ÿ ×©×’×™××” | ×§×˜×’×•×¨×™×” |
| ğŸ—„ï¸ | ×“××˜×”-×‘×™×™×¡ | ×§×©×•×¨ ×œ××¡×“ × ×ª×•× ×™× | ×§×˜×’×•×¨×™×” |
| ğŸ§ª | × ×™×¡×™×•× ×™/testing | ×§×•×“ ×‘×©×œ×‘ ×‘×“×™×§×” | ×§×˜×’×•×¨×™×” |
| 1ï¸âƒ£ | ×¡×“×¨ ×¨××©×•×Ÿ | ×§×•×‘×¥ ×¨××©×•×Ÿ ×‘×¡×“×¨ ×”×˜×™×¤×•×œ | ×¡×“×¨ |
| 2ï¸âƒ£ | ×¡×“×¨ ×©× ×™ | ×§×•×‘×¥ ×©× ×™ ×‘×¡×“×¨ ×”×˜×™×¤×•×œ | ×¡×“×¨ |
| 3ï¸âƒ£ | ×¡×“×¨ ×©×œ×™×©×™ | ×§×•×‘×¥ ×©×œ×™×©×™ ×‘×¡×“×¨ ×”×˜×™×¤×•×œ | ×¡×“×¨ |

### ××¨×’×•×Ÿ ×œ×¤×™ ×§×˜×’×•×¨×™×•×ª

```python
TAG_CATEGORIES = {
    'priority': ['ğŸ¢', 'ğŸ”¥'],              # ×¢×“×™×¤×•×ª
    'sentiment': ['ğŸ”®', 'â™¥ï¸'],            # ×¡× ×˜×™×× ×˜
    'security': ['ğŸ”'],                   # ××‘×˜×—×”
    'status': ['ğŸ’­', 'â¸ï¸', 'ğŸ¯'],          # ×¡×˜×˜×•×¡
    'category': ['ğŸ›', 'ğŸ—„ï¸', 'ğŸ§ª'],       # ×§×˜×’×•×¨×™×” ×¤×•× ×§×¦×™×•× ×œ×™×ª
    'order': ['1ï¸âƒ£', '2ï¸âƒ£', '3ï¸âƒ£']          # ×¡×“×¨ ×˜×™×¤×•×œ
}
```

---

## ××¨×›×™×˜×§×˜×•×¨×” ×•××‘× ×” × ×ª×•× ×™×

### ××‘× ×” × ×ª×•× ×™× ×§×™×™×

×›×¨×’×¢, ×‘×§×•×œ×§×¦×™×” `collection_items` ×™×© ××ª ×”××‘× ×” ×”×‘×:

```javascript
{
  "_id": ObjectId,
  "collection_id": ObjectId,
  "user_id": int,
  "source": str,              // "regular" | "large"
  "file_name": str,
  "note": str,                // ×¢×“ 500 ×ª×•×•×™×
  "pinned": bool,
  "custom_order": int,
  "workspace_state": str,     // "todo" | "in_progress" | "done"
  "added_at": datetime,
  "updated_at": datetime
}
```

### ×©×™× ×•×™ ××•×¦×¢: ×”×•×¡×¤×ª ×©×“×” `tags`

```javascript
{
  "_id": ObjectId,
  "collection_id": ObjectId,
  "user_id": int,
  "source": str,
  "file_name": str,
  "note": str,
  "pinned": bool,
  "custom_order": int,
  "workspace_state": str,
  "tags": [str],              // âœ¨ ×©×“×” ×—×“×© - ×¨×©×™××ª ××™××•×’'×™ ×ª×’×™×•×ª
  "added_at": datetime,
  "updated_at": datetime
}
```

### ×“×•×’×××•×ª ×œ××¡××›×™× ×¢× ×ª×’×™×•×ª

```javascript
// ×“×•×’××” 1: ×§×•×‘×¥ ×¢× ×‘××’ ×“×—×•×£
{
  "file_name": "auth_service.py",
  "tags": ["ğŸ›", "ğŸ”¥", "1ï¸âƒ£"],  // ×‘××’ ×“×—×•×£, ×¨××©×•×Ÿ ×‘×ª×•×¨
  "note": "×ª×™×§×•×Ÿ ×‘×¢×™×™×ª ×”×ª×—×‘×¨×•×ª"
}

// ×“×•×’××” 2: ×¨×¢×™×•×Ÿ ×œ×¢×ª×™×“
{
  "file_name": "ml_model.py",
  "tags": ["ğŸ’­", "ğŸ”®", "ğŸ§ª"],   // ×¨×¢×™×•×Ÿ ×§×¡×•× ×•× ×™×¡×™×•× ×™
  "note": "××•×“×œ ML ×—×“×© ×œ× ×™×¡×•×™"
}

// ×“×•×’××” 3: ×“××˜×”-×‘×™×™×¡ ×¡×•×“×™
{
  "file_name": "migration_001.sql",
  "tags": ["ğŸ—„ï¸", "ğŸ”"],        // ×“××˜×”-×‘×™×™×¡ ×¨×’×™×©
  "note": "××™×’×¨×¦×™×” ×œ×¡×›××” ×—×“×©×”"
}
```

---

## ×©×™× ×•×™×™× × ×“×¨×©×™× ×‘-Backend

### 1. ×§×‘×•×¢×™× ×•-Validation

**×§×•×‘×¥:** `database/collections_manager.py`

×”×•×¡×£ ×‘×ª×—×™×œ×ª ×”×§×•×‘×¥:

```python
# ×ª×’×™×•×ª ××•×ª×¨×•×ª (whitelist)
ALLOWED_TAGS = [
    # ×¢×“×™×¤×•×ª
    'ğŸ¢',  # ×œ× ×“×—×•×£
    'ğŸ”¥',  # ×“×—×•×£

    # ×¡× ×˜×™×× ×˜
    'ğŸ”®',  # ×§×¡×•×
    'â™¥ï¸',  # ××•×¢×“×£

    # ××‘×˜×—×”
    'ğŸ”',  # ×¡×•×“×™

    # ×¡×˜×˜×•×¡
    'ğŸ’­',  # ×¨×¢×™×•×Ÿ
    'â¸ï¸',  # ××•×©×”×”
    'ğŸ¯',  # ××˜×¨×”

    # ×§×˜×’×•×¨×™×”
    'ğŸ›',  # ×‘××’
    'ğŸ—„ï¸',  # ×“××˜×”-×‘×™×™×¡
    'ğŸ§ª',  # × ×™×¡×™×•× ×™

    # ×¡×“×¨
    '1ï¸âƒ£',  # ×¨××©×•×Ÿ
    '2ï¸âƒ£',  # ×©× ×™
    '3ï¸âƒ£',  # ×©×œ×™×©×™
]

# ×§×˜×’×•×¨×™×•×ª ×ª×’×™×•×ª
TAG_CATEGORIES = {
    'priority': ['ğŸ¢', 'ğŸ”¥'],
    'sentiment': ['ğŸ”®', 'â™¥ï¸'],
    'security': ['ğŸ”'],
    'status': ['ğŸ’­', 'â¸ï¸', 'ğŸ¯'],
    'category': ['ğŸ›', 'ğŸ—„ï¸', 'ğŸ§ª'],
    'order': ['1ï¸âƒ£', '2ï¸âƒ£', '3ï¸âƒ£']
}

# ××˜××“××˜×” ×œ×›×œ ×ª×’×™×ª
TAG_METADATA = {
    'ğŸ¢': {'name_he': '×œ× ×“×—×•×£', 'name_en': 'low priority', 'category': 'priority'},
    'ğŸ”¥': {'name_he': '×“×—×•×£', 'name_en': 'urgent', 'category': 'priority'},
    'ğŸ”®': {'name_he': '×§×¡×•×', 'name_en': 'magic', 'category': 'sentiment'},
    'â™¥ï¸': {'name_he': '××•×¢×“×£', 'name_en': 'favorite', 'category': 'sentiment'},
    'ğŸ”': {'name_he': '×¡×•×“×™', 'name_en': 'secret', 'category': 'security'},
    'ğŸ’­': {'name_he': '×¨×¢×™×•×Ÿ', 'name_en': 'idea', 'category': 'status'},
    'â¸ï¸': {'name_he': '××•×©×”×”', 'name_en': 'paused', 'category': 'status'},
    'ğŸ¯': {'name_he': '××˜×¨×”', 'name_en': 'goal', 'category': 'status'},
    'ğŸ›': {'name_he': '×‘××’', 'name_en': 'bug', 'category': 'category'},
    'ğŸ—„ï¸': {'name_he': '×“××˜×”-×‘×™×™×¡', 'name_en': 'database', 'category': 'category'},
    'ğŸ§ª': {'name_he': '× ×™×¡×™×•× ×™', 'name_en': 'experimental', 'category': 'category'},
    '1ï¸âƒ£': {'name_he': '×¨××©×•×Ÿ', 'name_en': 'first', 'category': 'order'},
    '2ï¸âƒ£': {'name_he': '×©× ×™', 'name_en': 'second', 'category': 'order'},
    '3ï¸âƒ£': {'name_he': '×©×œ×™×©×™', 'name_en': 'third', 'category': 'order'},
}

# ××’×‘×œ×•×ª
MAX_TAGS_PER_ITEM = 10  # ××§×¡×™××•× ×ª×’×™×•×ª ×œ×¤×¨×™×˜
```

### 2. ×¤×•× ×§×¦×™×™×ª Validation

×”×•×¡×£ ×¤×•× ×§×¦×™×” ×œ-`CollectionsManager`:

```python
def _validate_tags(self, tags):
    """
    ××•×•×“× ×©×¨×©×™××ª ×”×ª×’×™×•×ª ×ª×§×™× ×”.

    Args:
        tags: ×¨×©×™××ª ×ª×’×™×•×ª (××™××•×’'×™×)

    Returns:
        tuple: (is_valid, error_message)
    """
    if tags is None:
        return True, None

    if not isinstance(tags, list):
        return False, "tags must be a list"

    if len(tags) > MAX_TAGS_PER_ITEM:
        return False, f"maximum {MAX_TAGS_PER_ITEM} tags allowed per item"

    # ×‘×“×™×§×ª uniqueness
    if len(tags) != len(set(tags)):
        return False, "duplicate tags not allowed"

    # ×‘×“×™×§×ª whitelist
    for tag in tags:
        if tag not in ALLOWED_TAGS:
            return False, f"invalid tag: {tag}"

    return True, None
```

### 3. ×¢×“×›×•×Ÿ `add_items()` ×œ×ª××™×›×” ×‘×ª×’×™×•×ª

×¢×“×›×Ÿ ××ª ×”××ª×•×“×” `add_items()` ×‘-`CollectionsManager`:

```python
def add_items(self, user_id, collection_id, items):
    """
    ×”×•×¡×¤×ª ×¤×¨×™×˜×™× ×œ××•×¡×£ (××¦×‘ manual ××• mixed).

    Args:
        items: ×¨×©×™××” ×©×œ ×“×™×§×˜×™× ×¢× source, file_name, note (××•×¤×¦×™×•× ×œ×™), tags (××•×¤×¦×™×•× ×œ×™)
    """
    # ... ×§×•×“ ×§×™×™× ×œ×¤× ×™ ...

    for item_dict in items:
        source = item_dict.get('source', 'regular')
        file_name = item_dict.get('file_name')
        note = (item_dict.get('note') or '').strip()[:500]
        tags = item_dict.get('tags', [])  # âœ¨ ×§×¨×™××ª ×ª×’×™×•×ª

        # ×•×œ×™×“×¦×™×™×ª ×ª×’×™×•×ª
        is_valid, error = self._validate_tags(tags)
        if not is_valid:
            raise ValueError(f"Invalid tags for {file_name}: {error}")

        # ... ×§×•×“ ×§×™×™× ...

        # ×™×¦×™×¨×ª ×”××¡××š
        item_doc = {
            'collection_id': oid,
            'user_id': user_id,
            'source': source,
            'file_name': file_name,
            'note': note,
            'tags': tags,  # âœ¨ ×©××™×¨×ª ×ª×’×™×•×ª
            'pinned': False,
            'custom_order': 0,
            'workspace_state': None,
            'added_at': datetime.utcnow(),
            'updated_at': datetime.utcnow()
        }

        # ... ×”××©×š ×§×•×“ ×§×™×™× ...
```

### 4. ×¤×•× ×§×¦×™×” ×—×“×©×”: `update_item_tags()`

×”×•×¡×£ ××ª×•×“×” ×—×“×©×” ×œ-`CollectionsManager`:

```python
def update_item_tags(self, user_id, item_id, tags):
    """
    ×¢×“×›×•×Ÿ ×ª×’×™×•×ª ×©×œ ×¤×¨×™×˜ ×§×™×™× ×‘××•×¡×£.

    Args:
        user_id: ××–×”×” ××©×ª××©
        item_id: ××–×”×” ×”×¤×¨×™×˜ (collection_item _id)
        tags: ×¨×©×™××ª ×ª×’×™×•×ª ×—×“×©×”

    Returns:
        dict: ×”×¤×¨×™×˜ ×”××¢×•×“×›×Ÿ ××• None
    """
    # ×•×œ×™×“×¦×™×”
    is_valid, error = self._validate_tags(tags)
    if not is_valid:
        raise ValueError(f"Invalid tags: {error}")

    try:
        item_id_obj = ObjectId(item_id)
    except:
        return None

    # ×¢×“×›×•×Ÿ ×‘××¡×“ ×”× ×ª×•× ×™×
    result = self.db.collection_items.update_one(
        {
            '_id': item_id_obj,
            'user_id': user_id  # ACL check
        },
        {
            '$set': {
                'tags': tags,
                'updated_at': datetime.utcnow()
            }
        }
    )

    if result.matched_count == 0:
        return None

    # ×§×¨×™××ª ×”×¤×¨×™×˜ ×”××¢×•×“×›×Ÿ
    item = self.db.collection_items.find_one({'_id': item_id_obj})

    # ×‘×™×˜×•×œ cache
    if item:
        cid = item['collection_id']
        cache.delete_pattern(f"collections_items:{user_id}:{cid}:*")
        cache.delete_pattern(f"collections_detail:{user_id}:{cid}")

    emit_event('collections_item_tags_update', {
        'user_id': user_id,
        'item_id': str(item_id),
        'tags': tags
    })

    return self._public_item(item) if item else None
```

### 5. ×¢×“×›×•×Ÿ `_public_item()` ×œ×”×—×–×¨×ª ×ª×’×™×•×ª

×•×•×“× ×©-`_public_item()` ××—×–×™×¨×” ××ª ×©×“×” ×”-`tags`:

```python
def _public_item(self, doc):
    """×”××¨×ª ××¡××š ×¤×¨×™×˜ ×œ××‘× ×” ×¦×™×‘×•×¨×™"""
    if not doc:
        return None

    return {
        'id': str(doc['_id']),
        'source': doc.get('source', 'regular'),
        'file_name': doc.get('file_name'),
        'note': doc.get('note', ''),
        'tags': doc.get('tags', []),  # âœ¨ ×”×—×–×¨×ª ×ª×’×™×•×ª
        'pinned': doc.get('pinned', False),
        'custom_order': doc.get('custom_order', 0),
        'workspace_state': doc.get('workspace_state'),
        'added_at': doc.get('added_at'),
        'updated_at': doc.get('updated_at')
    }
```

### 6. ×¤×•× ×§×¦×™×” ×œ×§×‘×œ×ª ××˜××“××˜×” ×©×œ ×ª×’×™×•×ª

```python
def get_tags_metadata(self):
    """
    ×”×—×–×¨×ª ××˜××“××˜×” ×¢×œ ×›×œ ×”×ª×’×™×•×ª ×”×–××™× ×•×ª.

    Returns:
        dict: {
            'allowed_tags': [...],
            'categories': {...},
            'metadata': {...}
        }
    """
    return {
        'allowed_tags': ALLOWED_TAGS,
        'categories': TAG_CATEGORIES,
        'metadata': TAG_METADATA
    }
```

### 7. ××™× ×“×§×¡ ×‘××¡×“ ×”× ×ª×•× ×™×

×”×•×¡×£ ××™× ×“×§×¡ ×œ×©×“×” `tags` ×œ×¦×•×¨×š ×—×™×¤×•×© ××”×™×¨:

```python
# ×‘×¤×•× ×§×¦×™×” ensure_indexes() ××• ×‘-migration script
self.db.collection_items.create_index([
    ('collection_id', 1),
    ('tags', 1)
])
```

---

## ×©×™× ×•×™×™× × ×“×¨×©×™× ×‘-Frontend

### 1. API Functions

**×§×•×‘×¥:** `webapp/static/js/collections.js`

×”×•×¡×£ ×‘×ª×•×š ××•×‘×™×™×§×˜ ×”-`api`:

```javascript
const api = {
    // ... ×¤×•× ×§×¦×™×•×ª ×§×™×™××•×ª ...

    /**
     * ×¢×“×›×•×Ÿ ×ª×’×™×•×ª ×©×œ ×¤×¨×™×˜ ×‘××•×¡×£
     */
    updateItemTags(itemId, tags) {
        return fetch(`/api/collections/items/${itemId}/tags`, {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ tags })
        }).then(r => r.json());
    },

    /**
     * ×§×‘×œ×ª ××˜××“××˜×” ×©×œ ×ª×’×™×•×ª ×–××™× ×•×ª
     */
    getTagsMetadata() {
        return fetch('/api/collections/tags/metadata')
            .then(r => r.json());
    }
};
```

### 2. ×§×‘×•×¢×™× ×’×œ×•×‘×œ×™×™×

×”×•×¡×£ ×‘×ª×—×™×œ×ª ×”×§×•×‘×¥:

```javascript
// ×ª×’×™×•×ª ×–××™× ×•×ª (×™×˜×¢×Ÿ ××”×©×¨×ª)
let TAGS_METADATA = null;

// ××˜×-××™×“×¢ ×¢×œ ×ª×’×™×•×ª (default ×¢×“ ×©×™×˜×¢×Ÿ ××”×©×¨×ª)
const DEFAULT_TAGS_METADATA = {
    allowed_tags: [
        'ğŸ¢', 'ğŸ”¥', 'ğŸ”®', 'â™¥ï¸', 'ğŸ”', 'ğŸ’­',
        'â¸ï¸', 'ğŸ¯', 'ğŸ›', 'ğŸ—„ï¸', 'ğŸ§ª',
        '1ï¸âƒ£', '2ï¸âƒ£', '3ï¸âƒ£'
    ],
    categories: {
        priority: ['ğŸ¢', 'ğŸ”¥'],
        sentiment: ['ğŸ”®', 'â™¥ï¸'],
        security: ['ğŸ”'],
        status: ['ğŸ’­', 'â¸ï¸', 'ğŸ¯'],
        category: ['ğŸ›', 'ğŸ—„ï¸', 'ğŸ§ª'],
        order: ['1ï¸âƒ£', '2ï¸âƒ£', '3ï¸âƒ£']
    },
    metadata: {
        'ğŸ¢': { name_he: '×œ× ×“×—×•×£', name_en: 'low priority', category: 'priority' },
        'ğŸ”¥': { name_he: '×“×—×•×£', name_en: 'urgent', category: 'priority' },
        'ğŸ”®': { name_he: '×§×¡×•×', name_en: 'magic', category: 'sentiment' },
        'â™¥ï¸': { name_he: '××•×¢×“×£', name_en: 'favorite', category: 'sentiment' },
        'ğŸ”': { name_he: '×¡×•×“×™', name_en: 'secret', category: 'security' },
        'ğŸ’­': { name_he: '×¨×¢×™×•×Ÿ', name_en: 'idea', category: 'status' },
        'â¸ï¸': { name_he: '××•×©×”×”', name_en: 'paused', category: 'status' },
        'ğŸ¯': { name_he: '××˜×¨×”', name_en: 'goal', category: 'status' },
        'ğŸ›': { name_he: '×‘××’', name_en: 'bug', category: 'category' },
        'ğŸ—„ï¸': { name_he: '×“××˜×”-×‘×™×™×¡', name_en: 'database', category: 'category' },
        'ğŸ§ª': { name_he: '× ×™×¡×™×•× ×™', name_en: 'experimental', category: 'category' },
        '1ï¸âƒ£': { name_he: '×¨××©×•×Ÿ', name_en: 'first', category: 'order' },
        '2ï¸âƒ£': { name_he: '×©× ×™', name_en: 'second', category: 'order' },
        '3ï¸âƒ£': { name_he: '×©×œ×™×©×™', name_en: 'third', category: 'order' }
    }
};
```

### 3. ×˜×¢×™× ×ª ××˜××“××˜×” ×‘×¢×ª ××ª×—×•×œ

```javascript
/**
 * ××ª×—×•×œ ××˜××“××˜×” ×©×œ ×ª×’×™×•×ª
 */
async function initTagsMetadata() {
    try {
        const resp = await api.getTagsMetadata();
        if (resp.ok) {
            TAGS_METADATA = resp;
        } else {
            TAGS_METADATA = DEFAULT_TAGS_METADATA;
        }
    } catch (err) {
        console.error('Failed to load tags metadata:', err);
        TAGS_METADATA = DEFAULT_TAGS_METADATA;
    }
}

// ×§×¨×™××” ×‘××ª×—×•×œ
document.addEventListener('DOMContentLoaded', async () => {
    await initTagsMetadata();
    // ... ×”××©×š ××ª×—×•×œ ×§×™×™× ...
});
```

### 4. ×¨×™× ×“×•×¨ ×ª×’×™×•×ª ×‘×¤×¨×™×˜

×”×•×¡×£ ×¤×•× ×§×¦×™×” ×œ×¨×™× ×“×•×¨ ×ª×’×™×•×ª:

```javascript
/**
 * ×‘× ×™×™×ª HTML ×œ×ª×’×™×•×ª ×©×œ ×¤×¨×™×˜
 * @param {Array} tags - ×¨×©×™××ª ×ª×’×™×•×ª (××™××•×’'×™×)
 * @param {String} itemId - ××–×”×” ×”×¤×¨×™×˜
 * @returns {String} HTML
 */
function buildItemTagsHtml(tags, itemId) {
    if (!tags || tags.length === 0) {
        return `<span class="item-tags-empty" data-item-id="${itemId}">××™×Ÿ ×ª×’×™×•×ª</span>`;
    }

    const meta = TAGS_METADATA || DEFAULT_TAGS_METADATA;

    const tagsHtml = tags.map(tag => {
        const info = meta.metadata[tag] || {};
        const tooltip = info.name_he || tag;
        return `<span class="item-tag" data-tag="${tag}" title="${tooltip}">${tag}</span>`;
    }).join('');

    return `<div class="item-tags" data-item-id="${itemId}">${tagsHtml}</div>`;
}
```

### 5. ×¢×“×›×•×Ÿ ×¨×™× ×“×•×¨ ×¤×¨×™×˜ ×‘×œ×™×¡×˜×”

×¢×“×›×Ÿ ××ª ×”×¤×•× ×§×¦×™×” ×©××¨× ×“×¨×ª ×¤×¨×™×˜×™× ×›×“×™ ×œ×›×œ×•×œ ×ª×’×™×•×ª:

```javascript
/**
 * ×¨×™× ×“×•×¨ ×¤×¨×™×˜ ×‘×•×“×“ ×‘×¨×©×™××” (×¢×“×›×•×Ÿ ×œ×§×•×“ ×§×™×™×)
 */
function renderCollectionItem(item) {
    const { id, file_name, source, pinned, tags = [] } = item;

    const tagsHtml = buildItemTagsHtml(tags, id);

    return `
        <div class="collection-item"
             data-item-id="${id}"
             data-source="${source}"
             data-name="${file_name}"
             data-pinned="${pinned ? '1' : '0'}">
            <span class="drag-handle">â‹®â‹®</span>
            <a class="item-file-name" href="#">${file_name}</a>
            ${tagsHtml}
            <div class="item-actions">
                <button class="btn-tag-edit" data-item-id="${id}" title="×¢×¨×•×š ×ª×’×™×•×ª">ğŸ·ï¸</button>
                <button class="btn-preview" data-item-id="${id}" title="×ª×¦×•×’×” ××§×“×™××”">ğŸ§¾</button>
                <button class="btn-remove" data-item-id="${id}" title="×”×¡×¨">âœ•</button>
            </div>
        </div>
    `;
}
```

### 6. ××•×“×œ ×¢×¨×™×›×ª ×ª×’×™×•×ª

×¦×•×¨ ×¤×•× ×§×¦×™×” ×œ×¤×ª×™×—×ª ××•×“×œ ×¢×¨×™×›×ª ×ª×’×™×•×ª:

```javascript
/**
 * ×¤×ª×™×—×ª ××•×“×œ ×œ×¢×¨×™×›×ª ×ª×’×™×•×ª ×©×œ ×¤×¨×™×˜
 * @param {String} itemId - ××–×”×” ×”×¤×¨×™×˜
 * @param {Array} currentTags - ×ª×’×™×•×ª × ×•×›×—×™×•×ª
 */
function openTagsEditorModal(itemId, currentTags = []) {
    const meta = TAGS_METADATA || DEFAULT_TAGS_METADATA;

    // ×‘× ×™×™×ª HTML ×©×œ ×‘×•×—×¨ ×ª×’×™×•×ª ×œ×¤×™ ×§×˜×’×•×¨×™×•×ª
    let categoriesHtml = '';

    Object.entries(meta.categories).forEach(([catKey, catTags]) => {
        const categoryNames = {
            priority: '×¢×“×™×¤×•×ª',
            sentiment: '×¡× ×˜×™×× ×˜',
            security: '××‘×˜×—×”',
            status: '×¡×˜×˜×•×¡',
            category: '×§×˜×’×•×¨×™×”',
            order: '×¡×“×¨'
        };

        const catName = categoryNames[catKey] || catKey;

        const tagsHtml = catTags.map(tag => {
            const info = meta.metadata[tag] || {};
            const selected = currentTags.includes(tag) ? 'selected' : '';
            return `
                <button class="tag-option ${selected}"
                        data-tag="${tag}"
                        title="${info.name_he || tag}">
                    ${tag}
                    <span class="tag-name">${info.name_he || ''}</span>
                </button>
            `;
        }).join('');

        categoriesHtml += `
            <div class="tag-category">
                <h4 class="tag-category-title">${catName}</h4>
                <div class="tag-category-options">
                    ${tagsHtml}
                </div>
            </div>
        `;
    });

    const modalHtml = `
        <div class="modal tags-editor-modal" id="tagsEditorModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>×¢×¨×™×›×ª ×ª×’×™×•×ª</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="tags-selected-preview">
                        <strong>×ª×’×™×•×ª × ×‘×—×¨×•×ª:</strong>
                        <div class="selected-tags-container">
                            ${currentTags.length > 0
                                ? currentTags.map(t => `<span class="selected-tag">${t}</span>`).join('')
                                : '<span class="no-tags">×œ× × ×‘×—×¨×• ×ª×’×™×•×ª</span>'}
                        </div>
                    </div>
                    <div class="tags-categories">
                        ${categoriesHtml}
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" id="saveTagsBtn">×©××•×¨</button>
                    <button class="btn btn-secondary modal-close">×‘×™×˜×•×œ</button>
                </div>
            </div>
        </div>
    `;

    // ×”×•×¡×¤×ª ×”××•×“×œ ×œ-DOM
    const existingModal = document.getElementById('tagsEditorModal');
    if (existingModal) existingModal.remove();

    document.body.insertAdjacentHTML('beforeend', modalHtml);
    const modal = document.getElementById('tagsEditorModal');

    // Selected tags state
    let selectedTags = [...currentTags];

    // Event listeners ×œ×‘×—×™×¨×ª ×ª×’×™×•×ª
    modal.querySelectorAll('.tag-option').forEach(btn => {
        btn.addEventListener('click', () => {
            const tag = btn.dataset.tag;

            if (selectedTags.includes(tag)) {
                // ×”×¡×¨×ª ×ª×’×™×ª
                selectedTags = selectedTags.filter(t => t !== tag);
                btn.classList.remove('selected');
            } else {
                // ×”×•×¡×¤×ª ×ª×’×™×ª
                if (selectedTags.length >= 10) {
                    showToast('× ×™×ª×Ÿ ×œ×‘×—×•×¨ ×¢×“ 10 ×ª×’×™×•×ª', 'warning');
                    return;
                }
                selectedTags.push(tag);
                btn.classList.add('selected');
            }

            // ×¢×“×›×•×Ÿ ×ª×¦×•×’×ª ×ª×’×™×•×ª × ×‘×—×¨×•×ª
            updateSelectedTagsPreview();
        });
    });

    // ×¢×“×›×•×Ÿ ×ª×¦×•×’×”
    function updateSelectedTagsPreview() {
        const container = modal.querySelector('.selected-tags-container');
        if (selectedTags.length === 0) {
            container.innerHTML = '<span class="no-tags">×œ× × ×‘×—×¨×• ×ª×’×™×•×ª</span>';
        } else {
            container.innerHTML = selectedTags
                .map(t => `<span class="selected-tag">${t}</span>`)
                .join('');
        }
    }

    // ×©××™×¨×ª ×ª×’×™×•×ª
    document.getElementById('saveTagsBtn').addEventListener('click', async () => {
        try {
            const resp = await api.updateItemTags(itemId, selectedTags);
            if (resp.ok) {
                showToast('×”×ª×’×™×•×ª ×¢×•×“×›× ×• ×‘×”×¦×œ×—×”', 'success');
                modal.remove();

                // ×¨×¢× ×•×Ÿ ×ª×¦×•×’×ª ×”×¤×¨×™×˜
                await renderCollectionItems(currentCollectionId);
            } else {
                showToast(resp.error || '×©×’×™××” ×‘×¢×“×›×•×Ÿ ×ª×’×™×•×ª', 'error');
            }
        } catch (err) {
            console.error('Error updating tags:', err);
            showToast('×©×’×™××” ×‘×¢×“×›×•×Ÿ ×ª×’×™×•×ª', 'error');
        }
    });

    // ×¡×’×™×¨×ª ××•×“×œ
    modal.querySelectorAll('.modal-close').forEach(btn => {
        btn.addEventListener('click', () => modal.remove());
    });

    // ×¡×’×™×¨×” ×‘×œ×—×™×¦×” ××—×•×¥ ×œ××•×“×œ
    modal.addEventListener('click', (e) => {
        if (e.target === modal) modal.remove();
    });

    // ×”×¦×’×ª ×”××•×“×œ
    modal.style.display = 'flex';
}
```

### 7. Event Listeners ×œ×›×¤×ª×•×¨ ×¢×¨×™×›×ª ×ª×’×™×•×ª

×”×•×¡×£ event delegation ×œ×›×¤×ª×•×¨ ×¢×¨×™×›×ª ×”×ª×’×™×•×ª:

```javascript
/**
 * Wire up tags editor button clicks
 */
function wireTagsEditorButtons(container) {
    container.addEventListener('click', (e) => {
        const btn = e.target.closest('.btn-tag-edit');
        if (!btn) return;

        e.preventDefault();
        e.stopPropagation();

        const itemId = btn.dataset.itemId;
        const itemEl = container.querySelector(`[data-item-id="${itemId}"]`);

        // ××¦×™××ª ×ª×’×™×•×ª × ×•×›×—×™×•×ª
        let currentTags = [];
        const tagsContainer = itemEl.querySelector('.item-tags');
        if (tagsContainer) {
            currentTags = Array.from(tagsContainer.querySelectorAll('.item-tag'))
                .map(el => el.dataset.tag);
        }

        openTagsEditorModal(itemId, currentTags);
    });
}

// ×§×¨×™××” ×œ×¤×•× ×§×¦×™×” ×–×• ×‘×¢×ª ×¨×™× ×“×•×¨ ×”××•×¡×£
function renderCollectionItems(collectionId) {
    // ... ×§×•×“ ×§×™×™× ...

    const contentArea = document.querySelector('.collections-content');
    wireTagsEditorButtons(contentArea);

    // ... ×”××©×š ×§×•×“ ...
}
```

---

## UI/UX Components

### 1. ×¡×˜×™×™×œ×™× ×’ CSS

**×§×•×‘×¥:** `webapp/static/css/collections.css`

×”×•×¡×£ CSS ×¢×‘×•×¨ ×ª×’×™×•×ª:

```css
/* ========== Item Tags Styling ========== */

.item-tags {
    display: inline-flex;
    gap: 4px;
    align-items: center;
    margin: 0 8px;
    flex-wrap: wrap;
}

.item-tag {
    display: inline-flex;
    align-items: center;
    font-size: 16px;
    padding: 2px 4px;
    border-radius: 4px;
    background: var(--bg-secondary, #f0f0f0);
    cursor: help;
    transition: transform 0.15s;
}

.item-tag:hover {
    transform: scale(1.15);
}

.item-tags-empty {
    font-size: 12px;
    color: var(--text-muted, #999);
    font-style: italic;
}

/* ========== Tags Editor Modal ========== */

.tags-editor-modal .modal-content {
    max-width: 600px;
    max-height: 80vh;
    overflow-y: auto;
}

.tags-selected-preview {
    margin-bottom: 20px;
    padding: 12px;
    background: var(--bg-secondary, #f5f5f5);
    border-radius: 8px;
}

.selected-tags-container {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
    margin-top: 8px;
}

.selected-tag {
    font-size: 20px;
    padding: 4px 8px;
    background: var(--color-primary, #4a90e2);
    color: white;
    border-radius: 6px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.no-tags {
    font-size: 13px;
    color: var(--text-muted, #999);
    font-style: italic;
}

/* ========== Tag Categories ========== */

.tags-categories {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.tag-category {
    border: 1px solid var(--border-color, #e0e0e0);
    border-radius: 8px;
    padding: 12px;
    background: var(--bg-primary, white);
}

.tag-category-title {
    font-size: 14px;
    font-weight: 600;
    margin: 0 0 10px 0;
    color: var(--text-primary, #333);
}

.tag-category-options {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.tag-option {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 6px 10px;
    font-size: 18px;
    border: 2px solid var(--border-color, #ddd);
    border-radius: 8px;
    background: var(--bg-primary, white);
    cursor: pointer;
    transition: all 0.2s;
}

.tag-option:hover {
    border-color: var(--color-primary, #4a90e2);
    transform: scale(1.05);
}

.tag-option.selected {
    border-color: var(--color-primary, #4a90e2);
    background: var(--color-primary-light, #e3f2fd);
    box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
}

.tag-name {
    font-size: 12px;
    color: var(--text-secondary, #666);
}

/* ========== Item Actions with Tag Button ========== */

.item-actions {
    display: flex;
    gap: 4px;
    align-items: center;
    margin-right: auto;
}

.btn-tag-edit {
    padding: 4px 8px;
    font-size: 16px;
    border: none;
    background: transparent;
    cursor: pointer;
    border-radius: 4px;
    transition: background 0.2s;
}

.btn-tag-edit:hover {
    background: var(--bg-hover, #f0f0f0);
}

/* ========== Dark Mode Support ========== */

[data-theme="dark"] .item-tag {
    background: var(--bg-tertiary, #2a2a2a);
}

[data-theme="dark"] .tags-selected-preview {
    background: var(--bg-tertiary, #2a2a2a);
}

[data-theme="dark"] .tag-category {
    background: var(--bg-secondary, #1e1e1e);
    border-color: var(--border-color, #444);
}

[data-theme="dark"] .tag-option {
    background: var(--bg-secondary, #1e1e1e);
    border-color: var(--border-color, #444);
}

[data-theme="dark"] .tag-option.selected {
    background: var(--color-primary-dark, #1e4d7b);
}
```

### 2. ×¢×“×›×•×Ÿ ××‘× ×” HTML ×©×œ ×¤×¨×™×˜

×”××‘× ×” ×”××¢×•×“×›×Ÿ ×©×œ ×¤×¨×™×˜ ×‘×¨×©×™××”:

```html
<div class="collection-item" data-item-id="ABC123" data-source="regular" data-name="file.py">
    <span class="drag-handle">â‹®â‹®</span>
    <a class="item-file-name" href="#">file.py</a>

    <!-- ×ª×’×™×•×ª -->
    <div class="item-tags" data-item-id="ABC123">
        <span class="item-tag" data-tag="ğŸ”¥" title="×“×—×•×£">ğŸ”¥</span>
        <span class="item-tag" data-tag="ğŸ›" title="×‘××’">ğŸ›</span>
        <span class="item-tag" data-tag="1ï¸âƒ£" title="×¨××©×•×Ÿ">1ï¸âƒ£</span>
    </div>

    <!-- ×¤×¢×•×œ×•×ª -->
    <div class="item-actions">
        <button class="btn-tag-edit" data-item-id="ABC123" title="×¢×¨×•×š ×ª×’×™×•×ª">ğŸ·ï¸</button>
        <button class="btn-preview" data-item-id="ABC123" title="×ª×¦×•×’×” ××§×“×™××”">ğŸ§¾</button>
        <button class="btn-remove" data-item-id="ABC123" title="×”×¡×¨">âœ•</button>
    </div>
</div>
```

### 3. ×ª××™×›×” ×‘-Workspace Kanban

×¢×“×›×•×Ÿ ×›×¨×˜×™×¡×™ ×”×§× ×‘×Ÿ ×›×“×™ ×œ×”×¦×™×’ ×ª×’×™×•×ª:

```javascript
function buildWorkspaceCardHtml(item) {
    const { id, file_name, tags = [] } = item;
    const tagsHtml = buildItemTagsHtml(tags, id);

    return `
        <div class="workspace-card" data-item-id="${id}">
            <button class="workspace-card__drag">â‹®â‹®</button>
            <div class="workspace-card__body">
                <div class="workspace-card__name">${file_name}</div>
                ${tagsHtml}
                <div class="workspace-card__meta">× ×•×¡×£ ${formatDate(item.added_at)}</div>
            </div>
            <div class="workspace-card__actions">
                <button class="btn-tag-edit" data-item-id="${id}">ğŸ·ï¸</button>
                <button class="btn-preview" data-item-id="${id}">ğŸ§¾</button>
                <button class="btn-remove" data-item-id="${id}">âœ•</button>
            </div>
        </div>
    `;
}
```

---

## ×“×•×’×××•×ª ×§×•×“

### Backend API Endpoint

**×§×•×‘×¥:** `webapp/collections_api.py`

```python
@collections_bp.route('/items/<item_id>/tags', methods=['PATCH'])
@require_auth
@traced()
def update_item_tags(item_id):
    """
    ×¢×“×›×•×Ÿ ×ª×’×™×•×ª ×©×œ ×¤×¨×™×˜ ×‘××•×¡×£.

    Body: {"tags": ["ğŸ”¥", "ğŸ›"]}
    """
    user_id = session['user_id']
    data = request.get_json() or {}
    tags = data.get('tags', [])

    mgr = CollectionsManager()

    try:
        updated_item = mgr.update_item_tags(user_id, item_id, tags)

        if not updated_item:
            return jsonify({'ok': False, 'error': 'Item not found'}), 404

        return jsonify({
            'ok': True,
            'item': updated_item
        })

    except ValueError as e:
        return jsonify({'ok': False, 'error': str(e)}), 400
    except Exception as e:
        logger.exception(f'Error updating item tags: {e}')
        emit_event('collections_item_tags_update_error', {
            'user_id': user_id,
            'item_id': item_id,
            'error': str(e)
        })
        return jsonify({'ok': False, 'error': 'Internal error'}), 500


@collections_bp.route('/tags/metadata', methods=['GET'])
@traced()
def get_tags_metadata():
    """
    ×§×‘×œ×ª ××˜××“××˜×” ×©×œ ×ª×’×™×•×ª ×–××™× ×•×ª.
    """
    mgr = CollectionsManager()
    metadata = mgr.get_tags_metadata()

    return jsonify({
        'ok': True,
        **metadata
    })
```

### Frontend - ×”×•×¡×¤×ª ×¤×¨×™×˜ ×¢× ×ª×’×™×•×ª

```javascript
async function addFileToCollection(collectionId, fileName, tags = []) {
    const resp = await api.addItems(collectionId, [
        {
            source: 'regular',
            file_name: fileName,
            note: '',
            tags: tags  // âœ¨ ×ª×’×™×•×ª
        }
    ]);

    if (resp.ok) {
        showToast('×”×§×•×‘×¥ × ×•×¡×£ ×‘×”×¦×œ×—×”', 'success');
        await renderCollectionItems(collectionId);
    } else {
        showToast(resp.error || '×©×’×™××” ×‘×”×•×¡×¤×ª ×§×•×‘×¥', 'error');
    }
}

// ×“×•×’××ª ×©×™××•×©
addFileToCollection('collection123', 'auth.py', ['ğŸ”¥', 'ğŸ›', '1ï¸âƒ£']);
```

### ×¡×™× ×•×Ÿ ×¤×¨×™×˜×™× ×œ×¤×™ ×ª×’×™×•×ª (Frontend)

```javascript
/**
 * ×¡×™× ×•×Ÿ ×¤×¨×™×˜×™× ×œ×¤×™ ×ª×’×™×•×ª
 * @param {Array} items - ×›×œ ×”×¤×¨×™×˜×™×
 * @param {Array} filterTags - ×ª×’×™×•×ª ×œ×¡×™× ×•×Ÿ
 * @returns {Array} ×¤×¨×™×˜×™× ××¡×•× × ×™×
 */
function filterItemsByTags(items, filterTags) {
    if (!filterTags || filterTags.length === 0) {
        return items;
    }

    return items.filter(item => {
        const itemTags = item.tags || [];
        // ×‘×“×™×§×” ×× ×”×¤×¨×™×˜ ××›×™×œ ×œ×¤×—×•×ª ××—×ª ××”×ª×’×™×•×ª
        return filterTags.some(tag => itemTags.includes(tag));
    });
}

// ×“×•×’××”: ×”×¦×’×ª ×¨×§ ×¤×¨×™×˜×™× ×“×—×•×¤×™×
const urgentItems = filterItemsByTags(allItems, ['ğŸ”¥']);
```

---

## ×©×œ×‘×™ ××™××•×© ××•××œ×¦×™×

### ×©×œ×‘ 1: Backend Infrastructure (×™×•× 1)

1. **×¢×“×›×•×Ÿ `collections_manager.py`:**
   - âœ… ×”×•×¡×¤×ª ×§×‘×•×¢×™×: `ALLOWED_TAGS`, `TAG_CATEGORIES`, `TAG_METADATA`
   - âœ… ×¤×•× ×§×¦×™×™×ª `_validate_tags()`
   - âœ… ×¢×“×›×•×Ÿ `add_items()` ×œ×ª××™×›×” ×‘×ª×’×™×•×ª
   - âœ… ×¤×•× ×§×¦×™×” ×—×“×©×” `update_item_tags()`
   - âœ… ×¢×“×›×•×Ÿ `_public_item()` ×œ×”×—×–×¨×ª tags
   - âœ… ×¤×•× ×§×¦×™×” `get_tags_metadata()`

2. **××™× ×“×§×¡ ×‘××¡×“ × ×ª×•× ×™×:**
   ```bash
   # ×”×¨×¦×ª script ×œ×™×¦×™×¨×ª ××™× ×“×§×¡
   python -c "from database.collections_manager import CollectionsManager; mgr = CollectionsManager(); mgr.db.collection_items.create_index([('collection_id', 1), ('tags', 1)])"
   ```

3. **×™×—×™×“×•×ª ×‘×“×™×§×”:**
   - ×‘×“×™×§×ª validation ×©×œ ×ª×’×™×•×ª
   - ×‘×“×™×§×ª ×”×•×¡×¤×ª ×¤×¨×™×˜ ×¢× ×ª×’×™×•×ª
   - ×‘×“×™×§×ª ×¢×“×›×•×Ÿ ×ª×’×™×•×ª
   - ×‘×“×™×§×ª ×”×—×–×¨×ª metadata

### ×©×œ×‘ 2: API Layer (×™×•× 1-2)

1. **×¢×“×›×•×Ÿ `collections_api.py`:**
   - âœ… Endpoint: `PATCH /api/collections/items/<item_id>/tags`
   - âœ… Endpoint: `GET /api/collections/tags/metadata`
   - âœ… ×¢×“×›×•×Ÿ response ×©×œ `GET /api/collections/<id>/items` ×œ×”×—×–×™×¨ tags

2. **×‘×“×™×§×•×ª API:**
   ```bash
   # ×‘×“×™×§×” ×™×“× ×™×ª ×¢× curl
   curl -X PATCH http://localhost:5000/api/collections/items/ABC123/tags \
     -H "Content-Type: application/json" \
     -d '{"tags": ["ğŸ”¥", "ğŸ›"]}'
   ```

### ×©×œ×‘ 3: Frontend - Core Functionality (×™×•× 2-3)

1. **×¢×“×›×•×Ÿ `collections.js`:**
   - âœ… ×”×•×¡×¤×ª `api.updateItemTags()`
   - âœ… ×”×•×¡×¤×ª `api.getTagsMetadata()`
   - âœ… ×¤×•× ×§×¦×™×” `initTagsMetadata()`
   - âœ… ×¤×•× ×§×¦×™×” `buildItemTagsHtml()`
   - âœ… ×¢×“×›×•×Ÿ `renderCollectionItem()` ×œ×”×¦×’×ª ×ª×’×™×•×ª

2. **×‘×“×™×§×•×ª ×™×“× ×™×•×ª:**
   - ×¤×ª×™×—×ª ×“×£ Collections
   - ×•×™×“×•× ×˜×¢×™× ×ª metadata
   - ×•×™×“×•× ×”×¦×’×ª ×ª×’×™×•×ª ×‘×¤×¨×™×˜×™× ×§×™×™××™×

### ×©×œ×‘ 4: Tags Editor UI (×™×•× 3-4)

1. **×¤×™×ª×•×— ××•×“×œ ×¢×¨×™×›×”:**
   - âœ… ×¤×•× ×§×¦×™×” `openTagsEditorModal()`
   - âœ… Event listeners ×œ×‘×—×™×¨×ª ×ª×’×™×•×ª
   - âœ… ×¢×“×›×•×Ÿ ×ª×¦×•×’×” ×‘×–××Ÿ ×××ª
   - âœ… ×©××™×¨×ª ×ª×’×™×•×ª

2. **Wire up ×›×¤×ª×•×¨ ×¢×¨×™×›×”:**
   - âœ… ×¤×•× ×§×¦×™×” `wireTagsEditorButtons()`
   - âœ… ×”×•×¡×¤×ª ×›×¤×ª×•×¨ ğŸ·ï¸ ×‘×›×œ ×¤×¨×™×˜

### ×©×œ×‘ 5: CSS Styling (×™×•× 4)

1. **×¢×“×›×•×Ÿ `collections.css`:**
   - âœ… ×¡×˜×™×™×œ×™× ×’ `.item-tags`, `.item-tag`
   - âœ… ×¡×˜×™×™×œ×™× ×’ `.tags-editor-modal`
   - âœ… ×¡×˜×™×™×œ×™× ×’ `.tag-category`, `.tag-option`
   - âœ… ×ª××™×›×” ×‘-Dark Mode

2. **×‘×“×™×§×•×ª UI:**
   - ×ª×¦×•×’×” ×ª×§×™× ×” ×‘××¦×‘ Light/Dark
   - Responsive design (<900px)
   - Accessibility (keyboard navigation)

### ×©×œ×‘ 6: Workspace Integration (×™×•× 5)

1. **×¢×“×›×•×Ÿ Kanban Board:**
   - âœ… ×¢×“×›×•×Ÿ `buildWorkspaceCardHtml()` ×œ×”×¦×’×ª ×ª×’×™×•×ª
   - âœ… Wire up ×›×¤×ª×•×¨ ×¢×¨×™×›×” ×‘×›×¨×˜×™×¡×™×
   - âœ… ×ª××™×›×” ×‘-drag & drop ×¢× ×ª×’×™×•×ª

### ×©×œ×‘ 7: Advanced Features (××•×¤×¦×™×•× ×œ×™, ×™×•× 6-7)

1. **×¡×™× ×•×Ÿ ×œ×¤×™ ×ª×’×™×•×ª:**
   - ×¤×•× ×§×¦×™×” `filterItemsByTags()`
   - UI dropdown ×œ×¡×™× ×•×Ÿ
   - Cache ×ª×•×¦××•×ª ×¡×™× ×•×Ÿ

2. **××™×•×Ÿ ×œ×¤×™ ×ª×’×™×•×ª:**
   - ××™×•×Ÿ ×œ×¤×™ ×¢×“×™×¤×•×ª (ğŸ”¥ ×œ×¤× ×™ ğŸ¢)
   - ××™×•×Ÿ ×œ×¤×™ ×¡×“×¨ (1ï¸âƒ£ â†’ 2ï¸âƒ£ â†’ 3ï¸âƒ£)

3. **Bulk operations:**
   - ×‘×—×™×¨×ª ××¡×¤×¨ ×¤×¨×™×˜×™×
   - ×¢×“×›×•×Ÿ ×ª×’×™×•×ª ××¨×•×‘×•×ª ×‘×‘×ª ××—×ª

### ×©×œ×‘ 8: Testing & Polish (×™×•× 7-8)

1. **×‘×“×™×§×•×ª ××•×˜×•××˜×™×•×ª:**
   - Unit tests ×œ-Backend
   - Integration tests ×œ-API
   - E2E tests ×¢× Playwright/Selenium

2. **×‘×“×™×§×•×ª ×™×“× ×™×•×ª:**
   - Flow ××œ×: ×™×¦×™×¨×” â†’ ×¢×¨×™×›×” â†’ ××—×™×§×”
   - Edge cases (10 tags, Unicode, RTL)
   - Performance (1000+ items)

3. **×“×•×§×•×× ×˜×¦×™×”:**
   - ×¢×“×›×•×Ÿ `docs/user/my_collections.rst`
   - Changelog
   - Screenshots

---

## ×©×™×§×•×œ×™× × ×•×¡×¤×™×

### 1. ×‘×™×¦×•×¢×™× (Performance)

**××•×¤×˜×™××™×–×¦×™×•×ª:**
- ××™× ×“×§×¡ ×¢×œ ×©×“×” `tags` ×œ×—×™×¤×•×© ××”×™×¨
- Cache metadata ×©×œ ×ª×’×™×•×ª (TTL 1 hour)
- Lazy loading ×©×œ ×¤×¨×™×˜×™× ×¢× pagination
- Debounce ×¢×œ ×¢×“×›×•× ×™ tags (300ms)

**××“×“×™× ×œ× ×™×˜×•×¨:**
```python
# Time to fetch items with tags
# Time to update tags
# Cache hit rate for metadata
```

### 2. ××‘×˜×—×” (Security)

**×•×•×œ×™×“×¦×™×•×ª:**
- âœ… Whitelist ×§×¤×“× ×™×ª ×©×œ ×ª×’×™×•×ª
- âœ… ××’×‘×œ×” ×©×œ 10 tags per item
- âœ… ACL check - user_id filtering
- âœ… Sanitization ×©×œ input
- âœ… Rate limiting ×¢×œ API endpoints

**×× ×™×¢×ª XSS:**
```javascript
// ×›×‘×¨ ××˜×•×¤×œ - ××™××•×’'×™× ×”× Unicode safe
// ××š ×•×•×“× ×©×œ× ×××¤×©×¨×™× HTML/JavaScript ×‘×ª×’×™×•×ª
```

### 3. × ×’×™×©×•×ª (Accessibility)

**WCAG 2.1 AA:**
- Keyboard navigation ×‘××•×“×œ ×”×ª×’×™×•×ª (Tab, Enter, Escape)
- ARIA labels ×œ×›×¤×ª×•×¨×™×
- Focus management ×‘×¤×ª×™×—×ª/×¡×’×™×¨×ª ××•×“×œ
- Screen reader support (alt text ×œ××™××•×’'×™×)

```html
<button class="tag-option"
        role="checkbox"
        aria-checked="false"
        aria-label="×ª×’×™×ª ×“×—×•×£">
    ğŸ”¥ <span class="sr-only">×“×—×•×£</span>
</button>
```

### 4. Internationalization (i18n)

×”×ª×’×™×•×ª ×›×‘×¨ ×“×•-×œ×©×•× ×™×•×ª (`name_he`, `name_en`):

```javascript
const lang = document.documentElement.lang || 'he';
const tagName = TAG_METADATA[tag][`name_${lang}`];
```

### 5. Analytics & Observability

**××™×¨×•×¢×™× ×œ× ×™×˜×•×¨:**
```python
emit_event('collections_tags_added', {
    'user_id': user_id,
    'item_id': item_id,
    'tags': tags,
    'count': len(tags)
})

emit_event('collections_tags_removed', {...})
emit_event('collections_tags_filtered', {...})
```

**××˜×¨×™×§×•×ª:**
- ×›××” ××©×ª××©×™× ××©×ª××©×™× ×‘×ª×™×•×’?
- ××”×Ÿ ×”×ª×’×™×•×ª ×”×¤×•×¤×•×œ×¨×™×•×ª ×‘×™×•×ª×¨?
- ×›××” ×ª×’×™×•×ª ×‘×××•×¦×¢ ×œ×¤×¨×™×˜?

### 6. Migration ×©×œ × ×ª×•× ×™× ×§×™×™××™×

×× ×™×© ×¤×¨×™×˜×™× ×§×™×™××™× ×‘-DB:

```python
# Migration script
def migrate_existing_items_add_tags_field():
    """×”×•×¡×¤×ª ×©×“×” tags ×¨×™×§ ×œ×¤×¨×™×˜×™× ×§×™×™××™×"""
    from database.collections_manager import CollectionsManager

    mgr = CollectionsManager()
    result = mgr.db.collection_items.update_many(
        {'tags': {'$exists': False}},
        {'$set': {'tags': []}}
    )

    print(f"Updated {result.modified_count} items with empty tags field")

# ×”×¨×¦×”
if __name__ == '__main__':
    migrate_existing_items_add_tags_field()
```

### 7. Feature Flags

**×©×œ×‘×™ rollout:**
```python
# config.py
FEATURE_COLLECTIONS_TAGS = os.getenv('FEATURE_COLLECTIONS_TAGS', 'true').lower() == 'true'

# ×‘×§×•×“
if FEATURE_COLLECTIONS_TAGS:
    # ×”×¦×’×ª UI ×©×œ ×ª×’×™×•×ª
    pass
```

### 8. ×—×™×¤×•×© ×¢"×™ ×ª×’×™×•×ª (Smart Collections)

×”×¨×—×‘×” ×¢×ª×™×“×™×ª - ××¤×©×¨ ×œ×”×•×¡×™×£ ×œ×—×™×¤×•×© ×©×œ Smart Collections:

```python
# ×‘-CollectionsManager
def compute_smart_items(self, user_id, rules, limit=200):
    # ... ×§×•×“ ×§×™×™× ...

    # ×”×•×¡×¤×ª ×—×™×¤×•×© ×œ×¤×™ ×ª×’×™×•×ª
    if rules.get('tags'):
        pipeline.append({
            '$match': {
                'tags': {'$all': rules['tags']}  # ×›×œ ×”×ª×’×™×•×ª ×—×™×™×‘×•×ª ×œ×”×ª××™×
            }
        })
```

### 9. Export/Import ×©×œ ×ª×’×™×•×ª

×ª××™×›×” ×‘-export ×œ-JSON/CSV:

```javascript
function exportCollectionWithTags(collectionId) {
    const items = await api.getItems(collectionId);

    const csv = items.map(item => {
        return `${item.file_name},"${(item.tags || []).join(',')}",${item.note}`;
    }).join('\n');

    downloadFile('collection_export.csv', csv);
}
```

---

## ×¡×™×›×•×

### ××” ×›×œ×•×œ ×‘××“×¨×™×š ×–×”:

âœ… **××¨×›×™×˜×§×˜×•×¨×” ××¤×•×¨×˜×ª** ×©×œ My Collections ×”×§×™×™×
âœ… **××‘× ×” × ×ª×•× ×™×** ××•×¦×¢ ×œ×ª×™×•×’ ×¢× 14 ××™××•×’'×™×
âœ… **×©×™× ×•×™×™× Backend** - validation, CRUD, API endpoints
âœ… **×©×™× ×•×™×™× Frontend** - UI components, ××•×“×œ ×¢×¨×™×›×”, ×¨×™× ×“×•×¨
âœ… **CSS Styling** ××œ× ×¢× ×ª××™×›×” ×‘-Dark Mode
âœ… **×“×•×’×××•×ª ×§×•×“** ××•×›× ×•×ª ×œ×©×™××•×©
âœ… **×©×œ×‘×™ ××™××•×©** ×¦×¢×“-××—×¨-×¦×¢×“ (8 ×™××™×)
âœ… **×©×™×§×•×œ×™×** - ×‘×™×¦×•×¢×™×, ××‘×˜×—×”, × ×’×™×©×•×ª

### ×”×¦×¢×“×™× ×”×‘××™×:

1. **×ª×—×™×œ×ª ×¤×™×ª×•×—** - ×”×ª×—×œ ×‘×©×œ×‘ 1 (Backend Infrastructure)
2. **×¡×§×™×¨×ª ×§×•×“** - ×•×•×“× ×©×›×œ ×©×™× ×•×™ ×¢×•×‘×¨ code review
3. **×‘×“×™×§×•×ª** - ×›×ª×•×‘ tests ×œ×›×œ ×©×›×‘×”
4. **×“×•×§×•×× ×˜×¦×™×”** - ×¢×“×›×Ÿ ××ª ×ª×™×¢×•×“ ×”××©×ª××©
5. **Rollout** - ×”×©×§ ×‘×”×“×¨×’×” ×¢× feature flag

---

**× ×•×¦×¨ ×¢×‘×•×¨:** ×¤×¨×•×™×§×˜ CodeBot
**×’×¨×¡×”:** 1.0
**×ª××¨×™×š:** 2026-01-29
**×›×•×ª×‘:** Claude Code Assistant
