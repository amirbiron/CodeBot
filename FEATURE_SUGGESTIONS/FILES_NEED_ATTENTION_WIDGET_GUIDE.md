# ××“×¨×™×š ××™××•×©: ×•×•×™×“×’'×˜ "×§×‘×¦×™× ×©×“×•×¨×©×™× ×˜×™×¤×•×œ" ×‘×“×©×‘×•×¨×“ (v2)

> **××˜×¨×”:** ×•×•×™×“×’'×˜ ×‘×“×©×‘×•×¨×“ ×©××¨×›×– ×§×‘×¦×™× "×‘×¢×™×™×ª×™×™×" (×—×¡×¨×™ ×ª×™××•×¨/×ª×’×™×•×ª, ××• ×œ× ×¢×•×“×›× ×• ×–××Ÿ ×¨×‘) ×¢× ××¤×©×¨×•×ª ×œ×ª×™×§×•×Ÿ ××”×™×¨ ×™×©×™×¨×•×ª ××”×“×©×‘×•×¨×“.
>
> **×’×¨×¡×”:** 2.0 | **×¢×“×›×•×Ÿ ××—×¨×•×Ÿ:** 19/01/2026

---

## 1. ×¡×§×™×¨×” ×›×œ×œ×™×ª

### ××” ×”×•×•×™×“×’'×˜ ×¢×•×©×”
- **××¨×›×– ×§×‘×¦×™× ×©×“×•×¨×©×™× ×˜×™×¤×•×œ** ×‘×›×¨×˜×™×¡ ××—×“ ×‘×“×©×‘×•×¨×“
- **××—×•×œ×§ ×œ×©×ª×™ ×§×‘×•×¦×•×ª ×‘×œ×ª×™-×—×•×¤×¤×•×ª:**
  1. **"×—×¡×¨ ×ª×™××•×¨/×ª×’×™×•×ª"** â€” ×§×‘×¦×™× ×©××™×Ÿ ×œ×”× `description` ××• ×©×¨×©×™××ª ×”-`tags` ×¨×™×§×”/×—×¡×¨×”
  2. **"×œ× ×¢×•×“×›×Ÿ ×–××Ÿ ×¨×‘"** â€” ×§×‘×¦×™× ×©×”-`updated_at` ×©×œ×”× ×™×©×Ÿ ×-X ×™××™× (×‘×¨×™×¨×ª ××—×“×œ: 60), **×•×™×© ×œ×”× ××˜×-×“××˜×” ×ª×§×™×Ÿ**
- **××¦×™×¢ ×ª×™×§×•×Ÿ ××”×™×¨ (Quick Fix):**
  - ×”×•×¡×¤×ª ×ª×™××•×¨ inline
  - ×”×•×¡×¤×ª ×ª×’×™×•×ª (×§×œ×˜ ×˜×§×¡×˜ ××•×¤×¨×“ ×‘×¤×¡×™×§×™×)
  - ×¤×ª×™×—×” ×œ×¢×¨×™×›×” ××œ××”
  - ×“×—×™×™×”/×”×¡×ª×¨×” ×–×× ×™×ª ("×˜×¤×œ ×××•×—×¨ ×™×•×ª×¨")

### ×œ××” ×–×” ×©×™××•×©×™
- ××¦××¦× "×–×™×”×•×" ×©×œ ×§×‘×¦×™× ×œ× ××ª×•×¢×“×™×
- ×¢×•×–×¨ ×œ×–×›×•×¨ ×§×‘×¦×™× ×©× × ×˜×©×• ×‘×œ×™ ×œ×¤×ª×•×— ×—×™×¤×•×© ×™×“× ×™
- ××§×¦×¨ ×–××Ÿ: ×ª×™×§×•×Ÿ ×§×˜×Ÿ (×ª×™××•×¨/×ª×’×™×•×ª) ×‘×œ×—×™×¦×” ××—×ª

### ×”×‘×”×¨×” ×—×©×•×‘×”: "×œ× ×¢×•×“×›×Ÿ" vs "×œ× × ×¤×ª×—"
×”×•×•×™×“×’'×˜ ××‘×•×¡×¡ ×¢×œ ×©×“×” `updated_at` (××ª×™ ×”×§×•×‘×¥ × ×©××¨/×¢×•×“×›×Ÿ ×œ××—×¨×•× ×”).
**××™×Ÿ ×œ× ×• ×›×¨×’×¢ ×©×“×” `last_viewed_at`**, ×•×œ×›×Ÿ ×”××•× ×— ×”× ×›×•×Ÿ ×”×•× **"×œ× ×¢×•×“×›×Ÿ ×–××Ÿ ×¨×‘"** ×•×œ× "×œ× × ×¤×ª×—".
×× ×‘×¢×ª×™×“ × ×¨×¦×” ×œ×¢×§×•×‘ ××—×¨×™ ×¦×¤×™×•×ª, ×™×© ×œ×”×•×¡×™×£ ×©×“×” × ×¤×¨×“ ×•×œ×¢×“×›×Ÿ ××•×ª×• ×‘-route `/file/<id>`.

---

## 2. ××¨×›×™×˜×§×˜×•×¨×” ×•×ª×›× ×•×Ÿ

### ××™×§×•× ×‘×“×©×‘×•×¨×“
×”×•×•×™×“×’'×˜ ×™×ª×•×•×¡×£ ×œ-**dashboard-grid** ×›-card ×—×“×©:
- **Desktop (â‰¥1200px):** ×©×•×¨×” × ×•×¡×¤×ª ××ª×—×ª ×œ-pinned/whatsnew/lastcommit
- **Tablet (769â€“1199px):** ×›×¨×˜×™×¡ ×©×œ× ×‘×©×•×¨×” ×—×“×©×” ××• ×œ×¦×“ languages-top
- **Mobile:** ×›×¨×˜×™×¡ ××ª×—×ª ×œ-activity-section

### ××‘× ×” × ×ª×•× ×™× ×§×™×™× (××ª×•×š `database/models.py`)

```python
@dataclass
class CodeSnippet:
    # ... ×©×“×•×ª ×§×™×™××™× ...
    description: str = ""
    tags: Optional[List[str]] = None
    updated_at: Optional[datetime] = None
    # ... ×©××¨ ×”×©×“×•×ª ...
```

### ×¢×™×§×¨×•×Ÿ ××¤×ª×—: ×”×¤×¨×“×” ×œ×•×’×™×ª ××•×—×œ×˜×ª ×‘×™×Ÿ ×”×§×‘×•×¦×•×ª

| ×§×‘×•×¦×” | ×ª× ××™ ×”×›×œ×œ×” | ×ª× ××™ ×”×—×¨×’×” |
|-------|------------|------------|
| **×—×¡×¨ ××˜×-×“××˜×”** | `description` ×¨×™×§/×—×¡×¨ **××•** `tags` ×¨×™×§/×—×¡×¨ | - |
| **×œ× ×¢×•×“×›×Ÿ ×–××Ÿ ×¨×‘** | `updated_at` < cutoff | ×§×•×‘×¥ ×©× ××¦× ×‘×§×‘×•×¦×” 1 (×—×¡×¨ ××˜×-×“××˜×”) |

**×”××˜×¨×”:** ×§×•×‘×¥ ×™×›×•×œ ×œ×”×•×¤×™×¢ **×¨×§ ×‘×§×‘×•×¦×” ××—×ª**.

---

## 3. ×©×™× ×•×™×™× × ×“×¨×©×™× ×‘-Backend

### 3.1 ×¤×•× ×§×¦×™×™×ª ×¢×–×¨ ×—×“×©×” ×‘-`webapp/app.py`

×”×•×¡×£ ××ª ×”×¤×•× ×§×¦×™×” ×”×‘××” ×œ×™×“ ×”×¤×•× ×§×¦×™×•×ª ×”×§×™×™××•×ª ×©×œ ×”×“×©×‘×•×¨×“ (`_build_activity_timeline`, `_build_push_card`, ×•×›×•'):

```python
def _build_files_need_attention(
    db,
    user_id: int,
    max_items: int = 10,
    stale_days: int = 60,
    dismissed_ids: Optional[List[str]] = None
) -> Dict[str, Any]:
    """
    ×‘×•× ×” × ×ª×•× ×™× ×¢×‘×•×¨ ×•×•×™×“×’'×˜ "×§×‘×¦×™× ×©×“×•×¨×©×™× ×˜×™×¤×•×œ".
    
    Args:
        db: ×—×™×‘×•×¨ ×œ××¡×“ ×”× ×ª×•× ×™×
        user_id: ××–×”×” ×”××©×ª××©
        max_items: ××§×¡×™××•× ×¤×¨×™×˜×™× ×œ×”×¦×’×” ×‘×›×œ ×§×‘×•×¦×”
        stale_days: ××¡×¤×¨ ×™××™× ×œ××—×¨×™×”× ×§×•×‘×¥ × ×—×©×‘ "×œ× ×¢×•×“×›×Ÿ ×–××Ÿ ×¨×‘"
        dismissed_ids: ×¨×©×™××ª ××–×”×™× ×©×”××©×ª××© ×“×—×” (×œ×”×¡×ª×¨×” ×–×× ×™×ª)
    
    Returns:
        ××™×œ×•×Ÿ ×¢× × ×ª×•× ×™ ×”×•×•×™×“×’'×˜
    """
    from datetime import datetime, timezone, timedelta
    from database.repository import HEAVY_FIELDS_EXCLUDE_PROJECTION
    
    dismissed_ids = dismissed_ids or []
    dismissed_oids = []
    for did in dismissed_ids:
        try:
            dismissed_oids.append(ObjectId(did))
        except Exception:
            pass
    
    result = {
        'missing_metadata': [],
        'stale_files': [],
        'total_missing': 0,
        'total_stale': 0,
        'shown_missing': 0,
        'shown_stale': 0,
        'has_items': False,
        'settings': {
            'stale_days': stale_days,
            'max_items': max_items
        }
    }
    
    # === ×‘×¡×™×¡ ×©××™×œ×ª×” ××©×•×ª×£ ===
    base_query: Dict[str, Any] = {
        'user_id': user_id,
        'is_active': True
    }
    
    if dismissed_oids:
        base_query['_id'] = {'$nin': dismissed_oids}
    
    # === Projection ×§×œ (×‘×œ×™ code/content) ===
    projection = dict(HEAVY_FIELDS_EXCLUDE_PROJECTION)
    projection.update({
        'file_name': 1,
        'programming_language': 1,
        'description': 1,
        'tags': 1,
        'updated_at': 1,
        'created_at': 1
    })
    
    # =====================================================
    # ×§×‘×•×¦×” 1: ×§×‘×¦×™× ×—×¡×¨×™ ×ª×™××•×¨ ××• ×ª×’×™×•×ª
    # =====================================================
    # ×ª× ××™: description ×¨×™×§/×—×¡×¨ ××• tags ×¨×™×§/×—×¡×¨
    missing_query = dict(base_query)
    missing_query['$or'] = [
        # ×ª×™××•×¨ ×—×¡×¨ ××• ×¨×™×§
        {'description': {'$exists': False}},
        {'description': None},
        {'description': ''},
        # ×ª×’×™×•×ª ×—×¡×¨×•×ª ××• ×¨×™×§×•×ª
        {'tags': {'$exists': False}},
        {'tags': None},
        {'tags': []},
    ]
    
    # ×¡×¤×™×¨×” ×›×•×œ×œ×ª
    result['total_missing'] = db.code_snippets.count_documents(missing_query)
    
    # ×©×œ×™×¤×” ××•×’×‘×œ×ª
    missing_docs = list(db.code_snippets.find(
        missing_query,
        projection
    ).sort('updated_at', -1).limit(max_items))
    
    result['shown_missing'] = len(missing_docs)
    
    for doc in missing_docs:
        reasons = []
        desc = (doc.get('description') or '').strip()
        tags = doc.get('tags') or []
        
        if not desc:
            reasons.append('×—×¡×¨ ×ª×™××•×¨')
        if not tags:
            reasons.append('×—×¡×¨×•×ª ×ª×’×™×•×ª')
        
        result['missing_metadata'].append({
            'id': str(doc['_id']),
            'file_name': doc.get('file_name', ''),
            'language': doc.get('programming_language', 'text'),
            'icon': get_language_icon(doc.get('programming_language', '')),
            'description': desc[:100],
            'tags': tags[:5],  # ×œ×ª×¦×•×’×” ×‘×¨×©×™××” ×‘×œ×‘×“
            'tags_full': tags,  # ×›×œ ×”×ª×’×™×•×ª - ×œ×©×™××•×© ×‘-quick edit
            'tags_count': len(tags),
            'updated_at': doc.get('updated_at'),
            'reasons': reasons,
            'reason_text': ' + '.join(reasons) if reasons else '×—×¡×¨ ××™×“×¢'
        })
    
    # =====================================================
    # ×§×‘×•×¦×” 2: ×§×‘×¦×™× ×©×œ× ×¢×•×“×›× ×• ×–××Ÿ ×¨×‘
    # =====================================================
    # ×ª× ××™ ××¤×ª×—: ×¨×§ ×§×‘×¦×™× ×¢× ××˜×-×“××˜×” ×ª×§×™×Ÿ!
    # ×§×•×‘×¥ × ×—×©×‘ "stale" ×¨×§ ××:
    #   - updated_at ×™×©×Ÿ
    #   - description ×§×™×™× ×•×œ× ×¨×™×§
    #   - tags ×§×™×™× ×•×™×© ×‘×• ×œ×¤×—×•×ª ××™×‘×¨ ××—×“
    
    cutoff_date = datetime.now(timezone.utc) - timedelta(days=stale_days)
    
    stale_query = dict(base_query)
    stale_query['updated_at'] = {'$lt': cutoff_date}
    
    # ×”×—×¨×’×” ××¤×•×¨×©×ª ×©×œ ×§×‘×¦×™× ×—×¡×¨×™ ××˜×-×“××˜×”
    # ×©×™××•×© ×‘-$and ×›×“×™ ×œ×•×•×“× ×©×’× description ×•×’× tags ×ª×§×™× ×™×
    stale_query['$and'] = [
        # description ×§×™×™× ×•×œ× ×¨×™×§
        {'description': {'$exists': True}},
        {'description': {'$ne': None}},
        {'description': {'$ne': ''}},
        # tags ×§×™×™× ×•×™×© ×œ×¤×—×•×ª ××™×‘×¨ ××—×“ (pattern ××•××œ×¥ ×œ××•× ×’×•)
        {'tags.0': {'$exists': True}}
    ]
    
    # ×¡×¤×™×¨×” ×›×•×œ×œ×ª
    result['total_stale'] = db.code_snippets.count_documents(stale_query)
    
    # ×©×œ×™×¤×” ××•×’×‘×œ×ª - ×”×™×©× ×™× ×§×•×“×
    stale_docs = list(db.code_snippets.find(
        stale_query,
        projection
    ).sort('updated_at', 1).limit(max_items))
    
    result['shown_stale'] = len(stale_docs)
    
    for doc in stale_docs:
        updated = doc.get('updated_at')
        days_ago = 0
        if updated:
            try:
                delta = datetime.now(timezone.utc) - updated
                days_ago = delta.days
            except Exception:
                days_ago = stale_days
        
        result['stale_files'].append({
            'id': str(doc['_id']),
            'file_name': doc.get('file_name', ''),
            'language': doc.get('programming_language', 'text'),
            'icon': get_language_icon(doc.get('programming_language', '')),
            'description': (doc.get('description') or '')[:100],
            'tags': (doc.get('tags') or [])[:5],
            'updated_at': updated,
            'days_ago': days_ago,
            'reason_text': f'×œ× ×¢×•×“×›×Ÿ {days_ago} ×™××™×'
        })
    
    result['has_items'] = bool(result['missing_metadata'] or result['stale_files'])
    
    return result
```

### 3.2 ×¤×•× ×§×¦×™×™×ª ×¢×–×¨ ×œ×©×œ×™×¤×ª Dismissals

```python
def _get_active_dismissals(db, user_id: int) -> List[str]:
    """
    ×©×•×œ×£ ××ª ×¨×©×™××ª ×”-file_ids ×©×”××©×ª××© ×“×—×” ×•×¢×“×™×™×Ÿ ×œ× ×¤×’×•.
    
    Returns:
        ×¨×©×™××ª ××–×”×™ ×§×‘×¦×™× (×›-strings)
    """
    from datetime import datetime, timezone
    
    now = datetime.now(timezone.utc)
    
    try:
        # ×©×œ×™×¤×ª ×›×œ ×”×“×—×™×•×ª ×©×¢×“×™×™×Ÿ ×‘×ª×•×§×£
        dismissals = db.attention_dismissals.find(
            {
                'user_id': user_id,
                'expires_at': {'$gt': now}
            },
            {'file_id': 1}
        )
        
        return [str(d['file_id']) for d in dismissals if d.get('file_id')]
    except Exception as e:
        logger.warning(f"Failed to get dismissals for user {user_id}: {e}")
        return []
```

### 3.3 ×¢×“×›×•×Ÿ route ×©×œ `/dashboard`

×‘×¤×•× ×§×¦×™×™×ª `dashboard()` (×‘×¡×‘×™×‘×•×ª ×©×•×¨×” 10048), ×”×•×¡×£ ×§×¨×™××” ×œ×¤×•× ×§×¦×™×•×ª ×”×—×“×©×•×ª:

```python
# === ×•×•×™×“×’'×˜: ×§×‘×¦×™× ×©×“×•×¨×©×™× ×˜×™×¤×•×œ ===
# ×©×œ×™×¤×ª ×“×—×™×•×ª ×¤×¢×™×œ×•×ª
dismissed_ids = _get_active_dismissals(db, user_id)

# ×‘× ×™×™×ª × ×ª×•× ×™ ×”×•×•×™×“×’'×˜
files_need_attention = _build_files_need_attention(
    db,
    user_id,
    max_items=10,
    stale_days=60,  # × ×™×ª×Ÿ ×œ×§×¨×•× ××”×¢×“×¤×•×ª ×”××©×ª××© ×‘×¢×ª×™×“
    dismissed_ids=dismissed_ids
)

return render_template('dashboard.html',
    # ... ×©××¨ ×”×¤×¨××˜×¨×™× ×”×§×™×™××™× ...
    files_need_attention=files_need_attention,
)
```

### 3.4 API Endpoints ×—×“×©×™×

#### 3.4.1 Quick Update (×¢×“×›×•×Ÿ ××”×™×¨ ×©×œ ×ª×™××•×¨/×ª×’×™×•×ª)

```python
@app.route('/api/file/<file_id>/quick-update', methods=['POST'])
@login_required
def api_file_quick_update(file_id):
    """
    ×¢×“×›×•×Ÿ ××”×™×¨ ×©×œ ×ª×™××•×¨ ×•/××• ×ª×’×™×•×ª ×œ×§×•×‘×¥.
    Body: { "description": "...", "tags": ["tag1", "tag2"] }
    
    ×”×¢×¨×”: ×¢×“×›×•×Ÿ ××•×¦×œ×— ×’× ××¢×“×›×Ÿ ××ª updated_at, ××” ×©×™×’×¨×•× ×œ×§×•×‘×¥
    ×œ×¦××ª ××¨×©×™××ª "×œ× ×¢×•×“×›×Ÿ ×–××Ÿ ×¨×‘" (×•×–×• ×”×ª× ×”×’×•×ª ×¨×¦×•×™×”).
    """
    try:
        user_id = session['user_id']
        db = get_db()
        
        try:
            oid = ObjectId(file_id)
        except Exception:
            return jsonify({'ok': False, 'error': '××–×”×” ×œ× ×ª×§×™×Ÿ'}), 400
        
        # ×•×™×“×•× ×‘×¢×œ×•×ª
        doc = db.code_snippets.find_one({
            '_id': oid,
            'user_id': user_id,
            'is_active': True
        }, {'_id': 1})
        
        if not doc:
            return jsonify({'ok': False, 'error': '×”×§×•×‘×¥ ×œ× × ××¦×'}), 404
        
        data = request.get_json() or {}
        updates = {'updated_at': datetime.now(timezone.utc)}
        
        if 'description' in data:
            desc = (data.get('description') or '').strip()[:500]
            updates['description'] = desc
        
        if 'tags' in data:
            raw_tags = data.get('tags') or []
            if isinstance(raw_tags, str):
                # ×ª××™×›×” ×‘×§×œ×˜ comma-separated
                raw_tags = [t.strip() for t in raw_tags.split(',') if t.strip()]
            # × ×™×§×•×™ ×•× ×•×¨××œ×™×–×¦×™×”
            clean_tags = []
            for t in raw_tags[:20]:  # ××§×¡×™××•× 20 ×ª×’×™×•×ª
                tag = str(t).strip().lower()[:50]
                if tag and tag not in clean_tags:
                    clean_tags.append(tag)
            updates['tags'] = clean_tags
        
        if len(updates) <= 1:  # ×¨×§ updated_at
            return jsonify({'ok': False, 'error': '×œ× ×¡×•×¤×§×• ×©×“×•×ª ×œ×¢×“×›×•×Ÿ'}), 400
        
        db.code_snippets.update_one({'_id': oid}, {'$set': updates})
        
        # Invalidate cache
        try:
            cache.invalidate_file_related(file_id, user_id)
        except Exception:
            pass
        
        return jsonify({
            'ok': True,
            'updated_fields': list(updates.keys())
        })
        
    except Exception as e:
        logger.exception(f"Error in quick update: {e}")
        return jsonify({'ok': False, 'error': '×©×’×™××” ×‘×¢×“×›×•×Ÿ'}), 500


@app.route('/api/file/<file_id>/dismiss-attention', methods=['POST'])
@login_required
def api_file_dismiss_attention(file_id):
    """
    ×“×•×—×” ×§×•×‘×¥ ××¨×©×™××ª "×“×•×¨×© ×˜×™×¤×•×œ" (×”×¡×ª×¨×” ×–×× ×™×ª).
    Body: { "days": 30 } - ××¡×¤×¨ ×™××™× ×œ×”×¡×ª×¨×” (×‘×¨×™×¨×ª ××—×“×œ: 30)
    
    ××¤×©×¨×•×™×•×ª ××•××œ×¦×•×ª: 7, 30, 90 ×™××™×.
    """
    try:
        user_id = session['user_id']
        db = get_db()
        
        try:
            oid = ObjectId(file_id)
        except Exception:
            return jsonify({'ok': False, 'error': '××–×”×” ×œ× ×ª×§×™×Ÿ'}), 400
        
        # ×•×™×“×•× ×‘×¢×œ×•×ª
        doc = db.code_snippets.find_one({
            '_id': oid,
            'user_id': user_id,
            'is_active': True
        }, {'_id': 1})
        
        if not doc:
            return jsonify({'ok': False, 'error': '×”×§×•×‘×¥ ×œ× × ××¦×'}), 404
        
        data = request.get_json() or {}
        days = min(max(int(data.get('days', 30)), 1), 365)  # 1-365 ×™××™×
        
        now = datetime.now(timezone.utc)
        expires_at = now + timedelta(days=days)
        
        # ×©××™×¨×” ×‘-collection ×™×™×¢×•×“×™
        db.attention_dismissals.update_one(
            {'user_id': user_id, 'file_id': oid},
            {
                '$set': {
                    'dismissed_at': now,
                    'expires_at': expires_at,
                    'days': days
                }
            },
            upsert=True
        )
        
        return jsonify({
            'ok': True,
            'dismissed_until': expires_at.isoformat(),
            'days': days
        })
        
    except Exception as e:
        logger.exception(f"Error in dismiss attention: {e}")
        return jsonify({'ok': False, 'error': '×©×’×™××” ×‘×“×—×™×™×”'}), 500
```

---

## 4. ×©×™× ×•×™×™× ×‘-Frontend (HTML)

### 4.1 ×”×•×¡×¤×” ×œ-`webapp/templates/dashboard.html`

×”×•×¡×£ ××ª ×”×§×•×“ ×”×‘× **×œ×¤× ×™** ×¡×’×™×¨×ª ×”-`</div>` ×©×œ `dashboard-grid` (×‘×¡×‘×™×‘×•×ª ×©×•×¨×” 250):

**×©×™× ×œ×‘:** ×©×™××•×© ×‘-`tojson` ×¢×‘×•×¨ ×¢×¨×›×™ `data-*` ×œ×× ×™×¢×ª ×‘×¢×™×•×ª escaping.

```html
{# === ×•×•×™×“×’'×˜: ×§×‘×¦×™× ×©×“×•×¨×©×™× ×˜×™×¤×•×œ === #}
{% if files_need_attention and files_need_attention.has_items %}
<article class="glass-card attention-card widget-attention" data-attention-widget>
    <header class="attention-header">
        <h2 class="section-title">
            <i class="fas fa-exclamation-triangle"></i>
            ×§×‘×¦×™× ×©×“×•×¨×©×™× ×˜×™×¤×•×œ
        </h2>
        <span class="badge badge-warning" data-attention-total-badge>
            {{ files_need_attention.total_missing + files_need_attention.total_stale }}
        </span>
    </header>

    {# --- ×§×‘×•×¦×” 1: ×—×¡×¨ ×ª×™××•×¨/×ª×’×™×•×ª --- #}
    {% if files_need_attention.missing_metadata %}
    <section class="attention-group" data-group="missing">
        <h3 class="attention-group__title">
            <span class="attention-group__icon">ğŸ“</span>
            ×—×¡×¨ ×ª×™××•×¨ ××• ×ª×’×™×•×ª
            <span class="attention-group__count" data-group-count="missing">
                ({{ files_need_attention.shown_missing }}{% if files_need_attention.total_missing > files_need_attention.shown_missing %}/{{ files_need_attention.total_missing }}{% endif %})
            </span>
        </h3>
        <ul class="attention-list" data-attention-list="missing">
            {% for file in files_need_attention.missing_metadata %}
            <li class="attention-item" data-file-id="{{ file.id }}">
                <div class="attention-item__info">
                    <span class="attention-item__icon">{{ file.icon }}</span>
                    <div class="attention-item__details">
                        <a href="/file/{{ file.id }}" class="attention-item__name">{{ file.file_name }}</a>
                        <span class="attention-item__reason">{{ file.reason_text }}</span>
                    </div>
                </div>
                <div class="attention-item__actions">
                    <button type="button" 
                            class="btn btn-sm btn-icon attention-quick-edit"
                            data-action="quick-edit"
                            data-file-id="{{ file.id }}"
                            data-file-name="{{ file.file_name | e }}"
                            data-current-desc={{ file.description | tojson }}
                            data-current-tags={{ (file.tags_full | join(',')) | tojson }}
                            title="×¢×¨×™×›×” ××”×™×¨×”">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button type="button"
                            class="btn btn-sm btn-icon attention-dismiss"
                            data-action="dismiss"
                            data-file-id="{{ file.id }}"
                            title="×˜×¤×œ ×××•×—×¨ ×™×•×ª×¨">
                        <i class="fas fa-clock"></i>
                    </button>
                </div>
            </li>
            {% endfor %}
        </ul>
        {% if files_need_attention.total_missing > files_need_attention.shown_missing %}
        <p class="attention-more">
            ×•×¢×•×“ {{ files_need_attention.total_missing - files_need_attention.shown_missing }} ×§×‘×¦×™× × ×•×¡×¤×™×...
            <a href="/files?filter=missing_metadata" class="attention-more-link">×”×¦×’ ×”×›×œ</a>
        </p>
        {% endif %}
    </section>
    {% endif %}

    {# --- ×§×‘×•×¦×” 2: ×œ× ×¢×•×“×›×Ÿ ×–××Ÿ ×¨×‘ --- #}
    {% if files_need_attention.stale_files %}
    <section class="attention-group" data-group="stale">
        <h3 class="attention-group__title">
            <span class="attention-group__icon">â°</span>
            ×œ× ×¢×•×“×›×Ÿ ×–××Ÿ ×¨×‘
            <span class="attention-group__count" data-group-count="stale">
                ({{ files_need_attention.shown_stale }}{% if files_need_attention.total_stale > files_need_attention.shown_stale %}/{{ files_need_attention.total_stale }}{% endif %})
            </span>
        </h3>
        <ul class="attention-list" data-attention-list="stale">
            {% for file in files_need_attention.stale_files %}
            <li class="attention-item" data-file-id="{{ file.id }}">
                <div class="attention-item__info">
                    <span class="attention-item__icon">{{ file.icon }}</span>
                    <div class="attention-item__details">
                        <a href="/file/{{ file.id }}" class="attention-item__name">{{ file.file_name }}</a>
                        <span class="attention-item__reason">{{ file.reason_text }}</span>
                    </div>
                </div>
                <div class="attention-item__actions">
                    <a href="/edit/{{ file.id }}" 
                       class="btn btn-sm btn-icon"
                       title="×¤×ª×— ×œ×¢×¨×™×›×”">
                        <i class="fas fa-external-link-alt"></i>
                    </a>
                    <button type="button"
                            class="btn btn-sm btn-icon attention-dismiss"
                            data-action="dismiss"
                            data-file-id="{{ file.id }}"
                            title="×˜×¤×œ ×××•×—×¨ ×™×•×ª×¨">
                        <i class="fas fa-clock"></i>
                    </button>
                </div>
            </li>
            {% endfor %}
        </ul>
        {% if files_need_attention.total_stale > files_need_attention.shown_stale %}
        <p class="attention-more">
            ×•×¢×•×“ {{ files_need_attention.total_stale - files_need_attention.shown_stale }} ×§×‘×¦×™× × ×•×¡×¤×™×...
            <a href="/files?filter=stale&days={{ files_need_attention.settings.stale_days }}" class="attention-more-link">×”×¦×’ ×”×›×œ</a>
        </p>
        {% endif %}
    </section>
    {% endif %}

    {# --- ×”×’×“×¨×•×ª --- #}
    <footer class="attention-footer">
        <span class="attention-footer-hint">
            âš™ï¸ ×§×•×‘×¥ × ×—×©×‘ "×™×©×Ÿ" ××—×¨×™ {{ files_need_attention.settings.stale_days }} ×™××™×
        </span>
        <a href="/settings#attention" class="attention-settings-link">
            <i class="fas fa-cog"></i>
            ×”×’×“×¨×•×ª
        </a>
    </footer>
</article>

{# --- ××•×“×œ ×¢×¨×™×›×” ××”×™×¨×” (Quick Edit Modal) --- #}
<div class="modal attention-modal" id="attentionQuickEditModal" data-quick-edit-modal hidden>
    <div class="modal-backdrop" data-modal-close></div>
    <div class="modal-content glass-card">
        <header class="modal-header">
            <h3>×¢×¨×™×›×” ××”×™×¨×”</h3>
            <button type="button" class="modal-close" data-modal-close aria-label="×¡×’×•×¨">
                <i class="fas fa-times"></i>
            </button>
        </header>
        <form class="modal-body" data-quick-edit-form>
            <input type="hidden" name="file_id" data-field="file_id">
            <p class="quick-edit-file-name" data-field="file_name_display"></p>
            <div class="form-group">
                <label for="quickEditDescription">×ª×™××•×¨</label>
                <input type="text" 
                       id="quickEditDescription" 
                       name="description" 
                       class="form-field"
                       maxlength="500"
                       placeholder="××” ×”×§×•×‘×¥ ×¢×•×©×”? (×ª×™××•×¨ ×§×¦×¨)">
            </div>
            <div class="form-group">
                <label for="quickEditTags">×ª×’×™×•×ª</label>
                <input type="text" 
                       id="quickEditTags" 
                       name="tags" 
                       class="form-field"
                       placeholder="utils, helper, api">
                <small class="form-hint">×”×¤×¨×“ ×ª×’×™×•×ª ×‘×¤×¡×™×§×™× (Comma-separated)</small>
            </div>
        </form>
        <footer class="modal-footer">
            <button type="button" class="btn btn-secondary" data-modal-close>×‘×™×˜×•×œ</button>
            <button type="button" class="btn btn-primary" data-action="save-quick-edit">
                <i class="fas fa-save"></i>
                ×©××•×¨
            </button>
        </footer>
    </div>
</div>

{# --- ××•×“×œ ×“×—×™×™×” (Dismiss Modal) --- #}
<div class="modal attention-modal" id="attentionDismissModal" data-dismiss-modal hidden>
    <div class="modal-backdrop" data-modal-close></div>
    <div class="modal-content glass-card modal-content--small">
        <header class="modal-header">
            <h3>×“×—×” ×œ×˜×™×¤×•×œ ×××•×—×¨</h3>
            <button type="button" class="modal-close" data-modal-close aria-label="×¡×’×•×¨">
                <i class="fas fa-times"></i>
            </button>
        </header>
        <div class="modal-body">
            <input type="hidden" data-field="dismiss_file_id">
            <p>×”×¡×ª×¨ ×§×•×‘×¥ ×–×” ××”×¨×©×™××” ×œ××©×š:</p>
            <div class="dismiss-options">
                <button type="button" class="btn btn-secondary dismiss-option" data-days="7">×©×‘×•×¢</button>
                <button type="button" class="btn btn-secondary dismiss-option" data-days="30">×—×•×“×©</button>
                <button type="button" class="btn btn-secondary dismiss-option" data-days="90">3 ×—×•×“×©×™×</button>
            </div>
        </div>
    </div>
</div>
{% endif %}
```

### 4.2 ×¡×’× ×•× ×•×ª CSS

×”×•×¡×£ ××ª ×”×¡×’× ×•× ×•×ª ×”×‘××™× ×‘×ª×•×š ×‘×œ×•×§ ×”-`<style>` ×”×§×™×™× ×‘-`dashboard.html`:

```css
/* === Attention Widget === */
.attention-card {
    border-right: 3px solid #f59e0b;
}

.attention-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.attention-header .section-title {
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.attention-header .section-title i {
    color: #f59e0b;
}

.badge-warning {
    background: rgba(245, 158, 11, 0.2);
    color: #fbbf24;
    padding: 0.25rem 0.75rem;
    border-radius: 999px;
    font-size: 0.85rem;
    font-weight: 600;
}

.attention-group {
    margin-bottom: 1.5rem;
}

.attention-group:last-of-type {
    margin-bottom: 0.5rem;
}

.attention-group__title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.attention-group__icon {
    font-size: 1.2rem;
}

.attention-group__count {
    font-weight: 400;
    opacity: 0.7;
    font-size: 0.9rem;
}

.attention-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.attention-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.08);
    transition: all 0.2s ease;
}

.attention-item:hover {
    background: rgba(255, 255, 255, 0.06);
    border-color: rgba(245, 158, 11, 0.3);
}

.attention-item__info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex: 1;
    min-width: 0;
}

.attention-item__icon {
    font-size: 1.5rem;
    flex-shrink: 0;
}

.attention-item__details {
    display: flex;
    flex-direction: column;
    gap: 0.2rem;
    min-width: 0;
}

.attention-item__name {
    font-weight: 500;
    color: inherit;
    text-decoration: none;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.attention-item__name:hover {
    color: #fbbf24;
}

.attention-item__reason {
    font-size: 0.8rem;
    opacity: 0.7;
    color: #f59e0b;
}

.attention-item__actions {
    display: flex;
    gap: 0.5rem;
    flex-shrink: 0;
}

.attention-item__actions .btn {
    padding: 0.4rem 0.6rem;
    opacity: 0.7;
    transition: opacity 0.2s;
}

.attention-item:hover .attention-item__actions .btn {
    opacity: 1;
}

.attention-more {
    font-size: 0.85rem;
    opacity: 0.7;
    text-align: center;
    margin-top: 0.75rem;
}

.attention-more-link {
    color: #fbbf24;
    margin-right: 0.5rem;
}

.attention-footer {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.attention-footer-hint {
    font-size: 0.8rem;
    opacity: 0.6;
}

.attention-settings-link {
    font-size: 0.85rem;
    color: inherit;
    opacity: 0.7;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
}

.attention-settings-link:hover {
    opacity: 1;
    color: #fbbf24;
}

/* Quick Edit Modal */
.attention-modal {
    position: fixed;
    inset: 0;
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
}

.attention-modal[hidden] {
    display: none;
}

.attention-modal .modal-backdrop {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
}

.attention-modal .modal-content {
    position: relative;
    width: 90%;
    max-width: 450px;
    max-height: 90vh;
    overflow-y: auto;
    padding: 0;
}

.attention-modal .modal-content--small {
    max-width: 320px;
}

.attention-modal .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.attention-modal .modal-header h3 {
    margin: 0;
    font-size: 1.1rem;
}

.attention-modal .modal-close {
    background: none;
    border: none;
    color: inherit;
    font-size: 1.2rem;
    cursor: pointer;
    opacity: 0.7;
}

.attention-modal .modal-close:hover {
    opacity: 1;
}

.attention-modal .modal-body {
    padding: 1.5rem;
}

.attention-modal .form-group {
    margin-bottom: 1rem;
}

.attention-modal .form-group:last-child {
    margin-bottom: 0;
}

.attention-modal .form-group label {
    display: block;
    margin-bottom: 0.4rem;
    font-weight: 500;
}

.attention-modal .form-hint {
    display: block;
    margin-top: 0.3rem;
    font-size: 0.8rem;
    opacity: 0.7;
}

.attention-modal .modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 0.75rem;
    padding: 1rem 1.5rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.quick-edit-file-name {
    font-weight: 600;
    margin: 0 0 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    font-family: monospace;
}

/* Dismiss Modal */
.dismiss-options {
    display: flex;
    gap: 0.75rem;
    margin-top: 1rem;
}

.dismiss-option {
    flex: 1;
}

/* Rose Pine Dawn overrides */
:root[data-theme="rose-pine-dawn"] .attention-card {
    border-right-color: #ea9d34;
}

:root[data-theme="rose-pine-dawn"] .attention-header .section-title i {
    color: #ea9d34;
}

:root[data-theme="rose-pine-dawn"] .badge-warning {
    background: rgba(234, 157, 52, 0.15);
    color: #ea9d34;
}

:root[data-theme="rose-pine-dawn"] .attention-item {
    background: rgba(255, 255, 255, 0.4);
    border-color: rgba(87, 82, 121, 0.15);
}

:root[data-theme="rose-pine-dawn"] .attention-item:hover {
    background: rgba(255, 255, 255, 0.5);
    border-color: rgba(234, 157, 52, 0.4);
}

:root[data-theme="rose-pine-dawn"] .attention-item__reason {
    color: #ea9d34;
}

:root[data-theme="rose-pine-dawn"] .attention-item__name:hover,
:root[data-theme="rose-pine-dawn"] .attention-settings-link:hover,
:root[data-theme="rose-pine-dawn"] .attention-more-link {
    color: #ea9d34;
}

/* Animation for item removal */
.attention-item.is-removing {
    opacity: 0;
    transform: translateX(-10px);
    transition: opacity 0.3s, transform 0.3s;
}

/* Grid placement */
.widget-attention {
    grid-area: attention;
}

@media (min-width: 769px) {
    .dashboard-grid.has-attention {
        grid-template-areas:
            "pinned whatsnew lastcommit"
            "attention attention attention";
    }
    
    .dashboard-grid.no-last-commit.has-attention {
        grid-template-areas:
            "pinned whatsnew languages-top"
            "attention attention attention";
    }
}

@media (max-width: 768px) {
    .attention-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
    }
    
    .attention-item__actions {
        width: 100%;
        justify-content: flex-end;
    }
    
    .dismiss-options {
        flex-direction: column;
    }
}
```

### 4.3 JavaScript

×”×•×¡×£ ××ª ×”×§×•×“ ×”×‘× ×‘×¡×•×£ ×‘×œ×•×§ ×”-`<script>` ×‘-`dashboard.html`:

```javascript
// === Attention Widget: Quick Edit & Dismiss ===
document.addEventListener('DOMContentLoaded', () => {
    const widget = document.querySelector('[data-attention-widget]');
    if (!widget) return;

    const quickEditModal = document.getElementById('attentionQuickEditModal');
    const dismissModal = document.getElementById('attentionDismissModal');
    const quickEditForm = quickEditModal?.querySelector('[data-quick-edit-form]');
    const saveBtn = quickEditModal?.querySelector('[data-action="save-quick-edit"]');

    // === ×¤×ª×™×—×ª ××•×“×œ ×¢×¨×™×›×” ××”×™×¨×” ===
    // ××©×ª× ×™× ×œ×©××™×¨×ª ×”×¢×¨×›×™× ×”××§×•×¨×™×™× (×œ×× ×™×¢×ª ××™×‘×•×“ × ×ª×•× ×™×)
    // ×—×©×•×‘: ×× ×”××©×ª××© ×œ× ×©×™× ×” ×©×“×”, ×œ× × ×©×œ×— ××•×ª×• ×œ×©×¨×ª
    let originalDescription = '';
    let originalTags = '';

    widget.addEventListener('click', (e) => {
        const editBtn = e.target.closest('[data-action="quick-edit"]');
        if (editBtn && quickEditModal && quickEditForm) {
            const fileId = editBtn.dataset.fileId;
            const fileName = editBtn.dataset.fileName || '';
            // ×”×¢×¨×›×™× ××’×™×¢×™× ×›-JSON escaped, ×¦×¨×™×š ×œ×¤×¨×¡×¨
            let currentDesc = '';
            let currentTags = '';
            try {
                currentDesc = JSON.parse(editBtn.dataset.currentDesc || '""');
            } catch { currentDesc = ''; }
            try {
                // ×›××Ÿ ××’×™×¢×•×ª ×›×œ ×”×ª×’×™×•×ª (tags_full), ×œ× ×¨×§ 5 ×”×¨××©×•× ×•×ª
                currentTags = JSON.parse(editBtn.dataset.currentTags || '""');
            } catch { currentTags = ''; }

            // ×©××™×¨×ª ×”×¢×¨×›×™× ×”××§×•×¨×™×™× ×œ×”×©×•×•××” ×‘×¢×ª ×©××™×¨×”
            originalDescription = currentDesc;
            originalTags = currentTags;

            quickEditForm.querySelector('[data-field="file_id"]').value = fileId;
            quickEditForm.querySelector('[data-field="file_name_display"]').textContent = fileName;
            quickEditForm.querySelector('#quickEditDescription').value = currentDesc;
            quickEditForm.querySelector('#quickEditTags').value = currentTags;

            quickEditModal.hidden = false;
            quickEditForm.querySelector('#quickEditDescription').focus();
        }
    });

    // === ×¡×’×™×¨×ª ××•×“×œ×™× ===
    [quickEditModal, dismissModal].forEach(modal => {
        modal?.querySelectorAll('[data-modal-close]').forEach(btn => {
            btn.addEventListener('click', () => {
                modal.hidden = true;
            });
        });
    });

    // === ESC ×œ×¡×’×™×¨×ª ××•×“×œ×™× ===
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            if (quickEditModal && !quickEditModal.hidden) quickEditModal.hidden = true;
            if (dismissModal && !dismissModal.hidden) dismissModal.hidden = true;
        }
    });

    // === ×©××™×¨×” ××”×™×¨×” ===
    saveBtn?.addEventListener('click', async () => {
        if (!quickEditForm) return;

        const fileId = quickEditForm.querySelector('[data-field="file_id"]').value;
        const newDescription = quickEditForm.querySelector('#quickEditDescription').value.trim();
        const newTagsRaw = quickEditForm.querySelector('#quickEditTags').value.trim();

        // ×‘× ×™×™×ª payload - ×©×•×œ×—×™× ×¨×§ ×©×“×•×ª ×©×”×©×ª× ×•!
        // ×–×” ××•× ×¢ ××™×‘×•×“ × ×ª×•× ×™× (×œ××©×œ ×ª×’×™×•×ª ×©×œ× ×”×•×¦×’×• ×‘××œ×•××Ÿ)
        const payload = {};
        
        if (newDescription !== originalDescription) {
            payload.description = newDescription;
        }
        
        if (newTagsRaw !== originalTags) {
            payload.tags = newTagsRaw ? newTagsRaw.split(',').map(t => t.trim()).filter(Boolean) : [];
        }

        // ×× ×œ× ×”×©×ª× ×” ×›×œ×•×, ××™×Ÿ ××” ×œ×©××•×¨
        if (Object.keys(payload).length === 0) {
            quickEditModal.hidden = true;
            showToast('×œ× ×‘×•×¦×¢×• ×©×™× ×•×™×™×', 'info');
            return;
        }

        saveBtn.disabled = true;
        saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ×©×•××¨...';

        try {
            const resp = await fetch(`/api/file/${fileId}/quick-update`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const data = await resp.json();

            if (!resp.ok || !data.ok) {
                throw new Error(data.error || '×©×’×™××” ×‘×©××™×¨×”');
            }

            // ×”×¡×¨×ª ×”×¤×¨×™×˜ ××”×¨×©×™××” (×•×™×–×•××œ×™×ª)
            removeAttentionItem(fileId);
            quickEditModal.hidden = true;

            showToast('× ×©××¨ ×‘×”×¦×œ×—×”!', 'success');

        } catch (err) {
            console.error('Quick update failed:', err);
            showToast(err.message || '×©×’×™××” ×‘×©××™×¨×”', 'error');
        } finally {
            saveBtn.disabled = false;
            saveBtn.innerHTML = '<i class="fas fa-save"></i> ×©××•×¨';
        }
    });

    // === ×¤×ª×™×—×ª ××•×“×œ ×“×—×™×™×” ===
    widget.addEventListener('click', (e) => {
        const dismissBtn = e.target.closest('[data-action="dismiss"]');
        if (!dismissBtn || !dismissModal) return;

        const fileId = dismissBtn.dataset.fileId;
        dismissModal.querySelector('[data-field="dismiss_file_id"]').value = fileId;
        dismissModal.hidden = false;
    });

    // === ×‘×—×™×¨×ª ×ª×§×•×¤×ª ×“×—×™×™×” ===
    dismissModal?.querySelectorAll('.dismiss-option[data-days]').forEach(btn => {
        btn.addEventListener('click', async () => {
            const fileId = dismissModal.querySelector('[data-field="dismiss_file_id"]').value;
            const days = parseInt(btn.dataset.days, 10) || 30;

            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

            try {
                const resp = await fetch(`/api/file/${fileId}/dismiss-attention`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ days })
                });
                const data = await resp.json();

                if (!resp.ok || !data.ok) {
                    throw new Error(data.error || '×©×’×™××” ×‘×“×—×™×™×”');
                }

                removeAttentionItem(fileId);
                dismissModal.hidden = true;
                
                const daysText = days === 7 ? '×©×‘×•×¢' : days === 30 ? '×—×•×“×©' : `${days} ×™××™×`;
                showToast(`× ×“×—×” ×œ-${daysText}`, 'info');

            } catch (err) {
                console.error('Dismiss failed:', err);
                showToast(err.message || '×©×’×™××” ×‘×“×—×™×™×”', 'error');
            } finally {
                btn.disabled = false;
                // Reset button text based on days
                const daysMap = { 7: '×©×‘×•×¢', 30: '×—×•×“×©', 90: '3 ×—×•×“×©×™×' };
                btn.textContent = daysMap[btn.dataset.days] || `${btn.dataset.days} ×™××™×`;
            }
        });
    });

    /**
     * ×”×¡×¨×ª ×¤×¨×™×˜ ××”×¨×©×™××” (×•×™×–×•××œ×™×ª ×‘×œ×‘×“).
     * 
     * ×”×¢×¨×” ×—×©×•×‘×”: ×”×¡×¤×™×¨×•×ª (total) ×©××’×™×¢×•×ª ××”×©×¨×ª ×œ× ××ª×¢×“×›× ×•×ª ×›××Ÿ.
     * ×”-Badge ×”×›×•×œ×œ ××•×¤×—×ª ×•×™×–×•××œ×™×ª, ××‘×œ ×”×¡×¤×™×¨×•×ª ×‘×›×•×ª×¨×•×ª ×”×§×‘×•×¦×•×ª
     * × ×©××¨×•×ª ×›×¤×™ ×©×”×™×• (××• ××¦×™×’×•×ª "××•×¦×’×™× X ××ª×•×š Y").
     * ×œ×¡× ×›×¨×•×Ÿ ××œ× ×™×© ×œ×¨×¢× ×Ÿ ××ª ×”×“×£.
     */
    function removeAttentionItem(fileId) {
        const item = widget.querySelector(`.attention-item[data-file-id="${fileId}"]`);
        if (item) {
            item.classList.add('is-removing');
            setTimeout(() => {
                item.remove();
                updateVisualCounts();
            }, 300);
        }
    }

    /**
     * ×¢×“×›×•×Ÿ ×¡×¤×™×¨×•×ª ×•×™×–×•××œ×™ ×‘×œ×‘×“.
     * ××¢×“×›×Ÿ ××ª ×”-Badge ×”×›×•×œ×œ ×‘×”×ª×‘×¡×¡ ×¢×œ ××¡×¤×¨ ×”×¤×¨×™×˜×™× ×©× ×•×ª×¨×• ×‘-DOM.
     * ×”×¡×¤×™×¨×•×ª ×‘×›×•×ª×¨×•×ª ×”×§×‘×•×¦×•×ª ×œ× ××©×ª× ×•×ª (×›×™ ×”×Ÿ ××¦×™×’×•×ª total ××”×©×¨×ª).
     */
    function updateVisualCounts() {
        const allItems = widget.querySelectorAll('.attention-item:not(.is-removing)');
        const totalBadge = widget.querySelector('[data-attention-total-badge]');
        
        if (totalBadge) {
            totalBadge.textContent = allItems.length;
        }

        // ×”×¡×ª×¨ ×§×‘×•×¦×” ×¨×™×§×”
        widget.querySelectorAll('[data-attention-list]').forEach(list => {
            const group = list.closest('.attention-group');
            const items = list.querySelectorAll('.attention-item:not(.is-removing)');
            
            if (items.length === 0 && group) {
                group.style.display = 'none';
            }
        });

        // ×”×¡×ª×¨ ××ª ×›×œ ×”×•×•×™×“×’'×˜ ×× ××™×Ÿ ×¤×¨×™×˜×™×
        if (allItems.length === 0) {
            widget.style.display = 'none';
        }
    }

    function showToast(message, type = 'info') {
        // ×©×™××•×© ×‘××¢×¨×›×ª Toast ×§×™×™××ª ×× ×™×©
        if (typeof window.showNotification === 'function') {
            window.showNotification(message, type);
        } else if (typeof window.Toastify === 'function') {
            Toastify({
                text: message,
                duration: 3000,
                gravity: 'bottom',
                position: 'right',
                className: `toast-${type}`
            }).showToast();
        } else {
            console.log(`[${type}] ${message}`);
        }
    }
});
```

---

## 5. ×”×’×“×¨×•×ª ××©×ª××© (××•×¤×¦×™×•× ×œ×™)

### 5.1 ×©×“×•×ª ×”×’×“×¨×” ×—×“×©×™×

× ×™×ª×Ÿ ×œ×”×•×¡×™×£ ×œ×¢××•×“ ×”×”×’×“×¨×•×ª (`/settings`) ×¡×¢×™×£ ×—×“×©:

```python
# ×‘-user preferences / settings:
attention_settings = {
    'enabled': True,                    # ×”×¤×¢×œ×”/×›×™×‘×•×™ ×”×•×•×™×“×’'×˜
    'stale_days': 60,                   # ××¡×¤×¨ ×™××™× ×œ×§×•×‘×¥ "×œ× ×¢×•×“×›×Ÿ"
    'max_items_per_group': 10,          # ××§×¡×™××•× ×¤×¨×™×˜×™× ×œ×›×œ ×§×‘×•×¦×”
    'show_missing_description': True,   # ×”×¦×’ ×§×‘×¦×™× ×—×¡×¨×™ ×ª×™××•×¨
    'show_missing_tags': True,          # ×”×¦×’ ×§×‘×¦×™× ×—×¡×¨×™ ×ª×’×™×•×ª
    'show_stale_files': True            # ×”×¦×’ ×§×‘×¦×™× ×©×œ× ×¢×•×“×›× ×•
}
```

### 5.2 API ×œ×¢×“×›×•×Ÿ ×”×’×“×¨×•×ª

```python
@app.route('/api/settings/attention', methods=['PUT'])
@login_required
def api_update_attention_settings():
    """×¢×“×›×•×Ÿ ×”×’×“×¨×•×ª ×•×•×™×“×’'×˜ '×§×‘×¦×™× ×©×“×•×¨×©×™× ×˜×™×¤×•×œ'"""
    user_id = session['user_id']
    data = request.get_json() or {}
    
    allowed_fields = {
        'enabled', 'stale_days', 'max_items_per_group',
        'show_missing_description', 'show_missing_tags', 'show_stale_files'
    }
    
    updates = {}
    for field in allowed_fields:
        if field in data:
            value = data[field]
            if field == 'stale_days':
                value = min(max(int(value), 7), 365)
            elif field == 'max_items_per_group':
                value = min(max(int(value), 3), 50)
            elif field in ('enabled', 'show_missing_description', 'show_missing_tags', 'show_stale_files'):
                value = bool(value)
            updates[f'attention_settings.{field}'] = value
    
    if updates:
        db = get_db()
        db.user_preferences.update_one(
            {'user_id': user_id},
            {'$set': updates},
            upsert=True
        )
    
    return jsonify({'ok': True})
```

---

## 6. ××™× ×“×§×¡×™× ××•××œ×¦×™× (MongoDB)

×”×•×¡×£ ××ª ×”××™× ×“×§×¡×™× ×”×‘××™× ×œ×©×™×¤×•×¨ ×‘×™×¦×•×¢×™×:

```python
# ×‘-scripts/create_repo_indexes.py ××• ×‘×¡×§×¨×™×¤×˜ ××ª×—×•×œ

# ××™× ×“×§×¡ ×œ×©××™×œ×ª×ª ×§×‘×¦×™× ×—×¡×¨×™ ××˜×-×“××˜×”
# ×”×¢×¨×”: ××™× ×“×§×¡ ×¢×œ ×©×“×•×ª ××•×¤×¦×™×•× ×œ×™×™× ×¢× $or ×œ× ×ª××™×“ ×™×¢×™×œ.
# ××•××œ×¥ ×œ×‘×“×•×§ ×¢× explain() ×•×œ×©×§×•×œ ×”×•×¡×¤×ª ×©×“×” ××—×•×©×‘ ×‘×¢×ª×™×“.
db.code_snippets.create_index(
    [
        ('user_id', 1),
        ('is_active', 1),
        ('updated_at', -1)
    ],
    name='idx_attention_base'
)

# ××™× ×“×§×¡ ×œ×©××™×œ×ª×ª ×§×‘×¦×™× ×©×œ× ×¢×•×“×›× ×• (×›×•×œ×œ ×ª× ××™ tags.0)
db.code_snippets.create_index(
    [
        ('user_id', 1),
        ('is_active', 1),
        ('updated_at', 1),
        ('tags.0', 1)
    ],
    name='idx_attention_stale_with_tags'
)

# ××™× ×“×§×¡ ×œ-dismissals
db.attention_dismissals.create_index(
    [
        ('user_id', 1),
        ('file_id', 1)
    ],
    unique=True,
    name='idx_attention_dismissals_unique'
)

# TTL index - ××—×™×§×” ××•×˜×•××˜×™×ª ×›×©-expires_at ×¢×•×‘×¨
db.attention_dismissals.create_index(
    [('expires_at', 1)],
    expireAfterSeconds=0,
    name='idx_attention_dismissals_ttl'
)
```

### ×”×¢×¨×” ×œ×’×‘×™ ×‘×™×¦×•×¢×™ ×©××™×œ×ª×•×ª

×”×©××™×œ×ª×” ×©×œ `missing_metadata` ××©×ª××©×ª ×‘-`$or` ×¢×œ ×©×“×•×ª ××•×¤×¦×™×•× ×œ×™×™×, ××” ×©×œ× ×ª××™×“ ×× ×¦×œ ××™× ×“×§×¡×™× ×‘×™×¢×™×œ×•×ª.

**××•×¤×¦×™×” ×œ×©×™×¤×•×¨ ×¢×ª×™×“×™:** ×”×•×¡×¤×ª ×©×“×” ××—×•×©×‘ `has_complete_metadata: true/false` ×©××ª×¢×“×›×Ÿ ×‘×¢×ª ×©××™×¨×”:

```python
# ×‘×–××Ÿ save/update ×©×œ ×§×•×‘×¥:
has_complete_metadata = bool(
    (doc.get('description') or '').strip() and 
    (doc.get('tags') or [])
)
doc['has_complete_metadata'] = has_complete_metadata
```

××– ×”×©××™×œ×ª×” ×”×•×¤×›×ª ×œ×¤×©×•×˜×”:
```python
{'has_complete_metadata': False}  # ×§×‘×¦×™× ×—×¡×¨×™ ××˜×-×“××˜×”
{'has_complete_metadata': True, 'updated_at': {'$lt': cutoff}}  # ×§×‘×¦×™× ×™×©× ×™×
```

---

## 7. ×–×¨×™××ª ×¢×‘×•×“×” ×œ×“×•×’××”

1. **××©×ª××© × ×›× ×¡ ×œ×“×©×‘×•×¨×“** â†’ ×¨×•××” ×›×¨×˜×™×¡ "×§×‘×¦×™× ×©×“×•×¨×©×™× ×˜×™×¤×•×œ"
2. **×¨×•××” 3 ×§×‘×¦×™× "×—×¡×¨×™ ×ª×™××•×¨/×ª×’×™×•×ª"** ×•-2 ×§×‘×¦×™× "×œ× ×¢×•×“×›× ×• ×–××Ÿ ×¨×‘"
3. **×œ×•×—×¥ ×¢×œ ×›×¤×ª×•×¨ ×”×¢×¨×™×›×” ×”××”×™×¨×”** (×¢×™×¤×¨×•×Ÿ) ×¢×œ ×§×•×‘×¥ ×—×¡×¨ ×ª×™××•×¨
4. **× ×¤×ª×— ××•×“×œ** â†’ ××•×¡×™×£ ×ª×™××•×¨ ×•×ª×’×™×•×ª â†’ ×œ×•×—×¥ "×©××•×¨"
5. **×”×§×•×‘×¥ × ×¢×œ× ××”×¨×©×™××”** â†’ ×”-Badge ×™×•×¨×“ ×‘-1
6. **×œ×•×—×¥ ×¢×œ ×›×¤×ª×•×¨ "×©×¢×•×Ÿ"** ×¢×œ ×§×•×‘×¥ ××—×¨ â†’ × ×¤×ª×— ××•×“×œ ×‘×—×™×¨×ª ×ª×§×•×¤×”
7. **×‘×•×—×¨ "×—×•×“×©"** â†’ ×”×§×•×‘×¥ × ×“×—×” ×œ-30 ×™××™× ×•× ×¢×œ× ××”×¨×©×™××”
8. **×××©×™×š ×œ×§×•×‘×¥ ×”×‘×** â€” ×”×›×œ ×‘×œ×™ ×œ×¢×–×•×‘ ××ª ×”×“×©×‘×•×¨×“

---

## 8. ×¡×™×›×•× ×©×™× ×•×™×™× × ×“×¨×©×™×

| ×§×•×‘×¥ | ×¡×•×’ ×©×™× ×•×™ | ×ª×™××•×¨ |
|------|-----------|--------|
| `webapp/app.py` | ×¤×•× ×§×¦×™×” ×—×“×©×” | `_build_files_need_attention()` |
| `webapp/app.py` | ×¤×•× ×§×¦×™×” ×—×“×©×” | `_get_active_dismissals()` |
| `webapp/app.py` | ×¢×“×›×•×Ÿ route | `/dashboard` - ×”×•×¡×¤×ª × ×ª×•× ×™ ×”×•×•×™×“×’'×˜ |
| `webapp/app.py` | API ×—×“×© | `/api/file/<id>/quick-update` |
| `webapp/app.py` | API ×—×“×© | `/api/file/<id>/dismiss-attention` |
| `webapp/templates/dashboard.html` | HTML ×—×“×© | ×ª×‘× ×™×ª ×”×•×•×™×“×’'×˜ + 2 ××•×“×œ×™× |
| `webapp/templates/dashboard.html` | CSS ×—×“×© | ×¡×’× ×•× ×•×ª ×œ×•×•×™×“×’'×˜ |
| `webapp/templates/dashboard.html` | JS ×—×“×© | ×œ×•×’×™×§×ª Quick Edit + Dismiss |
| MongoDB | ××™× ×“×§×¡×™× | 4 ××™× ×“×§×¡×™× ×—×“×©×™× |
| MongoDB | Collection ×—×“×© | `attention_dismissals` |

---

## 9. × ×§×•×“×•×ª ×—×©×•×‘×•×ª ×œ××™××•×©

### 9.1 ×”×¤×¨×“×” ×œ×•×’×™×ª ×‘×™×Ÿ ×”×§×‘×•×¦×•×ª
- ×§×•×‘×¥ **×œ× ×™×›×•×œ ×œ×”×•×¤×™×¢ ×‘×©×ª×™ ×”×§×‘×•×¦×•×ª** ×‘×•-×–×× ×™×ª
- ×§×‘×•×¦×ª "×œ× ×¢×•×“×›×Ÿ" ×›×•×œ×œ×ª **×¨×§** ×§×‘×¦×™× ×¢× ××˜×-×“××˜×” ××œ×
- ×”×©×™××•×© ×‘-`{'tags.0': {'$exists': True}}` ××‘×˜×™×— ×©×™×© ×œ×¤×—×•×ª ×ª×’×™×ª ××—×ª

### 9.2 Escaping ×‘-Template
- ×›×œ ×¢×¨×š ×©××•×–×¨×§ ×œ-`data-*` attribute ×¢×•×‘×¨ ×“×¨×š `| tojson`
- ×–×” ××•× ×¢ ×©×‘×™×¨×ª HTML ××ª×•×•×™× ××™×•×—×“×™× (×’×¨×©×™×™×, ×¡×•×’×¨×™×™× ×•×›×•')

### 9.3 ×¡×¤×™×¨×•×ª ×‘-UI
- ×”-Badge ×”×›×•×œ×œ ××ª×¢×“×›×Ÿ ×•×™×–×•××œ×™×ª ×‘×¢×ª ×”×¡×¨×ª ×¤×¨×™×˜×™×
- ×”×¡×¤×™×¨×•×ª ×‘×›×•×ª×¨×•×ª ×”×§×‘×•×¦×•×ª ××¦×™×’×•×ª "××•×¦×’×™× X ××ª×•×š Y"
- ×œ×¡× ×›×¨×•×Ÿ ××œ× ×©×œ ×”×¡×¤×™×¨×•×ª ×™×© ×œ×¨×¢× ×Ÿ ××ª ×”×“×£

### 9.4 "×œ× ×¢×•×“×›×Ÿ" vs "×œ× × ×¤×ª×—"
- ×”×•×•×™×“×’'×˜ ××‘×•×¡×¡ ×¢×œ `updated_at` ×‘×œ×‘×“
- ×”××•× ×— ×”× ×›×•×Ÿ ×”×•× **"×œ× ×¢×•×“×›×Ÿ ×–××Ÿ ×¨×‘"**
- ×× × ×¨×¦×” ×œ×¢×§×•×‘ ××—×¨×™ ×¦×¤×™×•×ª ×‘×¢×ª×™×“, ×™×© ×œ×”×•×¡×™×£ ×©×“×” `last_viewed_at` × ×¤×¨×“

### 9.5 ×ª×’×™×•×ª
- ×”×§×œ×˜ ×”×•× **×˜×§×¡×˜ ××•×¤×¨×“ ×‘×¤×¡×™×§×™×** (Comma-separated)
- ×œ× chip UI ××œ× ×‘×©×œ×‘ ×–×”
- ×”×ª×’×™×•×ª ×× ×•×¨××œ×•×ª ×œ-lowercase ×•××•×’×‘×œ×•×ª ×œ-20 ×ª×’×™×•×ª, 50 ×ª×•×•×™× ×›×œ ××—×ª

### 9.6 ×× ×™×¢×ª ××™×‘×•×“ × ×ª×•× ×™× ×‘-Quick Edit
**×‘×¢×™×” ×¤×•×˜× ×¦×™××œ×™×ª:** ×× ×”××©×ª××© ×¤×•×ª×— ×¢×¨×™×›×” ××”×™×¨×” ×¢×œ ×§×•×‘×¥ ×¢× 10 ×ª×’×™×•×ª, ××©× ×” ×¨×§ ××ª ×”×ª×™××•×¨ ×•×©×•××¨, ×”×ª×’×™×•×ª ×¢×œ×•×œ×•×ª ×œ×”×™×—×ª×š.

**×”×¤×ª×¨×•×Ÿ ×”××™×•×©×:**
1. **Backend:** ×©×•×œ×— ××ª **×›×œ** ×”×ª×’×™×•×ª (`tags_full`) ×‘-data attribute, ×œ× ×¨×§ 5 ×œ×ª×¦×•×’×”
2. **Frontend:** ×©×•××¨ ××ª ×”×¢×¨×›×™× ×”××§×•×¨×™×™× (`originalDescription`, `originalTags`) ×‘×¢×ª ×¤×ª×™×—×ª ×”××•×“×œ
3. **×‘×¢×ª ×©××™×¨×”:** ××©×•×•×” ××ª ×”×¢×¨×›×™× ×”×—×“×©×™× ×œ××§×•×¨×™×™× ×•×©×•×œ×— **×¨×§ ×©×“×•×ª ×©×”×©×ª× ×•**
4. ×× ×”××©×ª××© ×©×™× ×” ×¨×§ ××ª ×”×ª×™××•×¨ â€” ×”×ª×’×™×•×ª ×œ× × ×©×œ×—×•×ª ×•×œ× × ×¤×’×¢×•×ª

```javascript
// ×“×•×’××”: payload × ×‘× ×” ×¨×§ ××©×“×•×ª ×©×”×©×ª× ×•
const payload = {};
if (newDescription !== originalDescription) {
    payload.description = newDescription;
}
if (newTagsRaw !== originalTags) {
    payload.tags = newTagsRaw.split(',').map(t => t.trim()).filter(Boolean);
}
// ×× payload ×¨×™×§ â€” ×œ× × ×©×œ×— ×›×œ×•×
```

---

## 10. ×©×“×¨×•×’×™× ×¢×ª×™×“×™×™× ××¤×©×¨×™×™×

1. **Chip Input ×××™×ª×™** â€” ×¨×›×™×‘ UI ××ª×§×“× ×œ×‘×—×™×¨×ª ×ª×’×™×•×ª
2. **×©×“×” `last_viewed_at`** â€” ××¢×§×‘ ××—×¨×™ ×¦×¤×™×•×ª ×•×œ× ×¨×§ ×¢×“×›×•× ×™×
3. **×©×“×” `has_complete_metadata`** â€” ×œ×©×™×¤×•×¨ ×‘×™×¦×•×¢×™ ×©××™×œ×ª×•×ª
4. **Auto-suggest ×œ×ª×™××•×¨** â€” ×”×¦×¢×” ××•×˜×•××˜×™×ª ×¢×œ ×‘×¡×™×¡ ×©× ×”×§×•×‘×¥
5. **Bulk actions** â€” ×ª×™×§×•×Ÿ ××”×™×¨ ×©×œ ××¡×¤×¨ ×§×‘×¦×™× ×‘×‘×ª ××—×ª
6. **×¡×™× ×•×Ÿ ×œ×¤×™ ×©×¤×”** â€” ×”×¦×’×ª ×§×‘×¦×™× ×—×¡×¨×™ ××˜×-×“××˜×” ×œ×¤×™ ×©×¤×ª ×ª×›× ×•×ª

---

*××¡××š ×–×” (v2) × ×•×¦×¨ ×‘-19/01/2026 ×•××•×ª×× ×œ××¨×›×™×˜×§×˜×•×¨×” ×”×§×™×™××ª ×©×œ CodeBot.*
*×¢×•×“×›×Ÿ ×¢×œ ×‘×¡×™×¡ ×‘×™×§×•×¨×ª ××¨×›×™×˜×§×˜×•×¨×”.*
