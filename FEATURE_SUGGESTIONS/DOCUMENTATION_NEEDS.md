# ğŸ“š ×¦×¨×›×™ ×ª×™×¢×•×“ - CodeBot & WebApp

> **××˜×¨×”:** ×œ×¡×›× ××” ×§×¨×™×˜×™ ×œ×”×•×¡×™×£ ×œ××ª×¨ ×”×ª×™×¢×•×“ ([https://amirbiron.github.io/CodeBot/](https://amirbiron.github.io/CodeBot/)) ×›×“×™ ×œ×¢×–×•×¨ ×œ××¤×ª×—×™× ×•×œ×¡×•×›× ×™ AI ×‘×¢×‘×•×“×” ×¢×œ ×”×¨×™×¤×•.

**×ª××¨×™×š ×™×¦×™×¨×”:** 2025-10-10  
**×¡×˜×˜×•×¡:** ×××ª×™×Ÿ ×œ××™××•×©

---

## ğŸ“‹ ×ª×•×›×Ÿ ×¢× ×™×™× ×™×

- [×—×¡×¨×™× ×§×¨×™×˜×™×™× (×¢×“×™×¤×•×ª ×’×‘×•×”×”)](#-×—×¡×¨×™×-×§×¨×™×˜×™×™×-×¢×“×™×¤×•×ª-×’×‘×•×”×”)
- [×—×¡×¨×™× ×—×©×•×‘×™× (×¢×“×™×¤×•×ª ×‘×™× ×•× ×™×ª)](#-×—×¡×¨×™×-×—×©×•×‘×™×-×¢×“×™×¤×•×ª-×‘×™× ×•× ×™×ª)
- [×¨×¦×•×™ ×œ×”×•×¡×™×£ (×¢×“×™×¤×•×ª × ××•×›×”)](#-×¨×¦×•×™-×œ×”×•×¡×™×£-×¢×“×™×¤×•×ª-× ××•×›×”)
- [×”××œ×¦×•×ª ×™×™×©×•× ××™×™×“×™×•×ª](#-×”××œ×¦×•×ª-×™×™×©×•×-××™×™×“×™×•×ª)
- [×˜×™×¤ ×—×©×•×‘ ×œ×¡×•×›× ×™ AI](#-×˜×™×¤-×—×©×•×‘-×œ×¡×•×›× ×™-ai)

---

## âš ï¸ ×—×¡×¨×™× ×§×¨×™×˜×™×™× (×¢×“×™×¤×•×ª ×’×‘×•×”×”)

### 1. ğŸ¤ ××“×¨×™×š ×ª×¨×•××” ×œ××¤×ª×—×™× (CONTRIBUTING.md)

**×œ××” ×–×” ×—×©×•×‘:**
- ×¡×•×›× ×™ AI ×¦×¨×™×›×™× ×œ×”×‘×™×Ÿ ××ª ×ª×”×œ×™×š ×”×¤×™×ª×•×—
- ××¤×ª×—×™× ×—×“×©×™× ×¦×¨×™×›×™× × ×§×•×“×ª ×›× ×™×¡×” ×‘×¨×•×¨×”
- ×ª×§× ×™× ×¢×§×‘×™×™× ×œ×§×•×“

**××” ×œ×”×•×¡×™×£:**
- âœ… ×›×œ×œ×™ ×§×•×“ (code style, PEP 8, type hints)
- âœ… ×ª×”×œ×™×š PR (branch naming, commit messages, review process)
- âœ… ×”×¨×¦×ª ×˜×¡×˜×™× (pytest, coverage, linting)
- âœ… ×”×’×“×¨×ª ×¡×‘×™×‘×ª ×¤×™×ª×•×— ××§×•××™×ª
- âœ… ×“×•×’×××•×ª ×œ×ª×¨×•××•×ª ×˜×•×‘×•×ª
- âœ… checklist ×œ×¤× ×™ ×©×œ×™×—×ª PR

**××™×§×•× ××•×¦×¢:** `docs/contributing.rst`

---

### 2. ğŸ—ï¸ ××¨×›×™×˜×§×˜×•×¨×” ×•××‘× ×” ×”×¤×¨×•×™×§×˜ (ARCHITECTURE.md)

**×œ××” ×–×” ×—×©×•×‘:**
- ×”×‘× ×” ××”×™×¨×” ×©×œ ×”××¢×¨×›×ª ×›×•×œ×”
- ××¤×ª ×“×¨×›×™× ×œ××¦×™××ª ×§×•×“ ×¨×œ×•×•× ×˜×™
- ×”×—×œ×˜×•×ª ×¢×™×¦×•×‘ ×•×”×™×’×™×•×Ÿ

**××” ×œ×”×•×¡×™×£:**
- âœ… ×ª×¨×©×™× ××¨×›×™×˜×§×˜×•×¨×” (handlers â†’ services â†’ database)
- âœ… ×–×¨×™××ª × ×ª×•× ×™× (data flow)
- âœ… ×¨×›×™×‘×™× ×¢×™×§×¨×™×™× ×•×”××—×¨×™×•×ª ×©×œ×”×
- âœ… ×“×¤×•×¡×™ ×¢×™×¦×•×‘ ×‘×©×™××•×© (patterns)
- âœ… ×”×—×œ×˜×•×ª ×˜×›× ×™×•×ª ××¨×›×–×™×•×ª (×œ××” MongoDB? ×œ××” Telegram Bot API?)
- âœ… ××‘× ×” ×ª×™×§×™×•×ª ××¤×•×¨×˜
- âœ… ×§×©×¨×™× ×‘×™×Ÿ ××•×“×•×œ×™×

**×“×•×’××” ×œ××” ×©×¦×¨×™×š:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Telegram  â”‚
â”‚   Updates   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Handlers   â”‚
â”‚ (bot_handlers,â”‚
â”‚ conversation_â”‚
â”‚  handlers)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Services   â”‚
â”‚ (github,    â”‚
â”‚  backup,    â”‚
â”‚  code)      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database   â”‚
â”‚  (MongoDB)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**××™×§×•× ××•×¦×¢:** `docs/architecture.rst`

---

### 3. ğŸ§ª ××“×¨×™×š ×”×¨×¦×ª ×˜×¡×˜×™× ×•-CI/CD

**×œ××” ×–×” ×—×©×•×‘:**
- ×¡×•×›× ×™ AI ×¦×¨×™×›×™× ×œ×“×¢×ª ××™×š ×œ×•×•×“× ×©×”×§×•×“ ×©×œ×”× ×¢×•×‘×“
- ××¤×ª×—×™× ×¦×¨×™×›×™× ×œ×”×¨×™×¥ ×˜×¡×˜×™× ×œ×¤× ×™ PR

**××” ×œ×”×•×¡×™×£:**

#### ×. ×”×¨×¦×ª ×˜×¡×˜×™× ××§×•××™×ª
```bash
# ×”×¨×¦×ª ×›×œ ×”×˜×¡×˜×™×
pytest

# ×”×¨×¦×ª ×˜×¡×˜ ×¡×¤×¦×™×¤×™
pytest tests/test_bot_handlers.py

# ×¢× coverage
pytest --cov=. --cov-report=html

# ×”×¨×¦×ª linting
flake8 .
mypy .
black --check .
```

#### ×‘. ×”×¡×‘×¨ ×¢×œ CI/CD Pipeline
- GitHub Actions workflows
- ×¡×˜×˜×•×¡×™ ×‘×“×™×§×” × ×“×¨×©×™×:
  - ğŸ” Code Quality & Security
  - ğŸ§ª Unit Tests (3.11)
  - ğŸ§ª Unit Tests (3.12)
- ××™×š ×œ×“×‘×’ ×›×©×œ×•× ×•×ª ×‘-CI

#### ×’. ×›×œ×œ×™×
- Coverage ××™× ×™××œ×™: 80%
- ×›×œ PR ×—×™×™×‘ ×œ×¢×‘×•×¨ linting
- ×˜×¡×˜×™× ×—×™×™×‘×™× ×œ×¢×‘×•×¨ ×‘-2 ×’×¨×¡××•×ª Python

#### ×“. ××™×š ×œ×›×ª×•×‘ ×˜×¡×˜×™× ×—×“×©×™×
```python
# ×“×•×’××” ×œ×˜×¡×˜ handler
import pytest
from unittest.mock import AsyncMock, patch

@pytest.mark.asyncio
async def test_save_command():
    """Test the /save command handler."""
    update = create_mock_update()
    context = create_mock_context()
    
    result = await save_command(update, context)
    
    assert result == ConversationStates.WAITING_FOR_CODE
    assert context.bot.send_message.called
```

**××™×§×•× ××•×¦×¢:** `docs/testing.rst` + `docs/ci-cd.rst`

---

### 4. ğŸŒ API Reference ×œWebApp

**×œ××” ×–×” ×—×©×•×‘:**
- ×”×ª×™×¢×•×“ ×”×§×™×™× ××ª××§×“ ×‘×‘×•×˜, ×œ× ×‘-webapp
- endpoints, authentication, response formats ×—×¡×¨×™×

**××” ×œ×”×•×¡×™×£:**

#### ×˜×‘×œ×ª Endpoints ××œ××”

| Endpoint | Method | ×ª×™××•×¨ | ×“×•×¨×© ××™××•×ª | Request Body | Response |
|----------|--------|-------|-------------|--------------|----------|
| `/` | GET | ×“×£ ×”×‘×™×ª | âŒ | - | HTML |
| `/login` | GET | ×“×£ ×”×ª×—×‘×¨×•×ª | âŒ | - | HTML |
| `/auth/telegram` | POST | ××™××•×ª Telegram | âŒ | `{id, first_name, ...}` | `{success: true}` |
| `/logout` | GET | ×”×ª× ×ª×§×•×ª | âœ… | - | Redirect |
| `/dashboard` | GET | ×“×©×‘×•×¨×“ | âœ… | - | HTML |
| `/files` | GET | ×¨×©×™××ª ×§×‘×¦×™× | âœ… | Query: `?search=...&lang=...` | HTML |
| `/file/<id>` | GET | ×¦×¤×™×™×” ×‘×§×•×‘×¥ | âœ… | - | HTML |
| `/download/<id>` | GET | ×”×•×¨×“×ª ×§×•×‘×¥ | âœ… | - | File Download |
| `/html/<id>` | GET | ×ª×¦×•×’×ª HTML ×‘×˜×•×—×” | âœ… | - | HTML (iframe) |
| `/md/<id>` | GET | ×ª×¦×•×’×ª Markdown | âœ… | - | HTML (rendered) |
| `/api/stats` | GET | ×¡×˜×˜×™×¡×˜×™×§×•×ª | âœ… | - | JSON |

#### Authentication Flow
```mermaid
sequenceDiagram
    User->>WebApp: GET /login
    WebApp->>User: Login page with Telegram Widget
    User->>Telegram: Click "Login"
    Telegram->>WebApp: POST /auth/telegram (user data + hash)
    WebApp->>WebApp: Verify hash with BOT_TOKEN
    WebApp->>User: Set session cookie
    User->>WebApp: GET /dashboard
    WebApp->>User: Dashboard (authenticated)
```

#### Response Schemas
```json
// GET /api/stats
{
  "total_files": 156,
  "languages": {
    "python": 45,
    "javascript": 32,
    "java": 20
  },
  "recent_files": [
    {
      "id": "507f1f77bcf86cd799439011",
      "file_name": "example.py",
      "language": "python",
      "created_at": "2025-10-10T10:30:00Z"
    }
  ]
}
```

#### Error Handling
```json
// 401 Unauthorized
{
  "error": "Authentication required",
  "redirect": "/login"
}

// 404 Not Found
{
  "error": "File not found",
  "file_id": "507f1f77bcf86cd799439011"
}

// 500 Internal Server Error
{
  "error": "Database connection failed",
  "details": "..."
}
```

**××™×§×•× ××•×¦×¢:** `docs/webapp/api-reference.rst`

---

### 5. ğŸ”§ Environment Variables Reference ××œ×

**×œ××” ×–×” ×—×©×•×‘:**
- ×™×© ××©×ª× ×™ ×¡×‘×™×‘×” ×¤×–×•×¨×™× ×‘××¡××›×™× ×©×•× ×™×
- ×¦×¨×™×š ××§×•×¨ ××—×“ ×•××§×™×£

**××” ×œ×”×•×¡×™×£:**

#### ×˜×‘×œ×” ××¨×›×–×™×ª

| ××©×ª× ×” | ×ª×™××•×¨ | ×—×•×‘×” | ×‘×¨×™×¨×ª ××—×“×œ | ×“×•×’××” | ×¨×›×™×‘ |
|-------|--------|------|-------------|--------|------|
| `BOT_TOKEN` | ×˜×•×§×Ÿ ×”×‘×•×˜ ×-BotFather | âœ… | - | `123456:ABC-DEF...` | Bot |
| `MONGODB_URL` | ×—×™×‘×•×¨ ×œ-MongoDB | âœ… | - | `mongodb://localhost:27017` | Both |
| `DATABASE_NAME` | ×©× DB | âŒ | `code_keeper_bot` | `my_db` | Both |
| `SECRET_KEY` | ××¤×ª×— ×”×¦×¤× ×” Flask | âœ… (WebApp) | - | `supersecretkey123` | WebApp |
| `BOT_USERNAME` | ×©× ××©×ª××© ×”×‘×•×˜ | âŒ | `my_code_keeper_bot` | `@MyBot` | Both |
| `GITHUB_TOKEN` | ×˜×•×§×Ÿ GitHub | âŒ | - | `ghp_xxx...` | Bot |
| `WEBAPP_URL` | ×›×ª×•×‘×ª WebApp | âŒ | `https://...onrender.com` | `https://my.app` | WebApp |
| `REDIS_URL` | ×—×™×‘×•×¨ ×œ-Redis (cache) | âŒ | - | `redis://localhost:6379` | Bot |
| `LOG_LEVEL` | ×¨××ª logging | âŒ | `INFO` | `DEBUG` | Both |
| `ENCRYPTION_KEY` | ××¤×ª×— ×”×¦×¤× ×” × ×ª×•× ×™× | âŒ | - | `32-byte-key` | Both |
| `RATE_LIMIT_ENABLED` | ×”×¤×¢×œ×ª rate limiting | âŒ | `false` | `true` | Bot |
| `MAX_FILES_PER_USER` | ××§×¡×™××•× ×§×‘×¦×™× | âŒ | `1000` | `5000` | Bot |
| `BACKUP_ENABLED` | ×”×¤×¢×œ×ª ×’×™×‘×•×™×™× | âŒ | `false` | `true` | Bot |
| `UPTIME_PROVIDER` | ×¡×¤×§ uptime monitoring | âŒ | - | `betteruptime` | WebApp |

#### ×“×•×’×××•×ª ×œ×§×•× ×¤×™×’×•×¨×¦×™×•×ª

**Development (××§×•××™):**
```env
BOT_TOKEN=your_bot_token_here
MONGODB_URL=mongodb://localhost:27017
DATABASE_NAME=code_keeper_dev
LOG_LEVEL=DEBUG
```

**Staging:**
```env
BOT_TOKEN=staging_bot_token
MONGODB_URL=mongodb+srv://user:pass@cluster.mongodb.net
DATABASE_NAME=code_keeper_staging
LOG_LEVEL=INFO
REDIS_URL=redis://staging-redis:6379
```

**Production:**
```env
BOT_TOKEN=prod_bot_token
MONGODB_URL=mongodb+srv://user:pass@prod-cluster.mongodb.net
DATABASE_NAME=code_keeper_prod
LOG_LEVEL=WARNING
REDIS_URL=redis://prod-redis:6379
ENCRYPTION_KEY=your-32-byte-encryption-key
RATE_LIMIT_ENABLED=true
BACKUP_ENABLED=true
```

**××™×§×•× ××•×¦×¢:** `docs/environment-variables.rst`

---

## ğŸ”§ ×—×¡×¨×™× ×—×©×•×‘×™× (×¢×“×™×¤×•×ª ×‘×™× ×•× ×™×ª)

### 6. ğŸ› ï¸ Troubleshooting Guide ××¤×•×¨×˜

**××” ×œ×”×•×¡×™×£:**

#### ×©×’×™××•×ª × ×¤×•×¦×•×ª ×•×¤×ª×¨×•× ×•×ª

**×©×’×™××”:** `ModuleNotFoundError: No module named 'telegram'`
```bash
# ×¤×ª×¨×•×Ÿ:
pip install -r requirements.txt
# ××• ×¡×¤×¦×™×¤×™×ª:
pip install python-telegram-bot
```

**×©×’×™××”:** `ServerSelectionTimeoutError: No servers available`
```bash
# ×¤×ª×¨×•×Ÿ:
# 1. ×‘×“×•×§ ×©-MongoDB ×¨×¥:
systemctl status mongodb
# 2. ×‘×“×•×§ ××ª ×”-MONGODB_URL ×‘-.env
# 3. ×× Atlas - ×‘×“×•×§ Network Access (IP whitelist)
```

**×©×’×™××”:** `Telegram API Error: Conflict: terminated by other getUpdates`
```bash
# ×¤×ª×¨×•×Ÿ:
# ×™×© instance ××—×¨ ×©×œ ×”×‘×•×˜ ×©×¨×¥
pkill -f "python main.py"
# ×—×›×” 30 ×©× ×™×•×ª ×•× ×¡×” ×©×•×‘
```

**×©×’×™××”:** `Message is not modified`
```python
# ×¤×ª×¨×•×Ÿ: ×”×©×ª××© ×‘-wrapper ×‘×˜×•×—
async def safe_edit(query, text, reply_markup=None):
    try:
        await query.edit_message_text(text=text, reply_markup=reply_markup)
    except telegram.error.BadRequest as e:
        if "message is not modified" in str(e).lower():
            return  # ×”×ª×¢×œ× ××”×©×’×™××”
        raise
```

#### ×“×™×‘×•×’

**×”×¤×¢×œ×ª debug mode:**
```bash
LOG_LEVEL=DEBUG python main.py
```

**×¦×¤×™×™×” ×‘×œ×•×’×™×:**
```bash
# ×‘-Render:
# Dashboard â†’ Service â†’ Logs â†’ Live Logs

# ××§×•××™:
tail -f bot.log
```

**×‘×“×™×§×ª ×—×™×‘×•×¨ MongoDB:**
```python
python -c "from database.manager import DatabaseManager; db = DatabaseManager(); print('Connected!' if db.test_connection() else 'Failed')"
```

#### ×‘×¢×™×•×ª Deployment ×‘-Render

**×”×‘×•×˜ × ×¨×“× (sleep mode):**
- Free plan: ×”×‘×•×˜ × ×¨×“× ××—×¨×™ 15 ×“×§×•×ª ×—×•×¡×¨ ×¤×¢×™×œ×•×ª
- ×¤×ª×¨×•×Ÿ 1: ×©×“×¨×’ ×œ-Starter Plan ($7/month)
- ×¤×ª×¨×•×Ÿ 2: ×©×™××•×© ×‘-cron job ×œping ×›×œ 10 ×“×§×•×ª

**×‘×¢×™×•×ª ×–×™×›×¨×•×Ÿ:**
- Free plan: 512MB RAM
- ×‘×“×™×§×ª ×©×™××•×© ×–×™×›×¨×•×Ÿ:
```python
import psutil
print(f"RAM: {psutil.virtual_memory().percent}%")
```

**××™×§×•× ××•×¦×¢:** `docs/troubleshooting.rst`

---

### 7. ğŸ”„ ××“×¨×™×š Migration/Upgrade

**××” ×œ×”×•×¡×™×£:**
- ××™×š ×œ×©×“×¨×’ ×‘×™×Ÿ ×’×¨×¡××•×ª
- breaking changes ×‘×›×œ ×’×¨×¡×”
- database migrations (×× ×™×©)
- backup ×œ×¤× ×™ ×©×“×¨×•×’
- rollback plan

**×“×•×’××”:**
```markdown
## Upgrade from v1.0 to v2.0

### Breaking Changes
- Changed database schema for `code_snippets` collection
- New required environment variable: `ENCRYPTION_KEY`

### Migration Steps
1. Backup your database:
   ```bash
   mongodump --uri="$MONGODB_URL" --out=./backup
   ```

2. Update code:
   ```bash
   git pull origin main
   pip install -r requirements.txt --upgrade
   ```

3. Run migration script:
   ```bash
   python scripts/migrate_v1_to_v2.py
   ```

4. Test:
   ```bash
   pytest tests/
   ```

5. Deploy
```

**××™×§×•× ××•×¦×¢:** `docs/migration.rst`

---

### 8. ğŸ”¨ Development Workflow

**××” ×œ×”×•×¡×™×£:**

#### ××™×š ×œ×”×•×¡×™×£ handler ×—×“×©

```python
# 1. ×¦×•×¨ ×§×•×‘×¥ ×—×“×©: handlers/my_feature.py
from telegram import Update
from telegram.ext import ContextTypes

async def my_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Handle /mycommand."""
    await update.message.reply_text("Hello!")

# 2. ×”×•×¡×£ ×œ-main.py:
from handlers.my_feature import my_command

app.add_handler(CommandHandler("mycommand", my_command))

# 3. ×›×ª×•×‘ ×˜×¡×˜: tests/test_my_feature.py
@pytest.mark.asyncio
async def test_my_command():
    # ...
```

#### ××™×š ×œ×”×•×¡×™×£ endpoint ×œ-WebApp

```python
# 1. ×‘-webapp/app.py:
@app.route('/my-endpoint')
@login_required
def my_endpoint():
    return render_template('my_page.html')

# 2. ×¦×•×¨ template: webapp/templates/my_page.html
{% extends "base.html" %}
{% block content %}
  <h1>My Page</h1>
{% endblock %}

# 3. ×¢×“×›×Ÿ ×ª×™×¢×•×“ API
```

#### ××™×š ×œ×¢×“×›×Ÿ database schema

```python
# 1. ×¢×“×›×Ÿ model: database/models.py
class CodeSnippet:
    def __init__(self, new_field=None):
        self.new_field = new_field  # NEW

# 2. ×¦×•×¨ migration script
def migrate_add_new_field():
    db.code_snippets.update_many(
        {"new_field": {"$exists": False}},
        {"$set": {"new_field": None}}
    )

# 3. ×¢×“×›×Ÿ ×˜×¡×˜×™×
```

**××™×§×•× ××•×¦×¢:** `docs/development.rst`

---

### 9. ğŸ”’ Security Best Practices

**××” ×œ×”×•×¡×™×£:**
- ××™×š ×œ×˜×¤×œ ×‘×˜×•×§× ×™× (×”×¦×¤× ×”, ××—×¡×•×Ÿ)
- encryption ×©×œ × ×ª×•× ×™× ×¨×’×™×©×™×
- rate limiting
- input validation
- ×”×¨×©××•×ª ××©×ª××©
- OWASP Top 10 considerations

**×“×•×’×××•×ª:**
```python
# Encryption ×©×œ ×˜×•×§× ×™×
from cryptography.fernet import Fernet

def encrypt_token(token: str, key: bytes) -> str:
    f = Fernet(key)
    return f.encrypt(token.encode()).decode()

# Input validation
def validate_filename(filename: str) -> bool:
    if not filename or len(filename) > 255:
        return False
    # Block path traversal
    if '..' in filename or '/' in filename:
        return False
    return True

# Rate limiting
from functools import wraps
from time import time

def rate_limit(max_calls=10, period=60):
    calls = {}
    def decorator(func):
        @wraps(func)
        async def wrapper(update, context):
            user_id = update.effective_user.id
            now = time()
            if user_id not in calls:
                calls[user_id] = []
            calls[user_id] = [t for t in calls[user_id] if now - t < period]
            if len(calls[user_id]) >= max_calls:
                await update.message.reply_text("Too many requests!")
                return
            calls[user_id].append(now)
            return await func(update, context)
        return wrapper
    return decorator
```

**××™×§×•× ××•×¦×¢:** `docs/security.rst`

---

### 10. âš¡ Performance & Optimization Guide

**××” ×œ×”×•×¡×™×£:**

#### MongoDB Indexing
```javascript
// Recommended indexes
db.code_snippets.createIndex({"user_id": 1, "created_at": -1})
db.code_snippets.createIndex({"programming_language": 1})
db.code_snippets.createIndex({"file_name": "text", "code": "text"})

// Check index usage
db.code_snippets.find({user_id: 123}).explain("executionStats")
```

#### Caching Strategies
```python
# Redis cache for frequent queries
import redis
from functools import wraps

redis_client = redis.from_url(os.getenv('REDIS_URL'))

def cache_result(ttl=300):
    def decorator(func):
        @wraps(func)
        async def wrapper(*args, **kwargs):
            key = f"{func.__name__}:{args}:{kwargs}"
            cached = redis_client.get(key)
            if cached:
                return json.loads(cached)
            result = await func(*args, **kwargs)
            redis_client.setex(key, ttl, json.dumps(result))
            return result
        return wrapper
    return decorator
```

#### Batch Processing
```python
# Process multiple files at once
async def save_multiple_files(files: list):
    # Instead of N database calls:
    # for file in files:
    #     db.insert_one(file)
    
    # Do one bulk insert:
    db.insert_many(files)
```

#### Memory Optimization
```python
# Don't load all files into memory
# BAD:
files = list(db.find({}))  # Loads everything!

# GOOD:
for file in db.find({}).batch_size(100):  # Streams in batches
    process_file(file)
```

**××™×§×•× ××•×¦×¢:** `docs/performance.rst`

---

## ğŸ“ ×¨×¦×•×™ ×œ×”×•×¡×™×£ (×¢×“×™×¤×•×ª × ××•×›×”)

### 11. â“ FAQ ×œ××¤×ª×—×™×

**×©××œ×•×ª × ×¤×•×¦×•×ª:**
- ×œ××” × ×‘×—×¨×” MongoDB?
- ××™×š ×¢×•×‘×“ ×”-state management ×‘-ConversationHandler?
- ×œ××” ×™×© ×’× bot ×•×’× webapp?
- ××™×š ×œ×ª×¨×•× ×ª×¨×’×•× ×œ×©×¤×” ×—×“×©×”?
- ××™×š ×œ×”×•×¡×™×£ ×©×¤×ª ×ª×›× ×•×ª ×—×“×©×” ×œ×”×“×’×©×ª syntax?

---

### 12. ğŸ“œ Code of Conduct

**×ª×•×›×Ÿ:**
- ×”×ª× ×”×’×•×ª ××¦×•×¤×”
- ×”×ª× ×”×’×•×ª ××¡×•×¨×”
- ×ª×”×œ×™×š ×“×™×•×•×— ×¢×œ ×‘×¢×™×•×ª
- enforcement

---

### 13. ğŸ“… Changelog ××¤×•×¨×˜

**×¤×•×¨××˜:**
```markdown
## [2.0.0] - 2025-10-10

### Added
- WebApp with Telegram Login
- Markdown preview with KaTeX support
- Bookmarks feature

### Changed
- Improved database schema
- Updated to python-telegram-bot v20

### Fixed
- Memory leak in file processing
- Rate limiting bug

### Security
- Added encryption for GitHub tokens
```

---

### 14. ğŸ—ºï¸ Roadmap ×¦×™×‘×•×¨×™

**××” ×œ×›×œ×•×œ:**
- ×¤×™×¦'×¨×™× ×‘×¤×™×ª×•×—
- ×¤×™×¦'×¨×™× ××ª×•×›× × ×™×
- ×¨×¢×™×•× ×•×ª ×¢×ª×™×“×™×™×
- timeline ××©×•×¢×¨

---

### 15. ğŸ“Š Sequence Diagrams ×œ×–×¨×™××•×ª ××¨×›×–×™×•×ª

**×“×•×’×××•×ª:**

**×©××™×¨×ª ×§×•×‘×¥:**
```mermaid
sequenceDiagram
    User->>Bot: /save file.py
    Bot->>Handler: save_command()
    Handler->>User: "×©×œ×— ××ª ×”×§×•×“"
    User->>Bot: <code content>
    Bot->>Handler: handle_code()
    Handler->>CodeProcessor: process_code()
    CodeProcessor->>Handler: {language, highlighted}
    Handler->>Database: save_snippet()
    Database->>Handler: {id, success}
    Handler->>User: "× ×©××¨ ×‘×”×¦×œ×—×”!"
```

**GitHub Integration:**
```mermaid
sequenceDiagram
    User->>Bot: /share file.py â†’ GitHub Gist
    Bot->>Handler: share_to_gist()
    Handler->>Database: get_file()
    Database->>Handler: file_data
    Handler->>GitHub API: create_gist()
    GitHub API->>Handler: gist_url
    Handler->>User: "×©×•×ª×£ ×‘-Gist: <url>"
```

---

## ğŸ¯ ×”××œ×¦×•×ª ×™×™×©×•× ××™×™×“×™×•×ª

### ×©×œ×‘ 1: ×™×¦×™×¨×ª ×“×¤×™× ×—×“×©×™× ×‘-`docs/`

```
docs/
â”œâ”€â”€ contributing.rst         # NEW - ××“×¨×™×š ×ª×¨×•××”
â”œâ”€â”€ architecture.rst         # NEW - ××¨×›×™×˜×§×˜×•×¨×”
â”œâ”€â”€ testing.rst             # NEW - ×˜×¡×˜×™×
â”œâ”€â”€ ci-cd.rst              # NEW - CI/CD
â”œâ”€â”€ troubleshooting.rst    # NEW - ×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª
â”œâ”€â”€ development.rst        # NEW - ×ª×”×œ×™×š ×¤×™×ª×•×—
â”œâ”€â”€ security.rst           # NEW - ××‘×˜×—×”
â”œâ”€â”€ performance.rst        # NEW - ×‘×™×¦×•×¢×™×
â”œâ”€â”€ environment-variables.rst  # NEW - ××©×ª× ×™ ×¡×‘×™×‘×”
â”œâ”€â”€ migration.rst          # NEW - ×©×“×¨×•×’×™×
â””â”€â”€ webapp/
    â””â”€â”€ api-reference.rst  # NEW - API ×©×œ webapp
```

### ×©×œ×‘ 2: ×¢×“×›×•×Ÿ `docs/index.rst`

×”×•×¡×£ ××ª ×”×“×¤×™× ×”×—×“×©×™× ×œ-toctree:

```rst
.. Code Keeper Bot documentation master file

Code Keeper Bot - ×ª×™×¢×•×“ API
============================

.. toctree::
   :maxdepth: 2
   :caption: ××“×¨×™×›×™× ×‘×¡×™×¡×™×™×:

   installation
   configuration
   environment-variables

.. toctree::
   :maxdepth: 2
   :caption: ×œ××¤×ª×—×™×:
   
   contributing
   architecture
   development
   testing
   ci-cd
   troubleshooting
   security
   performance
   migration

.. toctree::
   :maxdepth: 2
   :caption: API Reference:
   
   api/index
   modules/index
   handlers/index
   services/index
   database/index

.. toctree::
   :maxdepth: 2
   :caption: WebApp:
   
   webapp/overview
   webapp/api-reference

.. toctree::
   :maxdepth: 2
   :caption: ×¢×–×¨×” ×•×“×•×’×××•×ª:
   
   examples
   user/share_code
   user/github_browse
   user/download_repo
```

### ×©×œ×‘ 3: ×§×™×©×•×¨ ×-README.md

×”×•×¡×£ ×¡×¢×™×£ ×‘×•×œ×˜ ×‘-README:

```markdown
## ğŸ“– ×ª×™×¢×•×“ ×œ××¤×ª×—×™×

××ª×›× ×Ÿ ×œ×ª×¨×•× ×œ×¤×¨×•×™×§×˜? ×”×ª×—×œ ×›××Ÿ:

- **[××“×¨×™×š ×ª×¨×•××”](https://amirbiron.github.io/CodeBot/contributing.html)** - ××™×š ×œ×ª×¨×•× ×§×•×“
- **[××¨×›×™×˜×§×˜×•×¨×”](https://amirbiron.github.io/CodeBot/architecture.html)** - ×”×‘× ×ª ×”××¢×¨×›×ª
- **[××“×¨×™×š ×¤×™×ª×•×—](https://amirbiron.github.io/CodeBot/development.html)** - workflow ×™×•××™×•××™
- **[×˜×¡×˜×™×](https://amirbiron.github.io/CodeBot/testing.html)** - ××™×š ×œ×”×¨×™×¥ ×•×œ×›×ª×•×‘ ×˜×¡×˜×™×
- **[API Reference](https://amirbiron.github.io/CodeBot/api/index.html)** - ×ª×™×¢×•×“ API ××œ×
```

### ×©×œ×‘ 4: ×™×¦×™×¨×ª Templates

×¦×•×¨ ×ª×‘× ×™×•×ª ×¡×˜× ×“×¨×˜×™×•×ª:

**`docs/_templates/module_template.rst`:**
```rst
Module Name
===========

×ª×™××•×¨ ×›×œ×œ×™ ×©×œ ×”××•×“×•×œ.

Overview
--------

××” ×”××•×“×•×œ ×¢×•×©×”?

Usage
-----

.. code-block:: python

   from module import MyClass
   
   obj = MyClass()
   obj.do_something()

API Reference
-------------

.. automodule:: module
   :members:
   :undoc-members:
   :show-inheritance:

Examples
--------

×“×•×’×××•×ª ××¢×©×™×•×ª.

See Also
--------

- :mod:`related_module`
- :doc:`../guides/related_guide`
```

---

## ğŸ’¡ ×˜×™×¤ ×—×©×•×‘ ×œ×¡×•×›× ×™ AI

### ×¦×•×¨ ×§×•×‘×¥ `docs/ai-developer-guide.rst`

**×ª×•×›×Ÿ ××•×¦×¢:**

```rst
××“×¨×™×š ××”×™×¨ ×œ×¡×•×›× ×™ AI ×•××¤×ª×—×™×
==============================

××¡××š ×–×” ××¡×¤×§ ×¡×§×™×¨×” ××”×™×¨×” ×œ××¦×™××ª ××™×“×¢ ×‘×¤×¨×•×™×§×˜.

××™×¤×” ×œ××¦×•× ××”?
---------------

**×¨×•×¦×” ×œ×”×•×¡×™×£ ×¤×™×¦'×¨ ×—×“×©?**
â†’ ×§×¨×: :doc:`development` â†’ "Adding a new feature"

**×¨×•×¦×” ×œ×ª×§×Ÿ ×‘××’?**
â†’ ×§×¨×: :doc:`troubleshooting` â†’ ××¦× ××ª ×”×©×’×™××”

**×¨×•×¦×” ×œ×”×‘×™×Ÿ ××ª ×”××¨×›×™×˜×§×˜×•×¨×”?**
â†’ ×§×¨×: :doc:`architecture` â†’ ×ª×¨×©×™××™× ×•×–×¨×™××•×ª

**×¨×•×¦×” ×œ×”×¨×™×¥ ×˜×¡×˜×™×?**
â†’ ×§×¨×: :doc:`testing` â†’ Quick Start

**×¨×•×¦×” ×œ×¤×¨×•×¡?**
â†’ ×§×¨×: :doc:`installation` â†’ Deployment Options

××•×¡×›××•×ª ×”×¤×¨×•×™×§×˜
-----------------

Naming Conventions
~~~~~~~~~~~~~~~~~~

- Files: ``snake_case.py``
- Classes: ``PascalCase``
- Functions: ``snake_case()``
- Constants: ``UPPER_CASE``
- Private: ``_leading_underscore()``

Code Style
~~~~~~~~~~

- Follow PEP 8
- Use type hints
- Docstrings: Google style
- Max line length: 100
- Use Black for formatting

Structure
~~~~~~~~~

::

   handlers/        # Telegram handlers
   services/        # Business logic
   database/        # Database models & managers
   webapp/          # Flask web app
   tests/          # All tests
   docs/           # Documentation

×“×•×’×××•×ª ×œ×©×™× ×•×™×™× × ×¤×•×¦×™×
-------------------------

×”×•×¡×¤×ª ×¤×§×•×“×” ×—×“×©×” ×œ×‘×•×˜
~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: python

   # 1. handlers/my_handler.py
   async def my_command(update, context):
       await update.message.reply_text("Hello!")
   
   # 2. main.py
   from handlers.my_handler import my_command
   app.add_handler(CommandHandler("mycommand", my_command))
   
   # 3. tests/test_my_handler.py
   @pytest.mark.asyncio
   async def test_my_command():
       # test implementation

×”×•×¡×¤×ª endpoint ×œ-WebApp
~~~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: python

   # webapp/app.py
   @app.route('/my-endpoint')
   @login_required
   def my_endpoint():
       return render_template('my_template.html')

Checklist ×œ×¤× ×™ PR
------------------

- [ ] ×”×§×•×“ ×¢×•×‘×¨ ``pytest``
- [ ] ×”×§×•×“ ×¢×•×‘×¨ ``black --check .``
- [ ] ×”×§×•×“ ×¢×•×‘×¨ ``mypy .``
- [ ] Coverage > 80%
- [ ] ×¢×“×›× ×ª×™ docstrings
- [ ] ×¢×“×›× ×ª×™ ``CHANGELOG.md``
- [ ] ×‘×“×§×ª×™ ×©-CI ×¢×•×‘×¨
- [ ] ×‘×™×¦×¢×ª×™ self-review
- [ ] ×ª×™×¢×“×ª×™ breaking changes (×× ×™×©)
```

---

## ğŸ“Š ×¡×™×›×•× ×¢×“×™×¤×•×™×•×ª

| ×¢×“×™×¤×•×ª | ××¡××š | ×–××Ÿ ××©×•×¢×¨ | ×”×©×¤×¢×” |
|---------|------|-----------|--------|
| ğŸ”´ ×’×‘×•×”×” | Contributing Guide | 4 ×©×¢×•×ª | â­â­â­â­â­ |
| ğŸ”´ ×’×‘×•×”×” | Architecture | 6 ×©×¢×•×ª | â­â­â­â­â­ |
| ğŸ”´ ×’×‘×•×”×” | Testing Guide | 3 ×©×¢×•×ª | â­â­â­â­â­ |
| ğŸ”´ ×’×‘×•×”×” | WebApp API Reference | 4 ×©×¢×•×ª | â­â­â­â­ |
| ğŸ”´ ×’×‘×•×”×” | Environment Variables | 2 ×©×¢×•×ª | â­â­â­â­ |
| ğŸŸ¡ ×‘×™× ×•× ×™×ª | Troubleshooting | 3 ×©×¢×•×ª | â­â­â­â­ |
| ğŸŸ¡ ×‘×™× ×•× ×™×ª | Development Workflow | 3 ×©×¢×•×ª | â­â­â­ |
| ğŸŸ¡ ×‘×™× ×•× ×™×ª | Security Guide | 4 ×©×¢×•×ª | â­â­â­â­ |
| ğŸŸ¡ ×‘×™× ×•× ×™×ª | Performance Guide | 3 ×©×¢×•×ª | â­â­â­ |
| ğŸŸ¡ ×‘×™× ×•× ×™×ª | Migration Guide | 2 ×©×¢×•×ª | â­â­ |
| ğŸŸ¢ × ××•×›×” | FAQ | 2 ×©×¢×•×ª | â­â­ |
| ğŸŸ¢ × ××•×›×” | Code of Conduct | 1 ×©×¢×” | â­â­ |
| ğŸŸ¢ × ××•×›×” | Changelog | 1 ×©×¢×” | â­â­ |
| ğŸŸ¢ × ××•×›×” | Roadmap | 2 ×©×¢×•×ª | â­â­ |
| ğŸŸ¢ × ××•×›×” | AI Developer Guide | 3 ×©×¢×•×ª | â­â­â­â­ |

**×¡×”"×› ×–××Ÿ ××©×•×¢×¨:** ~45 ×©×¢×•×ª

**×”××œ×¦×”:** ×”×ª×—×œ ××”××¡××›×™× ×‘×¢×“×™×¤×•×ª ×’×‘×•×”×”, ×”× ×™×ª× ×• ××ª ×”×¢×¨×š ×”×’×“×•×œ ×‘×™×•×ª×¨ ××™×“.

---

## ğŸš€ ×¦×¢×“×™× ×”×‘××™×

1. **×ª×¢×“×•×£:** ×§×‘×¢ ××™×œ×• ××¡××›×™× ×”×›×™ ×§×¨×™×˜×™×™× ×œ×¦×¨×›×™× ×©×œ×š
2. **×”×§×¦××”:** ×”×§×¦×” ×–××Ÿ ×•××©××‘×™× ×œ×™×¦×™×¨×ª ×”××¡××›×™×
3. **×™×¦×™×¨×”:** ×¦×•×¨ ××ª ×”××¡××›×™× ×‘×”×“×¨×’×” (××¤×©×¨ ×œ×”×ª×—×™×œ ×¢× ×’×¨×¡××•×ª ×‘×¡×™×¡×™×•×ª)
4. **×¡×§×™×¨×”:** ×‘×§×© feedback ×××¤×ª×—×™× ×•××©×ª××©×™ AI
5. **×©×™×¤×•×¨:** ×¢×“×›×Ÿ ×•×©×¤×¨ ××ª ×”××¡××›×™× ×‘×”×ª×× ×œ×¦×•×¨×š
6. **×ª×—×–×•×§×”:** ×§×‘×¢ ×ª×”×œ×™×š ×œ×¢×“×›×•×Ÿ ×”×ª×™×¢×•×“ ×¢× ×›×œ ×©×™× ×•×™ ××©××¢×•×ª×™

---

## ğŸ“ ×™×¦×™×¨×ª ×§×©×¨

×©××œ×•×ª ×¢×œ ×”××¡××š ×”×–×” ××• ×¢×œ ×”×ª×™×¢×•×“?
- ×¤×ª×— Issue ×‘-GitHub
- ×¦×•×¨ ×§×©×¨ ×“×¨×š ×”×‘×•×˜
- ×§×‘×•×¦×ª Telegram: [https://t.me/+nh9skKRgTEVkZmJk](https://t.me/+nh9skKRgTEVkZmJk)

---

**ğŸ“ ×¢×“×›×•×Ÿ ××—×¨×•×Ÿ:** 2025-10-10  
**âœï¸ × ×•×¦×¨ ×¢×‘×•×¨:** CodeBot & WebApp  
**ğŸ¯ ××˜×¨×”:** ×©×™×¤×•×¨ ×”×ª×™×¢×•×“ ×œ××¤×ª×—×™× ×•×¡×•×›× ×™ AI
