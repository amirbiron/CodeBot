# Android & AI Style Rules

## ×›×œ×œ×™ ×›×ª×™×‘×”

- ×ª×—×©×•×‘ ×•×ª×¢× ×” ×ª××™×“ ×‘×¢×‘×¨×™×ª
- ×›×ª×•×‘ ×ª××™×“ ×‘×©×¤×” ×¤×©×•×˜×” ×•××•×‘× ×ª ×œ×›×œ ×•×œ× ×‘××™×œ×™× ×’×‘×•×”×•×ª
- ×©××•×¨ ×¢×œ ×˜×•×Ÿ ×¢× ×™×•, ×”×¡×‘×¨ ×›××™×œ×• ××ª×” ××¡×‘×™×¨ ×œ×—×‘×¨ ×˜×•×‘
- ×× ×™×© ×›××” ××¤×©×¨×•×™×•×ª, ×”×¦×’ ×§×•×“× ××ª ×”×¤×ª×¨×•×Ÿ ×”×¤×©×•×˜ ×•×”×××™×Ÿ ×‘×™×•×ª×¨

---

# ×”×™×× ×¢×•×ª ×××—×™×§×•×ª ×§×‘×¦×™× ×‘×˜×¡×˜×™× ×•×‘×¡×§×¨×™×¤×˜×™×

## 1. ×¢×‘×“×• ×¨×§ ×¢×œ ×ª×™×§×™×•×ª ×–×× ×™×•×ª

- ×”×©×ª××©×• ×‘-tmp ×œ×›×œ ×§×œ×˜/×¤×œ×˜ ×‘×˜×¡×˜×™× (pytest: tmp_path)
- ××œ ×ª×›×ª×‘×•/×ª××—×§×• ×‘-root ×©×œ ×”×¤×¨×•×™×§×˜ ××• ×‘×ª×§×™×•×ª ×§×•×“ ××§×•×¨

## 2. ×§×‘×¢×• ENV/×§×•× ×¤×™×’ ×œ××¡×œ×•×œ×™ tmp ×‘×œ×‘×“

- ×•×“××• ×©-ENV ×›××• OUTPUT_DIR/WORKDIR ××•×’×“×¨×™× ×œ×ª×™×§×™×•×ª tmp
- ×‘×“×§×• ×©×”× ×œ× ×¨×™×§×™× ×œ×¤× ×™ ×©×™××•×© (assert ×•×œ× default ×œ-".")

## 3. ××œ ×ª×©×ª××©×• ×‘×’×œ×•×‘×™× ×’×•×¨×¤×™×

- ×”×™×× ×¢×• ×-rm -rf */* ××• ×ª×‘× ×™×•×ª ×›××• build*
- ×”×¢×“×™×¤×• allowlist ×©××™×•×¢×“ ×œ×ª×ª-×ª×™×§×™×” ××—×ª ×¡×¤×¦×™×¤×™×ª

## 4. ×¡×•×¨×’×™ ×‘×˜×™×—×•×ª ×œ×¤× ×™ ××—×™×§×”

- ××œ ×ª××—×§×• ×× ×”× ×ª×™×‘ ×œ× ××ª×—×ª ×œ-allowlist
- ××œ ×ª××—×§×• × ×ª×™×‘×™× ××¡×•×›× ×™×: '/', '.', ×¡×¤×¨×™×™×ª ×”×¤×¨×•×™×§×˜

## ×“×•×’××ª Python ×œ××—×™×§×” ×‘×˜×•×—×”

from pathlib import Path
import shutil

def safe_rmtree(path: Path, allow_under: Path) -> None:
    p = path.resolve()
    base = allow_under.resolve()
    if not str(p).startswith(str(base)) or p in (Path('/'), base.parent, Path.cwd()):
        raise RuntimeError(f"Refusing to delete unsafe path: {p}")
    shutil.rmtree(p)
## 5. ×”×™×× ×¢×• ××©×™× ×•×™ cwd

- ×× ×—×™×™×‘×™×, ×©××¨×•/×©×—×–×¨×• cwd, ×•×”×©×ª××©×• ×‘× ×ª×™×‘×™× ××•×—×œ×˜×™× ×œ××—×™×§×”

## 6. × ×˜×¨×œ×• × ×™×§×•×™ ××¡×•×›×Ÿ ×‘-CI

- ×”×™×× ×¢×• ×-git clean/reset ×¢×œ ×”-workspace
- ×× ×—×™×™×‘×™×, ×¢×‘×“×• ×¢×œ clone ×–×× ×™ ×‘×œ×‘×“

## 7. ×‘××§×‘×™×œ×™×•×ª â€“ ×”×¤×¨×™×“×• ×ª×™×§×™×•×ª ×¢×‘×•×“×”

- ×œ×›×œ ×˜×¡×˜ UUID ×™×™×—×•×“×™ (ex: /tmp/app-test-<uuid>)
- ××• ×¡×“×¨×• ×˜×¡×˜×™× ×©× ×•×’×¢×™× ×œ×§×‘×¦×™× ×œ×¨×™×¦×” ×¡×¨×™××œ×™×ª

## 8. ×‘×“×§×• ×ª×§×œ×•×ª ××•×§×“×

- ×”×¨×—×™×§×• ×”×¨×©××•×ª ×›×ª×™×‘×” ×-src ×‘×ª×§×•×¤×ª ×”×˜×¡×˜×™× (chmod -w)
- ×›×¨×›×• ×§×¨×™××•×ª ××—×™×§×” ×‘-wrapper ×‘×˜×•×— ×›×“×™ ×œ×”×¨×™× ×—×¨×™×’×” ××•×§×“×

## ×‘×“×™×§×ª ×§×•×“ ×œ××™×ª×•×¨ ××—×™×§×•×ª ×œ× ×‘×˜×•×—×•×ª

rg -n "(shutil.rmtree|os.remove|Path.unlink|rm -rf|rimraf)" -S
## ×©×—×–×•×¨ ×œ××—×¨ ××—×™×§×” ×‘×˜×¢×•×ª

- ××œ ×ª×‘×¦×¢×• merge/PR ×›×“×™ ×œ× ×œ×“×¨×•×¡ ×”×™×¡×˜×•×¨×™×”
- ×‘×¦×¢×• git restore/git checkout ×œ×§×‘×¦×™× ××• git revert ×œ×§×•××™×˜×™×
- ×× ××™×Ÿ ×”×™×¡×˜×•×¨×™×” ××§×•××™×ª: ×©×—×–×¨×• ×-CI artifacts/×¢× ×£ ×’×™×‘×•×™/××›×•× ×” ××—×¨×ª

---

# ×§×™×©×•×¨ ×œ×ª×™×¢×•×“ ×•×”×§×©×¨

- ×§×¨××• ×•×”×¡×ª××›×• ×¢×œ ×”×ª×™×¢×•×“: [CodeBot â€“ Project Docs](https://amirbiron.github.io/CodeBot/)
- ×§×•×‘×¥ ×–×” ×”×•× ××“×™× ×™×•×ª ××—×™×™×‘×ª ×œ×¦×•×•×ª; ×™×© ×œ×”×¤× ×•×ª ××œ×™×• ×‘-PRs ×•×‘×ª×™×¢×•×“.

# ×›×œ×œ×™ ×©×™××•×© ×‘-AI/CodeBot

- ×›×œ ×©×™× ×•×™ ×©××•×¦×¢ ×¢×´×™ AI ×¢×•×‘×¨ code review ×× ×•×©×™ ×œ×¤× ×™ merge.
- ××™×Ÿ ×œ×”×–×™×Ÿ ×¡×•×“×•×ª, ××¤×ª×—×•×ª ××• PII ×œ×¤×¨×•××¤×˜×™× ××• ×§×‘×¦×™ ×”×§×©×¨.
- ×¤×§×•×“×•×ª ×©××•×¨×¦×•×ª ××•×˜×•××˜×™×ª: ×œ×œ× sudo, ×œ× ××™× ×˜×¨××§×˜×™×‘×™×•×ª, ×•×¨×§ ×‘×ª×™×§×™×•×ª tmp.
- ×ª×¢×“×• ×‘-PR ×”×—×œ×˜×•×ª ××•×˜×•××¦×™×”: ××§×•×¨ ×”×”×¦×¢×”, ×©×™×§×•×œ×™× ×•×‘×“×™×§×•×ª ×©×‘×•×¦×¢×•.

# Android/Kotlin/Compose

- Kotlin: ×”×¢×“×™×¤×• val ×¢×œ var, ××™-×©×™× ×•×™, data/sealed classes, Null-safety ×‘×¨×•×¨×”.
- Concurrency: Coroutines ×¢× Structured Concurrency, ×©×™××•×© ×‘-viewModelScope/CoroutineScope × ×›×•×Ÿ.
- ×–×¨×™××•×ª × ×ª×•× ×™×: ×”×¢×“×™×¤×• Flow, ××™×¤×•×™ ×‘-Repository, Dispatchers ××ª××™××™× (IO/Default).
- ××¨×›×™×˜×§×˜×•×¨×”: MVVM, Single Source of Truth, Repository/UseCases, DI ×¢× Hilt.
- Compose: State hoisting, remember/derivedStateOf, ×”×™×× ×¢×•×ª ×-side effects ×‘×ª×•×š Composables, ×©×™××•×© ×‘-LaunchedEffect/DisposableEffect, ×‘×“×™×§×•×ª ×¢× compose-ui-test.

# Commit/PR

- Conventional Commits (feat/fix/chore/docs/refactor/test/build).
- ×œ×¤× ×™ merge: ×ª×™××•×¨ ×‘×¨×•×¨, ×ª×•×›× ×™×ª ×‘×“×™×§×•×ª, ×¡×™×›×•× ×™ Rollback, ×¢×“×›×•×Ÿ docs.
- UI: ×¦×¨×¤×• ×¦×™×œ×•×/×•×™×“××• ×ª×•×¦××•×ª ×× ×¨×œ×•×•× ×˜×™.

# CI Gates

- ×—×•×‘×ª ××¢×‘×¨: ./gradlew test detekt ktlintCheck ×™×¨×•×§.
- ××™×Ÿ ×œ×”×¨×™×¥ git clean/reset ×¢×œ ×”-workspace; ×¢×‘×•×“×” ×¨×§ ×¢×œ ×ª×™×§×™×•×ª ×–×× ×™×•×ª.
- ×˜×¡×˜×™× ×©× ×•×’×¢×™× ×œ×§×‘×¦×™× ×™×¨×•×¦×• ×‘×¡×‘×™×‘×” ××‘×•×“×“×ª ×œ×›×œ ×˜×¡×˜.

# ×¡×•×“×•×ª ×•×œ×•×’×™×

- ××™×Ÿ ×œ×©××•×¨ ×¡×•×“×•×ª ×‘×§×•×“ ××• ×‘×œ×•×’×™×; ×©×™××•×© ×‘-ENV/Secret Manager.
- ××œ ×ª×¨×©××• PII; ×‘×¦×¢×• ×”×©×—×¨×” (redaction) ×œ×¢×¨×›×™× ×¨×’×™×©×™× ×‘×œ×•×’×™×.

# ××¢×˜×¤×ª Bash ×œ××—×™×§×” ×‘×˜×•×—×”

```bash
set -euo pipefail
IFS=$'\n\t'
safe_rmrf() {
  local target="${1:-}"; local allow_under="${2:-}"
  [[ -z "$target" || -z "$allow_under" ]] && { echo "empty path"; exit 1; }
  local rp_target rp_base
  rp_target="$(readlink -f -- "$target")"
  rp_base="$(readlink -f -- "$allow_under")"
  [[ "$rp_target" == "/" || "$rp_target" == "$HOME" || "$rp_target" == "$PWD" ]] && { echo "unsafe"; exit 1; }
  [[ "$rp_target" != "$rp_base"/* ]] && { echo "outside allowlist"; exit 1; }
  rm -rf -- "$rp_target"
}
```

# Docs/RTD
- :noindex: ×œ×¢××•×“×™ ×¡×§×™×¨×” ×—×•×¤×¤×™× (api, database, handlers, services, configuration).
- autodoc_mock_imports: cairosvg, aiohttp, textstat, langdetect, pytest, search_engine, code_processor, integrations.
- fail_on_warning: true ×—×•×‘×”; ××™×Ÿ ×œ×”×›× ×™×¡ imports ×›×‘×“×™×/×§×•×“ ×¨×™×¦×” ×‘×˜×•×¤-×œ×‘×œ.
- examples.rst ××•×—×¨×’ ××œ× ×× × ×•×¡×£ ×œ-toctree.

# CI/Required checks
- ×œ×©××•×¨ ×©××•×ª ×¡×˜×˜×•×¡×™× ×‘×“×™×•×§: â€œğŸ” Code Quality & Securityâ€, â€œğŸ§ª Unit Tests (3.11)â€, â€œğŸ§ª Unit Tests (3.12)â€.
- ×œ×“×•×•×— ×’× legacy context ×‘××™×“×ª ×”×¦×•×¨×š; ××™×Ÿ ×œ×©× ×•×ª ×©××•×ª jobs ×”× ×“×¨×©×™×.

# Telegram Bot
- ×ª××™×“ ×œ×”×©×ª××© ×‘-wrapper ×‘×˜×•×— ×œ-edit_message_text ×©××ª×¢×œ× ×-â€œMessage is not modifiedâ€.
- ×œ×§×¨×•× await query.answer() ×œ×¤× ×™ ×›×œ ×¢×¨×™×›×”; ×œ× ×œ×¢×¨×•×š ×× ××™×Ÿ ×©×™× ×•×™ ×‘×ª×•×›×Ÿ/markup.

# GitHub â€œğŸ“¥ ×”×•×¨×“ ×§×•×‘×¥ ××¨×™×¤×•â€
- ×‘×›× ×™×¡×”: browse_action=download, ×œ××¤×¡ multi_mode/safe_delete.
- ×‘××¦×‘ ×”×•×¨×“×” ×œ× ×œ×”×¦×™×’ ×›×¤×ª×•×¨×™ ××—×™×§×”.

# ×‘×˜×™×—×•×ª ×§×‘×¦×™×
- ××—×™×§×•×ª/× ×™×§×•×™×™× ×¨×§ ×ª×—×ª /tmp; ××™×Ÿ rm -rf ××—×•×¥ ×œ-allowlist; ×œ×œ× sudo.

# PRs
- ×©××•×ª ×¢× ×¤×™× fix/..., chore/...; ×ª×™××•×¨ PR ×‘-HTML ×§×¦×¨ (××” ×”×©×ª× ×”/×‘×“×™×§×•×ª).
- ×× ××©× ×™× ×¡×˜×˜×•×¡/×©× job â€“ ×œ×¢×“×›×Ÿ Branch protection.
