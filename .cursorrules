# Android & AI Style Rules

## ×›×œ×œ×™ ×›×ª×™×‘×”

- ×ª×—×©×•×‘ ×•×ª×¢× ×” ×ª××™×“ ×‘×¢×‘×¨×™×ª
- ×›×ª×•×‘ ×ª××™×“ ×‘×©×¤×” ×¤×©×•×˜×” ×•××•×‘× ×ª ×œ×›×œ ×•×œ× ×‘××™×œ×™× ×’×‘×•×”×•×ª
- ×©××•×¨ ×¢×œ ×˜×•×Ÿ ×¢× ×™×•, ×”×¡×‘×¨ ×›××™×œ×• ××ª×” ××¡×‘×™×¨ ×œ×—×‘×¨ ×˜×•×‘
- ×× ×™×© ×›××” ××¤×©×¨×•×™×•×ª, ×”×¦×’ ×§×•×“× ××ª ×”×¤×ª×¨×•×Ÿ ×”×¤×©×•×˜ ×•×”×××™×Ÿ ×‘×™×•×ª×¨

---

# ×”×™×× ×¢×•×ª ×××—×™×§×•×ª ×§×‘×¦×™× ×‘×˜×¡×˜×™× ×•×‘×¡×§×¨×™×¤×˜×™×

## 1. ×¢×‘×“×• ×¨×§ ×¢×œ ×ª×™×§×™×•×ª ×–×× ×™×•×ª

- ×”×©×ª××©×• ×‘-tmp ×œ×›×œ ×§×œ×˜/×¤×œ×˜ ×‘×˜×¡×˜×™× (pytest: tmp_path)
- ××œ ×ª×›×ª×‘×•/×ª××—×§×• ×‘-root ×©×œ ×”×¤×¨×•×™×§×˜ ××• ×‘×ª×§×™×•×ª ×§×•×“ ××§×•×¨

## 2. ×§×‘×¢×• ENV/×§×•× ×¤×™×’ ×œ××¡×œ×•×œ×™ tmp ×‘×œ×‘×“

- ×•×“××• ×©-ENV ×›××• OUTPUT_DIR/WORKDIR ××•×’×“×¨×™× ×œ×ª×™×§×™×•×ª tmp
- ×‘×“×§×• ×©×”× ×œ× ×¨×™×§×™× ×œ×¤× ×™ ×©×™××•×© (assert ×•×œ× default ×œ-".")

## 3. ××œ ×ª×©×ª××©×• ×‘×’×œ×•×‘×™× ×’×•×¨×¤×™×

- ×”×™×× ×¢×• ×-rm -rf */* ××• ×ª×‘× ×™×•×ª ×›××• build*
- ×”×¢×“×™×¤×• allowlist ×©××™×•×¢×“ ×œ×ª×ª-×ª×™×§×™×” ××—×ª ×¡×¤×¦×™×¤×™×ª

## 4. ×¡×•×¨×’×™ ×‘×˜×™×—×•×ª ×œ×¤× ×™ ××—×™×§×”

- ××œ ×ª××—×§×• ×× ×”× ×ª×™×‘ ×œ× ××ª×—×ª ×œ-allowlist
- ××œ ×ª××—×§×• × ×ª×™×‘×™× ××¡×•×›× ×™×: '/', '.', ×¡×¤×¨×™×™×ª ×”×¤×¨×•×™×§×˜

## ×“×•×’××ª Python ×œ××—×™×§×” ×‘×˜×•×—×”

from pathlib import Path
import shutil

def safe_rmtree(path: Path, allow_under: Path) -> None:
    p = path.resolve()
    base = allow_under.resolve()
    if not str(p).startswith(str(base)) or p in (Path('/'), base.parent, Path.cwd()):
        raise RuntimeError(f"Refusing to delete unsafe path: {p}")
    shutil.rmtree(p)
## 5. ×”×™×× ×¢×• ××©×™× ×•×™ cwd

- ×× ×—×™×™×‘×™×, ×©××¨×•/×©×—×–×¨×• cwd, ×•×”×©×ª××©×• ×‘× ×ª×™×‘×™× ××•×—×œ×˜×™× ×œ××—×™×§×”

## 6. × ×˜×¨×œ×• × ×™×§×•×™ ××¡×•×›×Ÿ ×‘-CI

- ×”×™×× ×¢×• ×-git clean/reset ×¢×œ ×”-workspace
- ×× ×—×™×™×‘×™×, ×¢×‘×“×• ×¢×œ clone ×–×× ×™ ×‘×œ×‘×“

## 7. ×‘××§×‘×™×œ×™×•×ª â€“ ×”×¤×¨×™×“×• ×ª×™×§×™×•×ª ×¢×‘×•×“×”

- ×œ×›×œ ×˜×¡×˜ UUID ×™×™×—×•×“×™ (ex: /tmp/app-test-<uuid>)
- ××• ×¡×“×¨×• ×˜×¡×˜×™× ×©× ×•×’×¢×™× ×œ×§×‘×¦×™× ×œ×¨×™×¦×” ×¡×¨×™××œ×™×ª

## 8. ×‘×“×§×• ×ª×§×œ×•×ª ××•×§×“×

- ×”×¨×—×™×§×• ×”×¨×©××•×ª ×›×ª×™×‘×” ×-src ×‘×ª×§×•×¤×ª ×”×˜×¡×˜×™× (chmod -w)
- ×›×¨×›×• ×§×¨×™××•×ª ××—×™×§×” ×‘-wrapper ×‘×˜×•×— ×›×“×™ ×œ×”×¨×™× ×—×¨×™×’×” ××•×§×“×

## ×‘×“×™×§×ª ×§×•×“ ×œ××™×ª×•×¨ ××—×™×§×•×ª ×œ× ×‘×˜×•×—×•×ª

rg -n "(shutil.rmtree|os.remove|Path.unlink|rm -rf|rimraf)" -S
## ×©×—×–×•×¨ ×œ××—×¨ ××—×™×§×” ×‘×˜×¢×•×ª

- ××œ ×ª×‘×¦×¢×• merge/PR ×›×“×™ ×œ× ×œ×“×¨×•×¡ ×”×™×¡×˜×•×¨×™×”
- ×‘×¦×¢×• git restore/git checkout ×œ×§×‘×¦×™× ××• git revert ×œ×§×•××™×˜×™×
- ×× ××™×Ÿ ×”×™×¡×˜×•×¨×™×” ××§×•××™×ª: ×©×—×–×¨×• ×-CI artifacts/×¢× ×£ ×’×™×‘×•×™/××›×•× ×” ××—×¨×ª

---

# ×§×™×©×•×¨ ×œ×ª×™×¢×•×“ ×•×”×§×©×¨

- ×§×¨××• ×•×”×¡×ª××›×• ×¢×œ ×”×ª×™×¢×•×“: [CodeBot â€“ Project Docs](https://amirbiron.github.io/CodeBot/)
- ×§×•×‘×¥ ×–×” ×”×•× ××“×™× ×™×•×ª ××—×™×™×‘×ª ×œ×¦×•×•×ª; ×™×© ×œ×”×¤× ×•×ª ××œ×™×• ×‘-PRs ×•×‘×ª×™×¢×•×“.

# ×›×œ×œ×™ ×©×™××•×© ×‘-AI/CodeBot

- ×›×œ ×©×™× ×•×™ ×©××•×¦×¢ ×¢×´×™ AI ×¢×•×‘×¨ code review ×× ×•×©×™ ×œ×¤× ×™ merge.
- ××™×Ÿ ×œ×”×–×™×Ÿ ×¡×•×“×•×ª, ××¤×ª×—×•×ª ××• PII ×œ×¤×¨×•××¤×˜×™× ××• ×§×‘×¦×™ ×”×§×©×¨.
- ×¤×§×•×“×•×ª ×©××•×¨×¦×•×ª ××•×˜×•××˜×™×ª: ×œ×œ× sudo, ×œ× ××™× ×˜×¨××§×˜×™×‘×™×•×ª, ×•×¨×§ ×‘×ª×™×§×™×•×ª tmp.
- ×ª×¢×“×• ×‘-PR ×”×—×œ×˜×•×ª ××•×˜×•××¦×™×”: ××§×•×¨ ×”×”×¦×¢×”, ×©×™×§×•×œ×™× ×•×‘×“×™×§×•×ª ×©×‘×•×¦×¢×•.

# Android/Kotlin/Compose

- Kotlin: ×”×¢×“×™×¤×• val ×¢×œ var, ××™-×©×™× ×•×™, data/sealed classes, Null-safety ×‘×¨×•×¨×”.
- Concurrency: Coroutines ×¢× Structured Concurrency, ×©×™××•×© ×‘-viewModelScope/CoroutineScope × ×›×•×Ÿ.
- ×–×¨×™××•×ª × ×ª×•× ×™×: ×”×¢×“×™×¤×• Flow, ××™×¤×•×™ ×‘-Repository, Dispatchers ××ª××™××™× (IO/Default).
- ××¨×›×™×˜×§×˜×•×¨×”: MVVM, Single Source of Truth, Repository/UseCases, DI ×¢× Hilt.
- Compose: State hoisting, remember/derivedStateOf, ×”×™×× ×¢×•×ª ×-side effects ×‘×ª×•×š Composables, ×©×™××•×© ×‘-LaunchedEffect/DisposableEffect, ×‘×“×™×§×•×ª ×¢× compose-ui-test.

# Commit/PR

- Conventional Commits (feat/fix/chore/docs/refactor/test/build).
- ×œ×¤× ×™ merge: ×ª×™××•×¨ ×‘×¨×•×¨, ×ª×•×›× ×™×ª ×‘×“×™×§×•×ª, ×¡×™×›×•× ×™ Rollback, ×¢×“×›×•×Ÿ docs.
- UI: ×¦×¨×¤×• ×¦×™×œ×•×/×•×™×“××• ×ª×•×¦××•×ª ×× ×¨×œ×•×•× ×˜×™.

# CI Gates

- ×—×•×‘×ª ××¢×‘×¨: ./gradlew test detekt ktlintCheck ×™×¨×•×§.
- ××™×Ÿ ×œ×”×¨×™×¥ git clean/reset ×¢×œ ×”-workspace; ×¢×‘×•×“×” ×¨×§ ×¢×œ ×ª×™×§×™×•×ª ×–×× ×™×•×ª.
- ×˜×¡×˜×™× ×©× ×•×’×¢×™× ×œ×§×‘×¦×™× ×™×¨×•×¦×• ×‘×¡×‘×™×‘×” ××‘×•×“×“×ª ×œ×›×œ ×˜×¡×˜.

# ×¡×•×“×•×ª ×•×œ×•×’×™×

- ××™×Ÿ ×œ×©××•×¨ ×¡×•×“×•×ª ×‘×§×•×“ ××• ×‘×œ×•×’×™×; ×©×™××•×© ×‘-ENV/Secret Manager.
- ××œ ×ª×¨×©××• PII; ×‘×¦×¢×• ×”×©×—×¨×” (redaction) ×œ×¢×¨×›×™× ×¨×’×™×©×™× ×‘×œ×•×’×™×.

# ××¢×˜×¤×ª Bash ×œ××—×™×§×” ×‘×˜×•×—×”

```bash
set -euo pipefail
IFS=$'\n\t'
safe_rmrf() {
  local target="${1:-}"; local allow_under="${2:-}"
  [[ -z "$target" || -z "$allow_under" ]] && { echo "empty path"; exit 1; }
  local rp_target rp_base
  rp_target="$(readlink -f -- "$target")"
  rp_base="$(readlink -f -- "$allow_under")"
  [[ "$rp_target" == "/" || "$rp_target" == "$HOME" || "$rp_target" == "$PWD" ]] && { echo "unsafe"; exit 1; }
  [[ "$rp_target" != "$rp_base"/* ]] && { echo "outside allowlist"; exit 1; }
  rm -rf -- "$rp_target"
}
```

# Sphinx/RTD (×ª×™×¢×•×“)
- ××™×Ÿ ×œ×”×¨×™×¥ ×§×•×“ ×‘×˜×•×¤Ö¾×œ×‘×œ ×‘×–××Ÿ build (import×™× ×—×™×™×‘×™× ×œ×”×™×•×ª ×‘×˜×•×—×™×).
- RTD × ×—×©×‘ × ×›×©×œ ×¢×œ ××–×”×¨×•×ª (fail_on_warning: true) â€“ ×œ×©××•×¨ 0 warnings.
- ×œ×”×©×ª××© ×‘-:noindex: ×‘×¢××•×“×™ ×¡×§×™×¨×” ×—×•×¤×¤×™×: api, database, handlers, services, configuration.
- ×œ×”×’×“×™×¨ autodoc_mock_imports: cairosvg, aiohttp, textstat, langdetect, pytest, search_engine, code_processor, integrations.
- docs/examples.rst ××•×—×¨×’ ×¢×“ ×©×”×¢××•×“ ×™×ª×•×•×¡×£ ×œ-toctree (×•××– ×œ×”×¡×™×¨ ××”-exclude).

# CI / Required Checks
- ×”Ö¾PR ×—×™×™×‘ ×œ×”×¦×™×’ ×‘×“×™×•×§ ××ª ×”×¡×˜×˜×•×¡×™× ×”×‘××™×:
  - "ğŸ” Code Quality & Security"
  - "ğŸ§ª Unit Tests (3.11)"
  - "ğŸ§ª Unit Tests (3.12)"
- ××™×Ÿ paths-ignore ×¢×œ `.cursorrules` â€“ ×©×™× ×•×™ ×‘×• ××¨×™×¥ CI.
- ×œ×©××•×¨ ×“×™×•×•×— ×¡×˜×˜×•×¡×™× ×’× ×‘×’×¨×¡×ª legacy/plain ×× × ×“×¨×© ×œ××“×™× ×™×•×ª.

# Telegram Bot â€“ ×× ×™×¢×ª "Message is not modified"
- ×›×©× ×¢×¨×›×ª ×¨×§ ×”××§×œ×“×ª: ×œ×”×©×ª××© ×‘-safe_edit_message_reply_markup (××•×ª×• ×˜×™×¤×•×œ ×—×¨×™×’×™×).
- ×ª××™×“ ×œ×§×¨×•× query.answer() ×œ×¤× ×™ ×¢×¨×™×›×”.
- ×œ×¢×˜×•×£ edit_message_text / edit_message_reply_markup ×‘-wrapper ×©××ª×¢×œ× ××”×©×’×™××” ×”×–×• ×‘×œ×‘×“:
- ×œ× ××©×ª×™×§×™× BadRequest ××—×¨×™×; ×¨×§ ×”××§×¨×” "message is not modified" × ×‘×œ×.

    ```python
    import telegram.error

    async def safe_edit(query, text, reply_markup=None, parse_mode=None):
        try:
            await query.edit_message_text(
                text=text,
                reply_markup=reply_markup,
                parse_mode=parse_mode
            )
        except telegram.error.BadRequest as e:
            if "message is not modified" in str(e).lower():
                return
            raise
    ```

# GitHub â€“ "ğŸ“¥ ×”×•×¨×“ ×§×•×‘×¥ ××¨×™×¤×•"
- ×‘×›× ×™×¡×” ×œ×¤×œ×•××•: browse_action=download, ×œ××¤×¡ multi_mode/safe_delete.
- ×‘××¦×‘ ×”×•×¨×“×” ×œ× ××¦×™×’×™× ×›×¤×ª×•×¨×™ ××—×™×§×” ××• ××¦×‘ ××—×™×§×”.
- ×—×–×¨×” ×œ×ª×¤×¨×™×˜ ×‘×œ×‘×“ ××—×–×™×¨×” ××ª ×”××¦×‘ ×œ×¢×¨×™×›×”/××—×™×§×” (×× × ×“×¨×©).

# PR/×ª×™×¢×•×“ ×©×™× ×•×™×™×
- ×©××•×ª ×¢× ×¤×™×: fix/..., chore/..., feat/...
- ×ª×™××•×¨ PR ×§×¦×¨ ×‘Ö¾HTML: What / Why / Tests (×›×•×œ×œ ×œ×™× ×§ ×œÖ¾RTD build/preview ×× ×™×©).
 
# Gists/×§×™×©×•×¨×™× ×—×™×¦×•× ×™×™× ×‘×”× ×—×™×•×ª ××©×ª××©
- ×‘×›×œ ×¤×¢× ×©×”××©×ª××© ××¦×¨×£ Gist/×§×™×©×•×¨ ×§×•×“: ×œ×¢×™×™×Ÿ ×‘×ª×•×›×Ÿ ×œ×¤× ×™ ××™××•×©.
- ×™×© ×œ×™×™×©× ×‘×”×ª×× ×œ×¨×•×— ×”×”×¦×¢×”; ××•×ª×¨ ×œ×¡×˜×•×ª ×‘×¤×¨×˜×™× ×× ×™×© ×©×™×§×•×œ×™ ××‘×˜×—×”/×¤×©×˜×•×ª, ××‘×œ ×œ×¦×™×™×Ÿ ×–××ª.
- ×× ×™×© ×¤×¢×¨: ×œ×”×¦×™×¢ ×”×ª×××” ××• ×œ×©××•×œ ×‘××™×“×ª ×”×¦×•×¨×š.
