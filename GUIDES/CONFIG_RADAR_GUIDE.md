# מדריך למסכי הניהול של מערכת ההתראות

## מסך הגדרות התראות (Alerts Configuration)

### 1. שורת הסטטוס והבדיקה (למעלה)

**כפתור Validate Schema** - הכפתור הלבן שבודק שהקובץ תקין.

**תווית הסטטוס הירוקה** - "הכל תקין לפי הסכמה" 🎉
זה אומר שהשרת (אחרי התקנת PyYAML) הצליח לקרוא את הקובץ, הבין את המספרים, ואישר שהם תקינים. אין יותר שגיאות.

**פרטי Git** - במרכז השורה מופיעים פרטי הגרסה (Commit 7a23bb6) ושעת העדכון האחרון (7:08). זה נותן ביטחון שאתה מסתכל על הגרסה העדכנית ביותר מהקוד.

### 2. הקלפים הגדולים - חוקי היסוד הגלובליים

אלו "חוקי היסוד" של מערכת ההתראות:

**5 חלון זמן (דק')** - הבוט מסתכל אחורה רק 5 דקות. שגיאות שקרו לפני שעה לא רלוונטיות.

**3 min_count (הסף)** - הבוט יתחיל לשלוח התראה רק אם קרו לפחות 3 שגיאות באותן 5 דקות. שגיאה בודדת נחשבת לרעש ונתעלמת ממנה.

**20 Cooldown (צינון)** - אם הבוט שלח התראה, הוא ישתוק למשך 20 דקות לפני שישלח נוספת על אותו נושא (כדי לא להספים אותך).

### 3. טבלת סוגי השגיאות

כאן רואים איך הבוט מסווג תקלות שונות. לכל שורה יש "אישיות" שונה:

#### שורה ראשונה: Config (קונפיגורציה) 🔴

- **חומרה**: Critical (הכי גרוע)
- **מדיניות**: Escalate (להעיר אותך דחוף)
- **Immediate**: מסומן! הבוט מתעלם מהחוק של "3 שגיאות". מספיקה שגיאת קונפיגורציה אחת כדי לשלוח התראה מיד.

#### שורה שניה: Retryable (ניתן לנסות שוב)

- **חומרה**: Anomaly (מוזר, אבל לא קריטי)
- **מדיניות**: Retry (לנסות שוב)
- הבוט לא יעיר אותך על זה אלא אם זה קורה המון פעמים.

#### שורה שלישית: Third Party (ספקים חיצוניים) ☁️

- **תיאור**: כשלי ספק חיצוני או תלות חיצונית (למשל: API של OpenAI לא עונה, GitHub למטה, או Render עושים בעיות)
- **חומרה**: Anomaly (זו לא קריסה של הקוד שלך)
- **מדיניות**: Escalate (להקפיץ למעלה)
- **למה?** אם OpenAI למטה, הבוט שלך כנראה לא שימושי כרגע. אתה כאדמין צריך לדעת מזה מיד (אולי כדי לשים הודעת "אנחנו בתחזוקה").

#### שורה רביעית: Transient (תקלות חולפות) 👻

- **תיאור**: תקלות חולפות שאינן מחייבות פעולה מיידית (ה"גיהוקים" של האינטרנט - Timeout רגעי, ניתוק לשנייה ומחצית)
- **חומרה**: Anomaly
- **מדיניות**: Retry (נסה שוב)
- **החוכמה**: הבוט מבין שאין טעם להעיר אותך. הוא פשוט ינסה לשלוח את הבקשה שוב בעוד דקה, וב-99% מהמקרים זה יצליח.

#### שורה חמישית: User Error (טעות משתמש) 🤦♂️

- **תיאור**: קלט או פעולה לא תקינה מצד המשתמש (מישהו ניסה להעלות קובץ exe כשהבוט מקבל רק טקסט, או שלח פקודה לא קיימת)
- **חומרה**: Warning (אזהרה בלבד, לא שגיאה)
- **מדיניות**: Notify (רק רישום/הודעה)
- **למה?** המערכת עבדה מצוין - היא חסמה פעולה לא חוקית. זה לא צריך להדליק נורה אדומה, אלא רק להירשם בלוג.

### סיכום התמונה הכוללת

הטבלה הזו היא בעצם "נתב שיחות" (Router):

- **קריטי?** 🚨 תעיר את האדמין מיד (config)
- **חיצוני חשוב?** 📢 תודיע לאדמין (third_party)
- **סתם גיהוק?** 🤫 תסתדר לבד (retryable, transient)
- **המשתמש טעה?** 📝 תרשום בצד (user_error)

---

## מסך חתימות השגיאות (Error Signatures)

### מה זה "חתימות"?

המילה "חתימות" (Signatures) מתייחסת ל"תבניות הזיהוי" או הכללים הטכניים שהגדרת בקובץ `error_signatures.yml`. תחשוב על זה כמו על "טביעות אצבע" של תקלות. הבוט לא סתם מנחש שיש שגיאה, הוא מחפש טקסט ספציפי בלוגים.

המספר שאתה רואה (למשל 3 בשורה של config) אומר: **"יש לי 3 דרכים שונות לזהות שמדובר בתקלת קונפיגורציה"**.

#### דוגמה מעשית

למה כנראה מסתתר מאחורי המספר 3:

- **חתימה א'**: אם מופיע הטקסט `FileNotFoundError: config.yml`
- **חתימה ב'**: אם מופיע הטקסט `ValueError: Missing API Key`
- **חתימה ג'**: אם מופיע הטקסט `YamlParseError`

כל אחד משלושת המשפטים האלה יגרום לבוט לצעוק: "זו שגיאת Config!" ולהפעיל את האזעקה הקריטית.

### למה זה טוב לראות את המספר הזה?

זה נותן לך אינדיקציה כמה המערכת שלך "מכוסה":

- אם בקטגוריה third_party היה כתוב 0, היית מבין שהבוט עיוור לתקלות של OpenAI או GitHub
- העובדה שכתוב שם 1 או 2 אומרת שהגדרת לו לחפש משהו (למשל `ConnectionRefused` או `502 Bad Gateway`)

**בקיצור**: חתימה = כלל חיפוש (Regex) בתוך הלוג.

### פירוט הקטגוריות בבנק המטרות

זה הלב הפועם של מערכת זיהוי התקלות! 🫀
בעוד שהמסך הקודם היה תקציר מנהלים, המסך הזה הוא המודיעין הטכני - "בנק המטרות" של הבוט.

#### 💀 Config / Critical (קוביות עליונות)

אלו הדברים שהורגים את השרת. הבוט מחפש:

- **"התהליך סיים בזיכרון נגמר" (OOM)**: מחפש `Out of memory`, `OOMKilled`. אם הוא מוצא - הוא צורח עליך מיד (Immediate)
- **"מערכת הקבצים חרגה"**: מחפש `Too many open files`
- **"אין מקום בדיסק"**: מחפש `No space left`

#### 🔄 Retryable / Anomaly (קוביות אמצעיות)

תקלות מעצבנות אבל לא קריטיות, שבדרך כלל מסתדרות לבד (Retry):

- **"חיבור רשת נותק זמנית"**: מחפש `ECONNRESET` או `socket hang up`
- **"מסד הנתונים נעול"**: מחפש `SQLITE_BUSY` או `deadlock`

#### ☁️ Third Party (צד שלישי)

- **"תעודת TLS/SSL פגה"**: מחפש `certificate verify failed`. זה אומר שהאתר שאתה מנסה לגשת אליו לא מאובטח או שהתעודה שלו פגה.

#### 👻 Transient (חולפות)

- **"תהליך שרת נתקע"**: מחפש `gunicorn.*worker timeout`. הבוט יודע לזהות ולסווג כ"תקלה חולפת" (ולכן הוא לא העיר אותך באמצע הלילה).

### 🛡️ סיווג שגיאות משתמש (`user_error`)

בקבצי הקונפיגורציה של הניטור (`error_signatures.yml`), מוגדרת קטגוריה בשם `user_error`.
מטרת הקטגוריה היא לסנן "רעש" (Noise) מהלוגים ולמנוע התראות שווא למפתחים על תקלות שאינן קשורות ליציבות השרת.

**הגדרה:**
שגיאות אלו נובעות משימוש לא תקין של משתמש הקצה (למשל: כתיבת קוד פייתון שגוי בבוט) ואינן מעידות על באג במערכת או על נפילת שרת.

**מדיניות הטיפול:**
* **רמת דחיפות:** `warning` (אזהרה בלבד).
* **פעולה:** `notify` (רישום בלוג/התראה שקטה, ללא הקפצת צוות DevOps).

**חתימות מזוהות (Signatures):**

1.  **שגיאות Python (קוד משתמש):**
    * **החתימה:** `Traceback \(`
    * **הסבר:** כאשר משתמש מנסה לשמור או להריץ קוד פייתון שמכיל שגיאות סינטקס או לוגיקה, המפרש (Interpreter) זורק `Traceback`. המערכת מזהה זאת כטעות בקלט המשתמש ולא כקריסת יישום.

2.  **שגיאות JavaScript (דפדפן/Frontend):**
    * **החתימה:** `UnhandledPromiseRejection|TypeError:|ReferenceError:`
    * **הסבר:** שגיאות המתרחשות בצד הלקוח (Client-side) או בעת עיבוד קוד JS שהוזן על ידי המשתמש בווב-אפ (למשל, בעת ניסיון לבצע Syntax Highlighting לקוד שבור). אלו שגיאות תצוגה/דפדפן שאינן משפיעות על ה-Backend.

### סיכום

הדף הזה הוא **מילון המונחים של הבוט**. במקום שהוא יגיד לך סתם "יש שגיאה", הוא יודע להגיד: "שמע, זה נראה כמו בעיית רשת (Retryable), אל תתרגש", או "אחי, נגמר הזיכרון (Critical), תתעורר!".

---

## 🎨 מסך הגדרות תמונה (Image Settings)

המסך הזה הוא "לוח הבקרה" של מנוע יצירת התמונות של הבוט (הפיצ'ר שלוקח קוד והופך אותו לתמונה יפה לשיתוף).

### 1. השורה העליונה: העיצוב (Look & Feel) 💅

כאן מוגדר איך התמונות יוצאות כברירת מחדל:

- **14px** - גודל הגופן שבו הקוד נכתב בתמונה
- **1400px** - רוחב התמונה שנוצרת (רחב ואיכותי)
- **monokai** - ערכת הצבעים של הקוד בתמונה
- **dark** - ערכת הנושא (רקע כללי)

### 2. השורה התחתונה: בטיחות וביצועים (Safety Limits) 🛡️

אלו ה"בלמים" של המערכת, שנועדו למנוע מהבוט לקרוס אם מישהו מנסה להפוך טקסט עצום לתמונה:

- **20** - כמות תמונות מקסימלית לפרוסס יחיד. אי אפשר לבקש 100 תמונות במכה
- **300,000** - תקציב תווים (המערכת שומרת על הזיכרון). אם הטקסט כבד מדי, הוא ייחתך
- **150** - Image all - max lines (אם משתמש מבקש את כל הקוד, הבוט יצלם עד 150 שורות)
- **50** - Preview max lines (בתצוגה מקדימה מצלמים רק 50 שורות)

### 3. למטה בצד ימין: פורמטים ורזולוציות 📐

הצ'יפים הקטנים (2000px, 1800px, png) מציגים אילו אפשרויות זמינות למשתמש לבחירה או מה נתמך טכנית.

### סיכום

בניגוד למסכים הקודמים שהיו "טבלאות מידע", המסך הזה מעוצב כמו דשבורד סטטיסטיקות (Big Numbers). זה נותן לאדמין תמונת מצב ויזואלית ומהירה: "האם אנחנו על הגדרות כבדות (2000px) או קלות?".

---

# מתי שימושי להסתכל במסך Config Radar?

## התשובה הקצרה
כשאתה רוצה **לראות במבט אחד** אם יש בעיה בקונפיגורציה של המערכת, **בלי לחפש** בעשרות קבצים או לנחש מה השתבש.

---

## תרחישים מעשיים - מתי תיכנס לשם?

### 🔴 תרחיש 1: "הבוט לא שולח התראות"
אתה עובד כרגיל, יש לך שגיאות בלוגים, אבל **לא מגיעות התראות לטלגרם**.

**במקום לנחש:**
- "האם ה-Cooldown ארוך מדי?"
- "אולי ה-min_count גבוה מדי?"
- "אולי השגיאה לא מוגדרת בחתימות?"

**אתה נכנס ל-Config Radar ורואה:**
- ✅ Cooldown: 20 דקות (אוקיי)
- ✅ min_count: 3 שגיאות (סביר)
- ❌ אבל בטבלת החתימות אין **אף חתימה** שתופסת את השגיאה שיש לך!

**פתרון מיידי:** אתה מבין שצריך להוסיף חתימה חדשה ל-`error_signatures.yml`

---

### 🟡 תרחיש 2: "מקבל יותר מדי התראות"
אתה מוצף בהתראות על כל דבר קטן.

**נכנס ל-Config Radar ורואה:**
- min_count: **1** (זה מסביר הכל! כל שגיאה בודדת שולחת התראה)
- Cooldown: **5 דקות** (קצר מדי, ממש מספים אותך)

**פתרון מיידי:** מעלה את min_count ל-3 ואת ה-Cooldown ל-20, ושומר.

---

### 🔵 תרחיש 3: "אני רוצה לשנות הגדרה, אבל לא זוכר מה הערך הנוכחי"
אתה יודע שאתה רוצה להגדיל את ה-Cooldown, אבל **לא זוכר מה היה שם קודם**.

**במקום:**
- לפתוח את `alerts_config.yml` בעורך
- לחפש את השורה הנכונה
- לשנות ידנית

**אתה:**
- נכנס ל-Config Radar
- רואה בקלף הגדול: **Cooldown: 20**
- מחליט שאתה רוצה 30
- (אם יש עריכה בממשק - משנה שם, אם לא - לפחות אתה יודע מה לשנות)

---

### 🟢 תרחיש 4: "רוצה לוודא שהשינויים שעשיתי בקובץ עלו לשרת"
ערכת את `alerts_config.yml` ביד ועשית push ל-Git.

**כדי לוודא שהשרת אכן קלט את השינויים:**
1. נכנס ל-Config Radar
2. לוחץ על **Validate Schema** (הכפתור הלבן)
3. רואה:
   - ✅ "הכל תקין לפי הסכמה" + Commit 7a23bb6 (הגרסה שזה עתה עשית push)
   - או ❌ "שגיאה בקובץ" (אז אתה יודע שמשהו לא תקין ב-YAML)

---

### 🟣 תרחיש 5: "רוצה להבין למה שגיאה מסוימת סווגה כ-Critical"
קיבלת התראה על שגיאה ששווגה **Critical**, אבל אתה לא בטוח למה.

**נכנס ל-Config Radar ורואה בטבלה:**
- שורת **Config** → חומרה: **Critical**, מדיניות: **Escalate**, **Immediate: V**
- עכשיו אתה מבין: "אה, זו שגיאת קונפיגורציה, לכן היא קריטית"

אפשר גם לעבור למסך **Error Signatures** ולראות **איזה טקסט בדיוק** תפס את השגיאה הזו (למשל: `FileNotFoundError: config.yml`)

---

## סיכום - באיזה מצבים נכנסים ל-Config Radar?

| מצב | מה רואים? | מה עושים? |
|-----|-----------|-----------|
| 🔍 **דיבאג** - "למה אין התראות?" | בודק סף, Cooldown, וחתימות | מתקן את ההגדרות |
| ⚙️ **תחזוקה** - "רוצה לשנות הגדרה" | רואה את הערכים הנוכחיים | מחליט מה לשנות |
| ✅ **ולידציה** - "וידוא שהשינוי עלה" | לוחץ Validate, בודק Commit | שקט נפשי |
| 📊 **סקירה** - "מה המצב הכללי?" | מבט על כל ההגדרות | הבנה מהירה |
| 🧐 **למידה** - "איך המערכת מתנהגת?" | קורא את הכללים והחתימות | הבנת הלוגיקה |

---

## הפואנטה

**Config Radar = לוח הבקרה של מערכת ההתראות שלך**

במקום לחפור בקבצי YAML או לנחש למה משהו לא עובד, אתה רואה **הכל במקום אחד**, בצורה ויזואלית וברורה. זה כמו שיש לך **מחוונים** במכונית - אתה לא צריך לפתוח את המכסה המנוע כדי לדעת אם נגמר הדלק. 🚗⛽
