# ××“×¨×™×š ××™××•×©: ×©×™× ×•×™ ×”×“×’×©×ª ×ª×—×‘×™×¨ ×‘×¢××•×“ ×ª×¦×•×’×ª ×”×§×•×“

> **×¡×˜×˜×•×¡:** ××“×¨×™×š ×œ××™××•×©  
> **×§×©×•×¨ ×œ-PR:** ×©×™× ×•×™ ×”×“×’×©×ª ×ª×—×‘×™×¨ ×‘×§×œ×•×ª ×‘×¢××•×“ ×ª×¦×•×’×ª ×”×§×•×“  
> **×§×‘×¦×™× ×¨×œ×•×•× ×˜×™×™×:** `view_file.html`, `view-codemirror-toggle.js`, `codemirror.local.js`, `theme_parser_service.py`

---

## ×ª×•×›×Ÿ ×¢× ×™×™× ×™×

1. [×¡×§×™×¨×” ×›×œ×œ×™×ª](#×¡×§×™×¨×”-×›×œ×œ×™×ª)
2. [××¨×›×™×˜×§×˜×•×¨×ª ×”××¢×¨×›×ª ×”×§×™×™××ª](#××¨×›×™×˜×§×˜×•×¨×ª-×”××¢×¨×›×ª-×”×§×™×™××ª)
3. [×ª×›× ×•×Ÿ ×”×¤×™×¦'×¨](#×ª×›× ×•×Ÿ-×”×¤×™×¦'×¨)
4. [×©×œ×‘×™ ××™××•×©](#×©×œ×‘×™-××™××•×©)
   - [×©×œ×‘ 0: ×©×™× ×•×™×™× ×‘-codemirror.local.js](#×©×œ×‘-0-×©×™× ×•×™×™×-×‘-codemirrorlocaljs)
   - [×©×œ×‘ 1: ×”×’×“×¨×ª ×¢×¨×›×•×ª ×”×”×“×’×©×”](#×©×œ×‘-1-×”×’×“×¨×ª-×¢×¨×›×•×ª-×”×”×“×’×©×”)
   - [×©×œ×‘ 2: ×™×¦×™×¨×ª ×”××•×“××œ](#×©×œ×‘-2-×™×¦×™×¨×ª-×”××•×“××œ)
   - [×©×œ×‘ 3: ×¡×’× ×•× ×•×ª ×”××•×“××œ](#×©×œ×‘-3-×¡×’× ×•× ×•×ª-×”××•×“××œ)
   - [×©×œ×‘ 4: ×œ×•×’×™×§×ª ×”×—×œ×¤×ª ×¢×¨×›×”](#×©×œ×‘-4-×œ×•×’×™×§×ª-×”×—×œ×¤×ª-×¢×¨×›×”)
   - [×©×œ×‘ 5: ××™× ×˜×’×¨×¦×™×” ×¢× view-codemirror-toggle.js](#×©×œ×‘-5-××™× ×˜×’×¨×¦×™×”-×¢×-view-codemirror-togglejs)
   - [×©×œ×‘ 6: ×¡×“×¨ ×˜×¢×™× ×ª ×”×§×‘×¦×™×](#×©×œ×‘-6-×¡×“×¨-×˜×¢×™× ×ª-×”×§×‘×¦×™×)
5. [××™×¤×•×™ ×¦×‘×¢×™×: Tech Guide Dark](#××™×¤×•×™-×¦×‘×¢×™×-tech-guide-dark)
6. [×¢×¨×›×ª One Dark](#×¢×¨×›×ª-one-dark)
7. [×‘×“×™×§×•×ª](#×‘×“×™×§×•×ª)
8. [× ×¡×¤×—×™×](#× ×¡×¤×—×™×)

---

## ×¡×§×™×¨×” ×›×œ×œ×™×ª

### ×”×¨×¢×™×•×Ÿ

×”×•×¡×¤×ª ×›×¤×ª×•×¨ ×‘×¢××•×“ ×ª×¦×•×’×ª ×”×§×•×‘×¥ (`view_file.html`) ×©×™××¤×©×¨ ×œ××©×ª××© ×œ×”×—×œ×™×£ ×‘×™×Ÿ ×©×ª×™ ×¢×¨×›×•×ª ×”×“×’×©×ª ×ª×—×‘×™×¨:

1. **Tech Guide Dark** - ×¢×¨×›×” ××•×ª×××ª ××™×©×™×ª ×œ×¤×™ ×”-JSON ×”××¦×•×¨×£ ×‘-PR
2. **One Dark** - ×¢×¨×›×ª ×‘×¨×™×¨×ª ×”××—×“×œ ×©×œ CodeMirror (××•×‘× ×™×ª)

### ××™×§×•× ×”×›×¤×ª×•×¨

×”×›×¤×ª×•×¨ ×™×•×¤×™×¢ ×œ×™×“ ×›×¤×ª×•×¨ "××ª×§×“× / ×‘×¡×™×¡×™" ×”×§×™×™×:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“„ ×§×•×“ ××§×•×¨                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ âš¡ ××ª×§×“×    â”‚  â”‚ ğŸ¨ ×¢×¨×›×”    â”‚  â”‚ â›¶ ××¡×š ××œ×   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ××¨×›×™×˜×§×˜×•×¨×ª ×”××¢×¨×›×ª ×”×§×™×™××ª

### ×§×‘×¦×™× ××¨×›×–×™×™×

| ×§×•×‘×¥ | ×ª×¤×§×™×“ |
|------|-------|
| `webapp/templates/view_file.html` | ×ª×‘× ×™×ª ×¢××•×“ ×ª×¦×•×’×ª ×”×§×•×“ |
| `webapp/static/js/view-codemirror-toggle.js` | ×œ×•×’×™×§×ª ××¢×‘×¨ ×‘×™×Ÿ ×ª×¦×•×’×” ×‘×¡×™×¡×™×ª ×œ××ª×§×“××ª |
| `webapp/static/js/codemirror.local.js` | ×‘×× ×“×œ CodeMirror ×”×›×•×œ×œ ×¢×¨×›×ª One Dark |
| `services/theme_parser_service.py` | ××™×¤×•×™ VS Code ×œ-CSS Variables |
| `docs/webapp/custom_themes_guide.rst` | ××“×¨×™×š ×¢×¨×›×•×ª ××•×ª×××•×ª |

### ×–×¨×™××ª ×”×“×’×©×ª ×”×ª×—×‘×™×¨ ×”× ×•×›×—×™×ª

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   view_file.html    â”‚
â”‚   (Jinja Template)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   view-codemirror-toggle.js                      â”‚
â”‚   - ××–×”×” ××ª data-theme ××”-HTML                   â”‚
â”‚   - ×§×•×¨× ×œ-resolveEffectiveThemeForEditorParity()â”‚
â”‚   - ××—×œ×™×˜: custom â†’ CSS classes, ××—×¨×ª â†’ oneDark  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   codemirror.local.js                            â”‚
â”‚   - getSyntaxHighlighter() - dynamic/class       â”‚
â”‚   - oneDark - ×¢×¨×›×” ××•×‘× ×™×ª                        â”‚
â”‚   - HighlightStyle.define() - ×™×¦×™×¨×ª ×¢×¨×›×” ×“×™× ××™×ª â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ×”×‘×“×œ ×—×©×•×‘: Editor Theme vs Syntax Highlighting

> âš ï¸ **×—×©×•×‘ ×œ×”×‘×™×Ÿ:** ×‘-CodeMirror 6 ×™×© ×”×¤×¨×“×” ×‘×™×Ÿ ×©× ×™ ×¡×•×’×™ ×¢×¨×›×•×ª:

| ×¡×•×’ | ×ª×™××•×¨ | Compartment |
|-----|-------|-------------|
| **Editor Theme** | ×¦×‘×¢×™ ×¨×§×¢, ×’××˜×¨, ×‘×—×™×¨×”, ×¤×•× ×˜, ×§×•×•×™ ×”×¤×¨×“×” | `themeCompartment` |
| **Syntax Highlighting** | ×¦×‘×¢×™ ×˜×•×§× ×™× (keywords, strings, comments) | `syntaxCompartment` (×—×“×©) |

×¢×¨×›×ª `oneDark` ×”××•×‘× ×™×ª ×›×•×œ×œ×ª **××ª ×©× ×™×”×** ×™×—×“. ×›×©×× ×—× ×• ×¨×•×¦×™× ×œ×”×—×œ×™×£ ×¨×§ ××ª ×”×“×’×©×ª ×”×ª×—×‘×™×¨, ×× ×—× ×• ×¦×¨×™×›×™× **×©× ×™ compartments × ×¤×¨×“×™×**.

### ×”×¤×•× ×§×¦×™×•×ª ×”×§×™×™××•×ª ×”×¨×œ×•×•× ×˜×™×•×ª

**`view-codemirror-toggle.js`:**
```javascript
function resolveEffectiveThemeForEditorParity() {
  // ××—×–×™×¨ 'custom' ×× data-theme="custom"
  // ××—×¨×ª ××—×–×™×¨ 'dark' (×©××¤×¢×™×œ oneDark)
  const htmlTheme = document.documentElement.getAttribute('data-theme');
  if (htmlTheme === 'custom') return 'custom';
  if (['dark', 'dim', 'nebula'].includes(htmlTheme)) return 'dark';
  return 'dark';
}
```

**`codemirror.local.js`:**
```javascript
function createDynamicHighlightStyle(syntaxColors) {
  // ×™×•×¦×¨ HighlightStyle ×××•×‘×™×™×§×˜ ×¦×‘×¢×™×
  const specs = [];
  for (const [tagName, style] of Object.entries(syntaxColors)) {
    // ×××¤×” tagName ×œ-tag ×©×œ CodeMirror
    specs.push({ tag, ...style });
  }
  return HighlightStyle.define(specs);
}

function getSyntaxHighlighter() {
  // ××—×–×™×¨ dynamic highlighter ×× theme=custom
  // ××—×¨×ª classHighlighter
}
```

---

## ×ª×›× ×•×Ÿ ×”×¤×™×¦'×¨

### ××¦×‘×™× ××¤×©×¨×™×™×

| ××¦×‘ | ×ª×™××•×¨ | ××—×¡×•×Ÿ |
|-----|-------|-------|
| `tech-guide-dark` | ×¢×¨×›×ª Tech Guide Dark ×”××•×ª×××ª | `localStorage.ck_syntax_theme` |
| `one-dark` | ×¢×¨×›×ª One Dark ×”××•×‘× ×™×ª | `localStorage.ck_syntax_theme` |

### ×”×ª× ×”×’×•×ª ×‘×¨×™×¨×ª ××—×“×œ

- ×× ××™×Ÿ ×¢×¨×š ×©××•×¨: **One Dark** (×”×¢×¨×›×” ×”×§×™×™××ª)
- ×”×¢×¨×š × ×©××¨ ×‘-`localStorage` ×•××©×•×ª×£ ×œ×›×œ ×¢××•×“×™ ×”×ª×¦×•×’×”
- ×¡× ×›×¨×•×Ÿ ×‘×™×Ÿ ×˜××‘×™× ×“×¨×š `storage` event

### ×¨×¡×¤×•× ×¡×™×‘×™×•×ª

- ×‘××•×‘×™×™×œ: ×”××•×“××œ ×™×•×¦×’ ×›-bottom sheet
- ×‘×“×¡×§×˜×•×¤: ××•×“××œ ×××•×¨×›×– ×¨×’×™×œ

### ×”×¤×¨×“×” ×‘×™×Ÿ UI Theme ×œ-Syntax Theme

> âš ï¸ **×—×©×•×‘:** ×”×¤×™×¦'×¨ ×”×–×” ××—×œ×™×£ **×¨×§** ××ª ×”×“×’×©×ª ×”×ª×—×‘×™×¨ (Syntax Highlighting), ×•×œ× ××ª ×¢×¨×›×ª ×”××ª×¨/×¢×•×¨×š ×”×›×œ×œ×™×ª.

- `data-theme` ×©×œ ×”-HTML = ×¢×¨×›×ª UI (dark/light/custom)
- `ck_syntax_theme` ×‘-localStorage = ×¢×¨×›×ª syntax ×‘×œ×‘×“

×œ× ×œ×¢×¨×‘×‘ ×‘×™×Ÿ ×”×©× ×™×™×!

---

## ×©×œ×‘×™ ××™××•×©

### ×©×œ×‘ 0: ×©×™× ×•×™×™× ×‘-codemirror.local.js

> âš ï¸ **×©×œ×‘ ×§×¨×™×˜×™:** ×™×© ×œ×”×•×¡×™×£ `syntaxCompartment` × ×¤×¨×“ ×›×“×™ ×œ××¤×©×¨ ×”×—×œ×¤×” ×“×™× ××™×ª ×©×œ ×”×“×’×©×ª ×ª×—×‘×™×¨.

**×©×™× ×•×™×™× × ×“×¨×©×™× ×‘×¡×•×£ ×”×‘×× ×“×œ (×œ×¤× ×™ ×”-export):**

```javascript
// === SYNTAX THEME COMPARTMENT ===
// Compartment × ×¤×¨×“ ×œ×”×“×’×©×ª ×ª×—×‘×™×¨ (×××¤×©×¨ ×”×—×œ×¤×” ×“×™× ××™×ª)
const syntaxCompartment = new Compartment();

// ×™×™×¦×•× ×”-compartment ×”×—×“×©
window.CodeMirror6.syntaxCompartment = syntaxCompartment;

// ×¤×•× ×§×¦×™×” ×œ×™×¦×™×¨×ª extensions ×¢× syntax compartment
window.CodeMirror6.createSyntaxExtension = function(highlightStyle) {
  if (!highlightStyle) return syntaxCompartment.of([]);
  return syntaxCompartment.of(syntaxHighlighting(highlightStyle));
};

// ×¤×•× ×§×¦×™×” ×œ×”×—×œ×¤×ª syntax ×‘×–××Ÿ ×¨×™×¦×”
window.CodeMirror6.reconfigureSyntax = function(view, highlightStyle) {
  if (!view || !view.dispatch) return false;
  try {
    const ext = highlightStyle 
      ? syntaxHighlighting(highlightStyle)
      : [];
    view.dispatch({
      effects: syntaxCompartment.reconfigure(ext)
    });
    return true;
  } catch (err) {
    console.error('[CM6] reconfigureSyntax failed:', err);
    return false;
  }
};
```

**×¢×“×›×•×Ÿ ×”-basicSetup ×œ×”×©×ª××© ×‘-syntaxCompartment:**

```javascript
// ×‘××§×•× ×œ×”×•×¡×™×£ syntaxHighlighting ×™×©×™×¨×•×ª ×œ-basicSetup,
// × ×¢×˜×•×£ ××•×ª×• ×‘-compartment
const basicSetup = [
  // ... extensions ×§×™×™××™× ...
  syntaxCompartment.of(syntaxHighlighting(classHighlighter)),
  // ... extensions × ×•×¡×¤×™× ...
];
```

---

### ×©×œ×‘ 1: ×”×’×“×¨×ª ×¢×¨×›×•×ª ×”×”×“×’×©×”

**×§×•×‘×¥ ×—×“×©: `webapp/static/js/syntax-themes.js`**

```javascript
/**
 * Syntax Highlighting Themes for CodeMirror
 * ××’×“×™×¨ ××ª ×¢×¨×›×•×ª ×”×”×“×’×©×” ×”×–××™× ×•×ª ×‘×¢××•×“ ×ª×¦×•×’×ª ×”×§×•×“
 */

const SYNTAX_THEMES = {
  'one-dark': {
    id: 'one-dark',
    name: 'One Dark',
    description: '×¢×¨×›×ª ×‘×¨×™×¨×ª ×”××—×“×œ ×©×œ CodeMirror',
    type: 'builtin', // ××•×‘× ×™×ª ×‘-codemirror.local.js
    preview: {
      background: '#282c34',
      keyword: '#c678dd',
      string: '#98c379',
      comment: '#5c6370',
    }
  },
  'tech-guide-dark': {
    id: 'tech-guide-dark',
    name: 'Tech Guide Dark',
    description: '×¢×¨×›×” ××•×ª×××ª ×¢× ×˜×•× ×™× ×›×—×•×œ×™×',
    type: 'custom',
    preview: {
      background: '#0f0f23',
      keyword: '#c586c0',
      string: '#ce9178',
      comment: '#6a9955',
    },
    // ××™×¤×•×™ ××œ× ×©×œ tokenColors - ×¨××” × ×¡×¤×— ××³
    syntaxColors: null // ×™××•×ª×—×œ ×-TECH_GUIDE_DARK_SYNTAX
  }
};

// ××™×¤×•×™ Tech Guide Dark tokenColors ×œ-CodeMirror tags
// âš ï¸ ×”×¢×¨×”: ××™×Ÿ ×›×¤×™×œ×•×™×•×ª ×©×œ keys! ×›×œ key ××•×¤×™×¢ ×¤×¢× ××—×ª ×‘×œ×‘×“.
const TECH_GUIDE_DARK_SYNTAX = {
  // === Comments ===
  'comment': { color: '#6a9955', fontStyle: 'italic' },
  'docComment': { color: '#6a9955', fontStyle: 'italic' },
  
  // === Keywords ===
  'keyword': { color: '#c586c0' },
  'controlKeyword': { color: '#c586c0' },
  'moduleKeyword': { color: '#c586c0' },
  'definitionKeyword': { color: '#c586c0' },
  
  // === Types and Classes ===
  'typeName': { color: '#4ec9b0' },
  'className': { color: '#4ec9b0' },
  'definition(className)': { color: '#4ec9b0' },
  'namespace': { color: '#4ec9b0' },
  
  // === Strings ===
  'string': { color: '#ce9178' },
  'string2': { color: '#ce9178' },
  
  // === Numbers and Constants ===
  'number': { color: '#b5cea8' },
  'bool': { color: '#b5cea8' },
  'atom': { color: '#b5cea8' },
  'literal': { color: '#b5cea8' },
  
  // === Variables ===
  'variableName': { color: '#9cdcfe' },
  'local(variableName)': { color: '#9cdcfe', fontStyle: 'italic' },
  'definition(variableName)': { color: '#9cdcfe' },
  'self': { color: '#9cdcfe' },
  
  // === Functions ===
  'function(variableName)': { color: '#dcdcaa' },
  'function(definition(variableName))': { color: '#dcdcaa' },
  'standard(function(variableName))': { color: '#dcdcaa' },
  
  // === Operators and Punctuation ===
  'operator': { color: '#d4d4d4' },
  'punctuation': { color: '#d4d4d4' },
  
  // === Properties (×›×•×œ×œ CSS properties ×•-JSON keys) ===
  'propertyName': { color: '#9cdcfe' },
  'definition(propertyName)': { color: '#9cdcfe' },
  
  // === HTML/XML ===
  'tagName': { color: '#569cd6' },
  'attributeName': { color: '#9cdcfe' },
  'attributeValue': { color: '#ce9178' },
  'angleBracket': { color: '#808080' },
  
  // === Regex and Escapes ===
  'regexp': { color: '#d16969' },
  'escape': { color: '#d7ba7d' },
  
  // === Special ===
  'meta': { color: '#c586c0' },
  'invalid': { color: '#f44747', textDecoration: 'underline' },
  
  // === Markdown ===
  'heading': { color: '#0088cc', fontWeight: 'bold' },
  'emphasis': { fontStyle: 'italic' },
  'strong': { color: '#dcdcaa', fontWeight: 'bold' },
  'link': { color: '#0088cc' },
  'url': { color: '#0088cc' },
  'monospace': { color: '#7fdbca' },
  
  // === CSS Units ===
  'unit': { color: '#b5cea8' },
  
  // === JSON Labels ===
  'labelName': { color: '#9cdcfe' },
};

// ××™×ª×—×•×œ syntaxColors
SYNTAX_THEMES['tech-guide-dark'].syntaxColors = TECH_GUIDE_DARK_SYNTAX;

// ×™×™×¦×•×
window.SYNTAX_THEMES = SYNTAX_THEMES;
window.TECH_GUIDE_DARK_SYNTAX = TECH_GUIDE_DARK_SYNTAX;
```

---

### ×©×œ×‘ 2: ×™×¦×™×¨×ª ×”××•×“××œ

**×©×™× ×•×™×™× ×‘-`view_file.html`:**

×”×•×¡×¤×ª ×›×¤×ª×•×¨ ×‘×ª×•×š ×”-`section-header`:

```html
<!-- ×‘×ª×•×š div.section-header, ××—×¨×™ ×›×¤×ª×•×¨ viewModeToggleBtn -->
<button id="syntaxThemeBtn"
        type="button"
        class="btn btn-secondary btn-icon"
        title="×©× ×” ×¢×¨×›×ª ×”×“×’×©×”">
  ğŸ¨ ×¢×¨×›×”
</button>
```

×”×•×¡×¤×ª ×”××•×“××œ ×œ×¤× ×™ ×¡×’×™×¨×ª ×”-`{% endblock content %}`:

```html
<!-- Syntax Theme Picker Modal -->
<div id="syntaxThemeModal" 
     class="syntax-theme-modal" 
     role="dialog" 
     aria-modal="true" 
     aria-labelledby="syntaxThemeModalTitle" 
     hidden>
  <div class="syntax-theme-modal__surface" role="document">
    <div class="syntax-theme-modal__header">
      <h3 id="syntaxThemeModalTitle">ğŸ¨ ×‘×—×¨ ×¢×¨×›×ª ×”×“×’×©×”</h3>
      <button type="button" 
              class="syntax-theme-modal__close" 
              data-syntax-modal-close 
              aria-label="×¡×’×•×¨">âœ•</button>
    </div>
    <div class="syntax-theme-modal__body">
      <p class="syntax-theme-modal__subtitle">
        ×‘×—×¨×• ××ª ×¡×’× ×•×Ÿ ×”×”×“×’×©×” ×”××•×¢×“×£ ×¢×œ×™×›× ×œ×ª×¦×•×’×ª ×”×§×•×“
      </p>
      <div class="syntax-theme-modal__grid" id="syntaxThemeGrid" role="listbox">
        <!-- ×™××•×›×œ×¡ ×“×™× ××™×ª -->
      </div>
    </div>
  </div>
</div>
```

---

### ×©×œ×‘ 3: ×¡×’× ×•× ×•×ª ×”××•×“××œ

**×”×•×¡×¤×” ×œ-`view_file.html` (×‘×ª×•×š `{% block extra_css %}`)**:

```css
/* Syntax Theme Picker Modal */
.syntax-theme-modal {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.6);
  z-index: 10000;
  padding: 1rem;
  opacity: 1;
  transition: opacity 0.15s ease;
}

.syntax-theme-modal[hidden] {
  display: none;
}

.syntax-theme-modal.is-closing {
  opacity: 0;
}

.syntax-theme-modal__surface {
  background: rgba(18, 26, 48, 0.96);
  border: 1px solid rgba(255, 255, 255, 0.12);
  border-radius: 16px;
  width: min(440px, 100%);
  max-height: 90vh;
  padding: 1.25rem;
  display: flex;
  flex-direction: column;
  gap: 1rem;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
  transform: scale(1);
  transition: transform 0.15s ease;
}

.syntax-theme-modal.is-closing .syntax-theme-modal__surface {
  transform: scale(0.95);
}

.syntax-theme-modal__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1rem;
}

.syntax-theme-modal__header h3 {
  margin: 0;
  font-size: 1.25rem;
}

.syntax-theme-modal__close {
  border: none;
  background: transparent;
  color: rgba(255, 255, 255, 0.7);
  font-size: 1.1rem;
  cursor: pointer;
}

.syntax-theme-modal__close:hover,
.syntax-theme-modal__close:focus-visible {
  color: #fff;
}

.syntax-theme-modal__subtitle {
  margin: 0;
  font-size: 0.95rem;
  color: rgba(255, 255, 255, 0.75);
}

.syntax-theme-modal__grid {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  max-height: 50vh;
  overflow-y: auto;
}

/* Theme Card */
.syntax-theme-card {
  display: flex;
  align-items: stretch;
  gap: 1rem;
  padding: 1rem;
  border-radius: 12px;
  border: 2px solid rgba(255, 255, 255, 0.1);
  background: rgba(255, 255, 255, 0.03);
  cursor: pointer;
  transition: all 0.2s ease;
}

.syntax-theme-card:hover {
  border-color: rgba(255, 255, 255, 0.25);
  background: rgba(255, 255, 255, 0.06);
}

.syntax-theme-card:focus-visible {
  outline: 2px solid var(--primary, #569cd6);
  outline-offset: 2px;
}

.syntax-theme-card.is-active {
  border-color: var(--primary, #569cd6);
  background: rgba(86, 156, 214, 0.1);
}

.syntax-theme-card__preview {
  width: 80px;
  height: 60px;
  border-radius: 8px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  font-family: 'Fira Code', monospace;
  font-size: 9px;
  line-height: 1.4;
  padding: 6px;
  /* ×§×•×“ ×ª××™×“ LTR */
  direction: ltr;
  text-align: left;
}

.syntax-theme-card__info {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 0.25rem;
}

.syntax-theme-card__name {
  font-weight: 600;
  font-size: 1rem;
}

.syntax-theme-card__desc {
  font-size: 0.85rem;
  opacity: 0.8;
}

.syntax-theme-card__check {
  align-self: center;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  border: 2px solid rgba(255, 255, 255, 0.3);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}

.syntax-theme-card.is-active .syntax-theme-card__check {
  background: var(--primary, #569cd6);
  border-color: var(--primary, #569cd6);
}

.syntax-theme-card.is-active .syntax-theme-card__check::after {
  content: 'âœ“';
  color: #fff;
  font-size: 14px;
}

@media (max-width: 500px) {
  .syntax-theme-modal {
    align-items: flex-end;
    padding: 0;
  }
  
  .syntax-theme-modal__surface {
    position: relative;
    width: 100%;
    max-height: 70vh;
    border-radius: 16px 16px 0 0;
    transform: translateY(0);
    animation: slideUp 0.25s ease-out;
  }
  
  .syntax-theme-modal.is-closing .syntax-theme-modal__surface {
    transform: translateY(100%);
  }
  
  @keyframes slideUp {
    from { transform: translateY(100%); }
    to { transform: translateY(0); }
  }
}
```

---

### ×©×œ×‘ 4: ×œ×•×’×™×§×ª ×”×—×œ×¤×ª ×¢×¨×›×”

**×§×•×‘×¥ ×—×“×©: `webapp/static/js/syntax-theme-picker.js`**

```javascript
/**
 * Syntax Theme Picker
 * ×× ×”×œ ××ª ×‘×—×™×¨×ª ×¢×¨×›×ª ×”×”×“×’×©×” ×‘×¢××•×“ ×ª×¦×•×’×ª ×”×§×•×“
 * 
 * âš ï¸ ×ª×œ×•×™×•×ª:
 * - syntax-themes.js (window.SYNTAX_THEMES)
 * - codemirror.local.js (window.CodeMirror6)
 */

(function() {
  'use strict';
  
  const STORAGE_KEY = 'ck_syntax_theme';
  const DEFAULT_THEME = 'one-dark';
  const THEME_CHANGED_EVENT = 'ck:syntax-theme-changed';
  
  // State
  let currentTheme = DEFAULT_THEME;
  let modal = null;
  let grid = null;
  let triggerButton = null; // ×œ×©××™×¨×ª focus ×‘×¡×’×™×¨×”
  
  // ========================================
  // Storage & State
  // ========================================
  
  /**
   * ×§×‘×œ×ª ×”×¢×¨×›×” ×”×©××•×¨×”
   */
  function getSavedTheme() {
    try {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved && window.SYNTAX_THEMES && window.SYNTAX_THEMES[saved]) {
        return saved;
      }
    } catch (_) {}
    return DEFAULT_THEME;
  }
  
  /**
   * ×©××™×¨×ª ×”×¢×¨×›×”
   */
  function saveTheme(themeId) {
    try {
      localStorage.setItem(STORAGE_KEY, themeId);
    } catch (_) {}
  }
  
  // ========================================
  // Theme Application
  // ========================================
  
  /**
   * ×”×¤×¢×œ×ª ×¢×¨×›×” ×¢×œ CodeMirror
   */
  function applyTheme(themeId) {
    const theme = window.SYNTAX_THEMES && window.SYNTAX_THEMES[themeId];
    if (!theme) return;
    
    const CM = window.CodeMirror6;
    if (!CM) {
      console.warn('[SyntaxThemePicker] CodeMirror6 not loaded');
      return;
    }
    
    // ×™×¦×™×¨×ª HighlightStyle ××ª××™×
    let highlightStyle = null;
    
    if (theme.type === 'builtin' || theme.id === 'one-dark') {
      // One Dark - ××©×ª××©×™× ×‘-oneDarkHighlightStyle ×”××•×‘× ×”
      highlightStyle = CM.oneDarkHighlightStyle || null;
    } else if (theme.type === 'custom' && theme.syntaxColors) {
      // ×¢×¨×›×” ××•×ª×××ª - ×™×•×¦×¨×™× HighlightStyle ×“×™× ××™
      if (CM.createDynamicHighlightStyle) {
        highlightStyle = CM.createDynamicHighlightStyle(theme.syntaxColors);
      }
    }
    
    // ×”×—×œ×¤×ª ×”-syntax ×‘-view instance ×”×¤×¢×™×œ (×× ×§×™×™×)
    const viewInstance = window.__ck_view_cm_view;
    if (viewInstance && CM.reconfigureSyntax) {
      const success = CM.reconfigureSyntax(viewInstance, highlightStyle);
      if (success) {
        console.log('[SyntaxThemePicker] Applied theme:', themeId);
      }
    }
    
    // ×¢×“×›×•×Ÿ ×›×¤×ª×•×¨
    updateThemeButton();
    
    // ×©×œ×™×—×ª event ×œ×¨×›×™×‘×™× ××—×¨×™× (×›×•×œ×œ ×˜××‘×™× ××—×¨×™×)
    dispatchThemeChangedEvent(themeId);
  }
  
  /**
   * ×©×œ×™×—×ª event ×¢×œ ×©×™× ×•×™ ×¢×¨×›×”
   */
  function dispatchThemeChangedEvent(themeId) {
    try {
      window.dispatchEvent(new CustomEvent(THEME_CHANGED_EVENT, {
        detail: { themeId, theme: window.SYNTAX_THEMES[themeId] }
      }));
    } catch (_) {}
  }
  
  // ========================================
  // UI Rendering
  // ========================================
  
  /**
   * ×™×¦×™×¨×ª ×ª×¦×•×’×” ××§×“×™××” ×œ×¢×¨×›×”
   */
  function createPreview(theme) {
    const preview = theme.preview || {};
    const bg = preview.background || '#1e1e1e';
    const keyword = preview.keyword || '#c678dd';
    const string = preview.string || '#98c379';
    const comment = preview.comment || '#5c6370';
    
    // dir="ltr" ×›×“×™ ×©×”×§×•×“ ×œ× ×™×ª×‘×œ×‘×œ ×‘×××©×§ RTL
    return `
      <div class="syntax-theme-card__preview" dir="ltr" style="background: ${bg};">
        <span style="color: ${keyword}">def</span>
        <span style="color: #d4d4d4"> hello():</span>
        <span style="color: ${comment}">  # hi</span>
        <span style="color: ${string}">  "world"</span>
      </div>
    `;
  }
  
  /**
   * ×¨×™× ×“×•×¨ ×¨×©×™××ª ×”×¢×¨×›×•×ª
   */
  function renderThemes() {
    if (!grid || !window.SYNTAX_THEMES) return;
    
    grid.innerHTML = '';
    
    for (const [id, theme] of Object.entries(window.SYNTAX_THEMES)) {
      const isActive = id === currentTheme;
      
      const card = document.createElement('div');
      card.className = `syntax-theme-card ${isActive ? 'is-active' : ''}`;
      card.dataset.themeId = id;
      card.setAttribute('role', 'option');
      card.setAttribute('tabindex', '0');
      card.setAttribute('aria-selected', isActive ? 'true' : 'false');
      
      card.innerHTML = `
        ${createPreview(theme)}
        <div class="syntax-theme-card__info">
          <div class="syntax-theme-card__name">${theme.name}</div>
          <div class="syntax-theme-card__desc">${theme.description}</div>
        </div>
        <div class="syntax-theme-card__check"></div>
      `;
      
      card.addEventListener('click', () => selectTheme(id));
      card.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          selectTheme(id);
        }
      });
      
      grid.appendChild(card);
    }
  }
  
  /**
   * ×¢×“×›×•×Ÿ ×˜×§×¡×˜ ×›×¤×ª×•×¨ ×”×¢×¨×›×”
   */
  function updateThemeButton() {
    const btn = document.getElementById('syntaxThemeBtn');
    if (!btn) return;
    
    const theme = window.SYNTAX_THEMES && window.SYNTAX_THEMES[currentTheme];
    const name = theme ? theme.name : '×¢×¨×›×”';
    
    btn.innerHTML = `ğŸ¨ ${name}`;
    btn.title = `×¢×¨×›×” × ×•×›×—×™×ª: ${name}`;
  }
  
  // ========================================
  // Theme Selection
  // ========================================
  
  /**
   * ×‘×—×™×¨×ª ×¢×¨×›×”
   */
  function selectTheme(themeId) {
    if (!window.SYNTAX_THEMES || !window.SYNTAX_THEMES[themeId]) return;
    
    currentTheme = themeId;
    saveTheme(themeId);
    renderThemes();
    
    // ×”×¤×¢×œ×ª ×”×¢×¨×›×” ×”×—×“×©×”
    applyTheme(themeId);
    
    // ×¡×’×™×¨×ª ×”××•×“××œ ×¢× ×× ×™××¦×™×”
    closeModalWithAnimation();
  }
  
  // ========================================
  // Modal Management
  // ========================================
  
  /**
   * ×¤×ª×™×—×ª ×”××•×“××œ
   */
  function openModal() {
    if (!modal) return;
    
    // ×©××™×¨×ª ×”××œ×× ×˜ ×©×¤×ª×— ××ª ×”××•×“××œ ×œ×¦×•×¨×š ×”×—×–×¨×ª focus
    triggerButton = document.activeElement;
    
    modal.hidden = false;
    modal.classList.remove('is-closing');
    renderThemes();
    
    // Focus trap - ×”×ª××§×“×•×ª ×¢×œ ×”×›×¨×˜×™×¡ ×”×¤×¢×™×œ
    setTimeout(() => {
      const active = modal.querySelector('.syntax-theme-card.is-active');
      if (active) {
        active.focus();
      } else {
        const firstCard = modal.querySelector('.syntax-theme-card');
        if (firstCard) firstCard.focus();
      }
    }, 50);
  }
  
  /**
   * ×¡×’×™×¨×ª ×”××•×“××œ ××™×™×“×™×ª
   */
  function closeModal() {
    if (!modal) return;
    modal.hidden = true;
    modal.classList.remove('is-closing');
    
    // ×”×—×–×¨×ª focus ×œ×›×¤×ª×•×¨ ×©×¤×ª×— ××ª ×”××•×“××œ
    if (triggerButton && typeof triggerButton.focus === 'function') {
      try { triggerButton.focus(); } catch (_) {}
    }
    triggerButton = null;
  }
  
  /**
   * ×¡×’×™×¨×ª ×”××•×“××œ ×¢× ×× ×™××¦×™×”
   */
  function closeModalWithAnimation() {
    if (!modal) return;
    
    modal.classList.add('is-closing');
    
    // ×”××ª× ×” ×œ×¡×™×•× ×”×× ×™××¦×™×” (150ms)
    setTimeout(() => {
      closeModal();
    }, 150);
  }
  
  /**
   * Focus Trap - ××•× ×¢ ×™×¦×™××” ××”××•×“××œ ×‘×˜××‘
   */
  function handleTabKey(e) {
    if (!modal || modal.hidden) return;
    
    const focusableElements = modal.querySelectorAll(
      'button, [tabindex]:not([tabindex="-1"])'
    );
    
    if (focusableElements.length === 0) return;
    
    const firstElement = focusableElements[0];
    const lastElement = focusableElements[focusableElements.length - 1];
    
    if (e.shiftKey && document.activeElement === firstElement) {
      e.preventDefault();
      lastElement.focus();
    } else if (!e.shiftKey && document.activeElement === lastElement) {
      e.preventDefault();
      firstElement.focus();
    }
  }
  
  // ========================================
  // Cross-Tab Sync
  // ========================================
  
  /**
   * ×¡× ×›×¨×•×Ÿ ×‘×™×Ÿ ×˜××‘×™×
   */
  function handleStorageChange(e) {
    if (e.key !== STORAGE_KEY) return;
    
    const newTheme = e.newValue;
    if (newTheme && window.SYNTAX_THEMES && window.SYNTAX_THEMES[newTheme]) {
      currentTheme = newTheme;
      applyTheme(newTheme);
      renderThemes(); // ×¢×“×›×•×Ÿ UI ×× ×”××•×“××œ ×¤×ª×•×—
    }
  }
  
  // ========================================
  // Initialization
  // ========================================
  
  /**
   * ××ª×—×•×œ
   */
  function init() {
    modal = document.getElementById('syntaxThemeModal');
    grid = document.getElementById('syntaxThemeGrid');
    const btn = document.getElementById('syntaxThemeBtn');
    
    if (!btn) {
      // ×¢××•×“ ×œ×œ× ×›×¤×ª×•×¨ ×¢×¨×›×” - ×œ× ×××ª×—×œ×™×
      return;
    }
    
    // ×˜×¢×™× ×ª ×¢×¨×›×” ×©××•×¨×”
    currentTheme = getSavedTheme();
    
    // ×¢×“×›×•×Ÿ ×›×¤×ª×•×¨
    updateThemeButton();
    
    // ××™×¨×•×¢×™ ×›×¤×ª×•×¨
    btn.addEventListener('click', openModal);
    
    if (modal) {
      // ×¡×’×™×¨×” ×‘×œ×—×™×¦×” ×¢×œ ×¨×§×¢
      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModalWithAnimation();
      });
      
      // ×¡×’×™×¨×” ×‘×›×¤×ª×•×¨ X
      modal.querySelectorAll('[data-syntax-modal-close]').forEach((el) => {
        el.addEventListener('click', closeModalWithAnimation);
      });
      
      // ××§×œ×“×ª: Escape ×œ×¡×’×™×¨×”, Tab ×œ-focus trap
      modal.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          e.preventDefault();
          closeModalWithAnimation();
        } else if (e.key === 'Tab') {
          handleTabKey(e);
        }
      });
    }
    
    // ×¡× ×›×¨×•×Ÿ ×‘×™×Ÿ ×˜××‘×™×
    window.addEventListener('storage', handleStorageChange);
    
    // ×”××–× ×” ×œ×©×™× ×•×™×™ ×¢×¨×›×” ××¨×›×™×‘×™× ××—×¨×™×
    window.addEventListener(THEME_CHANGED_EVENT, (e) => {
      const { themeId } = e.detail || {};
      if (themeId && themeId !== currentTheme) {
        currentTheme = themeId;
        updateThemeButton();
        renderThemes();
      }
    });
  }
  
  // ×™×™×¦×•× ×œ×©×™××•×© ×—×™×¦×•× ×™
  window.syntaxThemePicker = {
    open: openModal,
    close: closeModal,
    getCurrentTheme: () => currentTheme,
    setTheme: selectTheme,
    THEME_CHANGED_EVENT,
  };
  
  // ×”×¨×¦×” ×‘×˜×¢×™× ×ª ×”×“×£
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
```

---

### ×©×œ×‘ 5: ××™× ×˜×’×¨×¦×™×” ×¢× view-codemirror-toggle.js

**×©×™× ×•×™×™× × ×“×¨×©×™× ×‘-`view-codemirror-toggle.js`:**

> âš ï¸ **×—×©×•×‘:** ×©××™×¨×” ×¢×œ ×”×¤×¨×“×” ×‘×™×Ÿ UI theme ×œ-syntax theme!

```javascript
// === ×”×•×¡×¤×” ×‘×¨××© ×”×§×•×‘×¥ ===

/**
 * ×§×‘×œ×ª ×¢×¨×›×ª syntax ×¤×¢×™×œ×” ×-localStorage
 * × ×¤×¨×“ ×-UI theme!
 */
function getActiveSyntaxThemeId() {
  try {
    const saved = localStorage.getItem('ck_syntax_theme');
    if (saved && window.SYNTAX_THEMES && window.SYNTAX_THEMES[saved]) {
      return saved;
    }
  } catch (_) {}
  return 'one-dark';
}

/**
 * ×™×¦×™×¨×ª HighlightStyle ×œ×¤×™ ×¢×¨×›×ª syntax
 */
function getSyntaxHighlightStyle() {
  const syntaxThemeId = getActiveSyntaxThemeId();
  const CM = window.CodeMirror6;
  
  if (!CM) return null;
  
  if (syntaxThemeId === 'one-dark') {
    // One Dark - HighlightStyle ××•×‘× ×”
    return CM.oneDarkHighlightStyle || null;
  }
  
  // ×¢×¨×›×” ××•×ª×××ª
  const theme = window.SYNTAX_THEMES && window.SYNTAX_THEMES[syntaxThemeId];
  if (theme && theme.syntaxColors && CM.createDynamicHighlightStyle) {
    return CM.createDynamicHighlightStyle(theme.syntaxColors);
  }
  
  return null;
}

// === ×©×™× ×•×™ ×‘×¤×•× ×§×¦×™×” resolveEffectiveThemeForEditorParity ===
// âš ï¸ ×¤×•× ×§×¦×™×” ×–×• × ×©××¨×ª ×‘×œ×™ ×©×™× ×•×™! ×”×™× ×¢×•×¡×§×ª ×¨×§ ×‘-UI theme (×¨×§×¢, ×’××˜×¨ ×•×›×•')
// ×•×œ× ×‘-syntax highlighting.

function resolveEffectiveThemeForEditorParity() {
  // ×œ×•×’×™×§×” ×§×™×™××ª - ×œ×œ× ×©×™× ×•×™
  try {
    const htmlTheme = document.documentElement.getAttribute('data-theme') || '';
    const t = String(htmlTheme).toLowerCase();
    if (t === 'custom') return 'custom';
    if (t === 'dark' || t === 'dim' || t === 'nebula') return 'dark';
  } catch (_) {}
  return 'dark';
}

// === ×©×™× ×•×™ ×‘×¤×•× ×§×¦×™×” createReadOnlyCodeMirror ===

async function createReadOnlyCodeMirror({ mountEl, docText, language }) {
  const ok = await ensureCodeMirrorLoaded();
  if (!ok) {
    throw new Error('codemirror_not_available');
  }

  const { EditorState, EditorView, languageCompartment, themeCompartment, syntaxCompartment } = window.CodeMirror6;
  const mods = (window.CodeMirror6 && window.CodeMirror6._mods) || {};
  const viewMod = mods.viewMod;

  // === UI Theme (×¨×§×¢, ×’××˜×¨) ===
  const uiThemeName = resolveEffectiveThemeForEditorParity();
  let themeExt = [];
  try {
    if (window.editorManager && typeof window.editorManager.getTheme === 'function') {
      themeExt = (await window.editorManager.getTheme(uiThemeName)) || [];
    }
  } catch (_) {
    themeExt = [];
  }

  // === Language Support ===
  let langSupport = [];
  try {
    if (window.editorManager && typeof window.editorManager.getLanguageSupport === 'function') {
      langSupport = (await window.editorManager.getLanguageSupport(language)) || [];
    }
  } catch (_) {
    langSupport = [];
  }

  // === Syntax Highlighting (× ×¤×¨×“ ×-UI theme!) ===
  const syntaxHighlightStyle = getSyntaxHighlightStyle();
  let syntaxExt = [];
  if (syntaxHighlightStyle && window.CodeMirror6.syntaxHighlighting) {
    syntaxExt = [window.CodeMirror6.syntaxHighlighting(syntaxHighlightStyle)];
  }

  // === ×‘× ×™×™×ª Extensions ===
  const extensions = [
    ...(window.CodeMirror6.basicSetup || []),
    languageCompartment ? languageCompartment.of(langSupport || []) : (langSupport || []),
    themeCompartment ? themeCompartment.of(themeExt || []) : (themeExt || []),
    // Syntax Highlighting - ×‘-compartment × ×¤×¨×“ ×œ××¤×©×¨ ×”×—×œ×¤×” ×“×™× ××™×ª
    syntaxCompartment ? syntaxCompartment.of(syntaxExt) : syntaxExt,
    EditorView.lineWrapping,
    EditorState.readOnly.of(true),
    (viewMod && viewMod.EditorView && viewMod.EditorView.editable) 
      ? viewMod.EditorView.editable.of(false) 
      : EditorView.editable.of(false),
  ];

  const state = EditorState.create({
    doc: docText || '',
    extensions,
  });

  const view = new EditorView({ state, parent: mountEl });
  
  // ×©××™×¨×ª ×”-view instance ×œ×©×™××•×© ×¢"×™ syntax-theme-picker
  window.__ck_view_cm_view = view;
  
  return view;
}

// === ×”××–× ×” ×œ×©×™× ×•×™×™ syntax theme ===
// ××•×¡×™×¤×™× ×‘×¡×•×£ ×”×§×•×‘×¥, ×‘×ª×•×š ready() ××• ×‘-init

window.addEventListener('ck:syntax-theme-changed', (e) => {
  // ×”-syntax-theme-picker ×›×‘×¨ ××˜×¤×œ ×‘×¢×“×›×•×Ÿ ×”-view
  // ××¤×©×¨ ×œ×”×•×¡×™×£ ×›××Ÿ ×œ×•×’×™×§×” × ×•×¡×¤×ª ×× ×¦×¨×™×š
});
```

---

### ×©×œ×‘ 6: ×¡×“×¨ ×˜×¢×™× ×ª ×”×§×‘×¦×™×

> âš ï¸ **×§×¨×™×˜×™:** ×¡×“×¨ ×”×˜×¢×™× ×” ×—×©×•×‘ ×œ×ª×¤×§×•×“ ×ª×§×™×Ÿ!

**×‘-`view_file.html`, ×‘×ª×•×š `{% block extra_js %}`:**

```html
{% block extra_js %}
<!-- 1. ×”×’×“×¨×•×ª ×¢×¨×›×•×ª (×—×™×™×‘ ×œ×”×™×•×ª ×¨××©×•×Ÿ) -->
<script src="{{ url_for('static', filename='js/syntax-themes.js') }}?v={{ static_version }}" defer></script>

<!-- 2. ×œ×•×’×™×§×ª ×”××•×“××œ (×ª×œ×•×™ ×‘-syntax-themes.js) -->
<script src="{{ url_for('static', filename='js/syntax-theme-picker.js') }}?v={{ static_version }}" defer></script>

<!-- 3. ×œ×•×’×™×§×ª CodeMirror toggle (×ª×œ×•×™ ×‘-syntax-themes.js) -->
<script src="{{ url_for('static', filename='js/view-codemirror-toggle.js') }}?v={{ static_version }}" defer></script>
{% endblock %}
```

**×“×™××’×¨××ª ×ª×œ×•×™×•×ª:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   syntax-themes.js  â”‚  â† ×—×™×™×‘ ×œ×”×™×˜×¢×Ÿ ×¨××©×•×Ÿ
â”‚   (SYNTAX_THEMES)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
     â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ syntax-     â”‚  â”‚ view-codemirror-     â”‚
â”‚ theme-      â”‚  â”‚ toggle.js            â”‚
â”‚ picker.js   â”‚  â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ codemirror.     â”‚
           â”‚ local.js        â”‚  â† × ×˜×¢×Ÿ ×¢"×™ editor-manager
           â”‚ (CodeMirror6)   â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ××™×¤×•×™ ×¦×‘×¢×™×: Tech Guide Dark

### ××™×¤×•×™ VS Code Scopes ×œ-CodeMirror Tags

×˜×‘×œ×ª ×”××™×¤×•×™ ×”××œ××” ××‘×•×¡×¡×ª ×¢×œ ×”-JSON ××”-PR:

| VS Code Scope | CodeMirror Tag | ×¦×‘×¢ | ×¡×’× ×•×Ÿ |
|---------------|----------------|-----|-------|
| `comment` | `comment` | `#6a9955` | italic |
| `keyword` | `keyword` | `#c586c0` | - |
| `keyword.control` | `controlKeyword` | `#c586c0` | - |
| `storage.type` | `definitionKeyword` | `#c586c0` | - |
| `string` | `string` | `#ce9178` | - |
| `constant.numeric` | `number` | `#b5cea8` | - |
| `constant.language.boolean` | `bool` | `#b5cea8` | - |
| `variable` | `variableName` | `#9cdcfe` | - |
| `variable.parameter` | `local(variableName)` | `#9cdcfe` | italic |
| `entity.name.function` | `function(definition(variableName))` | `#dcdcaa` | - |
| `support.function` | `function(variableName)` | `#dcdcaa` | - |
| `entity.name.class` | `definition(className)` | `#4ec9b0` | - |
| `entity.name.type` | `typeName` | `#4ec9b0` | - |
| `keyword.operator` | `operator` | `#d4d4d4` | - |
| `punctuation` | `punctuation` | `#d4d4d4` | - |
| `entity.name.tag` | `tagName` | `#569cd6` | - |
| `entity.other.attribute-name` | `attributeName` | `#9cdcfe` | - |
| `string.regexp` | `regexp` | `#d16969` | - |
| `constant.character.escape` | `escape` | `#d7ba7d` | - |
| `markup.heading` | `heading` | `#0088cc` | bold |
| `markup.bold` | `strong` | `#dcdcaa` | bold |
| `markup.italic` | `emphasis` | - | italic |
| `markup.underline.link` | `link` | `#0088cc` | - |
| `markup.inline.raw` | `monospace` | `#7fdbca` | - |
| `support.type.property-name.css` | `propertyName` | `#9cdcfe` | - |
| `keyword.other.unit.css` | `unit` | `#b5cea8` | - |
| `support.type.property-name.json` | `labelName` | `#9cdcfe` | - |

---

## ×¢×¨×›×ª One Dark

×¢×¨×›×ª One Dark ××•×‘× ×™×ª ×‘-CodeMirror ×•× ××¦××ª ×‘-`codemirror.local.js`:

```javascript
var oneDarkHighlightStyle = HighlightStyle.define([
  { tag: tags.keyword, color: "#c678dd" },
  { tag: tags.operator, color: "#abb2bf" },
  { tag: tags.string, color: "#98c379" },
  { tag: tags.comment, color: "#5c6370", fontStyle: "italic" },
  { tag: tags.function(tags.variableName), color: "#61afef" },
  { tag: tags.number, color: "#d19a66" },
  { tag: tags.typeName, color: "#e5c07b" },
  // ... ×•×¢×•×“
]);
```

××™×Ÿ ×¦×•×¨×š ×œ×××© ××•×ª×” ××—×“×© - ×”×™× ×–××™× ×” ×“×¨×š `window.CodeMirror6.oneDarkHighlightStyle`.

---

## ×‘×“×™×§×•×ª

### ×‘×“×™×§×•×ª ×™×“× ×™×•×ª

1. **×¤×ª×™×—×ª ×”××•×“××œ:**
   - ×œ×—×™×¦×” ×¢×œ ×›×¤×ª×•×¨ "ğŸ¨ ×¢×¨×›×”" ×¤×•×ª×—×ª ××ª ×”××•×“××œ
   - ×”××•×“××œ ××¦×™×’ ××ª ×©×ª×™ ×”×¢×¨×›×•×ª
   - ×”×¢×¨×›×” ×”×¤×¢×™×œ×” ××¡×•×× ×ª
   - Focus × ××¦× ×¢×œ ×”×›×¨×˜×™×¡ ×”×¤×¢×™×œ

2. **×”×—×œ×¤×ª ×¢×¨×›×”:**
   - ×œ×—×™×¦×” ×¢×œ ×¢×¨×›×” ××—×¨×ª ××—×œ×™×¤×” ××•×ª×”
   - **×”×§×•×“ ××ª×¢×“×›×Ÿ ××™×™×“×™×ª** (×œ× ×¦×¨×™×š ×¨×¢× ×•×Ÿ!)
   - ×”×”×¢×“×¤×” × ×©××¨×ª ×‘-localStorage
   - ×”××•×“××œ × ×¡×’×¨ ×¢× ×× ×™××¦×™×”

3. **×©××™×¨×ª ×”×¢×“×¤×”:**
   - ×¨×¢× ×•×Ÿ ×”×¢××•×“ ×©×•××¨ ××ª ×”×¢×¨×›×” ×©× ×‘×—×¨×”
   - ××¢×‘×¨ ×œ×¢××•×“ ×§×•×‘×¥ ××—×¨ ×©×•××¨ ××ª ×”×¢×¨×›×”

4. **×¡× ×›×¨×•×Ÿ ×‘×™×Ÿ ×˜××‘×™×:**
   - ×¤×ª×™×—×ª ×¢××•×“ ×§×•×‘×¥ ×‘×˜××‘ ×—×“×©
   - ×©×™× ×•×™ ×¢×¨×›×” ×‘×˜××‘ ××—×“
   - ×”×˜××‘ ×”×©× ×™ ××ª×¢×“×›×Ÿ ××•×˜×•××˜×™×ª

5. **×¨×¡×¤×•× ×¡×™×‘×™×•×ª:**
   - ×‘××•×‘×™×™×œ ×”××•×“××œ ×¢×•×œ×” ××œ××˜×” (bottom sheet)
   - ×‘×“×¡×§×˜×•×¤ ×”××•×“××œ ×××•×¨×›×–

6. **× ×’×™×©×•×ª:**
   - × ×™×•×•×˜ ×‘××§×œ×“×ª ×¢×•×‘×“ (Tab, Enter, Escape)
   - Focus trap ×¤×¢×™×œ ×‘××•×“××œ
   - Focus ×—×•×–×¨ ×œ×›×¤×ª×•×¨ ×‘×¡×’×™×¨×”

### ×‘×“×™×§×•×ª ××•×˜×•××˜×™×•×ª

```python
# tests/test_syntax_theme_picker.py (×œ×“×•×’××”)

def test_syntax_themes_no_duplicate_keys():
    """×•×™×“×•× ×©××™×Ÿ keys ×›×¤×•×œ×™× ×‘-TECH_GUIDE_DARK_SYNTAX"""
    # ×¤×¨×¡×•×¨ syntax-themes.js
    # ×‘×“×™×§×” ×©×›×œ key ××•×¤×™×¢ ×¤×¢× ××—×ª
    pass

def test_syntax_themes_defined():
    """×•×™×“×•× ×©×›×œ ×”×¢×¨×›×•×ª ××•×’×“×¨×•×ª ×¢× ×”×©×“×•×ª ×”× ×“×¨×©×™×"""
    # ×‘×“×™×§×” ×©×”×§×•×‘×¥ syntax-themes.js ×§×™×™×
    # ×‘×“×™×§×” ×©×™×© ×œ×¤×—×•×ª 2 ×¢×¨×›×•×ª
    # ×‘×“×™×§×” ×©×œ×›×œ ×¢×¨×›×” ×™×© id, name, description, preview
    pass

def test_tech_guide_dark_colors():
    """×•×™×“×•× ×©×”×¦×‘×¢×™× ×©×œ Tech Guide Dark ×ª×•×××™× ×œ-JSON"""
    expected = {
        'comment': '#6a9955',
        'keyword': '#c586c0',
        'string': '#ce9178',
        # ...
    }
    # ×‘×“×™×§×” ×©×”××™×¤×•×™ ×‘-TECH_GUIDE_DARK_SYNTAX ×ª×•××
    pass

def test_codemirror_syntax_compartment_exists():
    """×•×™×“×•× ×©-syntaxCompartment ×§×™×™× ×‘-codemirror.local.js"""
    # ×‘×“×™×§×” ×©×”×§×•×“ ××™×™×¦× syntaxCompartment
    # ×‘×“×™×§×” ×©-reconfigureSyntax ×§×™×™×
    pass
```

---

## × ×¡×¤×—×™×

### × ×¡×¤×— ××³: JSON ××œ× ×©×œ Tech Guide Dark

×”-JSON ×”××œ× ××”-PR × ××¦× ×‘×ª×™××•×¨ ×”-PR. ×œ×”×œ×Ÿ ×”××™×¤×•×™ ×”××¨×›×–×™ ×©×œ `tokenColors`:

```json
{
  "tokenColors": [
    { "scope": "comment", "settings": { "foreground": "#6a9955", "fontStyle": "italic" } },
    { "scope": "keyword", "settings": { "foreground": "#c586c0" } },
    { "scope": "storage", "settings": { "foreground": "#c586c0" } },
    { "scope": "string", "settings": { "foreground": "#ce9178" } },
    { "scope": "constant.numeric", "settings": { "foreground": "#b5cea8" } },
    { "scope": "variable", "settings": { "foreground": "#9cdcfe" } },
    { "scope": "entity.name.function", "settings": { "foreground": "#dcdcaa" } },
    { "scope": "entity.name.class", "settings": { "foreground": "#4ec9b0" } },
    { "scope": "entity.name.type", "settings": { "foreground": "#4ec9b0" } },
    { "scope": "entity.name.tag", "settings": { "foreground": "#569cd6" } },
    { "scope": "entity.other.attribute-name", "settings": { "foreground": "#9cdcfe" } }
  ]
}
```

### × ×¡×¤×— ×‘×³: ×¡×™×›×•× ×§×‘×¦×™× ×œ×©×™× ×•×™/×™×¦×™×¨×”

| ×§×•×‘×¥ | ×¤×¢×•×œ×” | ×ª×™××•×¨ |
|------|-------|-------|
| `webapp/static/js/codemirror.local.js` | ×¢×¨×™×›×” | ×”×•×¡×¤×ª `syntaxCompartment` ×•-`reconfigureSyntax` |
| `webapp/templates/view_file.html` | ×¢×¨×™×›×” | ×”×•×¡×¤×ª ×›×¤×ª×•×¨, ××•×“××œ, CSS, ×•×˜×¢×™× ×ª scripts |
| `webapp/static/js/syntax-themes.js` | ×™×¦×™×¨×” | ×”×’×“×¨×ª ×¢×¨×›×•×ª ×”×”×“×’×©×” |
| `webapp/static/js/syntax-theme-picker.js` | ×™×¦×™×¨×” | ×œ×•×’×™×§×ª ×”××•×“××œ |
| `webapp/static/js/view-codemirror-toggle.js` | ×¢×¨×™×›×” | ××™× ×˜×’×¨×¦×™×” ×¢× syntax themes |

### × ×¡×¤×— ×’×³: ×§×™×©×•×¨×™× ×¨×œ×•×•× ×˜×™×™×

- [××“×¨×™×š ×¢×¨×›×•×ª ××•×ª×××•×ª](../docs/webapp/custom_themes_guide.rst)
- [××™×¤×•×™ VS Code ×œ-CodeMirror](../services/theme_parser_service.py)
- [×ª×™×¢×•×“ CodeMirror HighlightStyle](https://codemirror.net/docs/ref/#language.HighlightStyle)
- [×ª×™×¢×•×“ CodeMirror Compartment](https://codemirror.net/docs/ref/#state.Compartment)

### × ×¡×¤×— ×“×³: ×˜×™×¤×•×œ ×‘×‘×¢×™×•×ª × ×¤×•×¦×•×ª

#### ×”×§×•×“ ×œ× ××ª×¢×“×›×Ÿ ×‘×”×—×œ×¤×ª ×¢×¨×›×”

**×‘×¢×™×”:** ×‘×—×¨×ª×™ ×¢×¨×›×” ×—×“×©×” ××‘×œ ×”×¦×‘×¢×™× ×œ× ×”×©×ª× ×•.

**×¤×ª×¨×•×Ÿ:** ×•×•×“× ×©:
1. `syntaxCompartment` ×§×™×™× ×‘-`codemirror.local.js`
2. `reconfigureSyntax` ××™×•×¦× ×‘-`window.CodeMirror6`
3. `window.__ck_view_cm_view` ×××•×ª×—×œ ×‘×–××Ÿ ×™×¦×™×¨×ª ×”-view

#### ×¢×¨×›×” ×œ× × ×©××¨×ª ×‘×™×Ÿ ×¨×¢× ×•× ×™×

**×‘×¢×™×”:** ××—×¨×™ ×¨×¢× ×•×Ÿ ×”×¢××•×“, ×—×•×–×¨×ª ×¢×¨×›×ª ×‘×¨×™×¨×ª ×”××—×“×œ.

**×¤×ª×¨×•×Ÿ:** ×•×•×“× ×©-`localStorage` ×¢×•×‘×“ (×œ× ×¤×¨×˜×™/incognito) ×•×©×”×§×•×“ ×§×•×¨× ×-`getSavedTheme()` ×‘×–××Ÿ init.

#### ×ª×¦×•×’×” ××§×“×™××” (Preview) ×”×¤×•×›×”

**×‘×¢×™×”:** ×”×§×•×“ ×‘-preview ××•×¦×’ ××™××™×Ÿ ×œ×©×××œ.

**×¤×ª×¨×•×Ÿ:** ×•×•×“× ×©×™×© `dir="ltr"` ×¢×œ ×”-preview element.

---

## ×¡×™×›×•×

×”××“×¨×™×š ×”×–×” ××ª××¨ ××ª ×›×œ ×”×©×œ×‘×™× ×”× ×“×¨×©×™× ×œ××™××•×© ×”×¤×™×¦'×¨ ×©×œ ×©×™× ×•×™ ×”×“×’×©×ª ×ª×—×‘×™×¨ ×‘×¢××•×“ ×ª×¦×•×’×ª ×”×§×•×“.

### × ×§×•×“×•×ª ××¤×ª×—:

1. **×”×¤×¨×“×ª Compartments** - `themeCompartment` ×œ×¢×™×¦×•×‘ ×¢×•×¨×š, `syntaxCompartment` ×œ×”×“×’×©×ª ×ª×—×‘×™×¨
2. **×”×¤×¨×“×ª Concerns** - UI theme (data-theme) × ×¤×¨×“ ×-syntax theme (localStorage)
3. **×ª×§×©×•×¨×ª ×¢"×™ Events** - `ck:syntax-theme-changed` ×œ×¡× ×›×¨×•×Ÿ ×‘×™×Ÿ ×¨×›×™×‘×™×
4. **×¡×“×¨ ×˜×¢×™× ×”** - syntax-themes.js â†’ syntax-theme-picker.js â†’ view-codemirror-toggle.js

### ×”××™××•×© ×›×•×œ×œ:

- **UI** - ×›×¤×ª×•×¨ ×•××•×“××œ ×¢× ×× ×™××¦×™×•×ª ×•× ×’×™×©×•×ª
- **×œ×•×’×™×§×”** - × ×™×”×•×œ ××¦×‘, ×©××™×¨×ª ×”×¢×“×¤×•×ª, ×¡× ×›×¨×•×Ÿ ×‘×™×Ÿ ×˜××‘×™×
- **××™× ×˜×’×¨×¦×™×”** - ×—×™×‘×•×¨ ×œ-CodeMirror ×¢× ×”×—×œ×¤×” ×“×™× ××™×ª
- **×¢×¨×›×•×ª** - Tech Guide Dark ××•×ª×××ª + One Dark ××•×‘× ×™×ª
